server {
    listen 80;
    # 使用"_"作为默认服务器，可以接收所有指向该服务器IP的请求
    server_name _; 

    # 规则一：处理API请求
    # 所有以 /api/ 开头的请求，都转发给后端的app服务
    location /api/ {
        # 'app' 是我们在 docker-compose.yml 中定义的服务名
        # Docker Compose 会自动处理 DNS 解析，让 nginx 找到 app 容器
        proxy_pass http://app:8000; 
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 规则二：处理所有其他请求（前端静态文件）
    # Nginx 会在 /usr/share/nginx/html 目录里寻找匹配的文件
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        # 这个 try_files 是单页应用(SPA)的关键，它确保刷新页面时不会404
        try_files $uri $uri/ /index.html;
    }
}