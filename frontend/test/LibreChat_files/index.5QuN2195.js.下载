const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BookmarkNav.DkcamgBI.js","./vendor.8FatcInx.js","./react-interactions.BEV4E35r.js","./markdown_highlight.YFvJ8PVJ.js","./validation.CeCA-dRw.js","./math-katex.steiuUVT.js","./math-katex.sdXCKFqw.css","./radix-ui.Dt4cad6y.js","./utilities.TtBcTuYn.js","./tanstack-vendor.Cl8DR9al.js","./headlessui.Bn8SoVOz.js","./locales.AhKdRph_.js","./i18n.GAbSpk0b.js","./routing.D1l7nNkt.js","./avatars.h8saQOOS.js","./advanced-inputs.D9QEphBv.js","./animations.BpIZHmx4.js","./virtualization.CHAhSWD6.js","./framer-motion.CcWMOJln.js","./http-client.BfbdTDye.js","./date-utils.j-oxXFG2.js","./forms.B0vqYgxQ.js","./security-ui.CJ15mK8A.js","./heic-converter.Cz_Prg7D.js","./markdown-processing.Do1JsGqG.js","./sandpack.CX5T_CjM.js","./codemirror-core.BMNglnYO.js","./codemirror-state.Pf71Wo5N.js","./codemirror-view.D0dSrMRE.js","./codemirror-language.8WYKRakL.js","./AccountSettings.0d2sBFCE.js","./AgentMarketplaceButton.B8b4jdrn.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{r as n,j as s,bx as a,by as r,bz as o,bA as i,bB as l,bC as c,bD as d,bE as u,bF as m,bG as p,bH as f,bI as h,bJ as g,bK as x,bL as v,bM as b,bN as _,bO as y,bP as j,bQ as w,bR as N,bS as C,bT as k,R as S,bU as E,bV as T,bW as I,bX as R,bY as P,bZ as A,b_ as M,b$ as L,c0 as O,c1 as D,c2 as F,c3 as z,c4 as U,c5 as V,c6 as B,c7 as $,c8 as H,c9 as G,ca as K,cb as W,cc as q,cd as Q,ce as Y,cf as X,cg as Z,ch as J,ci as ee,cj as te,ck as ne,cl as se,cm as ae,cn as re,co as oe,cp as ie,cq as le,cr as ce,cs as de,ct as ue,cu as me,cv as pe,cw as fe,cx as he,cy as ge,ai as xe,cz as ve,cA as be,cB as _e,aq as ye,cC as je,cD as we,cE as Ne,cF as Ce,cG as ke,cH as Se,cI as Ee,cJ as Te,cK as Ie,cL as Re,cM as Pe,cN as Ae,cO as Me,cP as Le,cQ as Oe,aT as De,aU as Fe,cR as ze,cS as Ue,cT as Ve,cU as Be,cV as $e,cW as He,cX as Ge,cY as Ke,cZ as We,c_ as qe,c$ as Qe,d0 as Ye,d1 as Xe,d2 as Ze,d3 as Je,d4 as et,d5 as tt,d6 as nt,d7 as st,d8 as at,d9 as rt,da as ot,db as it,dc as lt,dd as ct,de as dt,df as ut,dg as mt,dh as pt,di as ft,dj as ht,dk as gt,dl as xt,dm as vt,dn as bt,dp as _t,dq as yt,dr as jt,ds as wt,dt as Nt,du as Ct,dv as kt,dw as St,dx as Et,dy as Tt,dz as It,dA as Rt,dB as Pt,dC as At,dD as Mt,dE as Lt,dF as Ot,dG as Dt,dH as Ft,dI as zt,dJ as Ut,dK as Vt,dL as Bt,dM as $t,dN as Ht,dO as Gt,dP as Kt,dQ as Wt,dR as qt,dS as Qt,dT as Yt,dU as Xt,dV as Zt,dW as Jt,dX as en,dY as tn,dZ as nn,d_ as sn,d$ as an,e0 as rn,e1 as on,e2 as ln,e3 as cn,ax as dn,e4 as un,e5 as mn,e6 as pn,e7 as fn,e8 as hn,e9 as gn,ea as xn,eb as vn,ec as bn,ed as _n,ee as yn,ef as jn,eg as wn,eh as Nn,ei as Cn,ej as kn,ek as Sn,el as En,em as Tn,en as In,eo as Rn,ep as Pn,eq as An,er as Mn,es as Ln,et as On,eu as Dn,ev as Fn,ew as zn,ex as Un,ey as Vn,ez as Bn,eA as $n,eB as Hn,eC as Gn,eD as Kn,eE as Wn,eF as qn,eG as Qn,eH as Yn,eI as Xn,eJ as Zn,eK as Jn,eL as es,eM as ts,eN as ns,eO as ss,eP as as,eQ as rs,eR as os,eS as is,eT as ls,eU as cs,eV as ds,eW as us,eX as ms,eY as ps,eZ as fs,e_ as hs,e$ as gs,f0 as xs,f1 as vs,f2 as bs,f3 as _s,f4 as ys,f5 as js,f6 as ws,f7 as Ns,f8 as Cs,f9 as ks,fa as Ss,fb as Es,fc as Ts,fd as Is}from"./vendor.8FatcInx.js";import"./locales.AhKdRph_.js";import{c as Rs,u as Ps,L as As,a as Ms,R as Ls}from"./routing.D1l7nNkt.js";import{I as Os,H as Ds,T as Fs,C as zs,a as Us,$ as Vs,b as Bs,d as $s,e as Hs,f as Gs,g as Ks,h as Ws,i as qs,j as Qs,S as Ys,k as Xs,P as Zs,l as Js,m as ea,n as ta,o as na,R as sa,L as aa,p as ra,q as oa,r as ia,s as la,t as ca,u as da,v as ua,w as ma,x as pa,y as fa,z as ha,A as ga,B as xa,D as va,E as ba,F as _a,G as ya,J as ja,K as wa,M as Na,N as Ca,O as ka,Q as Sa,U as Ea,V as Ta,W as Ia,X as Ra,Y as Pa,Z as Aa,_ as Ma,a0 as La,a1 as Oa,a2 as Da,a3 as Fa,a4 as za,a5 as Ua,a6 as Va,a7 as Ba,a8 as $a,a9 as Ha,aa as Ga,ab as Ka,ac as Wa,ad as qa,ae as Qa,af as Ya,ag as Xa,ah as Za,ai as Ja}from"./radix-ui.Dt4cad6y.js";import{u as er,F as tr,b as nr,h as sr,y as ar,D as rr,H as or}from"./react-interactions.BEV4E35r.js";import{f as ir,u as lr,g as cr,b as dr,c as ur,d as mr,h as pr,i as fr,j as hr,k as gr,Q as xr,l as vr,m as br,R as _r}from"./tanstack-vendor.Cl8DR9al.js";import{c as yr,p as jr}from"./avatars.h8saQOOS.js";import{T as wr,I as Nr,S as Cr,a as kr,P as Sr,C as Er,V as Tr,L as Ir,b as Rr,c as Pr,d as Ar,e as Mr}from"./advanced-inputs.D9QEphBv.js";import{u as Lr,a as Or,T as Dr,C as Fr,e as zr}from"./animations.BpIZHmx4.js";import{u as Ur,C as Vr,a as Br,A as $r,L as Hr}from"./virtualization.CHAhSWD6.js";import{w as Gr,a as Kr,V as Wr,z as qr,B as Qr,k as Yr,L as Xr,q as Zr,b as Jr,H as eo,c as to,R as no,I as so}from"./headlessui.Bn8SoVOz.js";import{A as ao,m as ro,a as oo,b as io}from"./framer-motion.CcWMOJln.js";import{u as lo}from"./i18n.GAbSpk0b.js";import{a as co}from"./http-client.BfbdTDye.js";import{e as uo,o as mo,s as po,n as fo,u as ho,b as go,a as xo,c as vo,l as bo,d as _o,f as yo,r as jo,g as wo,h as No,Z as Co}from"./validation.CeCA-dRw.js";import{d as ko,l as So,t as Eo,k as To}from"./utilities.TtBcTuYn.js";import{p as Io,i as Ro,a as Po,s as Ao,b as Mo,c as Lo,f as Oo,g as Do,d as Fo}from"./date-utils.j-oxXFG2.js";import{u as zo,C as Uo,a as Vo,F as Bo,b as $o,c as Ho,d as Go}from"./forms.B0vqYgxQ.js";import{T as Ko,Q as Wo}from"./security-ui.CJ15mK8A.js";import{v as qo,E as Qo}from"./heic-converter.Cz_Prg7D.js";import{M as Yo,r as Xo,s as Zo,a as Jo,b as ei,c as ti,d as ni}from"./markdown-processing.Do1JsGqG.js";import{S as si,u as ai,a as ri,b as oi,c as ii,_ as li}from"./sandpack.CX5T_CjM.js";import"./math-katex.steiuUVT.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const ci=(...e)=>a(H(e)),di=e=>{const t=document.documentElement;switch(e.split("-")[1]){case"xs":t.style.setProperty("--markdown-font-size","0.75rem");break;case"sm":t.style.setProperty("--markdown-font-size","0.875rem");break;case"base":t.style.setProperty("--markdown-font-size","1rem");break;case"lg":t.style.setProperty("--markdown-font-size","1.125rem");break;case"xl":t.style.setProperty("--markdown-font-size","1.25rem")}},ui=Fa,mi=n.forwardRef((({className:e="",...t},n)=>s.jsx(Os,{ref:n,className:ci("border-b",e),...t})));mi.displayName="AccordionItem";n.forwardRef((({className:e="",children:t,...n},a)=>s.jsx(Ds,{className:"flex",children:s.jsxs(Fs,{ref:a,className:ci("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,s.jsx(zs,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}))).displayName=Fs.displayName;const pi=n.forwardRef((({className:e="",children:t,...n},a)=>s.jsx(Us,{ref:a,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:s.jsx("div",{className:ci("pb-4 pt-0",e),children:t})})));function fi(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}pi.displayName=Us.displayName,fi("/* AnimatedTabs.css */\n.animated-tab-panel {\n  transition-property: opacity, translate;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 300ms;\n  animation-duration: 300ms;\n}\n\n/* Sliding underline animation for tabs */\n.animated-tab-list {\n  position: relative;\n}\n\n.animated-tab-list::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  height: 2px;\n  background-color: currentColor; /* Inherit color from active tab */\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  left: var(--tab-left, 0);\n  width: var(--tab-width, 0);\n}\n\n.animated-tab {\n  position: relative;\n}\n\n.animated-tab[data-state='active'] {\n  border-bottom-color: transparent !important;\n}\n\n.animated-tab-panel[data-enter] {\n  opacity: 1 !important;\n  translate: 0 !important;\n}\n\n@media (prefers-reduced-motion: reduce) {\n  .animated-tab-panel {\n    transition: none;\n  }\n}\n\n.animated-tab-panel:not([data-open]) {\n  position: absolute;\n  top: 0px;\n}\n\n.animated-panels:has(> [data-was-open]) > .animated-tab-panel {\n  opacity: 0;\n  translate: -100%;\n}\n\n.animated-panels [data-was-open] ~ .animated-tab-panel,\n.animated-panels [data-open] ~ .animated-tab-panel {\n  translate: 100%;\n}\n");const hi=n.forwardRef((function(e,t){const a=n.useRef(null);return n.useEffect((()=>{const e=a.current;if(!e)return;const t=()=>{const t="true"===e.getAttribute("aria-selected");e.setAttribute("data-state",t?"active":"inactive")};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,attributeFilter:["aria-selected"]}),()=>n.disconnect()}),[]),s.jsx(r,{ref:e=>{a.current=e,"function"==typeof t?t(e):t&&(t.current=e)},...e,className:`animated-tab aria-selected:text-token-text-primary flex select-none items-center justify-center gap-2 whitespace-nowrap border-none text-sm font-medium outline-none transition-colors aria-disabled:opacity-50 ${e.className||""}`})})),gi=n.forwardRef((function(e,t){const a=o(),r=function(e){const t=n.useRef(void 0);return n.useEffect((()=>{t.current=e}),[e]),t.current}(i(a,"selectedId")),c=e.tabId&&r===e.tabId;return s.jsx(l,{ref:t,...e,"data-was-open":c||void 0,className:`animated-tab-panel max-w-full ${e.className||""}`})}));function xi({tabs:e,className:t="",tabListClassName:a="",tabClassName:r="",tabPanelClassName:o="",containerClassName:i="",tabListProps:l={},defaultSelectedId:c}){const d=e.map(((e,t)=>e.id||`tab-${t}`)),u=c||d[0],m=n.useRef(null);return n.useEffect((()=>{const e=m.current;if(!e)return;const t=()=>{const t=e.querySelector('[data-state="active"]');t&&(e.style.setProperty("--tab-left",`${t.offsetLeft}px`),e.style.setProperty("--tab-width",`${t.offsetWidth}px`))};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,subtree:!0,attributeFilter:["data-state"]}),()=>n.disconnect()}),[e]),s.jsx("div",{className:`w-full ${t}`,children:s.jsxs(ue,{defaultSelectedId:u,children:[s.jsx(me,{ref:m,"aria-label":"Tabs",className:`animated-tab-list flex py-1 ${a}`,...l,children:e.map(((e,t)=>s.jsx(hi,{id:d[t],disabled:e.disabled,className:r,"data-state":d[t]===u?"active":"inactive",children:e.label},d[t])))}),s.jsx("div",{className:ci("animated-panels relative flex w-full flex-col items-center overflow-hidden p-0",i),children:e.map(((e,t)=>s.jsx(gi,{id:`panel-${d[t]}`,tabId:d[t],className:o,children:e.content},`panel-${d[t]}`)))})]})})}const vi=({className:e="",children:t,...n})=>s.jsx(Ia,{className:ci(e),...n,children:s.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:t})});vi.displayName=Ia.displayName;const bi=n.forwardRef((({className:e="",...t},n)=>s.jsx(Vs,{className:ci("fixed inset-0 z-50 bg-gray-500/90 transition-opacity animate-in fade-in dark:bg-gray-800/90",e),...t,ref:n})));bi.displayName=Vs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsxs(vi,{children:[s.jsx(bi,{}),s.jsx(Bs,{ref:n,className:ci("fixed z-50 grid w-full max-w-lg scale-100 gap-4 bg-white p-6 opacity-100 animate-in fade-in-90 slide-in-from-bottom-10 sm:rounded-lg sm:zoom-in-90 sm:slide-in-from-bottom-0 md:w-full","dark:bg-gray-900",e),...t})]}))).displayName=Bs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx($s,{ref:n,className:ci("text-lg font-semibold text-gray-900","dark:text-gray-50",e),...t}))).displayName=$s.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Hs,{ref:n,className:ci("text-sm text-gray-500","dark:text-gray-400",e),...t}))).displayName=Hs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Gs,{ref:n,className:ci("inline-flex h-10 items-center justify-center rounded-md bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-gray-100 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),...t}))).displayName=Gs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Ks,{ref:n,className:ci("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e),...t}))).displayName=Ks.displayName;const _i=n.forwardRef((({...e},t)=>s.jsx("nav",{ref:t,"aria-label":"breadcrumb",...e})));_i.displayName="Breadcrumb";const yi=n.forwardRef((({className:e,...t},n)=>s.jsx("ol",{ref:n,className:ci("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",e),...t})));yi.displayName="BreadcrumbList";const ji=n.forwardRef((({className:e,...t},n)=>s.jsx("li",{ref:n,className:ci("inline-flex items-center gap-1.5",e),...t})));ji.displayName="BreadcrumbItem";const wi=n.forwardRef((({asChild:e,className:t,...n},a)=>s.jsx(e?Ws:"a",{ref:a,className:ci("transition-colors hover:text-foreground",t),...n})));wi.displayName="BreadcrumbLink";n.forwardRef((({className:e,...t},n)=>s.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:ci("font-normal text-foreground",e),...t}))).displayName="BreadcrumbPage";const Ni=({children:e,className:t,...n})=>s.jsx("li",{role:"presentation","aria-hidden":"true",className:ci("[&>svg]:size-3.5",t),...n,children:e??s.jsx(u,{})});Ni.displayName="BreadcrumbSeparator";const Ci=c("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-surface-destructive text-destructive-foreground hover:bg-surface-destructive-hover",outline:"text-text-primary border border-border-light bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-surface-hover hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",submit:"bg-surface-submit text-white hover:bg-surface-submit-hover"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-lg px-8",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}}),ki=n.forwardRef((({className:e,variant:t,size:n,asChild:a=!1,...r},o)=>s.jsx(a?Ws:"button",{className:ci(Ci({variant:t,size:n,className:e})),ref:o,...r})));ki.displayName="Button";const Si=n.forwardRef((({className:e="",...t},n)=>s.jsx(qs,{ref:n,className:ci("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:s.jsx(Qs,{className:ci("flex items-center justify-center"),children:s.jsx(d,{className:"h-4 w-4"})})})));Si.displayName=qs.displayName;const Ei=La,Ti=Oa,Ii=Da;n.forwardRef((({className:e="",inset:t,children:n,...a},r)=>s.jsxs(Ys,{ref:r,className:ci("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-900 dark:data-[state=open]:bg-gray-900",t?"pl-8":"",e),...a,children:[n,s.jsx(u,{className:"ml-auto h-4 w-4"})]}))).displayName=Ys.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Xs,{ref:n,className:ci("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in slide-in-from-left-1 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...t}))).displayName=Xs.displayName;const Ri=n.forwardRef((({className:e="",sideOffset:t=4,...n},a)=>s.jsx(Zs,{children:s.jsx(Js,{ref:a,sideOffset:t,className:ci("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...n})})));Ri.displayName=Js.displayName;const Pi=n.forwardRef((({className:e="",inset:t,...n},a)=>s.jsx(ea,{ref:a,className:ci("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",t?"pl-8":"",e),...n})));Pi.displayName=ea.displayName;const Ai=n.forwardRef((({className:e="",children:t,checked:n,...a},r)=>s.jsxs(ta,{ref:r,className:ci("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",e),checked:n,...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(na,{children:s.jsx(d,{className:"h-4 w-4"})})}),t]})));Ai.displayName=ta.displayName;n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(sa,{ref:a,className:ci(e,"relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800"),...n,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(na,{children:s.jsx(m,{className:"h-2 w-2 fill-current"})})}),t]}))).displayName=sa.displayName;n.forwardRef((({className:e="",inset:t,...n},a)=>s.jsx(aa,{ref:a,className:ci("px-2 py-1.5 text-sm font-semibold text-gray-900 dark:text-gray-300",t?"pl-8":"",e),...n}))).displayName=aa.displayName;const Mi=n.forwardRef((({className:e="",...t},n)=>s.jsx(ra,{ref:n,className:ci("-mx-1 my-1 h-px bg-border-medium",e),...t})));var Li,Oi,Di;Mi.displayName=ra.displayName,(Di=Li||(Li={})).Top="top",Di.Right="right",Di.Bottom="bottom",Di.Left="left",function(e){e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(Oi||(Oi={}));const Fi=p("en"),zi=p("ltr");p("text-base");const Ui=p({open:!1,message:"",severity:Oi.SUCCESS,showIcon:!0});function Vi(e=100){const[t,s]=ge(Ui),a=n.useRef(null),r=n.useRef(null);return n.useEffect((()=>()=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current)}),[]),{toast:t,onOpenChange:e=>s({...t,open:e}),showToast:({message:t,severity:n=Oi.SUCCESS,showIcon:o=!0,duration:i=3e3,status:l})=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current),a.current=window.setTimeout((()=>{s({open:!0,message:t,severity:l??n,showIcon:o}),r.current=window.setTimeout((()=>{s((e=>({...e,open:!1})))}),i)}),e)}}}const Bi={},$i=e=>n.useMemo((()=>{const{username:t,name:n}=e??{},s=n||t;if(!s)return"";if((null==e?void 0:e.avatar)&&""!==(null==e?void 0:e.avatar))return e.avatar;if(Bi[s])return Bi[s];const a=yr(jr,{seed:s,fontFamily:["Verdana"],fontSize:36});let r="";try{r=a.toDataUri(),r&&(Bi[s]=r)}catch(yu){console.error("Failed to generate avatar:",yu)}return r}),[e]);function Hi({value:e,options:t}){const[s,a]=n.useState(!1),[r,o]=n.useState(""),i=n.useMemo((()=>{if(!r)return t;const n=A(t,r,{keys:["label","value"]}),s=t.find((t=>t.value===e));return s&&!n.includes(s)&&n.push(s),n}),[r,e,t]);return{open:s,setOpen:a,searchValue:r,setSearchValue:o,matches:i}}function Gi(){const e=g(Fi),{t:t,i18n:s}=lo();return n.useEffect((()=>{s.language!==e&&s.changeLanguage(e)}),[e,s]),(e,n)=>t(e,n)}function Ki(e){const[t,s]=n.useState(!1);return n.useEffect((()=>{const n=window.matchMedia(e);n.matches!==t&&s(n.matches);const a=()=>s(n.matches);return n.addEventListener("change",a),()=>n.removeEventListener("change",a)}),[t,e]),t}function Wi(e,t,s,a){n.useEffect((()=>{const n=n=>{const r=n.target;r&&"id"in r&&s.includes(r.id)||(null==r?void 0:r.parentNode)&&"id"in r.parentNode&&s.includes(r.parentNode.id)||a||e.current&&!e.current.contains(r)&&t()};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}}),[e,t])}const qi=pa,Qi=Ma,Yi=({className:e="",children:t,...n})=>s.jsx(fa,{className:ci(e),...n,children:s.jsx("div",{className:"fixed inset-0 z-[999] flex items-start justify-center sm:items-center",children:t})});Yi.displayName=fa.displayName;const Xi=n.forwardRef((({className:e,...t},n)=>s.jsx(oa,{className:ci("fixed inset-0 z-[999] bg-gray-600/65 transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in dark:bg-black/80",e??""),...t,ref:n})));Xi.displayName=oa.displayName;const Zi=n.forwardRef((({className:e,children:t=!0,showCloseButton:n=!0,disableScroll:a=!1,...r},o)=>{const i=Ki("(max-width: 768px)");return s.jsxs(Yi,{children:[s.jsx(Xi,{}),s.jsxs(ia,{ref:o,className:ci("fixed z-[999] grid w-full gap-4 rounded-b-lg bg-white pb-6 animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:rounded-lg","dark:bg-gray-700",i?"fixed left-1/2 top-1/2 z-[999] m-auto grid w-11/12 -translate-x-1/2 -translate-y-1/2 gap-4 rounded-xl bg-white pb-6":"",a?"overflow-hidden":"",e??""),...r,children:[t,n&&s.jsxs(la,{className:"absolute right-6 top-[1.6rem] rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 dark:focus:ring-white dark:focus:ring-offset-gray-700 dark:data-[state=open]:bg-gray-800",children:[s.jsx(f,{className:"h-5 w-5 text-black dark:text-white"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}));Zi.displayName=ia.displayName;const Ji=({className:e,...t})=>s.jsx("div",{className:ci("flex flex-col space-y-2 border-b border-black/10 p-6 pb-4 text-left dark:border-white/10",e??""),...t});Ji.displayName="DialogHeader";const el=({className:e,...t})=>s.jsx("div",{className:ci("flex flex-row justify-between space-x-2 px-6 py-4",e??""),...t});el.displayName="DialogFooter";const tl=n.forwardRef((({className:e,...t},n)=>s.jsx(ca,{ref:n,className:ci("text-lg font-semibold text-gray-900","dark:text-gray-50",e??""),...t})));tl.displayName=ca.displayName;const nl=n.forwardRef((({className:e,...t},n)=>s.jsx(da,{ref:n,className:ci("text-sm text-gray-500","dark:text-gray-400",e??""),...t})));nl.displayName=da.displayName;const sl=n.forwardRef((({className:e,...t},n)=>s.jsx(la,{ref:n,className:ci("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t})));sl.displayName=ca.displayName;n.forwardRef((({className:e,...t},n)=>s.jsx(ki,{ref:n,variant:"outline",className:ci("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t}))).displayName=ca.displayName;const al=Ra,rl=Pa,ol=Aa,il=n.forwardRef((({className:e="",align:t="center",sideOffset:n=6,disabled:a=!1,...r},o)=>a?null:s.jsx(ua,{ref:o,align:t,sideOffset:n,className:ci("z-50 w-64 origin-[--radix-hover-card-content-transform-origin] rounded-xl border border-border-light bg-surface-secondary p-4 text-text-primary shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})));il.displayName=ua.displayName;const ll=n.forwardRef((({className:e,...t},n)=>s.jsx("input",{className:ci("flex h-10 w-full rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e??""),ref:n,...t})));ll.displayName="Input";const cl=n.forwardRef((({className:e,...t},n)=>s.jsx(h,{className:ci("flex max-h-5 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50",e??""),ref:n,...t})));cl.displayName="Input";const dl=n.forwardRef((({className:e="",...t},n)=>s.jsx(ma,{ref:n,...t,className:ci("block w-full break-all text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-200",e)})));dl.displayName=ma.displayName;const ul=n.forwardRef((({children:e,triggerRef:t,triggerRefs:n,onOpenChange:a,...r},o)=>s.jsx(pa,{...r,onOpenChange:e=>{!e&&(null==t?void 0:t.current)&&setTimeout((()=>{var e;null==(e=t.current)||e.focus()}),0),(null==n?void 0:n.length)&&n.forEach((e=>{(null==e?void 0:e.current)&&setTimeout((()=>{var t;null==(t=e.current)||t.focus()}),0)})),null==a||a(e)},children:e}))),ml=Ma,pl=fa,fl=la,hl=n.forwardRef((({className:e,...t},n)=>s.jsx(oa,{ref:n,className:ci("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t})));hl.displayName=oa.displayName;const gl=n.forwardRef((({className:e,overlayClassName:t,showCloseButton:n=!0,children:a,...r},o)=>s.jsxs(pl,{children:[s.jsx(hl,{className:t}),s.jsxs(ia,{ref:o,className:ci("max-w-11/12 fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 rounded-2xl bg-background p-6 text-text-primary shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...r,children:[a,n&&s.jsxs(la,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-ring-primary ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));gl.displayName=ia.displayName;const xl=({className:e,...t})=>s.jsx("div",{className:ci("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});xl.displayName="DialogHeader";const vl=({className:e,...t})=>s.jsx("div",{className:ci("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});vl.displayName="DialogFooter";const bl=n.forwardRef((({className:e,...t},n)=>s.jsx(ca,{ref:n,className:ci("text-lg font-semibold leading-none tracking-tight",e),...t})));bl.displayName=ca.displayName;const _l=n.forwardRef((({className:e,...t},n)=>s.jsx(da,{ref:n,className:ci("text-sm text-text-secondary",e),...t})));_l.displayName=da.displayName;const yl=n.forwardRef((({className:e,onDoubleClick:t,...n},a)=>s.jsxs(ha,{ref:a,...n,className:ci("relative flex w-full cursor-pointer touch-none select-none items-center",e),onDoubleClick:t,children:[s.jsx(ga,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:s.jsx(xa,{className:"absolute h-full bg-primary"})}),s.jsx(va,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})));yl.displayName=ha.displayName;const jl=n.forwardRef((({className:e="",orientation:t="horizontal",decorative:n=!0,...a},r)=>s.jsx(ba,{ref:r,...a,decorative:n,orientation:t,className:ci("shrink-0 bg-border-light","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e)})));jl.displayName=ba.displayName;const wl=({label:e,labelClassName:t,placeholder:n="Select an option",options:a,className:r,value:o,onChange:i,onBlur:l})=>{const c=e=>null!=e&&"object"==typeof e&&"value"in e,[d,u]=S.useState(!1),[m,p]=S.useState(o),[f,h]=S.useState(!1);S.useEffect((()=>{p(o)}),[o]);const g=e=>{p(e),i(e)};return s.jsxs(G,{value:m,setValue:g,children:[null!=e&&s.jsx(K,{className:ci("mb-2 block text-sm font-medium text-text-primary",t??""),children:e}),s.jsx("div",{className:ci("relative",f?"rounded-md ring-2 ring-ring-primary":""),children:s.jsx(z,{placeholder:n,className:ci("h-10 w-full rounded-md border border-border-light bg-surface-primary px-3 py-2 text-sm","placeholder-text-secondary hover:bg-surface-hover","focus:outline-none",r),onChange:e=>g(e.target.value),onBlur:()=>{h(!1),l()},onFocusVisible:()=>{h(!0),u(!0)},onMouseDown:()=>{h(!1)}})}),s.jsx(W,{gutter:4,sameWidth:!0,open:d,onClose:()=>u(!1),className:ci("z-50 max-h-60 w-full overflow-auto rounded-md bg-surface-primary p-1 shadow-lg","animate-in fade-in-0 zoom-in-95"),children:a.map(((e,t)=>s.jsxs(B,{className:ci("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none","cursor-pointer hover:bg-surface-tertiary hover:text-text-primary","data-[active-item]:bg-surface-tertiary data-[active-item]:text-text-primary"),value:c(e)?`${e.value??""}`:e,children:[c(e)&&null!=e.icon&&s.jsx("span",{className:"mr-2 flex-shrink-0",children:e.icon}),c(e)?e.label:e]},t)))})]})};function Nl({className:e,...t}){return s.jsx("div",{className:ci("animate-pulse rounded-md bg-surface-tertiary opacity-50 dark:opacity-25",e),...t})}const Cl=n.forwardRef((({className:e,...t},n)=>s.jsx(_a,{className:ci("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-unchecked",e),...t,ref:n,children:s.jsx(ya,{className:ci("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})));Cl.displayName=_a.displayName;const kl=n.forwardRef((({className:e,...t},n)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:n,className:ci("w-full caption-bottom text-sm",e),...t})})));kl.displayName="Table";const Sl=n.forwardRef((({className:e,...t},n)=>s.jsx("thead",{ref:n,className:ci("[&_tr]:border-b",e),...t})));Sl.displayName="TableHeader";const El=n.forwardRef((({className:e,...t},n)=>s.jsx("tbody",{ref:n,className:ci("[&_tr:last-child]:border-0",e),...t})));El.displayName="TableBody";n.forwardRef((({className:e,...t},n)=>s.jsx("tfoot",{ref:n,className:ci("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}))).displayName="TableFooter";const Tl=n.forwardRef((({className:e,...t},n)=>s.jsx("tr",{ref:n,className:ci("border-b border-border-light transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t})));Tl.displayName="TableRow";const Il=n.forwardRef((({className:e,...t},n)=>s.jsx("th",{ref:n,className:ci("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t})));Il.displayName="TableHead";const Rl=n.forwardRef((({className:e,...t},n)=>s.jsx("td",{ref:n,className:ci("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t})));Rl.displayName="TableCell";n.forwardRef((({className:e,...t},n)=>s.jsx("caption",{ref:n,className:ci("mt-4 text-sm text-muted-foreground",e),...t}))).displayName="TableCaption";n.forwardRef((({className:e="",...t},n)=>s.jsx(ja,{ref:n,className:ci("inline-flex items-center justify-center rounded-md bg-surface-primary",e),...t}))).displayName=ja.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(wa,{className:ci("inline-flex min-w-[100px] items-center justify-center rounded-[0.185rem] px-3 py-1.5 text-sm font-medium text-gray-700 transition-all disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-800 data-[state=active]:shadow-sm dark:data-[state=active]:bg-gray-700 dark:data-[state=active]:text-gray-200",e),...t,ref:n}))).displayName=wa.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Na,{className:ci("mt-2 rounded-md p-6",e),...t,ref:n}))).displayName=Na.displayName;const Pl=n.forwardRef((({CancelButton:e,LabelNode:t,label:n,onRemove:a,className:r="",labelClassName:o="",...i},l)=>s.jsxs("div",{ref:l,...i,className:ci("flex max-h-8 items-center overflow-y-hidden rounded-3xl border-2 border-green-600 bg-green-600/20 text-xs text-green-600 dark:text-white",r),children:[s.jsxs("div",{className:ci("ml-1 whitespace-pre-wrap px-2 py-1",o),children:[t?s.jsxs(s.Fragment,{children:[t," "]}):null,n]}),e||a&&s.jsx("button",{onClick:e=>{e.stopPropagation(),a(e)},className:"rounded-full bg-green-600/50","aria-label":`Remove ${n}`,children:s.jsx(f,{className:"m-[1.5px] p-1"})})]})));Pl.displayName="Tag";const Al=n.memo(Pl);n.forwardRef((({className:e="",...t},n)=>s.jsx("textarea",{className:ci("flex h-20 w-full resize-none rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),ref:n,...t}))).displayName="Textarea";const Ml=n.forwardRef(((e,t)=>{const[,a]=n.useState(!1),r=g(zi).toLowerCase();return n.useLayoutEffect((()=>a(!0)),[]),s.jsx(x,{dir:r,...e,ref:t})}));function Ll(){const{toast:e,onOpenChange:t}=Vi(),n={[Oi.INFO]:"border-gray-500 bg-gray-500",[Oi.SUCCESS]:"border-green-500 bg-green-500",[Oi.WARNING]:"border-orange-500 bg-orange-500",[Oi.ERROR]:"border-red-500 bg-red-500"};return s.jsx(za,{open:e.open,onOpenChange:t,className:"toast-root",style:{height:"74px",marginBottom:"0px"},children:s.jsx("div",{className:"w-full p-1 text-center md:w-auto md:text-justify",children:s.jsxs("div",{className:`alert-root pointer-events-auto inline-flex flex-row gap-2 rounded-md border px-3 py-2 text-white ${n[e.severity]}`,children:[e.showIcon&&s.jsx("div",{className:"mt-1 flex-shrink-0 flex-grow-0",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"}),s.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),s.jsx(Ua,{className:"flex-1 justify-center gap-2",children:s.jsx("div",{className:"whitespace-pre-wrap text-left",children:e.message})})]})})})}fi(".tooltip {\n  z-index: 50;\n  cursor: pointer;\n  border-radius: 0.275rem;\n  background-color: var(--surface-primary);\n  padding-top: 0.25rem;\n  padding-bottom: 0.25rem;\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n  font-size: 1rem;\n  line-height: 1.5rem;\n  color: black;\n  box-shadow: 0 2px 4px 0 rgb(0 0 0 / 0.25);\n  /* Enhanced layout for longer descriptions */\n  max-width: 320px;\n  word-wrap: break-word;\n  text-align: left;\n}\n\n@media (max-width: 640px) {\n  .tooltip {\n    max-width: 200px;\n  }\n}\n\n.tooltip:where(.dark, .dark *) {\n  background-color: var(--surface-primary);\n  color: white;\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.35);\n}\n");const Ol=n.forwardRef((function({description:e,side:t="top",className:a,role:r,enableHTML:o=!1,...l},c){const d=v({placement:t}),u=i(d,(e=>e.mounted)),m=i(d,(e=>e.placement)),p=n.useId(),f=n.useMemo((()=>{const e=b();return e.addHook("afterSanitizeAttributes",(e=>{e.tagName&&"A"===e.tagName&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))})),e}),[]),h=n.useMemo((()=>{if(!o)return"";try{return f.sanitize(e,{ALLOWED_TAGS:["a","strong","b","em","i","br","code"],ALLOWED_ATTR:["href","class","target","rel"],ALLOW_DATA_ATTR:!1,ALLOW_ARIA_ATTR:!1})}catch(Di){return console.error("Sanitization failed",Di),e}}),[o,e,f]),{x:g,y:x}=n.useMemo((()=>{switch(m.split("-")[0]){case"top":return{x:0,y:-8};case"bottom":return{x:0,y:8};case"left":return{x:-8,y:0};case"right":return{x:8,y:0};default:return{x:0,y:0}}}),[m]);return s.jsxs(_,{store:d,hideTimeout:0,children:[s.jsx(y,{...l,ref:c,role:r,"aria-describedby":p,onKeyDown:e=>{"button"===r&&"Enter"===e.key&&(e.preventDefault(),e.target.click())},className:ci("cursor-pointer",a)}),s.jsx(ao,{children:!0===u&&s.jsxs(j,{gutter:4,alwaysVisible:!0,className:"tooltip",id:p,render:s.jsx(ro.div,{initial:{opacity:0,x:g,y:x},animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:g,y:x}}),children:[s.jsx(w,{}),o?s.jsx("div",{dangerouslySetInnerHTML:{__html:h}}):e]})})]})}));n.forwardRef((({className:e,...t},n)=>s.jsx("ul",{ref:n,className:ci("flex flex-row items-center gap-1",e),...t}))).displayName="PaginationContent";n.forwardRef((({className:e,...t},n)=>s.jsx("li",{ref:n,className:ci("",e),...t}))).displayName="PaginationItem";const Dl=n.forwardRef((({className:e,value:t,...n},a)=>s.jsx(Ca,{ref:a,className:ci("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...n,children:s.jsx(ka,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})));Dl.displayName=Ca.displayName;const Fl=n.forwardRef((({className:e,containerClassName:t,...n},a)=>s.jsx(N,{ref:a,containerClassName:ci("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:ci("disabled:cursor-not-allowed",e),...n})));Fl.displayName="InputOTP";const zl=n.forwardRef((({className:e,...t},n)=>s.jsx("div",{ref:n,className:ci("flex items-center",e),...t})));zl.displayName="InputOTPGroup";const Ul=n.forwardRef((({index:e,className:t,...a},r)=>{const o=n.useContext(C);if(!o)throw new Error("InputOTPSlot must be used within an OTPInput");const{char:i,hasFakeCaret:l,isActive:c}=o.slots[e];return s.jsxs("div",{ref:r,className:ci("text-md relative flex h-11 w-11 items-center justify-center border-y border-r border-input shadow-sm transition-all first:rounded-l-xl first:border-l last:rounded-r-xl",c&&"z-10 ring-1 ring-ring",t),...a,children:[i,l&&s.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})}));Ul.displayName="InputOTPSlot";const Vl=n.forwardRef((({...e},t)=>s.jsx("div",{ref:t,role:"separator",...e,children:s.jsx(k,{})})));function Bl({value:e,onChange:t,placeholder:a,className:r=""}){const o=n.useRef(null),i=n.useCallback((e=>t(e.target.value)),[t]);return s.jsxs("div",{className:ci("focus:to-surface-primary/50 group sticky left-0 top-0 z-10 flex h-12 items-center gap-2 bg-gradient-to-b from-surface-tertiary-alt from-65% to-transparent px-3 py-2 text-text-primary transition-colors duration-300 focus:bg-gradient-to-b focus:from-surface-primary",r),children:[s.jsx(F,{className:"h-4 w-4 text-text-secondary-alt transition-colors duration-300","aria-hidden":"true"}),s.jsx("input",{ref:o,type:"text",value:e??"",onChange:i,placeholder:String(a??"Search..."),"aria-label":"Search Model",className:"flex-1 rounded-md border-none bg-transparent px-2.5 py-2 text-sm placeholder-text-secondary focus:outline-none focus:ring-1 focus:ring-ring-primary"}),s.jsx("button",{className:ci("relative flex h-5 w-5 items-center justify-end rounded-md text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"hidden"),"aria-label":"Clear search",onClick:()=>{t(""),setTimeout((()=>{var e;null==(e=o.current)||e.focus()}),0)},tabIndex:0,children:s.jsx(f,{"aria-hidden":"true",className:ci("text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"opacity-0")})})]})}function $l(e){return"string"==typeof e?e.startsWith("---")&&e.endsWith("---")?"":e.toUpperCase():""}function Hl({availableOptions:e=[],placeholder:t,getTextKeyOverride:a,className:r,disabled:o=!1}){const[i,l]=n.useState(null),c=e.length>10&&!o,d=a||$l,u=n.useMemo((()=>{const t=i??"";if(!c||!t||!e.length)return e;const n=t.toUpperCase();return e.filter((e=>d(e).includes(n)))}),[e,d,i,c]),m=n.useCallback((e=>l(e)),[]);return[u,c?s.jsx(Bl,{value:i,className:r,onChange:m,placeholder:t}):null]}Vl.displayName="InputOTPSeparator";const Gl=({className:e="",...t})=>s.jsx(de,{className:ci("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),Kl=X,Wl=({withHandle:e,className:t="",...n})=>s.jsx(J,{className:ci("group relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:e&&s.jsx("div",{className:"invisible z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border group-hover:visible group-active:visible",children:s.jsx(ee,{className:"h-2.5 w-2.5"})})});n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(wr,{ref:a,className:ci("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-gray-200 border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 [&>span]:line-clamp-1","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[t,s.jsx(Nr,{asChild:!0,children:s.jsx(Sa,{className:"h-4 w-4 opacity-50"})})]}))).displayName=wr.displayName;const ql=n.forwardRef((({className:e="",...t},n)=>s.jsx(Cr,{ref:n,className:ci("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:s.jsx(Ea,{})})));ql.displayName=Cr.displayName;const Ql=n.forwardRef((({className:e="",...t},n)=>s.jsx(kr,{ref:n,className:ci("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:s.jsx(zs,{})})));Ql.displayName=kr.displayName;n.forwardRef((({className:e="",children:t,position:n="popper",...a},r)=>s.jsx(Sr,{children:s.jsxs(Er,{ref:r,className:ci("bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-600","popper"===n?"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1":"",e),position:n,...a,children:[s.jsx(ql,{}),s.jsx(Tr,{className:ci("p-1","popper"===n?"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]":""),children:t}),s.jsx(Ql,{})]})}))).displayName=Er.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Ir,{ref:n,className:ci("px-2 py-1.5 text-sm font-semibold",e),...t}))).displayName=Ir.displayName;n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(Rr,{ref:a,className:ci("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[s.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(Pr,{children:s.jsx(Ta,{className:"h-4 w-4"})})}),s.jsx(Ar,{children:t})]}))).displayName=Rr.displayName;function Yl({icon:e,label:t,id:n,isActive:a=!1,isEditing:r=!1,isDragging:o=!1,isAvailable:i=!0,isInChat:l=!1,onBadgeAction:c,onToggle:d,className:u,...m}){const p=r&&i,h="1"===n&&l;return s.jsxs(ro.button,{onClick:e=>{if(h)return e.preventDefault(),void e.stopPropagation();!r&&d&&(e.preventDefault(),e.stopPropagation(),d())},className:ci("group relative inline-flex items-center gap-1.5 rounded-full px-4 py-1.5","border border-border-medium text-sm font-medium transition-shadow md:w-full","size-9 p-2 md:p-3",a?"bg-surface-active shadow-md":"bg-surface-chat shadow-sm hover:bg-surface-hover hover:shadow-md","active:scale-95 active:shadow-inner",p&&"cursor-move",h&&"cursor-not-allowed opacity-50 hover:shadow-sm",u),animate:{scale:o?1.1:1,boxShadow:o?"0 10px 25px rgba(0,0,0,0.1)":void 0},whileTap:{scale:o?1.1:h?1:.97},transition:{type:"tween",duration:.1,ease:"easeOut"},...m,children:[e&&s.jsx(e,{className:ci("relative h-5 w-5 md:h-4 md:w-4",!t&&"mx-auto")}),s.jsx("span",{className:"relative hidden md:inline",children:t}),r&&!o&&s.jsx(ro.button,{className:"absolute -right-1 -top-1 flex h-6 w-6 items-center justify-center rounded-full bg-surface-secondary-alt text-text-primary shadow-sm md:h-5 md:w-5",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},whileTap:{scale:.9},onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),null==c||c()},children:s.jsx(i?f:pe,{className:"h-3 w-3"})})]})}function Xl({className:e=""}){return s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",className:ci("lucide lucide-blocks",e),children:[s.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),s.jsx("path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3"})]})}function Zl({className:e="",...t}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"none",className:ci("h-4 w-4",e),width:"16",height:"16",strokeWidth:"2",...t,children:s.jsxs("g",{fill:"currentColor",children:[s.jsx("path",{d:"M13.164.98a.7.7 0 0 0-1.328 0l-.478 1.435a.7.7 0 0 1-.443.443l-1.436.478a.7.7 0 0 0 0 1.328l1.436.479a.7.7 0 0 1 .443.442l.478 1.436a.7.7 0 0 0 1.328 0l.478-1.436a.7.7 0 0 1 .443-.443l1.436-.478a.7.7 0 0 0 0-1.328l-1.436-.478a.7.7 0 0 1-.443-.443L13.164.979Z"}),s.jsx("path",{d:"M13.237 10.534c-.228-.245-.513-.46-.847-.46a.823.823 0 0 0-.828.849c.04 1.04.128 2.067.263 3.08a.619.619 0 0 1-.528.695c-.872.121-1.748.208-2.626.262a.8.8 0 0 1-.845-.805c0-.325.21-.602.45-.82.235-.215.375-.488.375-.787 0-.683-.738-1.237-1.65-1.237-.911 0-1.65.554-1.65 1.237 0 .294.137.563.364.775.245.229.461.513.461.848a.823.823 0 0 1-.85.829 33.809 33.809 0 0 1-3.266-.278.619.619 0 0 1-.532-.532 34.099 34.099 0 0 1-.278-3.267.823.823 0 0 1 .83-.85c.333 0 .619.216.846.461.212.228.482.364.776.364.683 0 1.237-.738 1.237-1.65 0-.91-.554-1.65-1.237-1.65-.299 0-.572.142-.786.376-.219.24-.496.45-.821.45a.8.8 0 0 1-.805-.845c.054-.885.142-1.76.262-2.626a.619.619 0 0 1 .695-.528c1.022.136 2.05.224 3.08.263a.822.822 0 0 0 .85-.828c0-.334-.217-.62-.462-.847-.227-.212-.363-.482-.363-.776C5.352 1.554 6.09 1 7.002 1c.91 0 1.649.554 1.649 1.237 0 .173-.012.327-.029.473C8.258 3 8 3.41 8 4c0 1.5 1.667 1.833 2.5 2 .167.833.5 2.5 2 2.5.732 0 1.186-.397 1.479-.9l.034-.001c.683 0 1.237.738 1.237 1.65 0 .911-.554 1.65-1.237 1.65-.294 0-.564-.137-.776-.364Z"})]})})}function Jl({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 41 41",fill:"none",xmlns:"http://www.w3.org/2000/svg",strokeWidth:"1.5",className:ci(t,""),children:s.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z",fill:"currentColor"})})}n.forwardRef((({className:e="",...t},n)=>s.jsx(Mr,{ref:n,className:ci("-mx-1 my-1 h-px bg-muted",e),...t}))).displayName=Mr.displayName,n.memo((function({options:e,value:t,onChange:a,disabled:r=!1}){const o=Gi(),[i,l]=n.useState(t??""),c=n.useRef([]),[d,u]=n.useState({}),m=n.useCallback((()=>{const t=e.findIndex((e=>e.value===i));if(t>=0&&c.current[t]){const e=c.current[t],n=null==e?void 0:e.parentElement;if(e&&n){const t=n.getBoundingClientRect(),s=e.getBoundingClientRect(),a=s.left-t.left-4;u({width:`${s.width}px`,transform:`translateX(${a}px)`})}}}),[i,e]);if(n.useLayoutEffect((()=>{m()}),[m]),n.useLayoutEffect((()=>{void 0!==t&&l(t)}),[t]),0===e.length)return s.jsx("div",{className:"relative inline-flex items-center rounded-lg bg-muted p-1 opacity-50",role:"radiogroup",children:s.jsx("span",{className:"px-4 py-2 text-xs text-muted-foreground",children:o("com_ui_no_options")})});const p=e.findIndex((e=>e.value===i));return s.jsxs("div",{className:"relative inline-flex items-center rounded-lg bg-muted p-1",role:"radiogroup",children:[p>=0&&s.jsx("div",{className:"pointer-events-none absolute inset-y-1 rounded-md border border-border/50 bg-background shadow-sm transition-all duration-300 ease-out",style:d}),e.map(((e,t)=>s.jsx("button",{ref:e=>{c.current[t]=e},type:"button",role:"radio","aria-checked":i===e.value,onClick:()=>{return t=e.value,l(t),void(null==a||a(t));var t},disabled:r,className:`relative z-10 flex h-[34px] items-center justify-center rounded-md px-4 text-sm font-medium transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring ${e.value,"text-foreground"} ${r?"cursor-not-allowed opacity-50":""}`,children:s.jsx("span",{className:"whitespace-nowrap",children:e.label})},e.value)))]})}));const ec=S.forwardRef(((e,t)=>{const{className:n="icon-md",size:a="1.2em"}=e;return s.jsx("svg",{ref:t,fill:"none",strokeWidth:"2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",height:a,width:a,className:ci(n),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z",fill:"currentColor"})})}));function tc({className:e="icon-sm"}){return s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.00633 5.5C6.02321 5.53319 6.07042 5.60366 6.19525 5.70906C6.42458 5.9027 6.81573 6.12215 7.38659 6.32603C8.5196 6.73067 10.1506 7 12 7C13.8494 7 15.4804 6.73067 16.6134 6.32603C17.1843 6.12215 17.5754 5.9027 17.8048 5.70906C17.9296 5.60366 17.9768 5.53319 17.9937 5.5C17.9768 5.46681 17.9296 5.39634 17.8048 5.29094C17.5754 5.0973 17.1843 4.87785 16.6134 4.67397C15.4804 4.26933 13.8494 4 12 4C10.1506 4 8.5196 4.26933 7.38659 4.67397C6.81573 4.87785 6.42458 5.0973 6.19525 5.29094C6.07042 5.39634 6.02321 5.46681 6.00633 5.5ZM18 7.91726C17.7726 8.02403 17.5333 8.12123 17.2861 8.20951C15.8856 8.70968 14.0166 9 12 9C9.98341 9 8.1144 8.70968 6.71392 8.20951C6.46674 8.12123 6.22738 8.02403 6 7.91726V11.9866C6.00813 12.0073 6.03931 12.0661 6.14259 12.1624C6.31976 12.3277 6.63181 12.5252 7.10609 12.7189C8.04837 13.1039 9.43027 13.3932 11.051 13.476C11.6026 13.5042 12.0269 13.9741 11.9987 14.5257C11.9705 15.0773 11.5005 15.5016 10.949 15.4734C9.17744 15.3829 7.55934 15.0646 6.34969 14.5704C6.23097 14.5219 6.11419 14.4709 6 14.4173V18.4866C6.00813 18.5073 6.03931 18.5661 6.14259 18.6624C6.31976 18.8277 6.63181 19.0252 7.10609 19.2189C8.04837 19.6039 9.43027 19.8932 11.051 19.976C11.6026 20.0042 12.0269 20.4741 11.9987 21.0257C11.9705 21.5773 11.5005 22.0016 10.949 21.9734C9.17744 21.8829 7.55934 21.5646 6.34969 21.0704C5.74801 20.8246 5.19611 20.5146 4.77833 20.1249C4.35948 19.7341 4 19.1866 4 18.5V5.5C4 4.74631 4.43048 4.16346 4.90494 3.76283C5.38405 3.35829 6.01803 3.03902 6.71392 2.79049C8.1144 2.29032 9.98341 2 12 2C14.0166 2 15.8856 2.29032 17.2861 2.79049C17.982 3.03902 18.616 3.35829 19.0951 3.76283C19.5695 4.16346 20 4.74631 20 5.5V10C20 10.5523 19.5523 11 19 11C18.4477 11 18 10.5523 18 10V7.91726ZM17.5 13C18.0523 13 18.5 13.4477 18.5 14V14.6707C18.851 14.7948 19.172 14.9823 19.4492 15.2195L20.0308 14.8837C20.5091 14.6075 21.1207 14.7714 21.3968 15.2497C21.673 15.728 21.5091 16.3396 21.0308 16.6157L20.4499 16.9511C20.4828 17.1291 20.5 17.3125 20.5 17.5C20.5 17.6873 20.4828 17.8707 20.45 18.0485L21.0308 18.3838C21.5091 18.6599 21.6729 19.2715 21.3968 19.7498C21.1206 20.2281 20.5091 20.392 20.0308 20.1158L19.4495 19.7803C19.1722 20.0176 18.8511 20.2052 18.5 20.3293V21C18.5 21.5523 18.0523 22 17.5 22C16.9477 22 16.5 21.5523 16.5 21V20.3293C16.1489 20.2052 15.8277 20.0176 15.5504 19.7802L14.969 20.1159C14.4907 20.392 13.8791 20.2282 13.603 19.7499C13.3269 19.2716 13.4907 18.66 13.969 18.3839L14.55 18.0484C14.5172 17.8706 14.5 17.6873 14.5 17.5C14.5 17.3127 14.5172 17.1294 14.55 16.9515L13.9691 16.6161C13.4908 16.34 13.3269 15.7284 13.6031 15.2501C13.8792 14.7718 14.4908 14.608 14.9691 14.8841L15.5504 15.2197C15.8278 14.9824 16.1489 14.7948 16.5 14.6707V14C16.5 13.4477 16.9477 13 17.5 13ZM16.624 17.0174C16.6274 17.0117 16.6308 17.0059 16.6342 17.0001C16.6374 16.9946 16.6405 16.989 16.6436 16.9834C16.8187 16.6937 17.1367 16.5 17.5 16.5C17.8645 16.5 18.1835 16.6951 18.3583 16.9865C18.3607 16.9909 18.3632 16.9953 18.3658 16.9997C18.3685 17.0044 18.3713 17.0091 18.3741 17.0138C18.4543 17.1577 18.5 17.3235 18.5 17.5C18.5 17.6737 18.4557 17.8371 18.3778 17.9794C18.3737 17.9861 18.3697 17.9929 18.3657 17.9998C18.3619 18.0064 18.3581 18.0131 18.3545 18.0198C18.1789 18.3077 17.8619 18.5 17.5 18.5C17.1362 18.5 16.8178 18.3058 16.6428 18.0154C16.64 18.0102 16.6371 18.005 16.6341 17.9999C16.631 17.9945 16.6278 17.9891 16.6246 17.9838C16.5452 17.8404 16.5 17.6755 16.5 17.5C16.5 17.325 16.545 17.1605 16.624 17.0174Z",fill:"currentColor"})})}function nc({className:e}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z",fill:"currentColor"})})}function sc({className:e}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})}function ac({className:e="m-auto",size:t=20,color:n="currentColor",bgOpacity:a=.1,speed:r=.75}){const o={"--spinner-speed":`${r}s`};return s.jsxs("svg",{className:ci(e,"spinner"),width:t,height:t,viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",style:o,children:[s.jsx("defs",{children:s.jsx("style",{type:"text/css",children:"\n          .spinner {\n            transform-origin: center;\n            overflow: visible;\n            animation: spinner-rotate var(--spinner-speed) linear infinite;\n          }\n          @keyframes spinner-rotate {\n            to { transform: rotate(360deg); }\n          }\n        "})}),s.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeOpacity:a}),s.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeDasharray:"25 75",strokeLinecap:"round"})]})}function rc({className:e="icon-md-heavy",size:t="1em"}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci(e),children:s.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z",clipRule:"evenodd"})})}function oc({className:e=""}){return s.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci("h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.0633 5.67375C18.5196 5.98487 18.6374 6.607 18.3262 7.06331L10.8262 18.0633C10.6585 18.3093 10.3898 18.4678 10.0934 18.4956C9.79688 18.5234 9.50345 18.4176 9.29289 18.2071L4.79289 13.7071C4.40237 13.3166 4.40237 12.6834 4.79289 12.2929C5.18342 11.9023 5.81658 11.9023 6.20711 12.2929L9.85368 15.9394L16.6738 5.93664C16.9849 5.48033 17.607 5.36263 18.0633 5.67375Z",fill:"currentColor"})})}function ic({className:e=""}){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci(e,"h-4 w-4"),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function lc({size:e=25,className:t=""}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:ci("lucide lucide-bot",t),children:[s.jsx("path",{d:"M12 8V4H8"}),s.jsx("rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}),s.jsx("path",{d:"M2 14h2"}),s.jsx("path",{d:"M20 14h2"}),s.jsx("path",{d:"M15 13v2"}),s.jsx("path",{d:"M9 13v2"})]})}function cc({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor","aria-hidden":"true",className:ci("h-6 w-6",e),children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"})})}function dc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 7C9 4.23858 11.2386 2 14 2C16.7614 2 19 4.23858 19 7V15C19 18.866 15.866 22 12 22C8.13401 22 5 18.866 5 15V9C5 8.44772 5.44772 8 6 8C6.55228 8 7 8.44772 7 9V15C7 17.7614 9.23858 20 12 20C14.7614 20 17 17.7614 17 15V7C17 5.34315 15.6569 4 14 4C12.3431 4 11 5.34315 11 7V15C11 15.5523 11.4477 16 12 16C12.5523 16 13 15.5523 13 15V9C13 8.44772 13.4477 8 14 8C14.5523 8 15 8.44772 15 9V15C15 16.6569 13.6569 18 12 18C10.3431 18 9 16.6569 9 15V7Z",fill:"currentColor"})})}function uc({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:ci(e??"","lucide lucide-messages-square"),children:[s.jsx("path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"}),s.jsx("path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"})]})}function mc({className:e="",size:t="1em"}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci("icon-md-heavy",e),children:s.jsx("path",{fill:"currentColor",d:"M3.07 10.876C3.623 6.436 7.41 3 12 3a9.15 9.15 0 0 1 6.012 2.254V4a1 1 0 1 1 2 0v4a1 1 0 0 1-1 1H15a1 1 0 1 1 0-2h1.957A7.15 7.15 0 0 0 12 5a7 7 0 0 0-6.946 6.124 1 1 0 1 1-1.984-.248m16.992 1.132a1 1 0 0 1 .868 1.116C20.377 17.564 16.59 21 12 21a9.15 9.15 0 0 1-6-2.244V20a1 1 0 1 1-2 0v-4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H7.043A7.15 7.15 0 0 0 12 19a7 7 0 0 0 6.946-6.124 1 1 0 0 1 1.116-.868"})})}function pc({className:e=""}){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci("h-3 w-3 -rotate-180",e),height:"19",width:"19",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("polygon",{points:"11 19 2 12 11 5 11 19"}),s.jsx("polygon",{points:"22 19 13 12 22 5 22 19"})]})}function fc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",id:"google",className:"h-5 w-5",children:[s.jsx("path",{fill:"#fbbb00",d:"M113.47 309.408 95.648 375.94l-65.139 1.378C11.042 341.211 0 299.9 0 256c0-42.451 10.324-82.483 28.624-117.732h.014L86.63 148.9l25.404 57.644c-5.317 15.501-8.215 32.141-8.215 49.456.002 18.792 3.406 36.797 9.651 53.408z"}),s.jsx("path",{fill:"#518ef8",d:"M507.527 208.176C510.467 223.662 512 239.655 512 256c0 18.328-1.927 36.206-5.598 53.451-12.462 58.683-45.025 109.925-90.134 146.187l-.014-.014-73.044-3.727-10.338-64.535c29.932-17.554 53.324-45.025 65.646-77.911h-136.89V208.176h245.899z"}),s.jsx("path",{fill:"#28b446",d:"m416.253 455.624.014.014C372.396 490.901 316.666 512 256 512c-97.491 0-182.252-54.491-225.491-134.681l82.961-67.91c21.619 57.698 77.278 98.771 142.53 98.771 28.047 0 54.323-7.582 76.87-20.818l83.383 68.262z"}),s.jsx("path",{fill:"#f14336",d:"m419.404 58.936-82.933 67.896C313.136 112.246 285.552 103.82 256 103.82c-66.729 0-123.429 42.957-143.965 102.724l-83.397-68.276h-.014C71.23 56.123 157.06 0 256 0c62.115 0 119.068 22.126 163.404 58.936z"})]})}function hc(){return s.jsxs("svg",{viewBox:"0 0 40 40",width:"25",height:"25",children:[s.jsxs("linearGradient",{id:"a",x1:-277.375,x2:-277.375,y1:406.602,y2:407.573,gradientTransform:"matrix(40 0 0 -39.7778 11115.001 16212.334)",gradientUnits:"userSpaceOnUse",children:[s.jsx("stop",{offset:0,stopColor:"#0062e0"}),s.jsx("stop",{offset:1,stopColor:"#19afff"})]}),s.jsx("path",{fill:"url(#a)",d:"M16.7 39.8C7.2 38.1 0 29.9 0 20 0 9 9 0 20 0s20 9 20 20c0 9.9-7.2 18.1-16.7 19.8l-1.1-.9h-4.4l-1.1.9z"}),s.jsx("path",{fill:"#fff",d:"m27.8 25.6.9-5.6h-5.3v-3.9c0-1.6.6-2.8 3-2.8H29V8.2c-1.4-.2-3-.4-4.4-.4-4.6 0-7.8 2.8-7.8 7.8V20h-5v5.6h5v14.1c1.1.2 2.2.3 3.3.3 1.1 0 2.2-.1 3.3-.3V25.6h4.4z"})]})}function gc(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",id:"openid",className:"h-5 w-5",children:s.jsx("path",{fill:"currentColor",d:"M271.5 432l-68 32C88.5 453.7 0 392.5 0 318.2c0-71.5 82.5-131 191.7-144.3v43c-71.5 12.5-124 53-124 101.3 0 51 58.5 93.3 135.7 103v-340l68-33.2v384zM448 291l-131.3-28.5 36.8-20.7c-19.5-11.5-43.5-20-70-24.8v-43c46.2 5.5 87.7 19.5 120.3 39.3l35-19.8L448 291z"})})}function xc(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"none",children:s.jsx("path",{fill:"currentColor",d:"M12 0a12 12 0 0 0-3.84 23.399c.608.112.832-.256.832-.576v-2.015c-3.395.736-4.115-1.632-4.115-1.632a3.241 3.241 0 0 0-1.359-1.792c-1.104-.736.064-.736.064-.736a2.566 2.566 0 0 1 1.824 1.216a2.638 2.638 0 0 0 3.616 1.024a2.607 2.607 0 0 1 .768-1.6c-2.688-.32-5.504-1.344-5.504-5.984a4.677 4.677 0 0 1 1.216-3.168a4.383 4.383 0 0 1 .128-3.136s1.024-.32 3.36 1.216a11.66 11.66 0 0 1 6.112 0c2.336-1.536 3.36-1.216 3.36-1.216a4.354 4.354 0 0 1 .128 3.136a4.628 4.628 0 0 1 1.216 3.168c0 4.672-2.848 5.664-5.536 5.952a2.881 2.881 0 0 1 .832 2.24v3.36c0 .32.224.672.832.576A12 12 0 0 0 12 0z"})})}function vc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",id:"discord",className:"h-6 w-6",children:[s.jsx("circle",{cx:"512",cy:"512",r:"512",fill:"#5865f2"}),s.jsx("path",{fill:"#fff",d:"M689.43 349a422.21 422.21 0 0 0-104.22-32.32 1.58 1.58 0 0 0-1.68.79 294.11 294.11 0 0 0-13 26.66 389.78 389.78 0 0 0-117.05 0 269.75 269.75 0 0 0-13.18-26.66 1.64 1.64 0 0 0-1.68-.79A421 421 0 0 0 334.44 349a1.49 1.49 0 0 0-.69.59c-66.37 99.17-84.55 195.9-75.63 291.41a1.76 1.76 0 0 0 .67 1.2 424.58 424.58 0 0 0 127.85 64.63 1.66 1.66 0 0 0 1.8-.59 303.45 303.45 0 0 0 26.15-42.54 1.62 1.62 0 0 0-.89-2.25 279.6 279.6 0 0 1-39.94-19 1.64 1.64 0 0 1-.16-2.72c2.68-2 5.37-4.1 7.93-6.22a1.58 1.58 0 0 1 1.65-.22c83.79 38.26 174.51 38.26 257.31 0a1.58 1.58 0 0 1 1.68.2c2.56 2.11 5.25 4.23 8 6.24a1.64 1.64 0 0 1-.14 2.72 262.37 262.37 0 0 1-40 19 1.63 1.63 0 0 0-.87 2.28 340.72 340.72 0 0 0 26.13 42.52 1.62 1.62 0 0 0 1.8.61 423.17 423.17 0 0 0 128-64.63 1.64 1.64 0 0 0 .67-1.18c10.68-110.44-17.88-206.38-75.7-291.42a1.3 1.3 0 0 0-.63-.63zM427.09 582.85c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.02 28.44-20.37 51.6-46 51.6zm170.13 0c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.01 28.44-20.17 51.6-46 51.6z"})]})}function bc(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 814 1000",id:"apple",className:"h-6 w-6",children:s.jsx("path",{d:"M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 790.7 0 663 0 541.8c0-194.4 126.4-297.5 250.8-297.5 66.1 0 121.2 43.4 162.7 43.4 39.5 0 101.1-46 176.3-46 28.5 0 130.9 2.6 198.3 99.2zm-234-181.5c31.1-36.9 53.1-88.1 53.1-139.3 0-7.1-.6-14.3-1.9-20.1-50.6 1.9-110.8 33.7-147.1 75.8-28.5 32.4-55.1 83.6-55.1 135.5 0 7.8 1.3 15.6 1.9 18.1 3.2.6 8.4 1.3 13.6 1.3 45.4 0 102.5-30.4 135.5-71.3z",fill:"currentColor"})})}function _c(){return s.jsx("svg",{width:"800px",height:"800px",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"h-5 w-5",children:s.jsxs("g",{fill:"#000000",children:[s.jsx("path",{d:"M7.754 2l.463.41c.343.304.687.607 1.026.915C11.44 5.32 13.3 7.565 14.7 10.149c.072.132.137.268.202.403l.098.203-.108.057-.081-.115-.21-.299-.147-.214c-1.019-1.479-2.04-2.96-3.442-4.145a6.563 6.563 0 00-1.393-.904c-1.014-.485-1.916-.291-2.69.505-.736.757-1.118 1.697-1.463 2.653-.045.123-.092.245-.139.367l-.082.215-.172-.055c.1-.348.192-.698.284-1.049.21-.795.42-1.59.712-2.356.31-.816.702-1.603 1.093-2.39.169-.341.338-.682.5-1.025h.092z"}),s.jsx("path",{d:"M8.448 11.822c-1.626.77-5.56 1.564-7.426 1.36C.717 11.576 3.71 4.05 5.18 2.91l-.095.218a4.638 4.638 0 01-.138.303l-.066.129c-.76 1.462-1.519 2.926-1.908 4.53a7.482 7.482 0 00-.228 1.689c-.01 1.34.824 2.252 2.217 2.309.67.027 1.347-.043 2.023-.114.294-.03.587-.061.88-.084.108-.008.214-.021.352-.039l.231-.028z"}),s.jsx("path",{d:"M3.825 14.781c-.445.034-.89.068-1.333.108 4.097.39 8.03-.277 11.91-1.644-1.265-2.23-2.97-3.991-4.952-5.522.026.098.084.169.141.239l.048.06c.17.226.348.448.527.67.409.509.818 1.018 1.126 1.578.778 1.42.356 2.648-1.168 3.296-1.002.427-2.097.718-3.18.892-1.03.164-2.075.243-3.119.323z"})]})})}function yc({size:e=25,className:t=""}){return s.jsxs("svg",{viewBox:"0 0 24 16",overflow:"visible",width:e,height:e,className:ci("fill-current text-black",t),children:[s.jsx("g",{style:{transform:"translateX(13px) rotateZ(0deg)",transformOrigin:"4.775px 7.73501px"},children:s.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M0,0 C0,0 6.1677093505859375,15.470022201538086 6.1677093505859375,15.470022201538086 C6.1677093505859375,15.470022201538086 9.550004005432129,15.470022201538086 9.550004005432129,15.470022201538086 C9.550004005432129,15.470022201538086 3.382294178009033,0 3.382294178009033,0 C3.382294178009033,0 0,0 0,0 C0,0 0,0 0,0z"})}),s.jsx("g",{style:{transform:"none",transformOrigin:"7.935px 7.73501px"},opacity:"1",children:s.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 7.93500280380249,3.911694288253784 7.93500280380249,3.911694288253784 C7.93500280380249,3.911694288253784 10.045400619506836,9.348296165466309 10.045400619506836,9.348296165466309 C10.045400619506836,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309z M6.166755199432373,0 C6.166755199432373,0 0,15.470022201538086 0,15.470022201538086 C0,15.470022201538086 3.4480772018432617,15.470022201538086 3.4480772018432617,15.470022201538086 C3.4480772018432617,15.470022201538086 4.709278583526611,12.22130012512207 4.709278583526611,12.22130012512207 C4.709278583526611,12.22130012512207 11.16093635559082,12.22130012512207 11.16093635559082,12.22130012512207 C11.16093635559082,12.22130012512207 12.421928405761719,15.470022201538086 12.421928405761719,15.470022201538086 C12.421928405761719,15.470022201538086 15.87000560760498,15.470022201538086 15.87000560760498,15.470022201538086 C15.87000560760498,15.470022201538086 9.703250885009766,0 9.703250885009766,0 C9.703250885009766,0 6.166755199432373,0 6.166755199432373,0 C6.166755199432373,0 6.166755199432373,0 6.166755199432373,0z"})})]})}function jc({size:e=24,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",className:ci("text-white dark:text-black",t),children:s.jsx("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function wc(){return s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 5C14.4477 5 14 4.55228 14 4C14 3.44772 14.4477 3 15 3H20C20.5523 3 21 3.44772 21 4V9C21 9.55228 20.5523 10 20 10C19.4477 10 19 9.55228 19 9V6.41421L13.7071 11.7071C13.3166 12.0976 12.6834 12.0976 12.2929 11.7071C11.9024 11.3166 11.9024 10.6834 12.2929 10.2929L17.5858 5H15ZM4 7C4 5.34315 5.34315 4 7 4H10C10.5523 4 11 4.44772 11 5C11 5.55228 10.5523 6 10 6H7C6.44772 6 6 6.44772 6 7V17C6 17.5523 6.44772 18 7 18H17C17.5523 18 18 17.5523 18 17V14C18 13.4477 18.4477 13 19 13C19.5523 13 20 13.4477 20 14V17C20 18.6569 18.6569 20 17 20H7C5.34315 20 4 18.6569 4 17V7Z",fill:"currentColor"})})}const Nc=({className:e=""})=>s.jsxs("svg",{className:e,width:"17",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),s.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]});function Cc({unpin:e=!1}){return e?s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[s.jsx("path",{d:"M15 15V17.5585C15 18.4193 14.4491 19.1836 13.6325 19.4558L13.1726 19.6091C12.454 19.8487 11.6616 19.6616 11.126 19.126L4.87403 12.874C4.33837 12.3384 4.15132 11.546 4.39088 10.8274L4.54415 10.3675C4.81638 9.55086 5.58066 9 6.44152 9H9M12 6.2L13.6277 3.92116C14.3461 2.91549 15.7955 2.79552 16.6694 3.66942L20.3306 7.33058C21.2045 8.20448 21.0845 9.65392 20.0788 10.3723L18 11.8571",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M8 16L3 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M4 4L20 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):s.jsx("svg",{className:"icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.4845 2.8798C16.1773 1.57258 14.0107 1.74534 12.9272 3.24318L9.79772 7.56923C9.60945 7.82948 9.30775 7.9836 8.98654 7.9836H6.44673C3.74061 7.9836 2.27414 11.6759 4.16948 13.5713L6.59116 15.993L2.29324 20.2909C1.90225 20.6819 1.90225 21.3158 2.29324 21.7068C2.68422 22.0977 3.31812 22.0977 3.70911 21.7068L8.00703 17.4088L10.4287 19.8305C12.3241 21.7259 16.0164 20.2594 16.0164 17.5533V15.0135C16.0164 14.6923 16.1705 14.3906 16.4308 14.2023L20.7568 11.0728C22.2547 9.98926 22.4274 7.8227 21.1202 6.51549L17.4845 2.8798ZM11.8446 18.4147C12.4994 19.0694 14.0141 18.4928 14.0141 17.5533V15.0135C14.0141 14.0499 14.4764 13.1447 15.2572 12.58L19.5832 9.45047C20.0825 9.08928 20.1401 8.3671 19.7043 7.93136L16.0686 4.29567C15.6329 3.85993 14.9107 3.91751 14.5495 4.4168L11.4201 8.74285C10.8553 9.52359 9.95016 9.98594 8.98654 9.98594H6.44673C5.5072 9.98594 4.93059 11.5006 5.58535 12.1554L11.8446 18.4147Z",fill:"currentColor"})})}function kc({className:e=""}){return s.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci("icon-md h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z",fill:"currentColor"})})}function Sc({size:e,className:t="icon-md"}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.4646 19C15.2219 20.6961 13.7632 22 12 22C10.2368 22 8.77806 20.6961 8.53544 19H6C4.34315 19 3 17.6569 3 16V13.5C3 12.9477 3.44772 12.5 4 12.5H4.5C5.32843 12.5 6 11.8284 6 11C6 10.1716 5.32843 9.5 4.5 9.5H4C3.44772 9.5 3 9.05229 3 8.5L3 6C3 4.34315 4.34315 3 6 3L18 3C19.6569 3 21 4.34315 21 6L21 16C21 17.6569 19.6569 19 18 19H15.4646ZM12 20C12.8284 20 13.5 19.3284 13.5 18.5V18C13.5 17.4477 13.9477 17 14.5 17H18C18.5523 17 19 16.5523 19 16L19 6C19 5.44772 18.5523 5 18 5L6 5C5.44772 5 5 5.44772 5 6V7.53544C6.69615 7.77806 8 9.23676 8 11C8 12.7632 6.69615 14.2219 5 14.4646L5 16C5 16.5523 5.44771 17 6 17H9.5C10.0523 17 10.5 17.4477 10.5 18V18.5C10.5 19.3284 11.1716 20 12 20Z",fill:"currentColor"})})}function Ec({size:e=25,className:t="h-4 w-4"}){const n=e,a=e;return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:ci(t,""),width:a,height:n,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"m8.0458 0.81981a1.1197 1.1197 0 0 0-1.0608 0.76184l-6.7912 20.123a1.1178 1.1178 0 0 0 1.0592 1.4751h5.4647a1.1197 1.1197 0 0 0 1.0608-0.7615l1.3528-4.0084-2.3684-2.2107a0.51536 0.51536 0 0 1 0.35193-0.8923h3.0639l1.8213-5.3966-2.8111-8.3294a1.1181 1.1181 0 0 0-1.0595-0.76049h-0.0836z"}),s.jsx("path",{d:"m7.1147 15.307a0.51536 0.51536 0 0 0-0.35193 0.8923l7.1552 6.6782a1.1248 1.1248 0 0 0 0.76724 0.30238h0.2417a1.1181 1.1181 0 0 0 1.0534-1.4755l-2.1591-6.3974z"}),s.jsx("path",{d:"m17.015 1.5807a1.1178 1.1178 0 0 0-1.0593-0.76049h-7.8258a1.1181 1.1181 0 0 1 1.0593 0.76049l6.7916 20.123a1.1181 1.1181 0 0 1-1.0593 1.4757h7.8261a1.1181 1.1181 0 0 0 1.059-1.4757z"})]})}function Tc({className:e="h-4 w-4"}){return s.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"1",viewBox:"0 0 40 40",strokeLinecap:"round",strokeLinejoin:"round",className:e,height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z"})})}function Ic({size:e=25,className:t=""}){return s.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 19 17",fill:"none",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[s.jsx("path",{d:"M9.62674 16.2202H9.7049C10.4225 16.2202 11.0016 15.6412 11.0016 14.9236V4.04224H8.33008V14.92C8.33008 15.6376 8.90914 16.2202 9.62674 16.2202Z",fill:"#F9AB00"}),s.jsx("path",{d:"M14.6819 8.02813C13.3249 6.66752 11.2964 6.39398 9.66577 7.2004L15.0585 12.5931C15.2823 12.8169 15.6624 12.7281 15.7583 12.4297C16.2308 10.927 15.8756 9.21822 14.6819 8.02813Z",fill:"#5BB974"}),s.jsx("path",{d:"M4.64953 8.02813C6.00659 6.66752 8.03507 6.39398 9.66567 7.2004L4.27297 12.5931C4.04916 12.8169 3.66904 12.7281 3.57312 12.4297C3.10064 10.927 3.45589 9.21822 4.64953 8.02813Z",fill:"#129EAF"}),s.jsx("path",{d:"M14.284 3.84326C12.1383 3.84326 10.3159 5.25005 9.66577 7.20038H18.1918C18.5399 7.20038 18.7744 6.83092 18.6145 6.5183C17.8081 4.93033 16.1704 3.84326 14.284 3.84326Z",fill:"#AF5CF7"}),s.jsx("path",{d:"M10.5574 1.55901C9.04053 3.07593 8.74567 5.36019 9.66577 7.20039L15.6944 1.17179C15.943 0.923113 15.8436 0.496814 15.5132 0.390239C13.8151 -0.1604 11.8896 0.226822 10.5574 1.55901Z",fill:"#FF8BCB"}),s.jsx("path",{d:"M8.77408 1.55901C10.291 3.07593 10.5859 5.36019 9.66576 7.20039L3.63716 1.17179C3.38848 0.923113 3.48795 0.496814 3.81833 0.390239C5.51643 -0.1604 7.44189 0.226822 8.77408 1.55901Z",fill:"#FA7B17"}),s.jsx("path",{d:"M5.04752 3.84326C7.19323 3.84326 9.01566 5.25005 9.66577 7.20038H1.13976C0.791616 7.20038 0.55715 6.83092 0.717013 6.5183C1.52343 4.93033 3.16114 3.84326 5.04752 3.84326Z",fill:"#4285F4"})]})}function Rc({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,className:ci("dark:fill-white",t),viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:s.jsx("path",{d:"M2 4.006C2 2.898 2.897 2 4.006 2h9.988C15.102 2 16 2.897 16 4.006v9.988A2.005 2.005 0 0 1 13.994 16H4.006A2.005 2.005 0 0 1 2 13.994V4.006zM13.992 9l.003-.003L10.997 6 9.75 7.247 11.503 9 9.75 10.753 10.997 12l2.997-2.997L13.992 9zm-9.99 0L4 8.997 6.997 6l1.247 1.247L6.492 9l1.753 1.753L6.997 12 4 9.003 4.003 9z",fillRule:"evenodd"})})}function Pc({size:e=25,className:t=""}){return s.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[s.jsx("path",{fill:"url(#_4rif_paint0_radial_897_42)",d:"M9 18c0-1.245-.24-2.415-.72-3.51a8.934 8.934 0 00-1.912-2.857A8.934 8.934 0 003.51 9.72 8.646 8.646 0 000 9a8.886 8.886 0 003.51-.697 9.247 9.247 0 002.857-1.936A8.934 8.934 0 008.28 3.51C8.76 2.415 9 1.245 9 0c0 1.245.232 2.415.697 3.51a9.247 9.247 0 001.936 2.857 9.247 9.247 0 002.857 1.936A8.886 8.886 0 0018 9c-1.245 0-2.415.24-3.51.72a8.934 8.934 0 00-2.857 1.912 9.247 9.247 0 00-1.935 2.858A8.886 8.886 0 009 18z"}),s.jsx("defs",{children:s.jsxs("radialGradient",{id:"_4rif_paint0_radial_897_42",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"rotate(135 9 3.728) scale(25.4558 12.7279)",children:[s.jsx("stop",{offset:".325",stopColor:"#FFDDB7"}),s.jsx("stop",{offset:".706",stopColor:"#076EFF"})]})})]})}function Ac({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",width:"800px",height:"800px",viewBox:"0 0 512 512",className:ci("h-4 w-4",e),children:s.jsx("path",{d:"M473.16,221.48l-2.26-9.59H262.46v88.22H387c-12.93,61.4-72.93,93.72-121.94,93.72-35.66,0-73.25-15-98.13-39.11a140.08,140.08,0,0,1-41.8-98.88c0-37.16,16.7-74.33,41-98.78s61-38.13,97.49-38.13c41.79,0,71.74,22.19,82.94,32.31l62.69-62.36C390.86,72.72,340.34,32,261.6,32h0c-60.75,0-119,23.27-161.58,65.71C58,139.5,36.25,199.93,36.25,256S56.83,369.48,97.55,411.6C141.06,456.52,202.68,480,266.13,480c57.73,0,112.45-22.62,151.45-63.66,38.34-40.4,58.17-96.3,58.17-154.9C475.75,236.77,473.27,222.12,473.16,221.48Z"})})}function Mc({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:ci(e),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),s.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),s.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function Lc({className:e="",size:t="1em"}){return s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:ci(e),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 4.9099C11 4.47485 10.4828 4.24734 10.1621 4.54132L6.67572 7.7372C6.49129 7.90626 6.25019 8.00005 6 8.00005H4C3.44772 8.00005 3 8.44776 3 9.00005V15C3 15.5523 3.44772 16 4 16H6C6.25019 16 6.49129 16.0938 6.67572 16.2629L10.1621 19.4588C10.4828 19.7527 11 19.5252 11 19.0902V4.9099ZM8.81069 3.06701C10.4142 1.59714 13 2.73463 13 4.9099V19.0902C13 21.2655 10.4142 22.403 8.81069 20.9331L5.61102 18H4C2.34315 18 1 16.6569 1 15V9.00005C1 7.34319 2.34315 6.00005 4 6.00005H5.61102L8.81069 3.06701ZM20.3166 6.35665C20.8019 6.09313 21.409 6.27296 21.6725 6.75833C22.5191 8.3176 22.9996 10.1042 22.9996 12.0001C22.9996 13.8507 22.5418 15.5974 21.7323 17.1302C21.4744 17.6185 20.8695 17.8054 20.3811 17.5475C19.8927 17.2896 19.7059 16.6846 19.9638 16.1962C20.6249 14.9444 20.9996 13.5175 20.9996 12.0001C20.9996 10.4458 20.6064 8.98627 19.9149 7.71262C19.6514 7.22726 19.8312 6.62017 20.3166 6.35665ZM15.7994 7.90049C16.241 7.5688 16.8679 7.65789 17.1995 8.09947C18.0156 9.18593 18.4996 10.5379 18.4996 12.0001C18.4996 13.3127 18.1094 14.5372 17.4385 15.5604C17.1357 16.0222 16.5158 16.1511 16.0539 15.8483C15.5921 15.5455 15.4632 14.9255 15.766 14.4637C16.2298 13.7564 16.4996 12.9113 16.4996 12.0001C16.4996 10.9859 16.1653 10.0526 15.6004 9.30063C15.2687 8.85905 15.3578 8.23218 15.7994 7.90049Z",fill:"currentColor"})})}function Oc({className:e="",size:t="1em"}){return s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:ci(e),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM9.5 8.5C8.94772 8.5 8.5 8.94772 8.5 9.5V14.5C8.5 15.0523 8.94772 15.5 9.5 15.5H14.5C15.0523 15.5 15.5 15.0523 15.5 14.5V9.5C15.5 8.94772 15.0523 8.5 14.5 8.5H9.5Z",fill:"currentColor"})})}function Dc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}function Fc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:ci("text-black dark:text-white",e),"aria-hidden":!0,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})}function zc({className:e=""}){return s.jsxs("svg",{version:"1.1",viewBox:"0 0 233.33 290",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:ci("h-9 w-9",e),children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"linearGradient1842",x1:"163.92",x2:"173.66",y1:"22.212",y2:"-6.5784",gradientTransform:"translate(.10391 .050143)",gradientUnits:"userSpaceOnUse",children:[s.jsx("stop",{stopColor:"#640a62",offset:"0"}),s.jsx("stop",{stopColor:"#852283",offset:".49917"}),s.jsx("stop",{stopColor:"#640a62",offset:"1"})]})}),s.jsxs("g",{children:[s.jsx("path",{transform:"matrix(.43416 .90084 -.89966 .4366 0 0)",d:"m259.29-126.03a232.2 237.56 0 0 1-17.412 231.34l-193.32-131.59z",fill:"url(#linearGradient1842)"}),s.jsx("path",{transform:"matrix(.6967 .051926 -.051926 .6967 35.578 23.196)",d:"m50.818 31.415c-1.4654 2.4749-10.838 2.4195-12.997 4.3204-2.1584 1.9009-3.288 11.206-5.9282 12.347-2.6402 1.1409-10.191-4.4132-13.054-4.1441-2.8636 0.26917-9.2466 7.133-12.053 6.5041-2.8066-0.62889-5.6503-9.5602-8.1252-11.026-2.4749-1.4654-11.673 0.33572-13.574-1.8227s1.0482-11.056-0.0927-13.696c-1.1409-2.6402-9.6412-6.5898-9.9104-9.4533-0.26917-2.8636 7.3463-8.328 7.9752-11.135 0.62889-2.8066-3.9265-10.998-2.4612-13.473 1.4654-2.4749 10.838-2.4195 12.997-4.3204 2.1584-1.9009 3.288-11.206 5.9282-12.347 2.6402-1.1409 10.191 4.4132 13.054 4.1441 2.8636-0.26917 9.2466-7.133 12.053-6.5041 2.8066 0.62889 5.6503 9.5602 8.1252 11.026s11.673-0.33572 13.574 1.8227c1.9009 2.1584-1.0482 11.056 0.0927 13.696 1.1409 2.6402 9.6412 6.5898 9.9104 9.4533 0.26917 2.8635-7.3463 8.328-7.9752 11.135-0.62889 2.8066 3.9265 10.998 2.4612 13.473z",fill:"#ff9d78",stroke:"#f29472",strokeWidth:"4.7877"}),s.jsx("circle",{cx:"170.36",cy:"215.76",r:"12.903",fill:"#cfffff"}),s.jsx("path",{d:"m220.77 174.77c-88.526 101.03-191.21 85.731-209.5 82.142-2.2101-2e-5 -2.6686 0.42426-3.437 2.0021l-1.7042 7.5028c0.056197 2.3603 0.37544 2.6428 1.9121 3.5409 18.396 3.3746 130.27 19.488 223.46-86.881 0.64011-1.5095 0.46653-3.1324-0.59137-4.7337l-5.1558-3.6482c-1.586-0.8743-3.9524-0.94332-4.9837 0.0751z",color:"#000000",fill:"#ff9d78",stroke:"#f29472",strokeLinejoin:"round",strokeWidth:"2.8913"}),s.jsxs("g",{fill:"#cfffff",children:[s.jsx("circle",{cx:"72.684",cy:"99.47",r:"12.903"}),s.jsx("circle",{cx:"99.144",cy:"172.32",r:"12.903"}),s.jsx("circle",{cx:"59.617",cy:"214.78",r:"12.903"}),s.jsx("circle",{cx:"135.4",cy:"118.42",r:"12.903"}),s.jsx("path",{transform:"rotate(38.66)",d:"m254.21-1.9608a12.903 12.903 0 0 1-6.4852 11.194 12.903 12.903 0 0 1-12.937-0.0582 12.903 12.903 0 0 1-6.3843-11.252l12.903 0.1161z"}),s.jsx("path",{d:"m29.476 158.16a12.903 12.903 0 0 0-3.6562 0.5293l-3.3691 23.189a12.903 12.903 0 0 0 7.0254 2.0879 12.903 12.903 0 0 0 12.904-12.904 12.903 12.903 0 0 0-12.904-12.902z"})]})]})]})}function Uc({className:e="",size:t="1em"}){return s.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:ci("text-token-secondary h-2/3 w-2/3",e),xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),s.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),s.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}function Vc({className:e="",size:t=24}){return s.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:ci("icon-md shrink-0",e),children:[s.jsx("path",{d:"M19.3975 1.35498C19.3746 1.15293 19.2037 1.00021 19.0004 1C18.7971 0.999793 18.6259 1.15217 18.6026 1.35417C18.4798 2.41894 18.1627 3.15692 17.6598 3.65983C17.1569 4.16274 16.4189 4.47983 15.3542 4.60264C15.1522 4.62593 14.9998 4.79707 15 5.00041C15.0002 5.20375 15.1529 5.37457 15.355 5.39746C16.4019 5.51605 17.1562 5.83304 17.6716 6.33906C18.1845 6.84269 18.5078 7.57998 18.6016 8.63539C18.6199 8.84195 18.7931 9.00023 19.0005 9C19.2078 8.99977 19.3806 8.84109 19.3985 8.6345C19.4883 7.59673 19.8114 6.84328 20.3273 6.32735C20.8433 5.81142 21.5967 5.48834 22.6345 5.39851C22.8411 5.38063 22.9998 5.20782 23 5.00045C23.0002 4.79308 22.842 4.61992 22.6354 4.60157C21.58 4.50782 20.8427 4.18447 20.3391 3.67157C19.833 3.15623 19.516 2.40192 19.3975 1.35498Z",fill:"currentColor"}),s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 3C11.4833 3 11.8974 3.34562 11.9839 3.82111C12.4637 6.46043 13.279 8.23983 14.5196 9.48039C15.7602 10.721 17.5396 11.5363 20.1789 12.0161C20.6544 12.1026 21 12.5167 21 13C21 13.4833 20.6544 13.8974 20.1789 13.9839C17.5396 14.4637 15.7602 15.279 14.5196 16.5196C13.279 17.7602 12.4637 19.5396 11.9839 22.1789C11.8974 22.6544 11.4833 23 11 23C10.5167 23 10.1026 22.6544 10.0161 22.1789C9.53625 19.5396 8.72096 17.7602 7.48039 16.5196C6.23983 15.279 4.46043 14.4637 1.82111 13.9839C1.34562 13.8974 1 13.4833 1 13C1 12.5167 1.34562 12.1026 1.82111 12.0161C4.46043 11.5363 6.23983 10.721 7.48039 9.48039C8.72096 8.23983 9.53625 6.46043 10.0161 3.82111C10.1026 3.34562 10.5167 3 11 3ZM5.66618 13C6.9247 13.5226 7.99788 14.2087 8.89461 15.1054C9.79134 16.0021 10.4774 17.0753 11 18.3338C11.5226 17.0753 12.2087 16.0021 13.1054 15.1054C14.0021 14.2087 15.0753 13.5226 16.3338 13C15.0753 12.4774 14.0021 11.7913 13.1054 10.8946C12.2087 9.99788 11.5226 8.9247 11 7.66618C10.4774 8.9247 9.79134 9.99788 8.89461 10.8946C7.99788 11.7913 6.9247 12.4774 5.66618 13Z",fill:"currentColor"})]})}function Bc({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:ci(e),children:[s.jsx("path",{d:"M2 10v3"}),s.jsx("path",{d:"M6 6v11"}),s.jsx("path",{d:"M10 3v18"}),s.jsx("path",{d:"M14 8v7"}),s.jsx("path",{d:"M18 5v13"}),s.jsx("path",{d:"M22 10v3"})]})}function $c({size:e="1em",className:t}){return s.jsx("svg",{viewBox:"64 64 896 896",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,width:e,height:e,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"})})}function Hc({className:e="icon-md-heavy",size:t="1em"}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:ci(e),children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.jsx("path",{d:"M12 17h.01"})]})}function Gc({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:ci("fill-current text-black",t),children:s.jsx("g",{fill:"currentColor",children:s.jsx("path",{d:"M12,18.1397014 L9.574,18.9487014 L8.628,18.3177014 L9.658,17.9737014 L9.342,17.0257014 L7.574,17.6147014 L7,17.2327014 L7,14.4997014 C7,14.3107014 6.893,14.1377014 6.724,14.0527014 L5,13.1907014 L5,10.8087014 L6.5,10.0587014 L8,10.8087014 L8,12.4997014 C8,12.6897014 8.107,12.8627014 8.276,12.9477014 L10.276,13.9477014 L10.724,13.0527014 L9,12.1907014 L9,10.8087014 L10.724,9.94770136 C10.893,9.86270136 11,9.68970136 11,9.49970136 L11,7.99970136 L10,7.99970136 L10,9.19070136 L8.5,9.94070136 L7,9.19070136 L7,6.76770136 L8,6.10070136 L8,7.99970136 L9,7.99970136 L9,5.43470136 L9.574,5.05170136 L12,5.86070136 L12,18.1397014 Z M17.5,16.9997014 C17.775,16.9997014 18,17.2237014 18,17.4997014 C18,17.7757014 17.775,17.9997014 17.5,17.9997014 C17.225,17.9997014 17,17.7757014 17,17.4997014 C17,17.2237014 17.225,16.9997014 17.5,16.9997014 L17.5,16.9997014 Z M16.5,5.99970136 C16.775,5.99970136 17,6.22370136 17,6.49970136 C17,6.77570136 16.775,6.99970136 16.5,6.99970136 C16.225,6.99970136 16,6.77570136 16,6.49970136 C16,6.22370136 16.225,5.99970136 16.5,5.99970136 L16.5,5.99970136 Z M18.5,11.9997014 C18.775,11.9997014 19,12.2237014 19,12.4997014 C19,12.7757014 18.775,12.9997014 18.5,12.9997014 C18.225,12.9997014 18,12.7757014 18,12.4997014 C18,12.2237014 18.225,11.9997014 18.5,11.9997014 L18.5,11.9997014 Z M17.092,12.9997014 C17.299,13.5807014 17.849,13.9997014 18.5,13.9997014 C19.327,13.9997014 20,13.3277014 20,12.4997014 C20,11.6727014 19.327,10.9997014 18.5,10.9997014 C17.849,10.9997014 17.299,11.4197014 17.092,11.9997014 L13,11.9997014 L13,9.99970136 L16.5,9.99970136 C16.776,9.99970136 17,9.77670136 17,9.49970136 L17,7.90770136 C17.581,7.70070136 18,7.15070136 18,6.49970136 C18,5.67270136 17.327,4.99970136 16.5,4.99970136 C15.673,4.99970136 15,5.67270136 15,6.49970136 C15,7.15070136 15.419,7.70070136 16,7.90770136 L16,8.99970136 L13,8.99970136 L13,5.49970136 C13,5.28470136 12.862,5.09370136 12.658,5.02570136 L9.658,4.02570136 C9.511,3.97670136 9.351,3.99870136 9.223,4.08370136 L6.223,6.08370136 C6.084,6.17670136 6,6.33270136 6,6.49970136 L6,9.19070136 L4.276,10.0527014 C4.107,10.1377014 4,10.3107014 4,10.4997014 L4,13.4997014 C4,13.6897014 4.107,13.8627014 4.276,13.9477014 L6,14.8087014 L6,17.4997014 C6,17.6667014 6.084,17.8237014 6.223,17.9157014 L9.223,19.9157014 C9.306,19.9717014 9.402,19.9997014 9.5,19.9997014 C9.553,19.9997014 9.606,19.9917014 9.658,19.9737014 L12.658,18.9737014 C12.862,18.9067014 13,18.7157014 13,18.4997014 L13,15.9997014 L15.293,15.9997014 L16.146,16.8537014 L16.159,16.8407014 C16.061,17.0407014 16,17.2627014 16,17.4997014 C16,18.3267014 16.673,18.9997014 17.5,18.9997014 C18.327,18.9997014 19,18.3267014 19,17.4997014 C19,16.6727014 18.327,15.9997014 17.5,15.9997014 C17.262,15.9997014 17.04,16.0607014 16.841,16.1597014 L16.854,16.1467014 L15.854,15.1467014 C15.76,15.0527014 15.633,14.9997014 15.5,14.9997014 L13,14.9997014 L13,12.9997014 L17.092,12.9997014 Z"})})})}function Kc({className:e="",size:t="1em",bold:n=!1}){return n?s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[s.jsx("path",{d:"M12.592 2.50386C12.8047 2.13014 13.2317 1.935 13.652 2.01942C15.5627 2.40314 16.7246 4.36079 16.1516 6.23085L15.303 9L17.0142 9C19.6409 9 21.5485 11.5079 20.8574 14.0525L19.4994 19.0525C19.0267 20.7927 17.4526 22 15.6562 22H9.96721C8.869 21.9979 7.97939 21.1033 7.97939 20V9H8.31734C8.67472 9 9.0047 8.80771 9.18201 8.49613L12.592 2.50386Z",fill:"currentColor"}),s.jsx("path",{d:"M5.98763 9C4.33761 9 3 10.3431 3 12V19C3 20.6569 4.33761 22 5.98763 22H6.52055C6.18162 21.4116 5.98763 20.7286 5.98763 20V9Z",fill:"currentColor"})]}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.1318 2.50389C12.3321 2.15338 12.7235 1.95768 13.124 2.00775L13.5778 2.06447C16.0449 2.37286 17.636 4.83353 16.9048 7.20993L16.354 8.99999H17.0722C19.7097 8.99999 21.6253 11.5079 20.9313 14.0525L19.5677 19.0525C19.0931 20.7927 17.5124 22 15.7086 22H6C4.34315 22 3 20.6568 3 19V12C3 10.3431 4.34315 8.99999 6 8.99999H8C8.25952 8.99999 8.49914 8.86094 8.6279 8.63561L12.1318 2.50389ZM10 20H15.7086C16.6105 20 17.4008 19.3964 17.6381 18.5262L19.0018 13.5262C19.3488 12.2539 18.391 11 17.0722 11H15C14.6827 11 14.3841 10.8494 14.1956 10.5941C14.0071 10.3388 13.9509 10.0092 14.0442 9.70591L14.9932 6.62175C15.3384 5.49984 14.6484 4.34036 13.5319 4.08468L10.3644 9.62789C10.0522 10.1742 9.56691 10.5859 9 10.8098V19C9 19.5523 9.44772 20 10 20ZM7 11V19C7 19.3506 7.06015 19.6872 7.17071 20H6C5.44772 20 5 19.5523 5 19V12C5 11.4477 5.44772 11 6 11H7Z",fill:"currentColor"})})}function Wc({className:e="",size:t="1em",bold:n=!1}){return n?s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[s.jsx("path",{d:"M11.4079 21.4961C11.1953 21.8698 10.7683 22.0649 10.348 21.9805C8.4373 21.5968 7.27541 19.6391 7.84844 17.7691L8.69697 14.9999L6.98577 14.9999C4.35915 14.9999 2.45151 12.492 3.14262 9.94747L4.50063 4.94747C4.97329 3.20722 6.54741 1.99994 8.34378 1.99994H14.0328C15.131 2.00207 16.0206 2.89668 16.0206 3.99994V14.9999H15.6827C15.3253 14.9999 14.9953 15.1922 14.818 15.5038L11.4079 21.4961Z",fill:"currentColor"}),s.jsx("path",{d:"M18.0124 14.9999C19.6624 14.9999 21 13.6568 21 11.9999V4.99994C21 3.34308 19.6624 1.99994 18.0124 1.99994H17.4794C17.8184 2.58829 18.0124 3.27136 18.0124 3.99994V14.9999Z",fill:"currentColor"})]}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.8727 21.4961C11.6725 21.8466 11.2811 22.0423 10.8805 21.9922L10.4267 21.9355C7.95958 21.6271 6.36855 19.1665 7.09975 16.7901L7.65054 15H6.93226C4.29476 15 2.37923 12.4921 3.0732 9.94753L4.43684 4.94753C4.91145 3.20728 6.49209 2 8.29589 2H18.0045C19.6614 2 21.0045 3.34315 21.0045 5V12C21.0045 13.6569 19.6614 15 18.0045 15H16.0045C15.745 15 15.5054 15.1391 15.3766 15.3644L11.8727 21.4961ZM14.0045 4H8.29589C7.39399 4 6.60367 4.60364 6.36637 5.47376L5.00273 10.4738C4.65574 11.746 5.61351 13 6.93226 13H9.00451C9.32185 13 9.62036 13.1506 9.8089 13.4059C9.99743 13.6612 10.0536 13.9908 9.96028 14.2941L9.01131 17.3782C8.6661 18.5002 9.35608 19.6596 10.4726 19.9153L13.6401 14.3721C13.9523 13.8258 14.4376 13.4141 15.0045 13.1902V5C15.0045 4.44772 14.5568 4 14.0045 4ZM17.0045 13V5C17.0045 4.64937 16.9444 4.31278 16.8338 4H18.0045C18.5568 4 19.0045 4.44772 19.0045 5V12C19.0045 12.5523 18.5568 13 18.0045 13H17.0045Z",fill:"currentColor"})})}function qc({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",fill:"currentColor",className:e,children:s.jsx("path",{d:"m3.005 8.858 8.783 12.544h3.904L6.908 8.858zM6.905 15.825 3 21.402h3.907l1.951-2.788zM16.585 2l-6.75 9.64 1.953 2.79L20.492 2zM17.292 7.965v13.437h3.2V3.395z"})})}function Qc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`icon-sm ${e}`,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4C10.3431 4 9 5.34315 9 7C9 8.65685 10.3431 10 12 10C13.6569 10 15 8.65685 15 7C15 5.34315 13.6569 4 12 4ZM7 7C7 4.23858 9.23858 2 12 2C14.7614 2 17 4.23858 17 7C17 9.76142 14.7614 12 12 12C9.23858 12 7 9.76142 7 7ZM19.0277 15.6255C18.6859 15.5646 18.1941 15.6534 17.682 16.1829C17.4936 16.3777 17.2342 16.4877 16.9632 16.4877C16.6922 16.4877 16.4328 16.3777 16.2444 16.1829C15.7322 15.6534 15.2405 15.5646 14.8987 15.6255C14.5381 15.6897 14.2179 15.9384 14.0623 16.3275C13.8048 16.9713 13.9014 18.662 16.9632 20.4617C20.0249 18.662 20.1216 16.9713 19.864 16.3275C19.7084 15.9384 19.3882 15.6897 19.0277 15.6255ZM21.721 15.5847C22.5748 17.7191 21.2654 20.429 17.437 22.4892C17.1412 22.6484 16.7852 22.6484 16.4893 22.4892C12.6609 20.4291 11.3516 17.7191 12.2053 15.5847C12.6117 14.5689 13.4917 13.8446 14.5481 13.6565C15.3567 13.5125 16.2032 13.6915 16.9632 14.1924C17.7232 13.6915 18.5697 13.5125 19.3783 13.6565C20.4347 13.8446 21.3147 14.5689 21.721 15.5847ZM9.92597 14.2049C10.1345 14.7163 9.889 15.2999 9.3776 15.5084C7.06131 16.453 5.5 18.5813 5.5 20.9999C5.5 21.5522 5.05228 21.9999 4.5 21.9999C3.94772 21.9999 3.5 21.5522 3.5 20.9999C3.5 17.6777 5.641 14.8723 8.6224 13.6565C9.1338 13.448 9.71743 13.6935 9.92597 14.2049Z",fill:"currentColor"})})}function Yc({className:e}){return s.jsxs("svg",{width:"195",height:"195",viewBox:"0 2 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[s.jsx("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),s.jsx("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),s.jsx("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"})]})}function Xc({className:e}){return s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:e,"aria-label":"",children:s.jsx("path",{d:"M7.45996 14.375C7.45996 13.3616 6.63844 12.54 5.625 12.54C4.61156 12.54 3.79004 13.3616 3.79004 14.375C3.79004 15.3884 4.61156 16.21 5.625 16.21C6.63844 16.21 7.45996 15.3884 7.45996 14.375ZM16.21 14.375C16.21 13.3616 15.3884 12.54 14.375 12.54C13.3616 12.54 12.54 13.3616 12.54 14.375C12.54 15.3884 13.3616 16.21 14.375 16.21C15.3884 16.21 16.21 15.3884 16.21 14.375ZM7.45996 5.625C7.45996 4.61156 6.63844 3.79004 5.625 3.79004C4.61156 3.79004 3.79004 4.61156 3.79004 5.625C3.79004 6.63844 4.61156 7.45996 5.625 7.45996C6.63844 7.45996 7.45996 6.63844 7.45996 5.625ZM16.21 5.625C16.21 4.61156 15.3884 3.79004 14.375 3.79004C13.3616 3.79004 12.54 4.61156 12.54 5.625C12.54 6.63844 13.3616 7.45996 14.375 7.45996C15.3884 7.45996 16.21 6.63844 16.21 5.625ZM17.54 14.375C17.54 16.123 16.123 17.54 14.375 17.54C12.627 17.54 11.21 16.123 11.21 14.375C11.21 12.627 12.627 11.21 14.375 11.21C16.123 11.21 17.54 12.627 17.54 14.375ZM8.79004 5.625C8.79004 7.37298 7.37298 8.79004 5.625 8.79004C3.87702 8.79004 2.45996 7.37298 2.45996 5.625C2.45996 3.87702 3.87702 2.45996 5.625 2.45996C7.37298 2.45996 8.79004 3.87702 8.79004 5.625ZM17.54 5.625C17.54 7.37298 16.123 8.79004 14.375 8.79004C13.7416 8.79004 13.153 8.60173 12.6582 8.28125L8.28125 12.6582C8.60173 13.153 8.79004 13.7416 8.79004 14.375C8.79004 16.123 7.37298 17.54 5.625 17.54C3.87702 17.54 2.45996 16.123 2.45996 14.375C2.45996 12.627 3.87702 11.21 5.625 11.21C6.25794 11.21 6.84623 11.3977 7.34082 11.7178L11.7178 7.34082C11.3977 6.84623 11.21 6.25794 11.21 5.625C11.21 3.87702 12.627 2.45996 14.375 2.45996C16.123 2.45996 17.54 3.87702 17.54 5.625Z"})})}function Zc(){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-3xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function Jc(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M21.333 23L26.333 18L21.333 13",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M14.667 13L9.66699 18L14.667 23",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}function ed({file:e,fileType:t}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",fill:"none",className:"h-10 w-10 flex-shrink-0",width:"36",height:"36",children:[s.jsx("rect",{width:"36",height:"36",rx:"6",fill:t.fill}),((null==e?void 0:e.progress)??1)>=1&&s.jsx(s.Fragment,{children:s.jsx(t.paths,{})})]})}function td({className:e=""}){return s.jsx("svg",{fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{d:"M24 13.5q0 1.242-.475 2.332-.474 1.09-1.289 1.904-.814.815-1.904 1.29-1.09.474-2.332.474-.762 0-1.523-.2-.106.997-.557 1.858-.451.862-1.154 1.494-.704.633-1.606.99-.902.358-1.91.358-1.09 0-2.045-.416-.955-.416-1.664-1.125-.709-.709-1.125-1.664Q6 19.84 6 18.75q0-.188.018-.375.017-.188.04-.375H.997q-.41 0-.703-.293T0 17.004V6.996q0-.41.293-.703T.996 6h3.54q.14-1.277.726-2.373.586-1.096 1.488-1.904Q7.652.914 8.807.457 9.96 0 11.25 0q1.395 0 2.625.533T16.02 1.98q.914.915 1.447 2.145T18 6.75q0 .188-.012.375-.011.188-.035.375 1.242 0 2.344.469 1.101.468 1.928 1.277.826.809 1.3 1.904Q24 12.246 24 13.5zm-12.75-12q-.973 0-1.857.34-.885.34-1.577.943-.691.604-1.154 1.43Q6.2 5.039 6.06 6h4.945q.41 0 .703.293t.293.703v4.945l.21-.035q.212-.75.61-1.424.399-.673.944-1.218.545-.545 1.213-.944.668-.398 1.43-.61.093-.503.093-.96 0-1.09-.416-2.045-.416-.955-1.125-1.664-.709-.709-1.664-1.125Q12.34 1.5 11.25 1.5zM6.117 15.902q.54 0 1.06-.111.522-.111.932-.37.41-.257.662-.679.252-.422.252-1.055 0-.632-.263-1.054-.264-.422-.662-.703-.399-.282-.856-.463l-.855-.34q-.399-.158-.662-.334-.264-.176-.264-.445 0-.2.14-.323.141-.123.335-.193.193-.07.404-.094.21-.023.351-.023.598 0 1.055.152.457.153.95.457V8.543q-.282-.082-.522-.14-.24-.06-.475-.1-.234-.041-.486-.059-.252-.017-.557-.017-.515 0-1.054.117-.54.117-.979.375-.44.258-.715.68-.275.421-.275 1.03 0 .598.263.997.264.398.663.68.398.28.855.474l.856.363q.398.17.662.358.263.187.263.457 0 .222-.123.351-.123.13-.31.2-.188.07-.393.087-.205.018-.369.018-.703 0-1.248-.234-.545-.235-1.107-.621v1.875q1.195.468 2.472.468zM11.25 22.5q.773 0 1.453-.293t1.19-.803q.51-.51.808-1.195.299-.686.299-1.459 0-.668-.223-1.277-.222-.61-.62-1.096-.4-.486-.95-.826-.55-.34-1.207-.48v1.933q0 .41-.293.703t-.703.293H7.57q-.07.375-.07.75 0 .773.293 1.459t.803 1.195q.51.51 1.195.803.686.293 1.459.293zM18 18q.926 0 1.746-.352.82-.351 1.436-.966.615-.616.966-1.43.352-.815.352-1.752 0-.926-.352-1.746-.351-.82-.966-1.436-.616-.615-1.436-.966Q18.926 9 18 9t-1.74.357q-.815.358-1.43.973t-.973 1.43q-.357.814-.357 1.74 0 .129.006.258t.017.258q.551.27 1.02.65t.838.855q.369.475.627 1.026.258.55.387 1.148Q17.18 18 18 18Z"})})}const nd=({user:e,size:t=32,className:a="",alt:r,showDefaultWhenEmpty:o=!0})=>{const i=$i(e),[l,c]=n.useState(!1),[d,u]=n.useState(!1),m=n.useMemo((()=>(null==e?void 0:e.avatar)||(null==e?void 0:e.username)||(null==e?void 0:e.email)||""),[null==e?void 0:e.avatar,null==e?void 0:e.username,null==e?void 0:e.email]),p=n.useMemo((()=>r||`${(null==e?void 0:e.name)||(null==e?void 0:e.username)||(null==e?void 0:e.email)||""}'s avatar`),[r,null==e?void 0:e.name,null==e?void 0:e.username,null==e?void 0:e.email]),f=n.useMemo((()=>!m||d?"":((null==e?void 0:e.avatar)??"")||i||""),[null==e?void 0:e.avatar,i,m,d]),h=n.useCallback((()=>{c(!0)}),[]),g=n.useCallback((()=>{u(!0),c(!1)}),[]),x=n.useCallback((()=>s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:`${t}px`,height:`${t}px`,boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:`relative flex items-center justify-center rounded-full p-1 text-text-primary ${a}`,"aria-hidden":"true",children:s.jsx(Dc,{})})),[t,a]);return 0===m.length&&o?s.jsx(x,{}):m.length>0&&!d?s.jsxs("div",{className:"relative",style:{width:`${t}px`,height:`${t}px`},children:[!l&&s.jsx(Nl,{className:"rounded-full",style:{width:`${t}px`,height:`${t}px`}}),s.jsx("img",{style:{width:`${t}px`,height:`${t}px`,display:l?"block":"none"},className:`rounded-full ${a}`,src:f,alt:p,onLoad:h,onError:g})]}):d&&o?s.jsx(x,{}):null};fi(".popover-ui {\n  display: flex;\n  max-height: min(var(--popover-available-height, 1700px), 1700px);\n  flex-direction: column;\n  overflow: auto;\n  overscroll-behavior: contain;\n  border-radius: 1rem;\n  border-width: 1px;\n  border-style: solid;\n  border-color: var(--border-light);\n  background-color: var(--surface-primary);\n  padding: 0.5rem;\n  color: var(--text-primary);\n  box-shadow:\n    0 10px 15px -3px rgb(0 0 0 / 0.1),\n    0 4px 6px -4px rgb(0 0 0 / 0.1);\n  transform-origin: top;\n  opacity: 0;\n  transition-property: opacity, scale, translate;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 150ms;\n  scale: 0.95;\n  translate: 0 -0.5rem;\n  margin-top: 4px;\n  margin-right: -2px;\n}\n\n.popover-animate {\n  opacity: 0;\n  transform: scale(0.95) translateY(-0.5rem);\n  transition:\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\n}\n.popover-animate[data-enter] {\n  opacity: 1;\n  transform: scale(1) translateY(0);\n}\n\n.popover-ui:focus-visible,\n.popover-ui[data-focus-visible] {\n  outline: var(--bg-surface-hover);\n  outline-offset: -1px;\n}\n\n.popover-ui:where(.dark, .dark *) {\n  background-color: var(--surface-secondary);\n  color: var(--text-secondary);\n  box-shadow:\n    0 10px 15px -3px rgb(0 0 0 / 0.25),\n    0 4px 6px -4px rgb(0 0 0 / 0.1);\n}\n\n.select-item {\n  display: flex;\n  cursor: pointer;\n  scroll-margin: 0.5rem;\n  align-items: center;\n  gap: 0.5rem;\n  border-radius: 0.5rem;\n  padding: 0.5rem;\n  outline: none !important;\n}\n\n.select-item[aria-disabled='true'] {\n  opacity: 0.5;\n}\n\n.select-item[data-active-item] {\n  background-color: var(--surface-hover);\n  color: var(--text-primary);\n}\n\n.popover-ui[data-enter] {\n  opacity: 1;\n  scale: 1;\n  translate: 0;\n}\n");const sd=e=>"object"==typeof e&&"divider"in e,ad=e=>"object"==typeof e&&"value"in e&&"label"in e,rd=({value:e,label:t="",onChange:n,options:a,className:r="",sizeClasses:o,testId:i="dropdown-menu",icon:l,iconOnly:c=!1,renderValue:d,ariaLabel:u,portal:m=!0})=>{const p=P({value:e,setValue:e=>{n(e)}}),f=e=>{if(null!=e&&""!==e)return a.filter((e=>!sd(e))).map((e=>"string"==typeof e?{value:e,label:e}:e)).find((t=>ad(t)&&t.value===e))};return s.jsxs("div",{className:ci("relative",r),children:[s.jsxs(L,{store:p,className:ci("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary",c?"h-full w-10":"w-fit gap-2",r),"data-testid":i,"aria-label":u,children:[s.jsxs("div",{className:"flex w-full items-center gap-2",children:[l,!c&&s.jsxs("span",{className:"block truncate",children:[t,(()=>{const t=f(e);return t&&d?d(t):(e=>{if(null==e||""===e)return"";const t=f(e);return t?t.label:e})(e)})()]})]}),!c&&s.jsx(Z,{})]}),s.jsx(D,{portal:m,store:p,className:ci("popover-ui",o,r,"max-h-[80vh] overflow-y-auto","[pointer-events:auto]"),children:a.map(((t,n)=>{if(sd(t))return s.jsx("div",{className:"my-1 border-t border-border-heavy"},`divider-${n}`);const a="string"==typeof t?{value:t,label:t}:t;return ad(a)?s.jsx($,{value:String(a.value),className:"select-item","data-theme":a.value,children:s.jsxs("div",{className:"flex w-full items-center gap-2",children:[null!=a.icon&&s.jsx("span",{children:a.icon}),s.jsx("span",{className:"block truncate",children:a.label}),e===a.value&&s.jsx("span",{className:"ml-auto pl-2",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block group-hover:hidden",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]})},`option-${n}`):null}))})]})},od=e=>{if("undefined"!=typeof Intl&&"Segmenter"in Intl){const t=new Intl.Segmenter("en",{granularity:"grapheme"}).segment(e);return Array.from(t).map((e=>e.segment))}return[...e]},id=({text:e="",className:t="",delay:a=100,animationFrom:r={opacity:0,transform:"translate3d(0,40px,0)"},animationTo:o={opacity:1,transform:"translate3d(0,0,0)"},easing:i=(e=>e),threshold:l=.1,rootMargin:c="-100px",textAlign:d="center",onLetterAnimationComplete:u,onLineCountChange:m})=>{const p=e.split(" ").map(od),f=p.flat(),[h,g]=n.useState(!1),x=n.useRef(null),v=n.useRef(0),[b]=Lr(f.length,(e=>({from:r,to:h?async e=>{await e(o),v.current+=1,v.current===f.length&&u&&u()}:r,delay:e*a,config:{easing:i}})),[h,e,a,r,o,i,u]);return n.useEffect((()=>{const e=new IntersectionObserver((([t])=>{t.isIntersecting&&(g(!0),x.current&&e.unobserve(x.current))}),{threshold:l,rootMargin:c});return x.current&&e.observe(x.current),()=>e.disconnect()}),[l,c]),n.useEffect((()=>{if(x.current&&h){const e=x.current;setTimeout((()=>{const t=parseInt(getComputedStyle(e).lineHeight)||1.2*parseInt(getComputedStyle(e).fontSize),n=e.offsetHeight,s=Math.round(n/t);m&&m(s)}),100)}}),[h,e,m]),s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"sr-only",children:e}),s.jsx("p",{ref:x,className:`split-parent inline overflow-hidden ${t}`,style:{textAlign:d,whiteSpace:"normal",wordWrap:"break-word"},"aria-hidden":"true",children:p.map(((e,t)=>s.jsxs("span",{style:{display:"inline-block",whiteSpace:"nowrap"},children:[e.map(((e,n)=>{const a=p.slice(0,t).reduce(((e,t)=>e+t.length),0)+n;return s.jsx(Or.span,{style:b[a],className:"inline-block transform transition-opacity will-change-transform",children:e},a)})),t<p.length-1&&s.jsx("span",{style:{display:"inline-block",width:"0.3em"},children:" "})]},t)))})]})},ld=({value:e,onChange:t,isSearching:n,placeholder:a})=>{const r=!0===n,o=null!=e&&e.length>0;return s.jsxs("div",{className:"relative w-full",children:[s.jsx("div",{className:"relative rounded-lg transition-all duration-500 ease-in-out",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 z-50 -translate-y-1/2",children:s.jsx(F,{className:ci("h-4 w-4 transition-all duration-500 ease-in-out",r&&o?"text-blue-400":"text-gray-400")})}),s.jsx("input",{type:"text",value:e,onChange:t,placeholder:a,className:"peer relative z-20 w-full rounded-lg bg-surface-secondary px-10 py-2 outline-none ring-0 backdrop-blur-sm transition-all duration-500 ease-in-out placeholder:text-gray-400 focus:outline-none focus:ring-0"}),s.jsx("div",{className:`pointer-events-none absolute inset-0 z-20 rounded-lg bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-blue-500/20 transition-all duration-500 ease-in-out ${r&&o?"opacity-100 blur-sm":"opacity-0 blur-none"} `}),s.jsx("div",{className:`absolute right-3 top-1/2 z-20 -translate-y-1/2 transition-all duration-500 ease-in-out ${r&&o?"scale-100 opacity-100":"scale-0 opacity-0"} `,children:s.jsxs("div",{className:"relative h-2 w-2",children:[s.jsx("div",{className:"absolute inset-0 animate-ping rounded-full bg-blue-500/60"}),s.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-500"})]})})]})}),s.jsx("div",{className:`absolute -inset-8 -z-10 transition-all duration-700 ease-in-out ${r&&o?"scale-105 opacity-100":"scale-100 opacity-0"} `,children:s.jsxs("div",{className:"absolute inset-0",children:[s.jsx("div",{className:`bg-gradient-radial absolute inset-0 from-blue-500/10 to-transparent transition-opacity duration-700 ease-in-out ${r&&o?"animate-pulse-slow opacity-100":"opacity-0"} `}),s.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-purple-500/5 via-blue-500/5 to-purple-500/5 blur-xl transition-all duration-700 ease-in-out ${r&&o?"animate-gradient-x opacity-100":"opacity-0"} `})]})}),s.jsx("div",{className:"absolute inset-0 -z-20 scale-100 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-blue-500/10 opacity-0 blur-xl transition-all duration-500 ease-in-out peer-focus:scale-105 peer-focus:opacity-100"})]})},cd=n.memo((({checked:e,onChange:t,ariaLabel:n})=>s.jsx("div",{role:"button",tabIndex:0,onKeyDown:e=>e.stopPropagation(),className:"flex h-full w-[30px] items-center justify-center",onClick:e=>e.stopPropagation(),children:s.jsx(Si,{checked:e,onCheckedChange:t,"aria-label":n})})));cd.displayName="SelectionCheckbox";const dd=n.memo((({row:e,isSmallScreen:t,onSelectionChange:a,index:r,isSearching:o})=>{const i=n.useCallback((t=>{e.toggleSelected(t),null==a||a(e.id,t)}),[e,a]);return s.jsx(Tl,{"data-state":e.getIsSelected()?"selected":void 0,className:"motion-safe:animate-fadeIn border-b border-border-light transition-all duration-300 ease-out hover:bg-surface-secondary",style:{animationDelay:20*r+"ms",transform:`translateY(${o?"4px":"0"})`,opacity:o?.5:1},children:e.getVisibleCells().map((n=>"select"===n.column.id?s.jsx(Rl,{className:"px-2 py-1 transition-all duration-300",children:s.jsx(cd,{checked:e.getIsSelected(),onChange:i,ariaLabel:"Select row"})},n.id):s.jsx(Rl,{className:"w-0 max-w-0 px-2 py-1 align-middle text-xs transition-all duration-300 sm:px-4 sm:py-2 sm:text-sm",style:ud(n.column.columnDef,t),children:s.jsx("div",{className:"overflow-hidden text-ellipsis",children:ir(n.column.columnDef.cell,n.getContext())})},n.id)))})}));function ud(e,t){var n,s,a,r;return{width:t?null==(n=e.meta)?void 0:n.mobileSize:null==(s=e.meta)?void 0:s.size,minWidth:null==(a=e.meta)?void 0:a.minWidth,maxWidth:null==(r=e.meta)?void 0:r.size}}const md=n.memo((({onDelete:e,isDeleting:t,disabled:n,isSmallScreen:a})=>e?s.jsx(ki,{variant:"outline",onClick:e,disabled:n,className:ci("min-w-[40px] transition-all duration-200",a&&"px-2 py-1"),children:t?s.jsx(ac,{className:"size-4"}):s.jsxs(s.Fragment,{children:[s.jsx(kc,{className:"size-3.5 text-red-400 sm:size-4"}),!a&&s.jsx("span",{className:"ml-2",children:"Delete"})]})}):null));function pd({columns:e,data:t,onDelete:a,filterColumn:r,defaultSort:o=[],className:i="",isFetchingNextPage:l=!1,hasNextPage:c=!1,fetchNextPage:d,enableRowSelection:u=!0,showCheckboxes:m=!0,onFilterChange:p,filterValue:f,isLoading:h,enableSearch:g=!0}){const x=Ki("(max-width: 768px)"),v=n.useRef(null),[b,_]=n.useState(!1),[y,j]=n.useState({}),[w,N]=n.useState(o),[C,k]=n.useState([]),[S,E]=n.useState({}),[T,I]=n.useState(f??""),[R,P]=n.useState(!1),A=n.useMemo((()=>{if(!u||!m)return e;const t={id:"select",header:({table:e})=>s.jsx("div",{className:"flex h-full w-[30px] items-center justify-center",children:s.jsx(Si,{checked:e.getIsAllPageRowsSelected(),onCheckedChange:t=>e.toggleAllPageRowsSelected(Boolean(t)),"aria-label":"Select all"})}),cell:({row:e})=>s.jsx(cd,{checked:e.getIsSelected(),onChange:t=>e.toggleSelected(t),ariaLabel:"Select row"}),meta:{size:"50px"}};return[t,...e]}),[e,u,m]),M=lr({data:t,columns:A,getCoreRowModel:ur(),getSortedRowModel:dr(),getFilteredRowModel:cr(),enableRowSelection:u,enableMultiRowSelection:!0,state:{sorting:w,columnFilters:C,columnVisibility:S,rowSelection:y},onSortingChange:N,onColumnFiltersChange:k,onColumnVisibilityChange:E,onRowSelectionChange:j}),{rows:L}=M.getRowModel(),O=Ur({count:L.length,getScrollElement:()=>v.current,estimateSize:n.useCallback((()=>48),[]),overscan:10}),D=O.getVirtualItems(),F=O.getTotalSize(),z=D.length>0?D[0].start:0,U=D.length>0?F-D[D.length-1].end:0;n.useEffect((()=>{const e=v.current;if(!e)return;const t=async()=>{if(!c||l)return;const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;if(n-t<=1.5*s)try{await(null==d?void 0:d())}catch(yu){console.error("Unable to fetch next page:",yu)}};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)}),[c,l,d]),n.useEffect((()=>{P(!0);const e=setTimeout((()=>{null==p||p(T),P(!1)}),300);return()=>clearTimeout(e)}),[T,p]);const V=n.useCallback((async()=>{if(a){_(!0);try{const e=M.getFilteredSelectedRowModel().rows.map((e=>e.original));await a(e),j({})}finally{_(!1)}}}),[a,M]),B=Array.from({length:13},((e,t)=>{var n;const a=Math.floor(241*Math.random())+170,r="select"===(null==(n=A[0])?void 0:n.id)?1:0;return s.jsx(Tl,{className:"motion-safe:animate-fadeIn border-b border-border-light",children:A.map(((e,t)=>{const n=ud(e,x);return s.jsx(Rl,{className:"px-2 py-1 sm:px-4 sm:py-2",style:n,children:s.jsx(Nl,{className:"h-6",style:t===r?{width:`${a}px`}:{width:"100%"}})},e.id)}))},t)}));return s.jsxs("div",{className:ci("flex h-full flex-col gap-4",i),children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[u&&m&&s.jsx(md,{onDelete:V,isDeleting:b,disabled:!M.getFilteredSelectedRowModel().rows.length||b,isSmallScreen:x}),void 0!==r&&M.getColumn(r)&&g&&s.jsx("div",{className:"relative flex-1",children:s.jsx(ld,{value:T,onChange:e=>I(e.target.value),isSearching:R,placeholder:"Search..."})})]}),s.jsx("div",{ref:v,className:ci("relative h-[calc(100vh-20rem)] max-w-full overflow-x-auto overflow-y-auto rounded-md border border-black/10 dark:border-white/10","transition-all duration-300 ease-out",R&&"bg-surface-secondary/50",i),children:s.jsxs(kl,{className:"w-full min-w-[300px] table-fixed border-separate border-spacing-0",children:[s.jsx(Sl,{className:"sticky top-0 z-50 bg-surface-secondary",children:M.getHeaderGroups().map((e=>s.jsx(Tl,{className:"border-b border-border-light",children:e.headers.map((e=>s.jsx(Il,{className:"whitespace-nowrap bg-surface-secondary px-2 py-2 text-left text-sm font-medium text-text-secondary sm:px-4",style:ud(e.column.columnDef,x),onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),s.jsxs(El,{children:[z>0&&s.jsx("tr",{children:s.jsx("td",{style:{height:`${z}px`}})}),h&&B,D.map((e=>{const t=L[e.index];return s.jsx(dd,{row:t,isSmallScreen:x,index:e.index,isSearching:R},t.id)})),!D.length&&s.jsx(Tl,{className:"hover:bg-transparent",children:s.jsx(Rl,{colSpan:e.length,className:"p-4 text-center",children:"No data available"})}),U>0&&s.jsx("tr",{children:s.jsx("td",{style:{height:`${U}px`}})}),(l||c)&&s.jsx(Tl,{className:"hover:bg-transparent",children:s.jsx(Rl,{colSpan:e.length,className:"p-4",children:s.jsx("div",{className:"flex h-full items-center justify-center",children:l?s.jsx(ac,{className:"size-4"}):c&&s.jsx("div",{className:"h-6"})})})})]})]})})]})}function fd({field:e,label:t,labelClass:n,inputClass:a,containerClass:r,labelAdjacent:o,placeholder:i="",type:l="string"}){return s.jsxs("div",{className:ci("flex w-full flex-col items-center gap-2",r),children:[s.jsxs("div",{className:"flex w-full items-center justify-start gap-2",children:[s.jsx(dl,{htmlFor:`${e.name}-input`,className:ci("text-left text-sm font-semibold text-text-primary",n),children:t}),o]}),s.jsx(ll,{id:`${e.name}-input`,value:e.value??"",onChange:t=>{const n=t.target.value;"number"===l?""===n?e.onChange(n):isNaN(Number(n))||e.onChange(Number(n)):e.onChange(n)},placeholder:i,className:ci("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2",a)})]})}class hd{constructor(e,t,n,s,a,r,o,i){this.width=e.width,this.height=e.height,this.ctx=t,this.x=n,this.y=s,this.color=a,this.speed=this.random(.1,.9)*r,this.size=0,this.sizeStep=.4*Math.random(),this.minSize=.5,this.maxSizeInteger=2,this.maxSize=this.random(this.minSize,this.maxSizeInteger),this.delay=o,this.counter=0,this.counterStep=4*Math.random()+.01*(this.width+this.height),this.isIdle=!1,this.isReverse=!1,this.isShimmer=!1,this.activationThreshold=i}random(e,t){return Math.random()*(t-e)+e}draw(){const e=.5*this.maxSizeInteger-.5*this.size;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+e,this.y+e,this.size,this.size)}appear(){this.isIdle=!1,this.counter<=this.delay?this.counter+=this.counterStep:(this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.draw())}appearWithProgress(e){if(e-this.activationThreshold<=0)this.isIdle=!0;else{if(this.counter<=this.delay)return this.counter+=this.counterStep,void(this.isIdle=!1);this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.isIdle=!1,this.draw()}}disappear(){this.isShimmer=!1,this.counter=0,this.size<=0?this.isIdle=!0:(this.size-=.1,this.draw())}shimmer(){this.size>=this.maxSize?this.isReverse=!0:this.size<=this.minSize&&(this.isReverse=!1),this.size+=this.isReverse?-this.speed:this.speed}}const gd=(e,t)=>{const n=parseInt(String(e),10);return n<=0||t?0:n>=100?.1:.001*n},xd=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),vd={default:{gap:5,speed:35,colors:"#f8fafc,#f1f5f9,#cbd5e1",noFocus:!1},blue:{gap:10,speed:25,colors:"#e0f2fe,#7dd3fc,#0ea5e9",noFocus:!1},yellow:{gap:3,speed:20,colors:"#fef08a,#fde047,#eab308",noFocus:!1},pink:{gap:6,speed:80,colors:"#fecdd3,#fda4af,#e11d48",noFocus:!0}};function bd({variant:e="default",gap:t,speed:a,colors:r,noFocus:o,className:i="",progress:l,randomness:c=.3,width:d,height:u}){const m=n.useRef(null),p=n.useRef(null),f=n.useRef([]),h=n.useRef(void 0),g=n.useRef(performance.now()),x=n.useRef(l),v=n.useRef(window.matchMedia("(prefers-reduced-motion: reduce)").matches).current,b=vd[e],_=t??b.gap,y=a??b.speed,j=r??b.colors,w=o??b.noFocus,N=n.useCallback((()=>{if(!p.current)return;if(void 0===x.current)return void(p.current.style.opacity="1");const e=x.current>=.9?1-(x.current-.9)/.1:1;p.current.style.opacity=String(xd(e))}),[]),C=n.useCallback((e=>{var t;h.current=requestAnimationFrame((()=>C(e)));const n=performance.now(),s=n-g.current;if(s<1e3/60)return;g.current=n-s%(1e3/60);const a=null==(t=p.current)?void 0:t.getContext("2d");if(!a||!p.current)return;a.clearRect(0,0,p.current.width,p.current.height);let r=!0;for(const o of f.current)"appearWithProgress"===e?void 0!==x.current?o.appearWithProgress(x.current):o.isIdle=!0:o[e](),o.isIdle||(r=!1);N(),r&&cancelAnimationFrame(h.current)}),[N]),k=n.useCallback((e=>{cancelAnimationFrame(h.current),h.current=requestAnimationFrame((()=>C(e)))}),[C]),S=n.useCallback((()=>{if(!m.current||!p.current)return;const{width:e,height:t}=m.current.getBoundingClientRect(),n=p.current.getContext("2d");p.current.width=Math.floor(e),p.current.height=Math.floor(t);const s=j.split(","),a=[],r=e/2,o=t/2,i=Math.hypot(r,o);for(let l=0;l<e;l+=_)for(let e=0;e<t;e+=_){const t=s[Math.floor(Math.random()*s.length)],d=Math.hypot(l-r,e-o)/i,u=xd(d*(1-c)+Math.random()*c),m=v?0:d*i;n&&a.push(new hd(p.current,n,l,e,t,gd(y,v),m,u))}f.current=a,void 0!==x.current&&k("appearWithProgress")}),[_,j,y,c,v,k]);return n.useEffect((()=>{x.current=l,void 0!==l&&k("appearWithProgress")}),[l,k]),n.useEffect((()=>{void 0===l&&cancelAnimationFrame(h.current)}),[l]),n.useEffect((()=>{S();const e=new ResizeObserver(S);return m.current&&e.observe(m.current),()=>{e.disconnect(),cancelAnimationFrame(h.current)}}),[S]),s.jsx("div",{ref:m,style:{width:d||"100%",height:u||"100%"},children:s.jsx("div",{className:ci("relative isolate grid select-none place-items-center overflow-hidden rounded-lg border border-border-light shadow-md transition-colors duration-200 ease-in-out",i),style:{width:"100%",height:"100%",transitionTimingFunction:"cubic-bezier(0.5, 1, 0.89, 1)"},onMouseEnter:()=>void 0===x.current&&k("appear"),onMouseLeave:()=>void 0===x.current&&k("disappear"),onFocus:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==x.current||k("appear")},onBlur:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==x.current||k("disappear")},tabIndex:w?-1:0,children:s.jsx("canvas",{ref:p,className:"pointer-events-none absolute inset-0 block",width:d&&"auto"!==d?parseInt(String(d)):void 0,height:u&&"auto"!==u?parseInt(String(u)):void 0})})})}const _d=n.forwardRef((({children:e,handleFileChange:t},n)=>s.jsxs(s.Fragment,{children:[e,s.jsx("input",{ref:n,multiple:!0,type:"file",style:{display:"none"},onChange:t})]})));function yd(e,t){return 0===e.length?t||"Select...":1===e.length?e[0]:`${e.length} items selected`}function jd({items:e,label:t,placeholder:a="Select...",onSelectedValuesChange:r,renderSelectedValues:o=yd,className:i,selectIcon:l,itemClassName:c,labelClassName:d,selectClassName:u,popoverClassName:m,selectItemsClassName:p,selectedValues:f=[],setSelectedValues:h,renderItemContent:g}){const x=n.useRef(null);return s.jsx("div",{className:i,children:s.jsxs(fe,{value:f,setValue:e=>{h(e),r&&r(e)},children:[t&&s.jsx(M,{className:ci("mb-1 block text-sm text-text-primary",d),children:t}),s.jsxs(L,{ref:x,className:ci("flex items-center justify-between gap-2 rounded-xl px-3 py-2 text-sm","bg-surface-tertiary text-text-primary shadow-sm hover:cursor-pointer hover:bg-surface-hover","outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75",u,f.length>0&&null!=p&&p),onChange:e=>e.stopPropagation(),children:[l&&s.jsx("span",{children:l}),s.jsx("span",{className:"mr-auto hidden truncate md:block",children:o(f,a)}),s.jsx(Z,{className:"ml-1 hidden stroke-1 text-base opacity-75 md:block"})]}),s.jsx(D,{gutter:4,sameWidth:!0,modal:!0,unmountOnHide:!0,finalFocus:x,className:ci("animate-popover z-50 flex max-h-[300px]","flex-col overflow-auto overscroll-contain rounded-xl","bg-surface-secondary px-1.5 py-1 text-text-primary shadow-lg","border border-border-light","outline-none",m),children:e.map((e=>{const t=s.jsxs(s.Fragment,{children:[s.jsx(he,{className:"mr-0.5 text-primary"}),s.jsx("span",{className:"truncate",children:e})]}),n=f.includes(e);return s.jsx($,{value:e,className:ci("flex items-center gap-2 rounded-lg px-2 py-1.5 hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 text-sm",c),children:g?g(e,t,n):t},e)}))})]})})}_d.displayName="FileUpload",fi(".animate-popover {\n  transform-origin: top;\n  opacity: 0;\n  transition:\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\n  transform: scale(0.95) translateY(-0.5rem);\n}\n\n.animate-popover[data-enter] {\n  opacity: 1;\n  transform: scale(1) translateY(0);\n}\n\n.animate-popover-left {\n  transform-origin: left;\n  opacity: 0;\n  transition:\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\n  transform: scale(0.95) translateX(-0.5rem);\n}\n\n.animate-popover-left[data-enter] {\n  opacity: 1;\n  transform: scale(1) translateX(0);\n}\n");const wd=({trigger:e,isOpen:t,setIsOpen:n,focusLoop:a,mountByState:r,...o})=>{const i=te({open:t,setOpen:n,focusLoop:a});return s.jsxs(ne,r?{store:i,children:[e,t&&s.jsx(Nd,{...o})]}:{store:i,children:[e,s.jsx(Nd,{...o})]})},Nd=({items:e,menuId:t,keyPrefix:n,className:a,iconClassName:r,itemClassName:o,modal:i,portal:l,sameWidth:c,gutter:d=8,finalFocus:u,unmountOnHide:m,preserveTabOrder:p,...f})=>{const h=te(),g=ae();return s.jsx(re,{id:t,modal:i,gutter:d,portal:l,sameWidth:c,finalFocus:u,unmountOnHide:m,preserveTabOrder:p,className:ci("popover-ui z-50",a),...f,children:e.filter((e=>!1!==e.show)).map(((e,a)=>{const{subItems:i}=e;return!0===e.separate?s.jsx(oe,{className:"my-1 h-px bg-white/10"},a):i&&i.length>0?s.jsxs(ne,{store:h,children:[s.jsxs(ie,{className:ci("group flex w-full cursor-pointer items-center justify-between gap-2 rounded-lg px-3 py-3.5 text-sm text-text-primary outline-none transition-colors duration-200 hover:bg-surface-hover focus:bg-surface-hover md:px-2.5 md:py-2",o),disabled:e.disabled,id:e.id,render:e.render,ref:e.ref,children:[s.jsxs("span",{className:"flex items-center gap-2",children:[null!=e.icon&&s.jsx("span",{className:ci("mr-2 size-4",r),"aria-hidden":"true",children:e.icon}),e.label]}),s.jsx(le,{className:"stroke-1 text-base opacity-75"})]}),s.jsx(Nd,{items:i,menuId:`${t}-${a}`,gutter:12,portal:!0},`${n??""}${a}-${e.id??""}`)]},`${n??""}${a}-${e.id??""}-provider`):s.jsxs(ce,{id:e.id,className:ci("group flex w-full cursor-pointer items-center gap-2 rounded-lg px-3 py-3.5 text-sm text-text-primary outline-none transition-colors duration-200 hover:bg-surface-hover focus:bg-surface-hover md:px-2.5 md:py-2",o),disabled:e.disabled,render:e.render,ref:e.ref,hideOnClick:e.hideOnClick,onClick:t=>{t.preventDefault(),e.onClick&&e.onClick(t),!1!==e.hideOnClick&&(null==g||g.hide())},children:[null!=e.icon&&s.jsx("span",{className:ci("mr-2 size-4",r),"aria-hidden":"true",children:e.icon}),e.label,null!=e.kbd&&s.jsxs("kbd",{className:"ml-auto hidden font-sans text-xs text-black/50 group-hover:inline group-focus:inline dark:text-white/50",children:["⌘",e.kbd]})]},`${n??""}${a}-${e.id??""}`)}))})},Cd=({delay:e,children:t})=>(e=>{const[t,s]=n.useState(!0),a=n.useRef(null);return n.useEffect((()=>{if(t){const t=new Promise((t=>{const n=setTimeout((()=>{s(!1),t()}),e);return()=>{clearTimeout(n)}}));a.current=t}return()=>{a.current=null}}),[e,t]),e=>{if(t&&a.current)throw a.current;return e()}})(e)((()=>t));const kd=E("color-theme","system",void 0,{getOnInit:!0}),Sd=E("theme-colors",void 0,void 0,{getOnInit:!0}),Ed=E("theme-name",void 0,void 0,{getOnInit:!0}),Td=n.createContext({theme:"system",setTheme:()=>{},setThemeRGB:()=>{},setThemeName:()=>{},resetTheme:()=>{}}),Id=e=>"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===e;function Rd({children:e,themeRGB:t,themeName:a,initialTheme:r}){const[o,i]=ge(kd),[l,c]=ge(Sd),[d,u]=ge(Ed),m=n.useRef(!1);n.useEffect((()=>{m.current||(m.current=!0,r&&i(r),t&&c(t),a&&u(a))}),[r,t,a,i,c,u]);const p=n.useCallback((e=>{const t=window.document.documentElement,n=Id(e);t.classList.remove(n?"light":"dark"),t.classList.add(n?"dark":"light")}),[]);n.useEffect((()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{"system"===o&&p("system")};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}),[o,p]),n.useEffect((()=>{p(o)}),[o,p]),n.useEffect((()=>{l&&function(e){if(!e)return;const t=function(e){const t={};return Object.entries({"rgb-text-primary":"--text-primary","rgb-text-secondary":"--text-secondary","rgb-text-secondary-alt":"--text-secondary-alt","rgb-text-tertiary":"--text-tertiary","rgb-text-warning":"--text-warning","rgb-ring-primary":"--ring-primary","rgb-header-primary":"--header-primary","rgb-header-hover":"--header-hover","rgb-header-button-hover":"--header-button-hover","rgb-surface-active":"--surface-active","rgb-surface-active-alt":"--surface-active-alt","rgb-surface-hover":"--surface-hover","rgb-surface-hover-alt":"--surface-hover-alt","rgb-surface-primary":"--surface-primary","rgb-surface-primary-alt":"--surface-primary-alt","rgb-surface-primary-contrast":"--surface-primary-contrast","rgb-surface-secondary":"--surface-secondary","rgb-surface-secondary-alt":"--surface-secondary-alt","rgb-surface-tertiary":"--surface-tertiary","rgb-surface-tertiary-alt":"--surface-tertiary-alt","rgb-surface-dialog":"--surface-dialog","rgb-surface-submit":"--surface-submit","rgb-surface-submit-hover":"--surface-submit-hover","rgb-surface-destructive":"--surface-destructive","rgb-surface-destructive-hover":"--surface-destructive-hover","rgb-surface-chat":"--surface-chat","rgb-border-light":"--border-light","rgb-border-medium":"--border-medium","rgb-border-medium-alt":"--border-medium-alt","rgb-border-heavy":"--border-heavy","rgb-border-xheavy":"--border-xheavy","rgb-brand-purple":"--brand-purple","rgb-presentation":"--presentation","rgb-background":"--background","rgb-foreground":"--foreground","rgb-primary":"--primary","rgb-primary-foreground":"--primary-foreground","rgb-secondary":"--secondary","rgb-secondary-foreground":"--secondary-foreground","rgb-muted":"--muted","rgb-muted-foreground":"--muted-foreground","rgb-accent":"--accent","rgb-accent-foreground":"--accent-foreground","rgb-destructive-foreground":"--destructive-foreground","rgb-border":"--border","rgb-input":"--input","rgb-ring":"--ring","rgb-card":"--card","rgb-card-foreground":"--card-foreground"}).forEach((([n,s])=>{const a=e[n];a&&(t[s]=a)})),t}(e),n=document.documentElement;Object.entries(t).forEach((([e,t])=>{t&&(function(e){if(!e)return!0;const t=e.match(/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})$/);if(!t)return!1;const[,n,s,a]=t;return[n,s,a].every((e=>{const t=parseInt(e,10);return t>=0&&t<=255}))}(t)?n.style.setProperty(e,`rgb(${t})`):console.error(`Invalid RGB value for ${e}: ${t}`))}))}(l)}),[l]);const f=n.useCallback((()=>{i("system"),c(void 0),u(void 0);const e=document.documentElement;Array.from(e.style).filter((e=>e.startsWith("--"))).forEach((t=>e.style.removeProperty(t)))}),[i,c,u]),h=n.useMemo((()=>({theme:o,setTheme:i,themeRGB:l,setThemeRGB:c,themeName:d,setThemeName:u,resetTheme:f})),[o,i,l,c,d,u,f]);return s.jsx(Td.Provider,{value:h,children:e})}const Pd=({theme:e,onChange:t})=>{const a={system:s.jsx(Y,{}),dark:s.jsx(Q,{color:"white"}),light:s.jsx(q,{})},r=Id(e)?"light":"dark",o=`Switch to ${r} theme`;return n.useEffect((()=>{const e=e=>{e.ctrlKey&&e.shiftKey&&"t"===e.key.toLowerCase()&&(e.preventDefault(),t(r))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[r,t]),s.jsx("button",{className:"flex items-center gap-2 rounded-lg p-2 transition-colors hover:bg-surface-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","aria-label":o,"aria-keyshortcuts":"Ctrl+Shift+T",onClick:e=>{e.preventDefault(),t(r)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t(r))},children:a[e]})},Ad=({returnThemeOnly:e})=>{const{theme:t,setTheme:a}=n.useContext(Td),[r,o]=n.useState(""),i=n.useCallback((e=>{const t=Date.now();"number"==typeof window.lastThemeChange&&t-window.lastThemeChange<500||(window.lastThemeChange=t,a(e),o(Id(e)?"Dark theme enabled":"Light theme enabled"))}),[a]);return n.useEffect((()=>{if("system"===t){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;a(e?"dark":"light")}}),[t,a]),n.useEffect((()=>{if(r){const e=setTimeout((()=>o("")),1e3);return()=>clearTimeout(e)}}),[r]),!0===e?s.jsx(Pd,{theme:t,onChange:i}):s.jsxs("div",{className:"flex flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[s.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:s.jsx(Pd,{theme:t,onChange:i})}),r&&s.jsx("div",{"aria-live":"polite",className:"sr-only",children:r})]})},Md=({side:e,text:t})=>s.jsxs(al,{openDelay:50,children:[s.jsxs(rl,{className:"cursor-help",children:[s.jsx(se,{className:"h-5 w-5 text-text-tertiary"})," "]}),s.jsx(ol,{children:s.jsx(il,{side:e,className:"z-[999] w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:t})})})})]}),Ld=n.forwardRef((({icon:e,label:t,setValue:a,className:r,checked:o,defaultChecked:l,isCheckedClassName:c},d)=>{const u=T(),m=i(u,(e=>null==e?void 0:e.value));return n.useEffect((()=>{void 0!==o&&u.setValue(o)}),[o,u]),n.useEffect((()=>{void 0!==l&&void 0===o&&u.setValue(l)}),[l,o,u]),s.jsxs(I,{ref:d,store:u,onChange:e=>{e.stopPropagation(),"boolean"==typeof m&&(null==a||a({e:e,value:!m}))},className:ci("group relative inline-flex items-center justify-center gap-1.5","rounded-full border border-border-medium text-sm font-medium","size-9 p-2 transition-all md:w-full md:p-3","bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner",m&&c&&c,r),render:s.jsx("button",{type:"button","aria-label":t}),children:[e&&s.jsx("span",{className:"icon-md text-text-primary",children:e}),s.jsx("span",{className:"hidden truncate md:block",children:t})]})}));Ld.displayName="CheckboxButton";const Od=n.forwardRef(((e,t)=>{const{title:n,description:a,main:r,buttons:o,leftButtons:i,selection:l,className:c,headerClassName:d,footerClassName:u,showCloseButton:m,showCancelButton:p=!0}=e,{selectHandler:f,selectClasses:h,selectText:g}=l||{};return s.jsxs(Zi,{showCloseButton:m,ref:t,className:ci("shadow-2xl dark:bg-gray-700",c||""),onClick:e=>e.stopPropagation(),children:[s.jsxs(Ji,{className:ci(d??""),children:[s.jsx(tl,{className:"text-lg font-medium leading-6 text-gray-800 dark:text-gray-200",children:n}),a&&s.jsx(nl,{className:"text-gray-600 dark:text-gray-300",children:a})]}),s.jsx("div",{className:"px-6",children:r||null}),s.jsxs(el,{className:u,children:[s.jsx("div",{children:i||null}),s.jsxs("div",{className:"flex h-auto gap-3",children:[p&&s.jsx(sl,{className:"border-gray-100 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-600",children:"cancel"}),o||null,l?s.jsx(sl,{onClick:f,className:`${h||"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} inline-flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm`,children:g}):null]})]})]})}));function Dd({title:e,value:t,disabled:a,setValue:r,availableValues:o,showAbove:i=!1,showLabel:l=!0,emptyTitle:c=!1,iconSide:d="right",optionIconSide:u="left",placeholder:m,containerClassName:p,optionsListClass:f,optionsClass:h,currentValueClass:g,subContainerClassName:x,className:v,renderOption:b,searchClassName:_,searchPlaceholder:y,showOptionIcon:j=!1}){const w={className:"top-full mt-3"};i&&(w.className="bottom-full mb-3");let N=e;c&&(N="");const C=o??[],[k,S]=Hl({availableOptions:C,placeholder:y,getTextKeyOverride:e=>{return(t=e,"string"==typeof t?t:"label"in t?t.label??"":"value"in t?(t.value??"")+"":"").toUpperCase();var t},className:_,disabled:a}),E=null!=S?k:C,T=j&&null!=t&&null!=t.icon,I=n.useRef(null);return s.jsx("div",{className:ci("flex items-center justify-center gap-2",p??""),children:s.jsx("div",{className:ci("relative w-full",x??""),children:s.jsx(Gr,{value:t,onChange:r,disabled:a,children:({open:e})=>s.jsxs(s.Fragment,{children:[s.jsxs(Kr,{ref:I,"data-testid":"select-dropdown-button",onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),!e&&I.current&&I.current.click())},className:ci("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:bg-white dark:border-gray-600 dark:bg-gray-700 sm:text-sm",v??""),children:[l&&s.jsx(Wr,{className:"block text-xs text-gray-700 dark:text-gray-500",id:"headlessui-listbox-label-:r1:","data-headlessui-state":"",children:N}),s.jsx("span",{className:"inline-flex w-full truncate",children:s.jsxs("span",{className:ci("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",l?"":"text-xs",g??""),children:[!l&&!c&&s.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[N,":"]}),T&&"right"!==u&&s.jsx("span",{className:"icon-md flex items-center",children:t.icon}),T&&s.jsx("span",{className:"icon-md absolute right-0 mr-8 flex items-center",children:t.icon}),t?"string"!=typeof t?t.label??"":t:s.jsx("span",{className:"text-text-secondary",children:m})]})}),s.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:i?{transform:"scaleY(-1)"}:{},children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),s.jsx(qr,{show:e,as:"div",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",...w,children:s.jsxs(Qr,{className:ci("absolute z-10 mt-2 max-h-60 w-full overflow-auto rounded border bg-white text-xs ring-black/10 dark:border-gray-600 dark:bg-gray-700 dark:ring-white/20 md:w-[100%]",f??""),children:[b&&s.jsx(Yr,{value:null,className:ci("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-700",h??""),children:b()},"listbox-render-option"),S,E.map(((e,n)=>{if(!e)return null;const a="string"==typeof e?e:e.label??e.value??"",r="string"==typeof e?e:e.value??"",o="string"==typeof e?null:e.icon??null;let i=t;return"string"!=typeof i&&(i=(null==i?void 0:i.value)??""),s.jsx(Yr,{value:e,className:({active:e})=>ci("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-600",e?"bg-surface-active text-text-primary":"",h??""),children:s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[s.jsxs("span",{className:ci("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",e===t?"font-semibold":"","left"===d?"ml-4":""),children:[null!=o&&s.jsx("span",{className:ci("mr-1","right"===u?"absolute right-0 pr-2":""),children:o}),a]}),r===i&&s.jsx("span",{className:ci("absolute inset-y-0 flex items-center text-gray-800 dark:text-gray-200","left"===d?"left-0 pl-2":"right-0 pr-3"),children:s.jsx(oc,{})})]})},n)}))]})})]})})})})}var Fd=n.memo((function({selectedValue:e,displayValue:t,items:a,setValue:r,ariaLabel:o,searchPlaceholder:i,selectPlaceholder:l,containerClassName:c,isCollapsed:d,SelectIcon:u,showCarat:m,className:p,disabled:f,iconClassName:h,iconSide:g="left",selectId:x}){const[v,b]=n.useState(""),_=n.useRef(null),[y,j]=n.useState(null),w=e=>({id:`item-${e.value}`,value:e.value,label:e.label,icon:e.icon}),N=R({defaultItems:a.map(w),resetValueOnHide:!0,value:v,setValue:b}),C=P({combobox:N,defaultItems:a.map(w),value:e,setValue:r}),k=n.useMemo((()=>A(a,v,{keys:["value","label"],baseSort:(e,t)=>e.index<t.index?-1:1}).map(w)),[v,a]);n.useEffect((()=>{_.current&&!d&&j(_.current.offsetWidth)}),[d]);const S=ci("flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",h),E=ci("mr-2 flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",h);return s.jsxs("div",{className:ci("flex w-full items-center justify-center px-1",c),children:[s.jsx(M,{store:C,className:"sr-only",children:o}),s.jsxs(L,{ref:_,store:C,id:x,disabled:f,className:ci("flex items-center justify-center gap-2 rounded-full bg-surface-secondary","text-text-primary hover:bg-surface-tertiary","border border-border-light",d?"h-10 w-10":"h-10 w-full rounded-xl px-3 py-2 text-sm",p),children:[null!=u&&"left"===g&&s.jsx("div",{className:S,children:u}),!d&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"flex-grow truncate text-left",children:null!=t?t||l:e||l}),null!=u&&"right"===g&&s.jsx("div",{className:S,children:u}),m&&s.jsx(O,{className:"h-4 w-4 text-text-secondary"})]})]}),s.jsxs(D,{store:C,gutter:4,portal:!0,className:ci("animate-popover z-50 overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-lg"),style:{width:d?"300px":y??"300px"},children:[s.jsx("div",{className:"py-1.5",children:s.jsxs("div",{className:"relative",children:[s.jsx(F,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-text-primary"}),s.jsx(z,{store:N,autoSelect:!0,placeholder:i,className:"w-full rounded-md bg-surface-secondary py-2 pl-9 pr-3 text-sm text-text-primary focus:outline-none"})]})}),s.jsx("div",{className:"max-h-[300px] overflow-auto",children:s.jsx(U,{store:N,children:s.jsx(V,{store:C,items:k,itemSize:36,overscan:5,children:({value:e,icon:t,label:n,...a})=>s.jsxs(B,{...a,className:ci("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:s.jsx($,{value:e}),children:[null!=t&&"left"===g&&s.jsx("div",{className:E,children:t}),s.jsx("span",{className:"flex-grow truncate text-left",children:n}),null!=t&&"right"===g&&s.jsx("div",{className:E,children:t})]},a.id)})})})]})]})}));const zd=n.forwardRef(((e,t)=>{const n=Gi(),{title:a,main:r,buttons:o,selection:i,className:l,leftButtons:c,description:d="",mainClassName:u,headerClassName:m,footerClassName:p,showCloseButton:f,overlayClassName:h,showCancelButton:g=!0}=e,{selectHandler:x,selectClasses:v,selectText:b,isLoading:_}=i||{};return s.jsxs(gl,{overlayClassName:h,showCloseButton:f,ref:t,className:ci("w-11/12 border-none bg-background text-foreground",l??""),onClick:e=>e.stopPropagation(),children:[s.jsxs(xl,{className:ci(m??""),children:[s.jsx(bl,{children:a}),d&&s.jsx(_l,{className:"items-center justify-center",children:d})]}),s.jsx("div",{className:ci("px-0 py-2",u),children:null!=r?r:null}),s.jsxs(vl,{className:p,children:[s.jsx("div",{children:null!=c?s.jsx("div",{className:"mt-3 flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:mt-0 sm:flex-row",children:c}):null}),s.jsxs("div",{className:"flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:flex-row",children:[g&&s.jsx(fl,{asChild:!0,children:s.jsx(ki,{variant:"outline",children:n("com_ui_cancel")})}),null!=o?o:null,i?s.jsx(fl,{onClick:x,disabled:_,className:`${v??"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm disabled:opacity-80 max-sm:order-first max-sm:w-full sm:order-none`,children:!0===_?s.jsx(ac,{className:"size-4 text-white"}):b}):null]})]})]})})),Ud=n.forwardRef((({className:e,options:t,onSelect:a,...r},o)=>{const[i,l]=n.useState(!1),[c,d]=n.useState(r.value||""),[u,m]=n.useState(-1),p=n.useRef(null),f=e=>{d(e),l(!1),m(-1),a&&a(e),r.onChange&&r.onChange({target:{value:e}})};return n.useEffect((()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&(l(!1),m(-1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),s.jsxs("div",{className:"relative",ref:p,children:[s.jsxs("div",{className:"relative",children:[s.jsx(ll,{...r,value:c,onChange:e=>{d(e.target.value),r.onChange&&r.onChange(e)},onKeyDown:e=>{switch(e.key){case"ArrowDown":e.preventDefault(),i?m((e=>e<t.length-1?e+1:e)):l(!0);break;case"ArrowUp":e.preventDefault(),m((e=>e>0?e-1:0));break;case"Enter":e.preventDefault(),i&&-1!==u&&f(t[u]),l(!1);break;case"Escape":l(!1),m(-1)}},"aria-haspopup":"listbox","aria-controls":"dropdown-list",className:ci("bg-surface-secondary",e??""),ref:o}),s.jsx("button",{type:"button",className:"text-tertiary absolute inset-y-0 right-0 flex items-center rounded-md px-2 hover:text-secondary focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring-primary",onClick:()=>l(!i),"aria-label":i?"Close dropdown":"Open dropdown",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i&&s.jsx("ul",{id:"dropdown-list",role:"listbox",className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md border border-border-medium bg-surface-secondary shadow-lg focus:ring-1 focus:ring-inset focus:ring-ring-primary",children:t.map(((e,t)=>s.jsx("li",{role:"option","aria-selected":t===u,className:ci("cursor-pointer rounded-md px-3 py-2","focus:bg-surface-tertiary focus:outline-none focus:ring-1 focus:ring-inset focus:ring-ring-primary",t===u?"bg-surface-active text-primary":"text-secondary hover:bg-surface-tertiary"),onClick:()=>f(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),f(e))},tabIndex:0,children:e},t)))})]})}));Ud.displayName="InputWithDropdown";const Vd=n.createContext({showToast:()=>({})});function Bd(){return n.useContext(Vd)}function $d({children:e}){const{showToast:t}=Vi();return s.jsx(Vd.Provider,{value:{showToast:t},children:e})}class Hd{constructor(e){t(this,"mediaSource",new MediaSource),t(this,"audioChunks",[]),t(this,"sourceBuffer"),this.mediaSource.addEventListener("sourceopen",(async()=>{this.sourceBuffer=this.mediaSource.addSourceBuffer(e),this.sourceBuffer.addEventListener("updateend",(()=>{this.tryAppendNextChunk()}))}))}tryAppendNextChunk(){null!=this.sourceBuffer&&!this.sourceBuffer.updating&&this.audioChunks.length>0&&this.sourceBuffer.appendBuffer(this.audioChunks.shift())}addBase64Data(e){this.addData(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))).buffer)}addData(e){this.audioChunks.push(e),this.tryAppendNextChunk()}close(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}get mediaSourceUrl(){return URL.createObjectURL(this.mediaSource)}}const Gd=7e3;var Kd=(e=>(e.SIMPLE="simple",e.ADVANCED="advanced",e))(Kd||{}),Wd=(e=>(e.browser="browser",e.external="external",e))(Wd||{});const qd="prompt-textarea",Qd="global-audio";var Yd=(e=>(e.landing="landing",e.menuItem="menu-item",e.nav="nav",e.message="message",e))(Yd||{}),Xd=(e=>(e.advanced="advanced",e.builder="builder",e.actions="actions",e.model="model",e.version="version",e.mcp="mcp",e))(Xd||{});const Zd=450;var Jd=(e=>(e.Top="top",e.Right="right",e.Bottom="bottom",e.Left="left",e))(Jd||{}),eu=(e=>(e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e))(eu||{});function tu(e){var t;const n={};for(const s of e){if(null==s)continue;const e=s.toolCallId||"";0!==e.length&&(n[e]||(n[e]=[]),null==(t=n[e])||t.push(s))}return n}function nu(e){const t={};for(const n of e)t[n.file_id]=n;return t}function su(e){const t={};for(const n of e)t[n.id]=n;return t}function au(e){return e.reduce(((e,t)=>(e[t.pluginKey]=t,e)),{})}const ru=e=>e?{list:e,map:au(e)}:{list:[],map:{}};function ou(e,t){return e.map((e=>"string"==typeof e?null==t?void 0:t[e]:e)).filter((e=>void 0!==e))}function iu(e){try{JSON.parse(e)}catch(Di){return!1}return!0}function lu(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch(Di){return e}}var cu={},du=function(){return du=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},du.apply(this,arguments)};function uu(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n}function mu(e,t,n,s){return new(n||(n=Promise))((function(t,a){function r(e){try{i(s.next(e))}catch(t){a(t)}}function o(e){try{i(s.throw(e))}catch(t){a(t)}}function i(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(r,o)}i((s=s.apply(e,[])).next())}))}function pu(e,t){var n,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&i[0]?s.return:i[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function fu(e,t,n){if(n||2===arguments.length)for(var s,a=0,r=t.length;a<r;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var hu,gu,xu,vu,bu,_u,yu,ju=/^\${(.+)}$/;function wu(e){if(!e)return e;var t=e.trim(),n=t.match(ju);if(n){var s=n[1];return cu[s]||t}for(var a,r=/\${([^}]+)}/g,o=t,i=[];null!==(a=r.exec(t));)i.push({fullMatch:a[0],varName:a[1],index:a.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(s=c.varName,c.index),m=cu[s]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}(yu=hu||(hu={})).execute_code="execute_code",yu.code_interpreter="code_interpreter",yu.file_search="file_search",yu.web_search="web_search",yu.retrieval="retrieval",yu.function="function",yu.memory="memory",function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.ocr="ocr"}(gu||(gu={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(xu||(xu={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(vu||(vu={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(bu||(bu={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(_u||(_u={}));var Nu,Cu="_action_";!function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(Nu||(Nu={}));var ku,Su={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(ku||(ku={}));var Eu=[{key:"not_matched",label:"com_ui_feedback_tag_not_matched",direction:"thumbsDown",icon:"AlertCircle"},{key:"inaccurate",label:"com_ui_feedback_tag_inaccurate",direction:"thumbsDown",icon:"AlertCircle"},{key:"bad_style",label:"com_ui_feedback_tag_bad_style",direction:"thumbsDown",icon:"PenTool"},{key:"missing_image",label:"com_ui_feedback_tag_missing_image",direction:"thumbsDown",icon:"ImageOff"},{key:"unjustified_refusal",label:"com_ui_feedback_tag_unjustified_refusal",direction:"thumbsDown",icon:"Ban"},{key:"not_helpful",label:"com_ui_feedback_tag_not_helpful",direction:"thumbsDown",icon:"ThumbsDown"},{key:"other",label:"com_ui_feedback_tag_other",direction:"thumbsDown",icon:"HelpCircle"},{key:"accurate_reliable",label:"com_ui_feedback_tag_accurate_reliable",direction:"thumbsUp",icon:"CheckCircle"},{key:"creative_solution",label:"com_ui_feedback_tag_creative_solution",direction:"thumbsUp",icon:"Lightbulb"},{key:"clear_well_written",label:"com_ui_feedback_tag_clear_well_written",direction:"thumbsUp",icon:"PenTool"},{key:"attention_to_detail",label:"com_ui_feedback_tag_attention_to_detail",direction:"thumbsUp",icon:"Search"}];function Tu(e){return Eu.filter((function(t){return t.direction===e}))}var Iu,Ru,Pu,Au,Mu,Lu=uo(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),Ou=uo(["thumbsUp","thumbsDown"]),Du=mo({rating:Ou,tag:Lu,text:po().max(1024).optional()});function Fu(e){if((null==e?void 0:e.rating)&&(null==e?void 0:e.tag)&&e.tag.key)return{rating:e.rating,tag:e.tag.key,text:e.text}}function zu(e){if(e)return Eu.find((function(t){return t.key===e}))}po().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(Mu||(Mu={}));var Uu,Vu=fo(Mu);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock",e.chatGPTBrowser="chatGPTBrowser",e.gptPlugins="gptPlugins"}(Uu||(Uu={}));var Bu,$u=new Set([Uu.agents,Uu.openAI,Uu.bedrock,Uu.azureOpenAI,Uu.anthropic,Uu.custom,Uu.google]);!function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(Bu||(Bu={}));var Hu,Gu,Ku,Wu,qu,Qu=function(e,t){var n=e,s=function(e,t){if(e===Uu.bedrock){var n=t.split("."),s=[n[0],n[1]].find((function(e){return Object.values(Bu).includes(e)}));return null!=s?s:n[0]}return t}(n,t);return["".concat(n,"-").concat(s),n]},Yu=function(e){var t=null!=e?e:"";return!!t&&t.toLowerCase().endsWith(Uu.assistants)},Xu=function(e){var t=null!=e?e:"";return!!t&&t===Uu.agents},Zu=function(e,t){return!!$u.has(e)||null!=t&&$u.has(t)};!function(e){e.low="low",e.auto="auto",e.high="high"}(Hu||(Hu={})),function(e){e.none="",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(Gu||(Gu={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(Ku||(Ku={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(Wu||(Wu={})),(Iu={})[Hu.low]=0,Iu[Hu.auto]=1,Iu[Hu.high]=2,Hu.low,Hu.auto,Hu.high;var Ju=fo(Hu),em=fo(Gu),tm=fo(Ku),nm=fo(Wu),sm={assistant:"",id:"",name:"",description:"",instructions:"",conversation_starters:[],model:"",functions:[],code_interpreter:!1,image_vision:!1,retrieval:!1,append_current_datetime:!1},am=((Ru={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[hu.execute_code]=!1,Ru[hu.file_search]=!1,Ru[hu.web_search]=!1,Ru.category="general",Ru.support_contact={name:"",email:""},Ru),rm=((Pu={type:hu.function})[hu.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}},Pu),om=function(e){var t,n;return"function"===e.type&&(null===(t=e.function)||void 0===t?void 0:t.name)===(null===(n=rm.function)||void 0===n?void 0:n.name)},im={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:Hu.auto,min:0,max:2,step:1}},lm={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32768,step:1,default:-1}},cm=4096,dm={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:128e3,step:1,default:8192,reset:function(e){return/claude-3[-.]5-sonnet/.test(e)||/claude-3[-.]7/.test(e)?8192:4096},set:function(e,t){return!/claude-3[-.]5-sonnet/.test(t)&&!/claude-3[-.]7/.test(t)&&e>cm?cm:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:cm,step:1,default:cm}},web_search:{default:!1}},um={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:Hu.auto}},mm=((Au={})[Uu.openAI]=im,Au[Uu.google]=lm,Au[Uu.anthropic]=dm,Au[Uu.agents]=um,Au[Uu.bedrock]=um,Au),pm=mm[Uu.google],fm=fo(Uu),hm=ho([fm,po()]),gm=mo({authField:po(),label:po(),description:po()}),xm=mo({name:po(),pluginKey:po(),description:po().optional(),icon:po().optional(),authConfig:xo(gm).optional(),authenticated:go().optional(),chatMenu:go().optional(),isButton:go().optional(),toolkit:go().optional()}),vm=mo({input:mo({content:po()}),output:mo({content:po()})});!function(e){e.functions="functions",e.classic="classic"}(qu||(qu={}));var bm={default:0},_m=(qu.functions,qu.functions,qu.classic,{default:!0});fo(qu);var ym=mo({agent:po().default(qu.functions),skipCompletion:go().default(_m.default),model:po(),temperature:vo().default(bm.default)}),jm=mo({messageId:po(),endpoint:po().optional(),clientId:po().nullable().optional(),conversationId:po().nullable(),parentMessageId:po().nullable(),responseMessageId:po().nullable().optional(),overrideParentMessageId:po().nullable().optional(),bg:po().nullable().optional(),model:po().nullable().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),sender:po().optional(),text:po(),generation:po().nullable().optional(),isCreatedByUser:go(),error:go().optional(),clientTimestamp:po().optional(),createdAt:po().optional().default((function(){return(new Date).toISOString()})),updatedAt:po().optional().default((function(){return(new Date).toISOString()})),current:go().optional(),unfinished:go().optional(),searchResult:go().optional(),finish_reason:po().optional(),thread_id:po().optional(),iconURL:po().nullable().optional(),feedback:Du.optional()}),wm=ho([vo(),po()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),Nm=_o((function(){return ho([yo(),go(),vo(),po(),xo(_o((function(){return Nm}))),jo(_o((function(){return Nm})))])})),Cm=mo({conversationId:po().nullable(),endpoint:fm.nullable(),endpointType:fm.nullable().optional(),isArchived:go().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),user:po().optional(),messages:xo(po()).optional(),tools:ho([xo(xm),xo(po())]).optional(),modelLabel:po().nullable().optional(),userLabel:po().optional(),model:po().nullable().optional(),promptPrefix:po().nullable().optional(),temperature:vo().nullable().optional(),topP:vo().optional(),topK:vo().optional(),top_p:vo().optional(),frequency_penalty:vo().optional(),presence_penalty:vo().optional(),parentMessageId:po().optional(),maxOutputTokens:wm.nullable().optional(),maxContextTokens:wm.optional(),max_tokens:wm.optional(),promptCache:go().optional(),system:po().optional(),thinking:go().optional(),thinkingBudget:wm.optional(),stream:go().optional(),artifacts:po().optional(),context:po().nullable().optional(),examples:xo(vm).optional(),tags:xo(po()).optional(),createdAt:po(),updatedAt:po(),resendFiles:go().optional(),file_ids:xo(po()).optional(),imageDetail:Ju.optional(),reasoning_effort:em.optional().nullable(),reasoning_summary:tm.optional().nullable(),verbosity:nm.optional().nullable(),useResponsesApi:go().optional(),web_search:go().optional(),disableStreaming:go().optional(),assistant_id:po().optional(),agent_id:po().optional(),region:po().optional(),maxTokens:wm.optional(),additionalModelRequestFields:Nm.optional(),instructions:po().optional(),additional_instructions:po().optional(),append_current_datetime:go().optional(),presetOverride:jo(wo()).optional(),stop:xo(po()).optional(),greeting:po().optional(),spec:po().nullable().optional(),iconURL:po().nullable().optional(),expiredAt:po().nullable().optional(),fileTokenLimit:wm.optional(),resendImages:go().optional(),agentOptions:ym.nullable().optional(),chatGptLabel:po().nullable().optional()}),km=Cm.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(mo({conversationId:po().nullable().optional(),presetId:po().nullable().optional(),title:po().nullable().optional(),defaultPreset:go().optional(),order:vo().optional(),endpoint:hm.nullable()})),Sm=Cm.merge(mo({endpoint:hm.nullable(),createdAt:po().optional(),updatedAt:po().optional()})),Em=Cm.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(mo({endpoint:hm.nullable()}));mo({conversationId:po(),shareId:po(),messages:xo(po()),isPublic:go(),title:po(),createdAt:po(),updatedAt:po()}),mo({_id:po(),user:po(),tag:po(),description:po().optional(),createdAt:po(),updatedAt:po(),count:vo(),position:vo()});var Tm=Cm.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),Im=Tm.transform((function(e){return Am(e)})).catch((function(){return{}}));mo({maxOutputTokens:wm.optional(),temperature:wm.optional(),topP:wm.optional(),topK:wm.optional(),presencePenalty:wm.optional(),frequencyPenalty:wm.optional(),stopSequences:xo(po()).optional(),thinkingConfig:mo({includeThoughts:go().optional(),thinkingBudget:wm.optional()}).optional(),web_search:go().optional()}).strip().optional();var Rm=Cm.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,artifacts:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),Pm=Rm.transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h=du(du({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(s=null!==(n=e.chatGptLabel)&&void 0!==n?n:e.modelLabel)&&void 0!==s?s:null,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:.8,top_p:null!==(o=e.top_p)&&void 0!==o?o:1,presence_penalty:null!==(i=e.presence_penalty)&&void 0!==i?i:0,frequency_penalty:null!==(l=e.frequency_penalty)&&void 0!==l?l:0,tools:null!==(c=e.tools)&&void 0!==c?c:[],agentOptions:null!==(d=e.agentOptions)&&void 0!==d?d:{agent:qu.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,spec:null!==(p=e.spec)&&void 0!==p?p:void 0,maxContextTokens:null!==(f=e.maxContextTokens)&&void 0!==f?f:void 0});return null!=e.modelLabel&&""!==e.modelLabel&&(h.modelLabel=null),h})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:qu.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:void 0,greeting:void 0,spec:void 0,maxContextTokens:void 0}}));function Am(e,t){var n=du({},e);return Object.keys(n).forEach((function(e){var s=n[e];null==s&&delete n[e],t&&"string"==typeof s&&""===s&&delete n[e]})),n}var Mm,Lm,Om,Dm=Cm.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,s,a,r,o,i,l;return du(du({},e),{model:null!==(t=e.model)&&void 0!==t?t:im.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(s=e.instructions)&&void 0!==s?s:void 0,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:im.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),Fm=Cm.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return Am(e)})).catch((function(){return{}}));Cm.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p;return du(du({},e),{model:null!==(t=e.model)&&void 0!==t?t:um.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(s=e.temperature)&&void 0!==s?s:1,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:um.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:Hu.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:um.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:um.resendFiles.default,imageDetail:Hu.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}}));var zm=Cm.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return Am(e,!0)})).catch((function(){return{}})),Um=Tm.transform((function(e){var t=du({},e);return t.temperature===pm.temperature.default&&delete t.temperature,t.maxOutputTokens===pm.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===pm.topP.default&&delete t.topP,t.topK===pm.topK.default&&delete t.topK,Am(t)})).catch((function(){return{}})),Vm=Cm.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return Am(e)})).catch((function(){return{}})),Bm=Rm.transform((function(e){var t,n=du({},e);return null===n.modelLabel&&delete n.modelLabel,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&n.agentOptions.agent===qu.functions&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,Am(n)})).catch((function(){return{}}));mo({bannerId:po(),message:po(),displayFrom:po(),displayTo:po(),createdAt:po(),updatedAt:po(),isPublic:go()});var $m=Cm.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return Am(e)})).catch((function(){return{}})),Hm=mo({name:po(),label:po(),preset:km,order:vo().optional(),default:go().optional(),description:po().optional(),showIconInMenu:go().optional(),showIconInHeader:go().optional(),iconURL:ho([po(),fm]).optional(),authType:Vu.optional()}),Gm=mo({enforce:go().default(!1),prioritize:go().default(!0),list:xo(Hm).min(1),addedEndpoints:xo(ho([po(),fm])).optional()}),Km=((Mm={})[Uu.openAI]=!0,Mm[Uu.google]=!0,Mm[Uu.assistants]=!0,Mm[Uu.azureAssistants]=!0,Mm[Uu.agents]=!0,Mm[Uu.azureOpenAI]=!0,Mm[Uu.anthropic]=!0,Mm[Uu.custom]=!0,Mm[Uu.bedrock]=!0,Mm),Wm=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];fu(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip","image/svg","image/svg+xml"],Wm,!0),fu(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],Wm,!0);var qm=/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i,Qm=/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,Ym=/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/,Xm=/^image\/(jpeg|gif|png|webp|heic|heif)$/,Zm=/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|x-m4a|flac|x-flac|webm)$/,Jm=[Xm,/^application\/pdf$/,/^application\/vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)$/,/^application\/vnd\.ms-(word|powerpoint|excel)$/,/^application\/epub\+zip$/],ep=[Ym],tp=[Zm],np=[Ym,Qm,/^(application\/(epub\+zip|csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,Xm,Zm,/^image\/(svg|svg\+xml)$/],sp={c:"text/x-c",cs:"text/x-csharp",cpp:"text/x-c++",h:"text/x-h",md:"text/markdown",php:"text/x-php",py:"text/x-python",rb:"text/x-ruby",tex:"text/x-tex",js:"text/javascript",sh:"application/x-sh",ts:"application/typescript",tar:"application/x-tar",zip:"application/zip",yml:"application/x-yaml",yaml:"application/x-yaml",log:"text/plain",tsv:"text/tab-separated-values"},ap=[/^(text\/(x-c|x-c\+\+|x-h|html|x-java|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|vtt|xml))$/,/^(application\/(json|pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation)))$/],rp=1048576,op=function(e){return e*rp},ip=op(512),lp={fileLimit:10,fileSizeLimit:ip,totalSizeLimit:ip,supportedMimeTypes:np,disabled:!1},cp={endpoints:(Lm={},Lm[Uu.assistants]=lp,Lm[Uu.azureAssistants]=lp,Lm[Uu.agents]=lp,Lm.default={fileLimit:10,fileSizeLimit:ip,totalSizeLimit:ip,supportedMimeTypes:np,disabled:!1},Lm),serverFileSizeLimit:ip,avatarSizeLimit:op(2),fileTokenLimit:1e5,clientImageResize:{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},ocr:{supportedMimeTypes:Jm},text:{supportedMimeTypes:ep},stt:{supportedMimeTypes:tp},checkType:function(e,t){return void 0===t&&(t=np),t.some((function(t){return t.test(e)}))}},dp=xo(No()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),up=mo({disabled:go().optional(),fileLimit:vo().min(0).optional(),fileSizeLimit:vo().min(0).optional(),totalSizeLimit:vo().min(0).optional(),supportedMimeTypes:dp.optional()}),mp=mo({endpoints:jo(up).optional(),serverFileSizeLimit:vo().min(0).optional(),avatarSizeLimit:vo().min(0).optional(),fileTokenLimit:vo().min(0).optional(),imageGeneration:mo({percentage:vo().min(0).max(100).optional(),px:vo().min(0).optional()}).optional(),clientImageResize:mo({enabled:go().optional(),maxWidth:vo().min(0).optional(),maxHeight:vo().min(0).optional(),quality:vo().min(0).max(1).optional()}).optional(),ocr:mo({supportedMimeTypes:dp.optional()}).optional(),text:mo({supportedMimeTypes:dp.optional()}).optional()}),pp=function(e){return e.reduce((function(e,t){try{var n=new RegExp(t);e.push(n)}catch(s){console.error('Invalid regex pattern "'.concat(t,'" skipped.'),s)}return e}),[])};function fp(e){var t,n,s,a=du(du({},cp),{ocr:du(du({},cp.ocr),{supportedMimeTypes:(null===(t=cp.ocr)||void 0===t?void 0:t.supportedMimeTypes)||[]}),text:du(du({},cp.text),{supportedMimeTypes:(null===(n=cp.text)||void 0===n?void 0:n.supportedMimeTypes)||[]}),stt:du(du({},cp.stt),{supportedMimeTypes:(null===(s=cp.stt)||void 0===s?void 0:s.supportedMimeTypes)||[]})});if(!e)return a;if(void 0!==e.serverFileSizeLimit&&(a.serverFileSizeLimit=op(e.serverFileSizeLimit)),void 0!==e.avatarSizeLimit&&(a.avatarSizeLimit=op(e.avatarSizeLimit)),void 0!==e.fileTokenLimit&&(a.fileTokenLimit=e.fileTokenLimit),void 0!==e.clientImageResize&&(a.clientImageResize=du(du({},a.clientImageResize),e.clientImageResize)),void 0!==e.ocr&&(a.ocr=du(du({},a.ocr),e.ocr),e.ocr.supportedMimeTypes&&(a.ocr.supportedMimeTypes=pp(e.ocr.supportedMimeTypes))),void 0!==e.text&&(a.text=du(du({},a.text),e.text),e.text.supportedMimeTypes&&(a.text.supportedMimeTypes=pp(e.text.supportedMimeTypes))),!e.endpoints)return a;var r=function(t){var n=e.endpoints[t];a.endpoints[t]||(a.endpoints[t]={});var s=a.endpoints[t];if(!0===n.disabled)return s.disabled=!0,s.fileLimit=0,s.fileSizeLimit=0,s.totalSizeLimit=0,s.supportedMimeTypes=[],"continue";void 0!==n.fileSizeLimit&&(s.fileSizeLimit=op(n.fileSizeLimit)),void 0!==n.totalSizeLimit&&(s.totalSizeLimit=op(n.totalSizeLimit)),["fileLimit"].forEach((function(e){void 0!==n[e]&&(s[e]=n[e])})),n.supportedMimeTypes&&(s.supportedMimeTypes=pp(n.supportedMimeTypes))};for(var o in e.endpoints)r(o);return a}!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(Om||(Om={}));var hp,gp,xp,vp,bp=function(e){return e===Om.openai||e===Om.azure};!function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(hp||(hp={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(gp||(gp={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(xp||(xp={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(vp||(vp={}));var _p=mo({startup:go().optional(),iconPath:po().optional(),timeout:vo().optional(),initTimeout:vo().optional(),chatMenu:go().optional(),serverInstructions:ho([go(),po()]).optional(),requiresOAuth:go().optional(),oauth:mo({authorization_url:po().url().optional(),token_url:po().url().optional(),client_id:po().optional(),client_secret:po().optional(),scope:po().optional(),redirect_uri:po().url().optional(),token_exchange_method:fo(vp).optional(),grant_types_supported:xo(po()).optional(),token_endpoint_auth_methods_supported:xo(po()).optional(),response_types_supported:xo(po()).optional(),code_challenge_methods_supported:xo(po()).optional()}).optional(),customUserVars:jo(po(),mo({title:po(),description:po()})).optional()}),yp=_p.extend({type:bo("stdio").optional(),command:po(),args:xo(po()),env:jo(po(),po()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,s=Object.entries(e);n<s.length;n++){var a=s[n],r=a[0],o=a[1];t[r]=wu(o)}return t})),stderr:No().optional()}),jp=_p.extend({type:bo("websocket").optional(),url:po().transform((function(e){return wu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),wp=_p.extend({type:bo("sse").optional(),headers:jo(po(),po()).optional(),url:po().transform((function(e){return wu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),Np=_p.extend({type:ho([bo("streamable-http"),bo("http")]),headers:jo(po(),po()).optional(),url:po().transform((function(e){return wu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),Cp=ho([yp,jp,wp,Np]),kp=jo(po(),Cp),Sp="";if(void 0===xe||!0===xe.browser){var Ep=document.querySelector("base");Sp=(null==Ep?void 0:Ep.getAttribute("href"))||"/"}Sp&&Sp.endsWith("/")&&(Sp=Sp.slice(0,-1));var Tp,Ip,Rp,Pp,Ap,Mp,Lp,Op,Dp,Fp=function(){return Sp},zp=function(e){var t=Object.entries(e).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&");return t?"?".concat(t):""},Up="".concat(Sp,"/api/messages"),Vp=function(e){var t=e.conversationId,n=e.messageId,s=uu(e,["conversationId","messageId"]);return t&&n?"".concat(Up,"/").concat(t,"/").concat(n):t?"".concat(Up,"/").concat(t):"".concat(Up).concat(zp(s))},Bp=function(e){return"".concat(Up,"/artifacts/").concat(e)},$p="".concat(Sp,"/api/share"),Hp=function(e){return"".concat($p,"/").concat(e)},Gp=function(e,t,n,s,a,r){return"".concat($p,"?pageSize=").concat(e,"&isPublic=").concat(t,"&sortBy=").concat(n,"&sortDirection=").concat(s).concat(a?"&search=".concat(a):"").concat(r?"&cursor=".concat(r):"")},Kp="".concat(Sp,"/api/keys"),Wp="".concat(Sp,"/api/convos"),qp=function(e){return"".concat(Wp).concat(zp(e))},Qp=function(){return"".concat(Wp,"/update")},Yp=function(){return"".concat(Sp,"/api/presets")},Xp=function(){return"".concat(Sp,"/api/prompts")},Zp=function(e){var t=e.path,n=void 0===t?"":t,s=e.options,a=e.version,r=e.endpoint,o=!0===e.isAvatar?"".concat(tf(),"/assistants"):"".concat(Sp,"/api/assistants/v").concat(a);if(n&&""!==n&&(o+="/".concat(n)),r&&(s=du(du({},null!=s?s:{}),{endpoint:r})),s&&Object.keys(s).length>0){var i=new URLSearchParams(s).toString();o+="?".concat(i)}return o},Jp=function(e){var t=e.path,n=void 0===t?"":t,s=e.options,a="".concat(Sp,"/api/agents");if(n&&""!==n&&(a+="/".concat(n)),s&&Object.keys(s).length>0){var r=new URLSearchParams(s).toString();a+="?".concat(r)}return a},ef=function(){return"".concat(Sp,"/api/files")},tf=function(){return"".concat(ef(),"/images")},nf=function(){return"".concat(ef(),"/speech")},sf=function(){return"".concat(nf(),"/tts")},af=function(e){return"".concat(Xp(),"/groups/").concat(e)},rf=function(e){return"".concat(Xp(),"/").concat(e)},of=Xp,lf=af,cf=af,df=function(e){return"".concat("".concat(Sp,"/api/roles"),"/").concat(e.toLowerCase())},uf=function(e){return"".concat(Sp,"/api/tags").concat(null!=e&&e?"/".concat(encodeURIComponent(e)):"")},mf=function(){return"".concat(Sp,"/api/memories")},pf=function(e){return"".concat(mf(),"/").concat(encodeURIComponent(e))},ff=new Set(["conversationId","title","iconURL","greeting","endpoint","endpointType","createdAt","updatedAt","expiredAt","messages","isArchived","tags","user","__v","_id","tools","model","files","spec","disableParams"]);!function(e){e.default="default",e.advanced="advanced"}(Dp||(Dp={}));var hf=fo(Om),gf=mo({default:hf.optional(),avatar:hf.optional(),image:hf.optional(),document:hf.optional()}).optional();var xf,vf,bf=mo({deploymentName:po().optional(),version:po().optional(),assistants:go().optional()}).or(go()),_f=mo({apiKey:po(),serverless:go().optional(),instanceName:po().optional(),deploymentName:po().optional(),assistants:go().optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),forcePrompt:go().optional(),version:po().optional(),baseURL:po().optional(),additionalHeaders:jo(No()).optional()}),yf=mo({group:po(),models:jo(po(),bf)}).required().and(_f),jf=xo(yf).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(xf||(xf={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.tools="tools",e.chain="chain",e.ocr="ocr"}(vf||(vf={}));var wf,Nf=((Tp={})[Uu.assistants]=2,Tp[Uu.azureAssistants]=1,Tp),Cf=mo({streamRate:vo().optional(),baseURL:po().optional(),titlePrompt:po().optional(),titleModel:po().optional(),titleConvo:go().optional(),titleMethod:ho([bo("completion"),bo("functions"),bo("structured")]).optional(),titleEndpoint:po().optional(),titlePromptTemplate:po().optional()});Cf.merge(mo({availableRegions:xo(po()).optional()}));var kf=Cf.merge(mo({disableBuilder:go().optional(),pollIntervalMs:vo().optional(),timeoutMs:vo().optional(),version:ho([po(),vo()]).default(2),supportedIds:xo(po()).min(1).optional(),excludedIds:xo(po()).min(1).optional(),privateAssistants:go().optional(),retrievalModels:xo(po()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:xo(fo(xf)).optional().default([xf.code_interpreter,xf.image_vision,xf.retrieval,xf.actions,xf.tools]),apiKey:po().optional(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}).optional(),headers:jo(No()).optional()})),Sf=[vf.execute_code,vf.file_search,vf.web_search,vf.artifacts,vf.actions,vf.tools,vf.chain,vf.ocr],Ef=Cf.merge(mo({recursionLimit:vo().optional(),disableBuilder:go().optional().default(!1),maxRecursionLimit:vo().optional(),maxCitations:vo().min(1).max(50).optional().default(30),maxCitationsPerFile:vo().min(1).max(10).optional().default(7),minRelevanceScore:vo().min(0).max(1).optional().default(.45),allowedProviders:xo(ho([po(),fm])).optional(),capabilities:xo(fo(vf)).optional().default(Sf)})).default({disableBuilder:!1,capabilities:Sf,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),Tf=Cf.merge(mo({name:po().refine((function(e){return!fm.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(Uu).join(", "))}),apiKey:po(),baseURL:po(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}),summarize:go().optional(),summaryModel:po().optional(),iconURL:po().optional(),forcePrompt:go().optional(),modelDisplayLabel:po().optional(),headers:jo(No()).optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),customParams:mo({defaultParamsEndpoint:po().default("custom"),paramDefinitions:xo(jo(No())).optional()}).strict(),customOrder:vo().optional(),directEndpoint:go().optional(),titleMessageRole:po().optional()})),If=mo({groups:jf,plugins:go().optional(),assistants:go().optional()}).and(Tf.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),Rf=mo({url:po().optional(),apiKey:po(),model:po(),voices:xo(po())}),Pf=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po(),model:po(),voices:xo(po())}),Af=mo({url:po().optional(),websocketUrl:po().optional(),apiKey:po(),model:po(),voices:xo(po()),voice_settings:mo({similarity_boost:vo().optional(),stability:vo().optional(),style:vo().optional(),use_speaker_boost:go().optional()}).optional(),pronunciation_dictionary_locators:xo(po()).optional()}),Mf=mo({url:po(),apiKey:po().optional(),voices:xo(po()),backend:po()}),Lf=mo({openai:Rf.optional(),azureOpenAI:Pf.optional(),elevenlabs:Af.optional(),localai:Mf.optional()}),Of=mo({url:po().optional(),apiKey:po(),model:po()}),Df=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po()}),Ff=mo({openai:Of.optional(),azureOpenAI:Df.optional()}),zf=mo({conversationMode:go().optional(),advancedMode:go().optional(),speechToText:go().optional().or(mo({engineSTT:po().optional(),languageSTT:po().optional(),autoTranscribeAudio:go().optional(),decibelValue:vo().optional(),autoSendText:vo().optional()})).optional(),textToSpeech:go().optional().or(mo({engineTTS:po().optional(),voice:po().optional(),languageTTS:po().optional(),automaticPlayback:go().optional(),playbackRate:vo().optional(),cacheTTS:go().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(wf||(wf={}));var Uf,Vf=mo({fileUploads:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),conversationsImport:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),tts:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),stt:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(Uf||(Uf={}));var Bf,$f,Hf,Gf,Kf,Wf,qf=mo({externalUrl:po().optional(),openNewTab:go().optional(),modalAcceptance:go().optional(),modalTitle:po().optional(),modalContent:po().or(xo(po())).optional()}),Qf=mo({placeholder:po().optional()}),Yf=mo({privacyPolicy:mo({externalUrl:po().optional(),openNewTab:go().optional()}).optional(),termsOfService:qf.optional(),customWelcome:po().optional(),mcpServers:Qf.optional(),endpointsMenu:go().optional(),modelSelect:go().optional(),parameters:go().optional(),sidePanel:go().optional(),multiConvo:go().optional(),bookmarks:go().optional(),memories:go().optional(),presets:go().optional(),prompts:go().optional(),agents:go().optional(),temporaryChat:go().optional(),temporaryChatRetention:vo().min(1).max(8760).optional(),runCode:go().optional(),webSearch:go().optional(),peoplePicker:mo({users:go().optional(),groups:go().optional(),roles:go().optional()}).optional(),marketplace:mo({use:go().optional()}).optional(),fileSearch:go().optional(),fileCitations:go().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},fileSearch:!0,fileCitations:!0}),Xf=mo({language:po().default("auto"),size:uo(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),Zf=mo({siteKey:po(),options:Xf.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(Bf||(Bf={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}($f||($f={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(Hf||(Hf={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(Gf||(Gf={})),function(e){e.JINA="jina",e.COHERE="cohere"}(Kf||(Kf={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(Wf||(Wf={}));var Jf,eh,th=mo({serperApiKey:po().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:po().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:po().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:po().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:po().optional().default("${FIRECRAWL_API_URL}"),jinaApiKey:po().optional().default("${JINA_API_KEY}"),jinaApiUrl:po().optional().default("${JINA_API_URL}"),cohereApiKey:po().optional().default("${COHERE_API_KEY}"),searchProvider:fo(Hf).optional(),scraperType:fo(Gf).optional(),rerankerType:fo(Kf).optional(),scraperTimeout:vo().optional(),safeSearch:fo(Wf).default(Wf.MODERATE),firecrawlOptions:mo({formats:xo(po()).optional(),includeTags:xo(po()).optional(),excludeTags:xo(po()).optional(),headers:jo(po()).optional(),waitFor:vo().optional(),timeout:vo().optional(),maxAge:vo().optional(),mobile:go().optional(),skipTlsVerification:go().optional(),blockAds:go().optional(),removeBase64Images:go().optional(),parsePDF:go().optional(),storeInCache:go().optional(),zeroDataRetention:go().optional(),location:mo({country:po().optional(),languages:xo(po()).optional()}).optional(),onlyMainContent:go().optional(),changeTrackingOptions:mo({modes:xo(po()).optional(),schema:jo(wo()).optional(),prompt:po().optional(),tag:po().nullable().optional()}).optional()}).optional()}),nh=mo({mistralModel:po().optional(),apiKey:po().optional().default("${OCR_API_KEY}"),baseURL:po().optional().default("${OCR_BASEURL}"),strategy:fo(Bf).default(Bf.MISTRAL_OCR)}),sh=mo({enabled:go().optional().default(!1),startBalance:vo().optional().default(2e4),autoRefillEnabled:go().optional().default(!1),refillIntervalValue:vo().optional().default(30),refillIntervalUnit:uo(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:vo().optional().default(1e4)}),ah=mo({enabled:go().optional().default(!0)}),rh=mo({disabled:go().optional(),validKeys:xo(po()).optional(),tokenLimit:vo().optional(),charLimit:vo().optional().default(1e4),personalize:go().default(!0),messageWindowSize:vo().optional().default(5),agent:ho([mo({id:po()}),mo({provider:po(),model:po(),instructions:po().optional(),model_parameters:jo(No()).optional()})]).optional()}),oh=xo(Tf.partial()).optional(),ih=mo({version:po(),cache:go().default(!0),ocr:nh.optional(),webSearch:th.optional(),memory:rh.optional(),secureImageLinks:go().optional(),imageOutputType:fo(Uf).default(Uf.PNG),includedTools:xo(po()).optional(),filteredTools:xo(po()).optional(),mcpServers:kp.optional(),interface:Yf,turnstile:Zf.optional(),fileStrategy:hf.default(Om.local),fileStrategies:gf,actions:mo({allowedDomains:xo(po()).optional()}).optional(),registration:mo({socialLogins:xo(po()).optional(),allowedDomains:xo(po()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:sh.optional(),transactions:ah.optional(),speech:mo({tts:Lf.optional(),stt:Ff.optional(),speechTab:zf.optional()}).optional(),rateLimits:Vf.optional(),fileConfig:mp.optional(),modelSpecs:Gm.optional(),endpoints:mo((Ip={all:Cf.optional()},Ip[Uu.openAI]=Cf.optional(),Ip[Uu.google]=Cf.optional(),Ip[Uu.anthropic]=Cf.optional(),Ip[Uu.gptPlugins]=Cf.optional(),Ip[Uu.azureOpenAI]=If.optional(),Ip[Uu.azureAssistants]=kf.optional(),Ip[Uu.assistants]=kf.optional(),Ip[Uu.agents]=Ef.optional(),Ip[Uu.custom]=oh.optional(),Ip[Uu.bedrock]=Cf.optional(),Ip)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),lh=function(){return e=ih.shape,t=Object.entries(e).map((function(e){var t=e[0],n=e[1];return n instanceof Co?[t,n._def.defaultValue()]:[t,void 0]})),Object.fromEntries(t);var e,t};!function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.xai="xai"}(Jf||(Jf={})),(eh||(eh={})).openrouter="openrouter";var ch,dh=[Uu.openAI,Uu.assistants,Uu.azureAssistants,Uu.azureOpenAI,Uu.agents,Uu.chatGPTBrowser,Uu.gptPlugins,Uu.google,Uu.anthropic,Uu.custom,Uu.bedrock],uh=((Rp={})[Uu.openAI]="OpenAI",Rp[Uu.assistants]="Assistants",Rp[Uu.agents]="My Agents",Rp[Uu.azureAssistants]="Azure Assistants",Rp[Uu.azureOpenAI]="Azure OpenAI",Rp[Uu.chatGPTBrowser]="ChatGPT",Rp[Uu.gptPlugins]="Plugins",Rp[Uu.google]="Google",Rp[Uu.anthropic]="Anthropic",Rp[Uu.custom]="Custom",Rp[Uu.bedrock]="AWS Bedrock",Rp[Jf.ollama]="Ollama",Rp[Jf.deepseek]="DeepSeek",Rp[Jf.xai]="xAI",Rp),mh=["gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],ph=((Pp={})[Uu.azureAssistants]=mh,Pp[Uu.assistants]=fu(fu([],mh,!0),["chatgpt-4o-latest"],!1),Pp[Uu.agents]=mh,Pp[Uu.google]=["gemini-2.0-flash-001","gemini-2.0-flash-exp","gemini-2.0-flash-lite","gemini-2.0-pro-exp-02-05","gemini-1.5-flash-001","gemini-1.5-flash-002","gemini-1.5-pro-001","gemini-1.5-pro-002","gemini-1.0-pro-001"],Pp[Uu.anthropic]=["claude-sonnet-4-20250514","claude-sonnet-4-latest","claude-opus-4-20250514","claude-opus-4-latest","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],Pp[Uu.openAI]=fu(fu([],mh,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),Pp[Uu.bedrock]=["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],Pp),fh=ph[Uu.openAI];(Ap={initial:[]})[Uu.openAI]=fh,Ap[Uu.assistants]=fh.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),Ap[Uu.agents]=fh,Ap[Uu.gptPlugins]=fh,Ap[Uu.azureOpenAI]=fh,Ap[Uu.chatGPTBrowser]=["text-davinci-002-render-sha"],Ap[Uu.google]=ph[Uu.google],Ap[Uu.anthropic]=ph[Uu.anthropic],Ap[Uu.bedrock]=ph[Uu.bedrock];var hh=((Mp={})[Uu.assistants]="".concat(Fp(),"/api/assistants/v2/chat"),Mp[Uu.azureAssistants]="".concat(Fp(),"/api/assistants/v1/chat"),Mp[Uu.agents]="".concat(Fp(),"/api/").concat(Uu.agents,"/chat"),Mp),gh=new Set([Uu.gptPlugins,Uu.anthropic,Uu.google,Uu.openAI,Uu.azureOpenAI,Uu.custom,Uu.agents,Uu.bedrock]);(Lp={})[Uu.custom]=!0,Lp[Uu.openAI]=!0,Lp[Uu.anthropic]=!0,Lp[Uu.gptPlugins]=!0,Lp[Uu.assistants]=!0,Lp[Uu.agents]=!0,Lp[Uu.azureAssistants]=!0,Lp[Uu.azureOpenAI]=!0,Lp[Uu.bedrock]=!0,function(e){e.generative="generative",e.agents="agents"}(ch||(ch={}));var xh,vh,bh,_h,yh,jh,wh,Nh,Ch,kh,Sh,Eh,Th,Ih,Rh,Ph,Ah,Mh,Lh=new Set(["dalle","dall-e","stable-diffusion","flux"]);!function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(xh||(xh={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(vh||(vh={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.PLUGINS="PLUGINS",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.LIBRECHAT_YAML_CONFIG="LIBRECHAT_YAML_CONFIG",e.STATIC_CONFIG="STATIC_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(bh||(bh={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(_h||(_h={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed"}(yh||(yh={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(jh||(jh={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(wh||(wh={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(Nh||(Nh={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(Ch||(Ch={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}(kh||(kh={})),function(e){e.VERSION="v0.8.0-rc3",e.CONFIG_VERSION="1.2.8",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_server="sys__server__sys",e.EPHEMERAL_AGENT_ID="ephemeral"}(Sh||(Sh={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(Eh||(Eh={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(Th||(Th={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(Ih||(Ih={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(Rh||(Rh={})),(Op={})[Uu.openAI]=Uu.openAI,Op[Uu.bedrock]=Uu.bedrock,Op[Uu.anthropic]=Uu.anthropic,Op[Uu.azureOpenAI]=Uu.azureOpenAI;var Oh={current_date:!0,current_user:!0,iso_datetime:!0,current_datetime:!0};!function(e){e.TEXT="text",e.THINK="think",e.TEXT_DELTA="text_delta",e.TOOL_CALL="tool_call",e.IMAGE_FILE="image_file",e.IMAGE_URL="image_url",e.AGENT_UPDATE="agent_update",e.ERROR="error"}(Ph||(Ph={})),function(e){e.TOOL_CALLS="tool_calls",e.MESSAGE_CREATION="message_creation"}(Ah||(Ah={})),function(e){e.FUNCTION="function",e.RETRIEVAL="retrieval",e.FILE_SEARCH="file_search",e.CODE_INTERPRETER="code_interpreter",e.TOOL_CALL="tool_call"}(Mh||(Mh={}));var Dh=Cm.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,maxOutputTokens:!0,maxContextTokens:!0,artifacts:!0,region:!0,system:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).transform((function(e){var t,n;if(null!=(null===(t=e.additionalModelRequestFields)||void 0===t?void 0:t.thinking)){var s=e;e.thinking=!!s.additionalModelRequestFields.thinking,e.thinkingBudget="object"==typeof s.additionalModelRequestFields.thinking?null===(n=s.additionalModelRequestFields.thinking)||void 0===n?void 0:n.budget_tokens:void 0,delete e.additionalModelRequestFields}return Am(e)})).catch((function(){return{}}));Cm.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,artifacts:!0,maxOutputTokens:!0,maxContextTokens:!0,region:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).catchall(No()).transform((function(e){var t=["modelLabel","promptPrefix","resendFiles","iconURL","greeting","spec","maxOutputTokens","artifacts","additionalModelRequestFields","region","model","maxTokens","temperature","topP","stop"],n={},s=e;return Object.entries(s).forEach((function(e){var a=e[0],r=e[1];t.includes(a)||("topK"===a?n.top_k=r:n[a]=r,delete s[a])})),"string"==typeof s.model&&(s.model.includes("anthropic.claude-3-7-sonnet")||/anthropic\.claude-(?:[4-9](?:\.\d+)?(?:-\d+)?-(?:sonnet|opus|haiku)|(?:sonnet|opus|haiku)-[4-9])/.test(s.model))?(void 0===n.thinking?n.thinking=!0:!1===n.thinking&&(delete n.thinking,delete n.thinkingBudget),!0===n.thinking&&void 0===n.thinkingBudget&&(n.thinkingBudget=2e3),n.anthropic_beta=["output-128k-2025-02-19"]):null==n.thinking&&null==n.thinkingBudget||(delete n.thinking,delete n.thinkingBudget),Object.keys(n).length>0&&(s.additionalModelRequestFields=du(du({},s.additionalModelRequestFields||{}),n)),void 0!==s.maxOutputTokens?s.maxTokens=s.maxOutputTokens:void 0!==s.maxTokens&&(s.maxOutputTokens=s.maxTokens),Am(s)})).catch((function(){return{}}));var Fh,zh,Uh=((Fh={})[Uu.openAI]=zm,Fh[Uu.azureOpenAI]=zm,Fh[Uu.custom]=zm,Fh[Uu.google]=Im,Fh[Uu.anthropic]=Vm,Fh[Uu.gptPlugins]=Pm,Fh[Uu.assistants]=Dm,Fh[Uu.azureAssistants]=Dm,Fh[Uu.agents]=$m,Fh[Uu.bedrock]=Dh,Fh);function Vh(e){for(var t,n=0,s=e;n<s.length;n++){var a=s[n];if(a){t=a;break}}return t}function Bh(e){for(var t=0,n=e;t<n.length;t++){var s=n[t];if(s&&""!==s.trim())return s}}var $h,Hh=function(e){var t,n,s=e.endpoint,a=e.endpointType,r=e.conversation,o=e.possibleValues,i=Uh[s];if(!i&&!a)throw new Error("Unknown endpoint: ".concat(s));!i&&a&&(i=Uh[a]);var l=null==i?void 0:i.parse(r),c=null!=o?o:{},d=c.models,u=c.secondaryModels;return d&&l&&(l.model=null!==(t=Vh(d))&&void 0!==t?t:l.model),u&&(null==l?void 0:l.agentOptions)&&(l.agentOptions.model=null!==(n=Vh(u))&&void 0!==n?n:l.agentOptions.model),l},Gh=function(e){var t=e.match(/gpt-(\d+(?:\.\d+)?)([a-z])?/i);if(t){var n=t[1],s=t[2]||"";return"GPT-".concat(n).concat(s)}return""},Kh=function(e){var t=e.match(/\bo(\d+(?:\.\d+)?)\b/i);if(t){var n=t[1];return"o".concat(n)}return""},Wh=function(e){var t,n=e.model,s=e.endpoint,a=e.endpointType,r=e.modelDisplayLabel,o=e.chatGptLabel,i=e.modelLabel,l=s,c=null!=n?n:"",d=null!=r?r:"",u=null!=o?o:"",m=null!=i?i:"";return[Uu.openAI,Uu.bedrock,Uu.gptPlugins,Uu.azureOpenAI,Uu.chatGPTBrowser].includes(l)?u||m||(c&&Kh(c)?Kh(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?Gh(c)||"GPT":null!==(t=uh[l])&&void 0!==t?t:"ChatGPT"):l===Uu.anthropic?m||"Claude":l===Uu.bedrock?m||uh[l]:l===Uu.google?m||(!0===(null==c?void 0:c.toLowerCase().includes("gemma"))?"Gemma":"Gemini"):l===Uu.custom||a===Uu.custom?m||u||(c&&Kh(c)?Kh(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?Gh(c)||"GPT":d||"AI"):""},qh=((zh={})[Uu.openAI]=zm,zh[Uu.azureOpenAI]=zm,zh[Uu.custom]=zm,zh[Uu.assistants]=Fm,zh[Uu.azureAssistants]=Fm,zh[Uu.agents]=$m,zh[Uu.google]=Um,zh[Uu.bedrock]=Dh,zh[Uu.anthropic]=Vm,zh[Uu.gptPlugins]=Bm,zh),Qh=function(e){var t,n=e.endpoint,s=e.endpointType,a=e.conversation,r=e.possibleValues;if(!n)throw new Error("undefined endpoint: ".concat(n));var o=qh[n];if(!o&&!s)throw new Error("Unknown endpoint: ".concat(n));if(!o&&s&&(o=qh[s]),!o)throw new Error("Unknown endpointType: ".concat(s));var i=o.parse(a),l=(null!=r?r:{}).models;return l&&i&&(i.model=null!==(t=Vh(l))&&void 0!==t?t:i.model),i};function Yh(e,t){void 0===t&&(t=!1);for(var n="",s=0,a=e;s<a.length;s++){var r=a[s];if(r.type)if(r.type===Ph.TEXT){var o="string"==typeof r.text?r.text:r.text.value;n.length>0&&o.length>0&&" "!==n[n.length-1]&&" "!==o[0]&&(n+=" "),n+=o}else r.type!==Ph.THINK||t||(o="string"==typeof r.think?r.think:"",n.length>0&&o.length>0&&" "!==n[n.length-1]&&" "!==o[0]&&(n+=" "),n+=o)}return n}function Xh(e){var t=e.text,n=e.user,s=t;if(!s)return s;var a=_e().format("YYYY-MM-DD"),r=_e().day(),o="".concat(a," (").concat(r,")");s=s.replace(/{{current_date}}/gi,o);var i=_e().format("YYYY-MM-DD HH:mm:ss");s=s.replace(/{{current_datetime}}/gi,"".concat(i," (").concat(r,")"));var l=_e().toISOString();return s=s.replace(/{{iso_datetime}}/gi,l),n&&n.name&&(s=s.replace(/{{current_user}}/gi,n.name)),s}function Zh(e){var t=e.messages,n=e.fileMap;if(null===t)return null;var s={},a=[],r={};return t.forEach((function(e){var t;if(e){var o=null!==(t=e.parentMessageId)&&void 0!==t?t:"";r[o]=(r[o]||0)+1;var i=du(du({},e),{children:[],depth:0,siblingIndex:r[o]-1});e.files&&n&&(i.files=e.files.map((function(e){var t,s;return null!==(s=n[null!==(t=e.file_id)&&void 0!==t?t:""])&&void 0!==s?s:e}))),s[e.messageId]=i;var l=s[o];l?(l.children.push(i),i.depth=l.depth+1):a.push(i)}})),a}!function(e){e.DEFAULT="default",e.SHADCNUI="shadcnui",e.CUSTOM="custom"}($h||($h={}));var Jh,eg,tg,ng,sg,ag,rg,og,ig,lg,cg,dg,ug,mg,pg,fg,hg,gg,xg={utils:'\nimport { type ClassValue, clsx } from "clsx"\nimport { twMerge } from "tailwind-merge"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n',accordian:'import * as React from "react"\nimport * as AccordionPrimitive from "@radix-ui/react-accordion"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn("border-b", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = "AccordionItem"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className="flex">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"\n    {...props}\n  >\n    <div className={cn("pb-4 pt-0", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n',alertDialog:'import * as React from "react"\nimport * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-2 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = "AlertDialogHeader"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = "AlertDialogFooter"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn("text-lg font-semibold", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: "outline" }),\n      "mt-2 sm:mt-0",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n',alert:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst alertVariants = cva(\n  "relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role="alert"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = "Alert"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn("mb-1 font-medium leading-none tracking-tight", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = "AlertTitle"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("text-sm [&_p]:leading-relaxed", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = "AlertDescription"\n\nexport { Alert, AlertTitle, AlertDescription }\n\n',avatar:'import * as React from "react"\nimport * as AvatarPrimitive from "@radix-ui/react-avatar"\n\nimport { cn } from "../../lib/utils"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn("aspect-square h-full w-full", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      "flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n\n',badge:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst badgeVariants = cva(\n  "inline-flex items-center rounded-full border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default:\n          "border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",\n        secondary:\n          "border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        destructive:\n          "border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",\n        outline: "text-gray-950 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n\n',breadcrumb:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<"nav"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)\nBreadcrumb.displayName = "Breadcrumb"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<"ol">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      "flex flex-wrap items-center gap-1.5 break-words text-sm text-gray-500 sm:gap-2.5 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = "BreadcrumbList"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<"li">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn("inline-flex items-center gap-1.5", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = "BreadcrumbItem"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<"a"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : "a"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn("transition-colors hover:text-gray-950 dark:hover:text-gray-50", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = "BreadcrumbLink"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<"span">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role="link"\n    aria-disabled="true"\n    aria-current="page"\n    className={cn("font-normal text-gray-950 dark:text-gray-50", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = "BreadcrumbPage"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<"li">) => (\n  <li\n    role="presentation"\n    aria-hidden="true"\n    className={cn("[&>svg]:size-3.5", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = "BreadcrumbSeparator"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    role="presentation"\n    aria-hidden="true"\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = "BreadcrumbElipssis"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n\n',button:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from \'../../lib/utils\';\n\nconst buttonVariants = cva(\n  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default: "bg-gray-900 text-gray-50 hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",\n        destructive:\n          "bg-red-500 text-gray-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",\n        outline:\n          "border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        secondary:\n          "bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        ghost: "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        link: "text-gray-900 underline-offset-4 hover:underline dark:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-4 py-2",\n        sm: "h-9 rounded-md px-3",\n        lg: "h-11 rounded-md px-8",\n        icon: "h-10 w-10",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : "button"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = "Button"\n\nexport { Button, buttonVariants }\n',calendar:'import * as React from "react"\nimport { ChevronLeft, ChevronRight } from "lucide-react"\nimport { DayPicker } from "react-day-picker"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn("p-3", className)}\n      classNames={{\n        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",\n        month: "space-y-4",\n        caption: "flex justify-center pt-1 relative items-center",\n        caption_label: "text-sm font-medium",\n        nav: "space-x-1 flex items-center",\n        nav_button: cn(\n          buttonVariants({ variant: "outline" }),\n          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"\n        ),\n        nav_button_previous: "absolute left-1",\n        nav_button_next: "absolute right-1",\n        table: "w-full border-collapse space-y-1",\n        head_row: "flex",\n        head_cell:\n          "text-gray-500 rounded-md w-9 font-normal text-[0.8rem] dark:text-gray-400",\n        row: "flex w-full mt-2",\n        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-gray-100/50 [&:has([aria-selected])]:bg-gray-100 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20 dark:[&:has([aria-selected].day-outside)]:bg-gray-800/50 dark:[&:has([aria-selected])]:bg-gray-800",\n        day: cn(\n          buttonVariants({ variant: "ghost" }),\n          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"\n        ),\n        day_range_end: "day-range-end",\n        day_selected:\n          "bg-gray-900 text-gray-50 hover:bg-gray-900 hover:text-gray-50 focus:bg-gray-900 focus:text-gray-50 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50 dark:hover:text-gray-900 dark:focus:bg-gray-50 dark:focus:text-gray-900",\n        day_today: "bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-50",\n        day_outside:\n          "day-outside text-gray-500 opacity-50 aria-selected:bg-gray-100/50 aria-selected:text-gray-500 aria-selected:opacity-30 dark:text-gray-400 dark:aria-selected:bg-gray-800/50 dark:aria-selected:text-gray-400",\n        day_disabled: "text-gray-500 opacity-50 dark:text-gray-400",\n        day_range_middle:\n          "aria-selected:bg-gray-100 aria-selected:text-gray-900 dark:aria-selected:bg-gray-800 dark:aria-selected:text-gray-50",\n        day_hidden: "invisible",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,\n        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = "Calendar"\n\nexport { Calendar }\n\n',card:'import * as React from \'react\';\n\nimport { cn } from \'../../lib/utils\';\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      "rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = "Card"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex flex-col space-y-1.5 p-6", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = "CardHeader"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      "text-2xl font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = "CardTitle"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = "CardDescription"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />\n))\nCardContent.displayName = "CardContent"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex items-center p-6 pt-0", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = "CardFooter"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n',carousel:'import * as React from "react"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from "embla-carousel-react"\nimport { ArrowLeft, ArrowRight } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { Button } from "./button"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: "horizontal" | "vertical"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error("useCarousel must be used within a <Carousel />")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = "horizontal",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === "horizontal" ? "x" : "y",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === "ArrowLeft") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === "ArrowRight") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on("reInit", onSelect)\n      api.on("select", onSelect)\n\n      return () => {\n        api?.off("select", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn("relative", className)}\n          role="region"\n          aria-roledescription="carousel"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = "Carousel"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className="overflow-hidden">\n      <div\n        ref={ref}\n        className={cn(\n          "flex",\n          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = "CarouselContent"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role="group"\n      aria-roledescription="slide"\n      className={cn(\n        "min-w-0 shrink-0 grow-0 basis-full",\n        orientation === "horizontal" ? "pl-4" : "pt-4",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = "CarouselItem"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute  h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-left-12 top-1/2 -translate-y-1/2"\n          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className="h-4 w-4" />\n      <span className="sr-only">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = "CarouselPrevious"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-right-12 top-1/2 -translate-y-1/2"\n          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className="h-4 w-4" />\n      <span className="sr-only">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = "CarouselNext"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n\n',checkbox:'import * as React from "react"\nimport * as CheckboxPrimitive from "@radix-ui/react-checkbox"\nimport { Check } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      "peer h-4 w-4 shrink-0 rounded-sm border border-gray-200 dark:border-gray-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=checked]:text-gray-50  dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=checked]:bg-gray-50 dark:data-[state=checked]:text-gray-900",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn("flex items-center justify-center text-current")}\n    >\n      <Check className="h-4 w-4" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n',collapsible:'import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n\n',dialog:'import * as React from "react"\nimport * as DialogPrimitive from "@radix-ui/react-dialog"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500 dark:ring-offset-gray-950 dark:focus:ring-gray-300 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-400">\n        <X className="h-4 w-4" />\n        <span className="sr-only">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-1.5 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = "DialogHeader"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = "DialogFooter"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n\n',drawer:'import * as React from "react"\nimport { Drawer as DrawerPrimitive } from "vaul"\n\nimport { cn } from "../../lib/utils"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = "Drawer"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn("fixed inset-0 z-50 bg-black/80", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-gray-100 dark:bg-gray-800" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = "DrawerContent"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = "DrawerHeader"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("mt-auto flex flex-col gap-2 p-4", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = "DrawerFooter"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n\n',dropdownMenu:'import * as React from "react"\nimport * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-800 dark:data-[state=open]:bg-gray-800",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = "DropdownMenuShortcut"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n\n',input:'import * as React from "react"\nimport { cn } from "../../lib/utils"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          "flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = "Input"\n\nexport { Input }\n',label:"import * as React from 'react';\nimport * as LabelPrimitive from '@radix-ui/react-label';\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nimport { cn } from '../../lib/utils';\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n",menuBar:'\nimport * as React from "react"\nimport * as MenubarPrimitive from "@radix-ui/react-menubar"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "flex h-10 items-center space-x-1 rounded-md border border-gray-200 bg-white p-1 dark:border-gray-800 dark:bg-gray-950",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          "z-50 min-w-[12rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        "ml-auto text-xs tracking-widest text-gray-500 dark:text-gray-400",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = "MenubarShortcut"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n\n',navigationMenu:'import * as React from "react"\nimport * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"\nimport { cva } from "class-variance-authority"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative z-10 flex max-w-max flex-1 items-center justify-center",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      "group flex flex-1 list-none items-center justify-center space-x-1",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-100 hover:text-gray-900 focus:bg-gray-100 focus:text-gray-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-gray-100/50 data-[state=open]:bg-gray-100/50 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[active]:bg-gray-800/50 dark:data-[state=open]:bg-gray-800/50"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), "group", className)}\n    {...props}\n  >\n    {children}{""}\n    <ChevronDown\n      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"\n      aria-hidden="true"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn("absolute left-0 top-full flex justify-center")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)] dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",\n      className\n    )}\n    {...props}\n  >\n    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-gray-200 shadow-md dark:bg-gray-800" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n\n',pagination:'import * as React from "react"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { ButtonProps, buttonVariants } from "./button"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (\n  <nav\n    role="navigation"\n    aria-label="pagination"\n    className={cn("mx-auto flex w-full justify-center", className)}\n    {...props}\n  />\n)\nPagination.displayName = "Pagination"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<"ul">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn("flex flex-row items-center gap-1", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = "PaginationContent"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<"li">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn("", className)} {...props} />\n))\nPaginationItem.displayName = "PaginationItem"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, "size"> &\n  React.ComponentProps<"a">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = "icon",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? "page" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? "outline" : "ghost",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = "PaginationLink"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to previous page"\n    size="default"\n    className={cn("gap-1 pl-2.5", className)}\n    {...props}\n  >\n    <ChevronLeft className="h-4 w-4" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = "PaginationPrevious"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to next page"\n    size="default"\n    className={cn("gap-1 pr-2.5", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className="h-4 w-4" />\n  </PaginationLink>\n)\nPaginationNext.displayName = "PaginationNext"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    aria-hidden\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = "PaginationEllipsis"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n\n',popover:'import * as React from "react"\nimport * as PopoverPrimitive from "@radix-ui/react-popover"\n\nimport { cn } from "../../lib/utils"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 w-72 rounded-md border border-gray-200 bg-white p-4 text-gray-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n\n',progress:'import * as React from "react"\nimport * as ProgressPrimitive from "@radix-ui/react-progress"\n\nimport { cn } from "../../lib/utils"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative h-4 w-full overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className="h-full w-full flex-1 bg-gray-900 transition-all dark:bg-gray-50"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n',radioGroup:'import * as React from "react"\nimport * as RadioGroupPrimitive from "@radix-ui/react-radio-group"\nimport { Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn("grid gap-2", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        "aspect-square h-4 w-4 rounded-full border border-gray-200 dark:border-gray-900 text-gray-900 ring-offset-white focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  dark:text-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">\n        <Circle className="h-2.5 w-2.5 fill-current text-current" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n\n',select:'import * as React from "react"\nimport * as SelectPrimitive from "@radix-ui/react-select"\nimport { Check, ChevronDown, ChevronUp } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-gray-300",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className="h-4 w-4 opacity-50" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className="h-4 w-4" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className="h-4 w-4" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = "popper", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        position === "popper" &&\n          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          "p-1",\n          position === "popper" &&\n            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <SelectPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n\n',separator:'import * as React from "react"\nimport * as SeparatorPrimitive from "@radix-ui/react-separator"\n\nimport { cn } from "../../lib/utils"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = "horizontal", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        "shrink-0 bg-gray-200 dark:bg-gray-800",\n        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n\n',skeleton:'import { cn } from "../../lib/utils"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn("animate-pulse rounded-md bg-gray-100 dark:bg-gray-800", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n',slider:'import * as React from "react"\nimport * as SliderPrimitive from "@radix-ui/react-slider"\n\nimport { cn } from "../../lib/utils"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex w-full touch-none select-none items-center",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800">\n      <SliderPrimitive.Range className="absolute h-full bg-gray-900 dark:bg-gray-50" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-gray-900 bg-white ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-gray-50 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n\n',switchComponent:'import * as React from "react"\nimport * as SwitchPrimitives from "@radix-ui/react-switch"\n\nimport { cn } from "../../lib/utils"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200 dark:focus-visible:ring-gray-300 dark:focus-visible:ring-offset-gray-950 dark:data-[state=checked]:bg-gray-50 dark:data-[state=unchecked]:bg-gray-800",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        "pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:bg-gray-950"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n\n',table:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className="relative w-full overflow-auto">\n    <table\n      ref={ref}\n      className={cn("w-full caption-bottom text-sm", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = "Table"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />\n))\nTableHeader.displayName = "TableHeader"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn("[&_tr:last-child]:border-0", className)}\n    {...props}\n  />\n))\nTableBody.displayName = "TableBody"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      "border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = "TableFooter"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      "border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = "TableRow"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      "h-12 px-4 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = "TableHead"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}\n    {...props}\n  />\n))\nTableCell.displayName = "TableCell"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn("mt-4 text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = "TableCaption"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n\n',tabs:'import * as React from "react"\nimport * as TabsPrimitive from "@radix-ui/react-tabs"\n\nimport { cn } from "../../lib/utils"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n\n',textarea:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          "flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = "Textarea"\n\nexport { Textarea }\n\n',toast:'import * as React from "react"\nimport * as ToastPrimitives from "@radix-ui/react-toast"\nimport { cva, type VariantProps } from "class-variance-authority"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border border-gray-200 p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:border-gray-800",\n  {\n    variants: {\n      variant: {\n        default: "border bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "destructive group border-red-500 bg-red-500 text-gray-50 dark:border-red-900 dark:bg-red-900 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border border-gray-200 bg-transparent px-3 text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-gray-100/40 group-[.destructive]:hover:border-red-500/30 group-[.destructive]:hover:bg-red-500 group-[.destructive]:hover:text-gray-50 group-[.destructive]:focus:ring-red-500 dark:border-gray-800 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:focus:ring-gray-300 dark:group-[.destructive]:border-gray-800/40 dark:group-[.destructive]:hover:border-red-900/30 dark:group-[.destructive]:hover:bg-red-900 dark:group-[.destructive]:hover:text-gray-50 dark:group-[.destructive]:focus:ring-red-900",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      "absolute right-2 top-2 rounded-md p-1 text-gray-950/50 opacity-0 transition-opacity hover:text-gray-950 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-50/50 dark:hover:text-gray-50",\n      className\n    )}\n    toast-close=""\n    {...props}\n  >\n    <X className="h-4 w-4" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn("text-sm font-semibold", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn("text-sm opacity-90", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n\n',toaster:'import {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from "./toast"\nimport { useToast } from "./use-toast"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className="grid gap-1">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n\n',toggleGroup:'import * as React from "react"\nimport * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"\nimport { type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\nimport { toggleVariants } from "./toggle"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: "default",\n  variant: "default",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn("flex items-center justify-center gap-1", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n\n',toggle:'import * as React from "react"\nimport * as TogglePrimitive from "@radix-ui/react-toggle"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst toggleVariants = cva(\n  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 hover:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-gray-100 data-[state=on]:text-gray-900 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-400 dark:focus-visible:ring-gray-300 dark:data-[state=on]:bg-gray-800 dark:data-[state=on]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-transparent",\n        outline:\n          "border border-gray-200 bg-transparent hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-3",\n        sm: "h-9 px-2.5",\n        lg: "h-11 px-5",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n\n',tooltip:'import * as React from "react"\nimport * as TooltipPrimitive from "@radix-ui/react-tooltip"\n\nimport { cn } from "../../lib/utils"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      "z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-950 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n\n',useToast:'import * as React from "react"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from "./toast"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: "ADD_TOAST",\n  UPDATE_TOAST: "UPDATE_TOAST",\n  DISMISS_TOAST: "DISMISS_TOAST",\n  REMOVE_TOAST: "REMOVE_TOAST",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType["ADD_TOAST"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType["UPDATE_TOAST"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType["DISMISS_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n  | {\n      type: ActionType["REMOVE_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: "REMOVE_TOAST",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case "ADD_TOAST":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case "UPDATE_TOAST":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case "DISMISS_TOAST": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I\'ll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case "REMOVE_TOAST":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, "id">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: "UPDATE_TOAST",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })\n\n  dispatch({\n    type: "ADD_TOAST",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),\n  }\n}\n\nexport { useToast, toast }\n'};!function(e){e.Input="input",e.Textarea="textarea",e.Slider="slider",e.Checkbox="checkbox",e.Switch="switch",e.Dropdown="dropdown",e.Combobox="combobox",e.Tags="tags"}(Jh||(Jh={})),function(e){e.Number="number",e.Boolean="boolean",e.String="string",e.Enum="enum",e.Array="array"}(eg||(eg={})),function(e){e.Conversation="conversation",e.Model="model",e.Custom="custom"}(tg||(tg={})),function(e){e.PROMPTS="PROMPTS",e.BOOKMARKS="BOOKMARKS",e.AGENTS="AGENTS",e.MEMORIES="MEMORIES",e.MULTI_CONVO="MULTI_CONVO",e.TEMPORARY_CHAT="TEMPORARY_CHAT",e.RUN_CODE="RUN_CODE",e.WEB_SEARCH="WEB_SEARCH",e.PEOPLE_PICKER="PEOPLE_PICKER",e.MARKETPLACE="MARKETPLACE",e.FILE_SEARCH="FILE_SEARCH",e.FILE_CITATIONS="FILE_CITATIONS"}(hg||(hg={})),function(e){e.SHARED_GLOBAL="SHARED_GLOBAL",e.USE="USE",e.CREATE="CREATE",e.UPDATE="UPDATE",e.READ="READ",e.READ_AUTHOR="READ_AUTHOR",e.SHARE="SHARE",e.OPT_OUT="OPT_OUT",e.VIEW_USERS="VIEW_USERS",e.VIEW_GROUPS="VIEW_GROUPS",e.VIEW_ROLES="VIEW_ROLES"}(gg||(gg={}));var vg,bg,_g,yg,jg,wg,Ng,Cg,kg,Sg,Eg,Tg,Ig,Rg,Pg,Ag,Mg,Lg,Og,Dg,Fg,zg,Ug,Vg,Bg,$g,Hg,Gg,Kg,Wg,qg,Qg,Yg=mo(((ng={})[gg.SHARED_GLOBAL]=go().default(!1),ng[gg.USE]=go().default(!0),ng[gg.CREATE]=go().default(!0),ng)),Xg=mo(((sg={})[gg.USE]=go().default(!0),sg)),Zg=mo(((ag={})[gg.USE]=go().default(!0),ag[gg.CREATE]=go().default(!0),ag[gg.UPDATE]=go().default(!0),ag[gg.READ]=go().default(!0),ag[gg.OPT_OUT]=go().default(!0),ag)),Jg=mo(((rg={})[gg.SHARED_GLOBAL]=go().default(!1),rg[gg.USE]=go().default(!0),rg[gg.CREATE]=go().default(!0),rg)),ex=mo(((og={})[gg.USE]=go().default(!0),og)),tx=mo(((ig={})[gg.USE]=go().default(!0),ig)),nx=mo(((lg={})[gg.USE]=go().default(!0),lg)),sx=mo(((cg={})[gg.USE]=go().default(!0),cg)),ax=mo(((dg={})[gg.VIEW_USERS]=go().default(!0),dg[gg.VIEW_GROUPS]=go().default(!0),dg[gg.VIEW_ROLES]=go().default(!0),dg)),rx=mo(((ug={})[gg.USE]=go().default(!1),ug)),ox=mo(((mg={})[gg.USE]=go().default(!0),mg)),ix=mo(((pg={})[gg.USE]=go().default(!0),pg)),lx=mo(((fg={})[hg.PROMPTS]=Yg,fg[hg.BOOKMARKS]=Xg,fg[hg.MEMORIES]=Zg,fg[hg.AGENTS]=Jg,fg[hg.MULTI_CONVO]=ex,fg[hg.TEMPORARY_CHAT]=tx,fg[hg.RUN_CODE]=nx,fg[hg.WEB_SEARCH]=sx,fg[hg.PEOPLE_PICKER]=ax,fg[hg.MARKETPLACE]=rx,fg[hg.FILE_SEARCH]=ox,fg[hg.FILE_CITATIONS]=ix,fg));!function(e){e.ADMIN="ADMIN",e.USER="USER"}(Qg||(Qg={}));var cx,dx,ux,mx,px,fx,hx=mo({name:po(),permissions:lx}),gx=mo(((vg={})[Qg.ADMIN]=hx.extend({name:bo(Qg.ADMIN),permissions:lx.extend((bg={},bg[hg.PROMPTS]=Yg.extend((_g={},_g[gg.SHARED_GLOBAL]=go().default(!0),_g[gg.USE]=go().default(!0),_g[gg.CREATE]=go().default(!0),_g)),bg[hg.BOOKMARKS]=Xg.extend((yg={},yg[gg.USE]=go().default(!0),yg)),bg[hg.MEMORIES]=Zg.extend((jg={},jg[gg.USE]=go().default(!0),jg[gg.CREATE]=go().default(!0),jg[gg.UPDATE]=go().default(!0),jg[gg.READ]=go().default(!0),jg[gg.OPT_OUT]=go().default(!0),jg)),bg[hg.AGENTS]=Jg.extend((wg={},wg[gg.SHARED_GLOBAL]=go().default(!0),wg[gg.USE]=go().default(!0),wg[gg.CREATE]=go().default(!0),wg)),bg[hg.MULTI_CONVO]=ex.extend((Ng={},Ng[gg.USE]=go().default(!0),Ng)),bg[hg.TEMPORARY_CHAT]=tx.extend((Cg={},Cg[gg.USE]=go().default(!0),Cg)),bg[hg.RUN_CODE]=nx.extend((kg={},kg[gg.USE]=go().default(!0),kg)),bg[hg.WEB_SEARCH]=sx.extend((Sg={},Sg[gg.USE]=go().default(!0),Sg)),bg[hg.PEOPLE_PICKER]=ax.extend((Eg={},Eg[gg.VIEW_USERS]=go().default(!0),Eg[gg.VIEW_GROUPS]=go().default(!0),Eg[gg.VIEW_ROLES]=go().default(!0),Eg)),bg[hg.MARKETPLACE]=mo((Tg={},Tg[gg.USE]=go().default(!1),Tg)),bg[hg.FILE_SEARCH]=ox.extend((Ig={},Ig[gg.USE]=go().default(!0),Ig)),bg[hg.FILE_CITATIONS]=ix.extend((Rg={},Rg[gg.USE]=go().default(!0),Rg)),bg))}),vg[Qg.USER]=hx.extend({name:bo(Qg.USER),permissions:lx}),vg)).parse(((Pg={})[Qg.ADMIN]={name:Qg.ADMIN,permissions:(Ag={},Ag[hg.PROMPTS]=(Mg={},Mg[gg.SHARED_GLOBAL]=!0,Mg[gg.USE]=!0,Mg[gg.CREATE]=!0,Mg),Ag[hg.BOOKMARKS]=(Lg={},Lg[gg.USE]=!0,Lg),Ag[hg.MEMORIES]=(Og={},Og[gg.USE]=!0,Og[gg.CREATE]=!0,Og[gg.UPDATE]=!0,Og[gg.READ]=!0,Og[gg.OPT_OUT]=!0,Og),Ag[hg.AGENTS]=(Dg={},Dg[gg.SHARED_GLOBAL]=!0,Dg[gg.USE]=!0,Dg[gg.CREATE]=!0,Dg),Ag[hg.MULTI_CONVO]=(Fg={},Fg[gg.USE]=!0,Fg),Ag[hg.TEMPORARY_CHAT]=(zg={},zg[gg.USE]=!0,zg),Ag[hg.RUN_CODE]=(Ug={},Ug[gg.USE]=!0,Ug),Ag[hg.WEB_SEARCH]=(Vg={},Vg[gg.USE]=!0,Vg),Ag[hg.PEOPLE_PICKER]=(Bg={},Bg[gg.VIEW_USERS]=!0,Bg[gg.VIEW_GROUPS]=!0,Bg[gg.VIEW_ROLES]=!0,Bg),Ag[hg.MARKETPLACE]=($g={},$g[gg.USE]=!0,$g),Ag[hg.FILE_SEARCH]=(Hg={},Hg[gg.USE]=!0,Hg),Ag[hg.FILE_CITATIONS]=(Gg={},Gg[gg.USE]=!0,Gg),Ag)},Pg[Qg.USER]={name:Qg.USER,permissions:(Kg={},Kg[hg.PROMPTS]={},Kg[hg.BOOKMARKS]={},Kg[hg.MEMORIES]={},Kg[hg.AGENTS]={},Kg[hg.MULTI_CONVO]={},Kg[hg.TEMPORARY_CHAT]={},Kg[hg.RUN_CODE]={},Kg[hg.WEB_SEARCH]={},Kg[hg.PEOPLE_PICKER]=(Wg={},Wg[gg.VIEW_USERS]=!1,Wg[gg.VIEW_GROUPS]=!1,Wg[gg.VIEW_ROLES]=!1,Wg),Kg[hg.MARKETPLACE]=(qg={},qg[gg.USE]=!1,qg),Kg[hg.FILE_SEARCH]={},Kg[hg.FILE_CITATIONS]={},Kg)},Pg));!function(e){e.PAST_HOUR="h",e.PAST_24_HOURS="d",e.PAST_WEEK="w",e.PAST_MONTH="m",e.PAST_YEAR="y"}(cx||(cx={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(dx||(dx={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(ux||(ux={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup"}(mx||(mx={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(px||(px={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner"}(fx||(fx={}));var xx,vx=mo({type:fo(dx),id:po().optional(),name:po().optional(),email:po().optional(),source:uo(["local","entra"]).optional(),avatar:po().optional(),description:po().optional(),idOnTheSource:po().optional(),accessRoleId:fo(fx).optional(),memberCount:vo().optional()}),bx=mo({accessRoleId:fo(fx),name:po(),description:po().optional(),resourceType:fo(mx).default(mx.AGENT),permBits:vo()}),_x=mo({id:po(),principalType:fo(dx),principalId:po().optional(),principalName:po().optional(),role:bx,grantedBy:po(),grantedAt:po(),inheritedFrom:po().optional(),source:uo(["local","entra"]).optional()});mo({resourceType:fo(mx),resourceId:po(),permissions:xo(_x)}),mo({updated:vx.array(),removed:vx.array(),public:go(),publicAccessRoleId:po().optional()}),mo({message:po(),results:mo({principals:vx.array(),public:go(),publicAccessRoleId:po().optional()})}),mo({resourceType:fo(mx),resourceId:fo(fx),principals:xo(vx),public:go(),publicAccessRoleId:fo(fx).optional()}),mo({permissionBits:vo()}),function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken"}(xx||(xx={}));var yx,jx=function(e){return["agentFiles",e]};function wx(e){co.defaults.headers.common.Authorization="Bearer "+e}function Nx(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}!function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}(yx||(yx={}));var Cx=!1,kx=[],Sx=function(e){return Nx((t=e,"".concat(Sp,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},Ex=function(e){wx(e),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},Tx=function(e,t){void 0===t&&(t=null),kx.forEach((function(n){e?n.reject(e):n.resolve(t)})),kx=[]};co.interceptors.response.use((function(e){return e}),(function(e){return mu(void 0,0,void 0,(function(){var t,n,s,a,r,o,i,l,c;return pu(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!Cx)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){kx.push({resolve:e,reject:t})}))];case 2:return a=d.sent(),t.headers.Authorization="Bearer "+a,[4,co(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:Cx=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,Sx(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return s=d.sent(),(a=null!==(c=null==s?void 0:s.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+a,Ex(a),Tx(null,a),[4,co(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href="/login",d.label=10;case 10:return[3,13];case 11:return r=d.sent(),Tx(r,null),[2,Promise.reject(r)];case 12:return Cx=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var Ix={get:function(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.get(e,du({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.get(e,du({},t))];case 1:return[2,n.sent()]}}))}))},post:Nx,postMultiPart:function(e,t,n){return mu(this,0,void 0,(function(){return pu(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,du(du({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,s.sent().data]}}))}))},postTTS:function(e,t,n){return mu(this,0,void 0,(function(){return pu(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,du(du({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,s.sent().data]}}))}))},put:function(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return mu(this,0,void 0,(function(){return pu(this,(function(t){switch(t.label){case 0:return[4,co.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.delete(e,du({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return mu(this,0,void 0,(function(){return pu(this,(function(n){switch(n.label){case 0:return[4,co.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:Sx,dispatchTokenUpdatedEvent:Ex},Rx=Object.freeze({__proto__:null,acceptTerms:function(){return Ix.post("".concat(Sp,"/api/user/terms/accept"))},addPromptToGroup:function(e,t){return Ix.post((n=e,"".concat(Sp,"/api/prompts/groups/").concat(n,"/prompts")),t);var n},addTagToConversation:function(e,t){return Ix.put((n=e,"".concat(uf(),"/convo/").concat(n)),t);var n},archiveConversation:function(e){return Ix.post(Qp(),{arg:e})},callTool:function(e){var t=e.toolId,n=e.toolParams;return Ix.post(Jp({path:"tools/".concat(t,"/call")}),n)},cancelMCPOAuth:function(e){return Ix.post((t=e,"".concat(Sp,"/api/mcp/oauth/cancel/").concat(t)),{});var t},clearAllConversations:function(){return Ix.delete("".concat(Wp,"/all"))},confirmTwoFactor:function(e){return Ix.post("".concat(Sp,"/api/auth/2fa/confirm"),e)},createAgent:function(e){var t=uu(e,[]);return Ix.post(Jp({}),t)},createAssistant:function(e){var t=e.version,n=uu(e,["version"]);return Ix.post(Zp({version:t}),n)},createConversationTag:function(e){return Ix.post(uf(),e)},createMemory:function(e){return Ix.post(mf(),e)},createPreset:function(e){return Ix.post(Yp(),e)},createPrompt:function(e){return Ix.post(of(),e)},createSharedLink:function(e){return Ix.post((t=e,"".concat($p,"/").concat(t)));var t},deleteAction:function(e){var t=e.assistant_id,n=e.action_id,s=e.model,a=e.version,r=e.endpoint;return mu(void 0,0,void 0,(function(){return pu(this,(function(e){return[2,Ix.delete(Zp({path:"actions/".concat(t,"/").concat(n,"/").concat(s),version:a,endpoint:r}))]}))}))},deleteAgent:function(e){var t=e.agent_id;return Ix.delete(Jp({path:t}))},deleteAgentAction:function(e){var t=e.agent_id,n=e.action_id;return mu(void 0,0,void 0,(function(){return pu(this,(function(e){return[2,Ix.delete(Jp({path:"actions/".concat(t,"/").concat(n)}))]}))}))},deleteAssistant:function(e){var t=e.assistant_id,n=e.model,s=e.endpoint,a=e.version;return Ix.delete(Zp({path:t,options:{model:n,endpoint:s},version:a}))},deleteConversation:function(e){return Ix.deleteWithOptions("".concat(Wp),{data:{arg:e}})},deleteConversationTag:function(e){return Ix.delete(uf(e))},deleteFiles:function(e){return mu(void 0,0,void 0,(function(){return pu(this,(function(t){return[2,Ix.deleteWithOptions(ef(),{data:e})]}))}))},deleteMemory:function(e){return Ix.delete(pf(e))},deletePreset:function(e){return Ix.post("".concat(Sp,"/api/presets/delete"),e)},deletePrompt:function(e){return Ix.delete((n=(t=e)._id,s=t.groupId,"".concat(Xp(),"/").concat(n,"?groupId=").concat(s)));var t,n,s},deletePromptGroup:function(e){return Ix.delete(cf(e))},deleteSharedLink:function(e){return Ix.delete(Hp(e))},deleteUser:function(){return Ix.delete("".concat(Sp,"/api/user/delete"))},disableTwoFactor:function(e){return Ix.post("".concat(Sp,"/api/auth/2fa/disable"),e)},duplicateAgent:function(e){var t=e.agent_id;return Ix.post(Jp({path:"".concat(t,"/duplicate")}))},duplicateConversation:function(e){return Ix.post("".concat(Wp,"/duplicate"),e)},editArtifact:function(e){return mu(void 0,0,void 0,(function(){var t=e.messageId,n=uu(e,["messageId"]);return pu(this,(function(e){return[2,Ix.post(Bp(t),n)]}))}))},enableTwoFactor:function(){return Ix.get("".concat(Sp,"/api/auth/2fa/enable"))},forkConversation:function(e){return Ix.post("".concat(Wp,"/fork"),e)},genTitle:function(e){return Ix.post("".concat(Wp,"/gen_title"),e)},getAIEndpoints:function(){return Ix.get("".concat(Sp,"/api/endpoints"))},getAccessRoles:function(e){return Ix.get((t=e,"".concat(Sp,"/api/permissions/").concat(t,"/roles")));var t},getActions:function(){return Ix.get(Jp({path:"actions"}))},getAgentById:function(e){var t=e.agent_id;return Ix.get(Jp({path:t}))},getAgentCategories:function(){return Ix.get(Jp({path:"categories"}))},getAgentFiles:function(e){return Ix.get((t=e,"".concat(Sp,"/api/files/agent/").concat(t)));var t},getAllPromptGroups:function(){return Ix.get("".concat(Xp(),"/all"))},getAssistantById:function(e){var t=e.endpoint,n=e.assistant_id,s=e.version;return Ix.get(Zp({path:n,endpoint:t,version:s}))},getAssistantDocs:function(e){var t=e.endpoint,n=e.version;return Yu(t)?Ix.get(Zp({path:"documents",version:n,options:{endpoint:t},endpoint:t})):Promise.resolve([])},getAvailableAgentTools:function(){return Ix.get(Jp({path:"tools"}))},getAvailablePlugins:function(){return Ix.get("".concat(Sp,"/api/plugins"))},getAvailableTools:function(e,t){var n="";return n=Yu(e)?Zp({path:"tools",endpoint:e,version:null!=t?t:Nf[e]}):Jp({path:"tools"}),Ix.get(n)},getBanner:function(){return Ix.get("".concat(Sp,"/api/banner"))},getCategories:function(){return Ix.get("".concat(Sp,"/api/categories"))},getCodeOutputDownload:function(e){return mu(void 0,0,void 0,(function(){return pu(this,(function(t){return[2,Ix.getResponse(e,{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getConversationById:function(e){return Ix.get((t=e,"".concat(Wp,"/").concat(t)));var t},getConversationTags:function(){return Ix.get(uf())},getConversations:function(e){return Ix.get(qp({cursor:e}))},getCustomConfigSpeech:function(){return Ix.get("".concat(nf(),"/config/get"))},getDomainServerBaseUrl:function(){return"".concat(Fp(),"/api")},getEffectivePermissions:function(e,t){return Ix.get((n=e,s=t,"".concat(Sp,"/api/permissions/").concat(n,"/").concat(s,"/effective")));var n,s},getExpandedAgentById:function(e){var t=e.agent_id;return Ix.get(Jp({path:"".concat(t,"/expanded")}))},getFileConfig:function(){return Ix.get("".concat(ef(),"/config"))},getFileDownload:function(e,t){return mu(void 0,0,void 0,(function(){return pu(this,(function(n){return[2,Ix.getResponse("".concat(ef(),"/download/").concat(e,"/").concat(t),{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getFiles:function(){return Ix.get(ef())},getGraphApiToken:function(e){return Ix.get((t=e.scopes,"".concat(Sp,"/api/auth/graph-token?scopes=").concat(encodeURIComponent(t))));var t},getLoginGoogle:function(){return Ix.get("".concat(Sp,"/api/auth/google"))},getMCPAuthValues:function(e){return Ix.get((t=e,"".concat(Sp,"/api/mcp/").concat(t,"/auth-values")));var t},getMCPConnectionStatus:function(){return Ix.get("".concat(Sp,"/api/mcp/connection/status"))},getMCPServerConnectionStatus:function(e){return Ix.get((t=e,"".concat(Sp,"/api/mcp/connection/status/").concat(t)));var t},getMarketplaceAgents:function(e){return Ix.get(Jp({options:e}))},getMemories:function(){return Ix.get(mf())},getMessagesByConvoId:function(e){return e===Sh.NEW_CONVO||e===Sh.PENDING_CONVO?Promise.resolve([]):Ix.get(Vp({conversationId:e}))},getModels:function(){return mu(void 0,0,void 0,(function(){return pu(this,(function(e){return[2,Ix.get("".concat(Sp,"/api/models"))]}))}))},getPresets:function(){return Ix.get(Yp())},getPrompt:function(e){return Ix.get(rf(e))},getPromptGroup:function(e){return Ix.get(af(e))},getPromptGroups:function(e){return Ix.get(function(e){var t="".concat(Xp(),"/groups"),n=Object.entries(e).reduce((function(e,t){var n=t[0],s=t[1];return null!=s&&""!==s&&(e[n]=s),e}),{});if(Object.keys(n).length>0){var s=new URLSearchParams(n).toString();t+="?".concat(s)}return t}(e))},getPrompts:function(e){return Ix.get(function(e){var t=Xp();if(Object.keys(e).length>0){var n=new URLSearchParams(e).toString();t+="?".concat(n)}return t}(e))},getRandomPrompts:function(e){return Ix.get((t=e.limit,n=e.skip,"".concat(Xp(),"/random?limit=").concat(t,"&skip=").concat(n)));var t,n},getResourcePermissions:function(e,t){return Ix.get((n=e,s=t,"".concat(Sp,"/api/permissions/").concat(n,"/").concat(s)));var n,s},getRole:function(e){return Ix.get(df(e))},getSearchEnabled:function(){return Ix.get("".concat(Sp,"/api/search/enable"))},getSharedLink:function(e){return Ix.get((t=e,"".concat($p,"/link/").concat(t)));var t},getSharedMessages:function(e){return Ix.get(Hp(e))},getStartupConfig:function(){return Ix.get("".concat(Sp,"/api/config"))},getToolCalls:function(e){return Ix.get(Jp({path:"tools/calls",options:e}))},getUser:function(){return Ix.get("".concat(Sp,"/api/user"))},getUserBalance:function(){return Ix.get("".concat(Sp,"/api/balance"))},getUserTerms:function(){return Ix.get("".concat(Sp,"/api/user/terms"))},getVerifyAgentToolAuth:function(e){return Ix.get(Jp({path:"tools/".concat(e.toolId,"/auth")}))},getVoices:function(){return Ix.get("".concat(sf(),"/voices"))},healthCheck:function(){return Ix.get("".concat(Sp,"/health"))},importConversationsFile:function(e){return Ix.postMultiPart("".concat(Wp,"/import"),e)},listAgents:function(e){return Ix.get(Jp({options:e}))},listAssistants:function(e,t){return Ix.get(Zp({version:t,options:e}))},listConversations:function(e){return Ix.get(qp(null!=e?e:{}))},listMessages:function(e){return Ix.get(Vp(null!=e?e:{}))},listSharedLinks:function(e){return mu(void 0,0,void 0,(function(){var t,n,s,a,r,o;return pu(this,(function(i){return t=e.pageSize,n=e.isPublic,s=e.sortBy,a=e.sortDirection,r=e.search,o=e.cursor,[2,Ix.get(Gp(t,n,s,a,r,o))]}))}))},login:function(e){return Ix.post("".concat(Sp,"/api/auth/login"),e)},logout:function(){return Ix.post("".concat(Sp,"/api/auth/logout"))},makePromptProduction:function(e){return Ix.patch("".concat(rf(e),"/tags/production"))},rebuildConversationTags:function(){return Ix.post(uf("rebuild"))},regenerateBackupCodes:function(){return Ix.post("".concat(Sp,"/api/auth/2fa/backup/regenerate"))},register:function(e){return Ix.post("".concat(Sp,"/api/auth/register"),e)},reinitializeMCPServer:function(e){return Ix.post((t=e,"".concat(Sp,"/api/mcp/").concat(t,"/reinitialize")));var t},requestPasswordReset:function(e){return Ix.post("".concat(Sp,"/api/auth/requestPasswordReset"),e)},resendVerificationEmail:function(e){return Ix.post("".concat(Sp,"/api/user/verify/resend"),e)},resetPassword:function(e){return Ix.post("".concat(Sp,"/api/auth/resetPassword"),e)},revertAgentVersion:function(e){var t=e.agent_id,n=e.version_index;return Ix.post("".concat(Jp({path:"".concat(t,"/revert")})),{version_index:n})},revokeAllUserKeys:function(){return Ix.delete("".concat(Kp,"?all=true"))},revokeUserKey:function(e){return Ix.delete((t=e,"".concat(Kp,"/").concat(t)));var t},searchPrincipals:function(e){return Ix.get((n=(t=e).q,s=t.limit,a=t.types,r="".concat(Sp,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==s&&(r+="&limit=".concat(s)),a&&a.length>0&&(r+="&types=".concat(a.join(","))),r));var t,n,s,a,r},speechToText:function(e){return Ix.postMultiPart("".concat(nf(),"/stt"),e)},textToSpeech:function(e){return Ix.postTTS("".concat(sf(),"/manual"),e)},updateAction:function(e){var t=e.assistant_id,n=e.version,s=uu(e,["assistant_id","version"]);return Ix.post(Zp({path:"actions/".concat(t),version:n}),s)},updateAgent:function(e){var t=e.agent_id,n=e.data;return Ix.patch(Jp({path:t}),n)},updateAgentAction:function(e){var t=e.agent_id,n=uu(e,["agent_id"]);return Ix.post(Jp({path:"actions/".concat(t)}),n)},updateAgentPermissions:function(e){return Ix.put((t=e.roleName,"".concat(df(t),"/agents")),e.updates);var t},updateAssistant:function(e){var t=e.assistant_id,n=e.data,s=e.version;return Ix.patch(Zp({path:t,version:s}),n)},updateConversation:function(e){return Ix.post(Qp(),{arg:e})},updateConversationTag:function(e,t){return Ix.put(uf(e),t)},updateFeedback:function(e,t,n){return Ix.put((s=e,a=t,"".concat(Sp,"/api/messages/").concat(s,"/").concat(a,"/feedback")),n);var s,a},updateMarketplacePermissions:function(e){return Ix.put((t=e.roleName,"".concat(df(t),"/marketplace")),e.updates);var t},updateMemory:function(e,t,n){return Ix.patch(pf(n||e),{key:e,value:t})},updateMemoryPermissions:function(e){return Ix.put((t=e.roleName,"".concat(df(t),"/memories")),e.updates);var t},updateMemoryPreferences:function(e){return Ix.patch("".concat(mf(),"/preferences"),e)},updateMessage:function(e){var t=e.conversationId,n=e.messageId,s=e.text;if(!t)throw new Error("conversationId is required");return Ix.put(Vp({conversationId:t,messageId:n}),{text:s})},updateMessageContent:function(e){var t=e.conversationId,n=e.messageId,s=e.index,a=e.text;if(!t)throw new Error("conversationId is required");return Ix.put(Vp({conversationId:t,messageId:n}),{text:a,index:s})},updatePeoplePickerPermissions:function(e){return Ix.put((t=e.roleName,"".concat(df(t),"/people-picker")),e.updates);var t},updatePreset:function(e){return Ix.post(Yp(),e)},updatePromptGroup:function(e){return Ix.patch(lf(e.id),e.payload)},updatePromptLabels:function(e){return Ix.patch((t=e.id,"".concat(rf(t),"/labels")),e.payload);var t},updatePromptPermissions:function(e){return Ix.put((t=e.roleName,"".concat(df(t),"/prompts")),e.updates);var t},updateResourcePermissions:function(e,t,n){return Ix.put((s=e,a=t,"".concat(Sp,"/api/permissions/").concat(s,"/").concat(a)),n);var s,a},updateSharedLink:function(e){return Ix.patch((t=e,"".concat($p,"/").concat(t)));var t},updateTokenCount:function(e){return Ix.post("".concat(Sp,"/api/tokenizer"),{arg:e})},updateUserKey:function(e){if(!e.value)throw new Error("value is required");return Ix.put(Kp,e)},updateUserPlugins:function(e){return Ix.post("".concat(Sp,"/api/user/plugins"),e)},uploadAgentAvatar:function(e){return Ix.postMultiPart("".concat(tf(),"/agents/").concat(e.agent_id,"/avatar"),e.formData)},uploadAssistantAvatar:function(e){return Ix.postMultiPart(Zp({isAvatar:!0,path:"".concat(e.assistant_id,"/avatar"),options:{model:e.model,endpoint:e.endpoint},version:e.version}),e.formData)},uploadAvatar:function(e){return Ix.postMultiPart("".concat(tf(),"/avatar"),e)},uploadFile:function(e,t){var n=t?{signal:t}:void 0;return Ix.postMultiPart(ef(),e,n)},uploadImage:function(e,t){var n=t?{signal:t}:void 0;return Ix.postMultiPart(tf(),e,n)},userKeyQuery:function(e){return Ix.get((t=e,"".concat(Kp,"?name=").concat(t)));var t},verifyEmail:function(e){return Ix.post("".concat(Sp,"/api/user/verify"),e)},verifyTwoFactor:function(e){return Ix.post("".concat(Sp,"/api/auth/2fa/verify"),e)},verifyTwoFactorTemp:function(e){return Ix.post("".concat(Sp,"/api/auth/2fa/verify-temp"),e)}});var Px={string:function(e){if(e.enum)return uo(e.enum);var t=po();return void 0!==e.minLength&&(t=t.min(e.minLength)),void 0!==e.maxLength&&(t=t.max(e.maxLength)),t},number:function(e){var t=vo();return void 0!==e.minimum&&(t=t.min(e.minimum)),void 0!==e.maximum&&(t=t.max(e.maximum)),t},integer:function(e){return Px.number(e).int()},boolean:function(){return go()},array:function(e){if(e.items){var t=Ax(e.items);return xo(t||wo())}return xo(wo())},object:function(e){var t={};return e.properties&&Object.entries(e.properties).forEach((function(n){var s=n[0],a=n[1],r=Ax(a);t[s]=r||wo(),e.required&&e.required.includes(s)?t[s]=t[s].describe(a.description||""):t[s]=t[s].optional().describe(a.description||"")})),mo(t)}};function Ax(e){if("object"!==e.type||0!==Object.keys(e.properties||{}).length)return(Px[e.type]||function(){return wo()})(e)}var Mx,Lx,Ox,Dx,Fx,zx,Ux=function(){function e(e,t,n,s){this.name=e,this.description=t,this.parameters=n,this.strict=null!=s&&s}return e.prototype.toObjectTool=function(){var e=du(du({},this.parameters),{additionalProperties:!this.strict&&void 0});return{type:hu.function,function:du({name:this.name,description:this.description,parameters:e},this.strict?{strict:this.strict}:{})}},e}(),Vx=function(e,t,n,s,a,r,o){this.domain=e,this.basePath=t,this.method=n,this.operation=s,this.isConsequential=a,this.contentType=r,this.parameterLocations=o},Bx=function(){function e(e){this.config=e,this.authHeaders={},this.path=e.basePath}return e.prototype.setParams=function(e){if(this.operationHash=function(e){return ve.createHash("sha1").update(e).digest("hex")}(JSON.stringify(e)),this.params=du({},e),this.config.parameterLocations)for(var t=0,n=Object.entries(e);t<n.length;t++){var s=n[t],a=s[0],r=s[1];if("path"===this.config.parameterLocations[a]){var o="{".concat(a,"}");this.path.includes(o)&&(this.path=this.path.replace(o,encodeURIComponent(String(r))),delete this.params[a])}}else for(var i=0,l=Object.entries(e);i<l.length;i++){var c=l[i];a=c[0],r=c[1],o="{".concat(a,"}"),this.path.includes(o)&&(this.path=this.path.replace(o,encodeURIComponent(String(r))),delete this.params[a])}return this},e.prototype.setAuth=function(e){return mu(this,0,void 0,(function(){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h,g,x,v;return pu(this,(function(b){if(!e.auth)return[2,this];if(t=e.auth,n=t.type,s=t.authorization_type,a=t.custom_auth_header,r=t.authorization_url,o=t.client_url,i=t.scope,l=t.token_exchange_method,c=e.api_key,d=e.oauth_client_id,u=e.oauth_client_secret,m=e.oauth_token_expires_at,p=e.oauth_access_token,f=void 0===p?"":p,h=null!=c&&c.length>0&&n===gp.ServiceHttp,g=!!(null!=d&&d&&null!=u&&u&&n===gp.OAuth&&null!=r&&r&&null!=o&&o&&null!=i&&i&&l),h&&s===xp.Basic)x=ye.from(c).toString("base64"),this.authHeaders.Authorization="Basic ".concat(x);else if(h&&s===xp.Bearer)this.authHeaders.Authorization="Bearer ".concat(c);else if(h&&s===xp.Custom&&null!=a&&a)this.authHeaders[a]=c;else if(g){if(v=new Date,!f)throw new Error("No access token found. Please log in first.");if(m&&v>=new Date(m))throw new Error("Access token is expired. Please re-login.");this.authToken=f,this.authHeaders.Authorization="Bearer ".concat(this.authToken)}return[2,this]}))}))},e.prototype.execute=function(){return mu(this,0,void 0,(function(){var e,t,n,s,a,r,o,i,l,c,d;return pu(this,(function(u){if(e=function(e,t){var n=e.replace(/\/$/,""),s=t.replace(/^\//,""),a="".concat(n,"/").concat(s);return new je(a).toString()}(this.config.domain,this.path),t=du(du({},this.authHeaders),this.config.contentType?{"Content-Type":this.config.contentType}:{}),n=this.config.method.toLowerCase(),s=co.create(),a={},r={},this.config.parameterLocations&&this.params)for(o=0,i=Object.keys(this.params);o<i.length;o++)l=i[o],c=this.config.parameterLocations[l]||("get"===n?"query":"body"),d=this.params[l],"query"===c?a[l]=d:"header"===c?t[l]=String(d):"body"===c&&(r[l]=d);else this.params&&(Object.assign(a,this.params),Object.assign(r,this.params));if("get"===n)return[2,s.get(e,{headers:t,params:a})];if("post"===n)return[2,s.post(e,r,{headers:t,params:a})];if("put"===n)return[2,s.put(e,r,{headers:t,params:a})];if("delete"===n)return[2,s.delete(e,{headers:t,data:r,params:a})];if("patch"===n)return[2,s.patch(e,r,{headers:t,params:a})];throw new Error("Unsupported HTTP method: ".concat(n))}))}))},e.prototype.getConfig=function(){return this.config},e}(),$x=function(){function e(e,t,n,s,a,r,o){this.config=new Vx(e,t,n,s,a,r,o)}return Object.defineProperty(e.prototype,"domain",{get:function(){return this.config.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.config.basePath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this.config.method},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"operation",{get:function(){return this.config.operation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConsequential",{get:function(){return this.config.isConsequential},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this.config.contentType},enumerable:!1,configurable:!0}),e.prototype.createExecutor=function(){return new Bx(this.config)},e.prototype.setParams=function(e){var t=this.createExecutor();return t.setParams(e),t},e.prototype.setAuth=function(e){return mu(this,0,void 0,(function(){return pu(this,(function(t){return[2,this.createExecutor().setAuth(e)]}))}))},e.prototype.execute=function(){return mu(this,0,void 0,(function(){return pu(this,(function(e){return[2,this.createExecutor().execute()]}))}))},e}();function Hx(e,t){if("$ref"in e&&t){for(var n=t,s=0,a=e.$ref.replace(/^#\/components\//,"").split("/");s<a.length;s++){var r=a[s];if("object"!=typeof n||null===n||!(r in n))throw new Error("Could not resolve reference: ".concat(e.$ref));n=n[r]}return Hx(n,t)}return e}function Gx(e){return e.replace(/[^a-zA-Z0-9_-]/g,"")}function Kx(e,t){var n,s,a,r,o,i,l,c;void 0===t&&(t=!1);for(var d=[],u={},m={},p=null!==(r=null===(a=null===(s=e.servers)||void 0===s?void 0:s[0])||void 0===a?void 0:a.url)&&void 0!==r?r:"",f=0,h=Object.entries(e.paths);f<h.length;f++)for(var g=h[f],x=g[0],v=g[1],b=0,_=Object.entries(v);b<_.length;b++){var y=_[b],j=y[0],w={},N=y[1],C="".concat(j,"_").concat(x),k=N.operationId||Gx(C),S=N.summary||N.description||"",E=null!==(o=N["x-strict"])&&void 0!==o&&o,T={type:"object",properties:{},required:[]};if(N.parameters)for(var I=0,R=null!==(i=N.parameters)&&void 0!==i?i:[];I<R.length;I++){var P=Hx(R[I],e.components),A=P.name;if(A&&P.schema){var M=Hx(P.schema,e.components);T.properties[A]=M,P.required&&T.required.push(A),w[A]="query"===P.in||"path"===P.in||"header"===P.in||"body"===P.in?P.in:"query"}}var L="";if(N.requestBody){var O=N.requestBody.content;L=Object.keys(null!=O?O:{})[0];var D=Hx(U=null===(l=null==O?void 0:O[L])||void 0===l?void 0:l.schema,e.components);if(T.properties=du(du({},T.properties),D.properties),D.required&&(n=T.required).push.apply(n,D.required),D.properties)for(var F in D.properties)w[F]="body";L=null!=L?L:"application/json"}var z=new Ux(k,S,T,E);d.push(z);var U,V=new $x(p,x,j,k,!(null===(c=N["x-openai-isConsequential"])||void 0===c||!c),L,w);u[k]=V,t&&Object.keys(T.properties).length>0&&(U=Ax(T))&&(m[k]=U)}return{functionSignatures:d,requestBuilders:u,zodSchemas:m}}function Wx(e){var t;try{var n=void 0;try{n=JSON.parse(e)}catch(N){n=be(e)}if(!n.servers||!Array.isArray(n.servers)||0===n.servers.length)return{status:!1,message:"Could not find a valid URL in `servers`"};if(!n.servers[0].url)return{status:!1,message:"Could not find a valid URL in `servers`"};var s=n.paths;if(!s||"object"!=typeof s||0===Object.keys(s).length)return{status:!1,message:"No paths found in the OpenAPI spec."};for(var a=(null===(t=n.components)||void 0===t?void 0:t.schemas)||{},r=[],o=0,i=Object.entries(s);o<i.length;o++)for(var l=i[o],c=l[0],d=l[1],u=0,m=Object.entries(d);u<m.length;u++){var p=m[u],f=p[0],h=p[1],g=h.responses;if("object"==typeof h&&g)for(var x=0,v=Object.entries(g);x<v.length;x++){var b=v[x],_=b[0],y=b[1].content;if(y&&y["application/json"]&&y["application/json"].schema){var j=y["application/json"].schema;if("$ref"in j&&"string"==typeof j.$ref){var w=j.$ref.split("/").pop();w&&!a[w]&&r.push("In context=('paths', '".concat(c,"', '").concat(f,"', '").concat(_,"', 'response', 'content', 'application/json', 'schema'), reference to unknown component ").concat(w,"; using empty schema"))}}}}return{status:!0,message:r.join("\n")||"OpenAPI spec is valid.",spec:n}}catch(C){return console.error(C),{status:!1,message:"Error parsing OpenAPI spec."}}}var qx={model:{key:"model",label:"com_ui_model",labelCode:!0,type:"string",component:"dropdown",optionType:"model",selectPlaceholder:"com_ui_select_model",searchPlaceholder:"com_ui_select_search_model",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:4},temperature:{key:"temperature",label:"com_endpoint_temperature",labelCode:!0,description:"com_endpoint_openai_temp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},topP:{key:"topP",label:"com_endpoint_top_p",labelCode:!0,description:"com_endpoint_anthropic_topp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},stop:{key:"stop",label:"com_endpoint_stop",labelCode:!0,description:"com_endpoint_openai_stop",descriptionCode:!0,placeholder:"com_endpoint_stop_placeholder",placeholderCode:!0,type:"array",default:[],component:"tags",optionType:"conversation",minTags:0,maxTags:4},imageDetail:{key:"imageDetail",label:"com_endpoint_plug_image_detail",labelCode:!0,description:"com_endpoint_openai_detail",descriptionCode:!0,type:"enum",default:Hu.auto,component:"slider",options:[Hu.low,Hu.auto,Hu.high],enumMappings:(Mx={},Mx[Hu.low]="com_ui_low",Mx[Hu.auto]="com_ui_auto",Mx[Hu.high]="com_ui_high",Mx),optionType:"conversation",columnSpan:2}},Qx=function(e,t){return du(du({},e),t)},Yx={modelLabel:{key:"modelLabel",label:"com_endpoint_custom_name",labelCode:!0,type:"string",default:"",component:"input",placeholder:"com_endpoint_openai_custom_name_placeholder",placeholderCode:!0,optionType:"conversation"},maxContextTokens:{key:"maxContextTokens",label:"com_endpoint_context_tokens",labelCode:!0,type:"number",component:"input",placeholder:"com_nav_theme_system",placeholderCode:!0,description:"com_endpoint_context_info",descriptionCode:!0,optionType:"model",columnSpan:2},resendFiles:{key:"resendFiles",label:"com_endpoint_plug_resend_files",labelCode:!0,description:"com_endpoint_openai_resend_files",descriptionCode:!0,type:"boolean",default:!0,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},promptPrefix:{key:"promptPrefix",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},fileTokenLimit:{key:"fileTokenLimit",label:"com_ui_file_token_limit",labelCode:!0,description:"com_ui_file_token_limit_desc",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,type:"number",component:"input",columnSpan:2}},Xx={chatGptLabel:du(du({},Yx.modelLabel),{key:"chatGptLabel"}),temperature:Qx(qx.temperature,{default:im.temperature.default,range:{min:im.temperature.min,max:im.temperature.max,step:im.temperature.step}}),top_p:Qx(qx.topP,{key:"top_p",default:im.top_p.default,range:{min:im.top_p.min,max:im.top_p.max,step:im.top_p.step}}),frequency_penalty:{key:"frequency_penalty",label:"com_endpoint_frequency_penalty",labelCode:!0,description:"com_endpoint_openai_freq",descriptionCode:!0,type:"number",default:im.frequency_penalty.default,range:{min:im.frequency_penalty.min,max:im.frequency_penalty.max,step:im.frequency_penalty.step},component:"slider",optionType:"model",columnSpan:4},presence_penalty:{key:"presence_penalty",label:"com_endpoint_presence_penalty",labelCode:!0,description:"com_endpoint_openai_pres",descriptionCode:!0,type:"number",default:im.presence_penalty.default,range:{min:im.presence_penalty.min,max:im.presence_penalty.max,step:im.presence_penalty.step},component:"slider",optionType:"model",columnSpan:4},max_tokens:{key:"max_tokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_openai_max_tokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},reasoning_effort:{key:"reasoning_effort",label:"com_endpoint_reasoning_effort",labelCode:!0,description:"com_endpoint_openai_reasoning_effort",descriptionCode:!0,type:"enum",default:Gu.none,component:"slider",options:[Gu.none,Gu.minimal,Gu.low,Gu.medium,Gu.high],enumMappings:(Lx={},Lx[Gu.none]="com_ui_none",Lx[Gu.minimal]="com_ui_minimal",Lx[Gu.low]="com_ui_low",Lx[Gu.medium]="com_ui_medium",Lx[Gu.high]="com_ui_high",Lx),optionType:"model",columnSpan:4},useResponsesApi:{key:"useResponsesApi",label:"com_endpoint_use_responses_api",labelCode:!0,description:"com_endpoint_openai_use_responses_api",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_openai_use_web_search",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},reasoning_summary:{key:"reasoning_summary",label:"com_endpoint_reasoning_summary",labelCode:!0,description:"com_endpoint_openai_reasoning_summary",descriptionCode:!0,type:"enum",default:Ku.none,component:"slider",options:[Ku.none,Ku.auto,Ku.concise,Ku.detailed],enumMappings:(Ox={},Ox[Ku.none]="com_ui_none",Ox[Ku.auto]="com_ui_auto",Ox[Ku.concise]="com_ui_concise",Ox[Ku.detailed]="com_ui_detailed",Ox),optionType:"model",columnSpan:4},verbosity:{key:"verbosity",label:"com_endpoint_verbosity",labelCode:!0,description:"com_endpoint_openai_verbosity",descriptionCode:!0,type:"enum",default:Wu.none,component:"slider",options:[Wu.none,Wu.low,Wu.medium,Wu.high],enumMappings:(Dx={},Dx[Wu.none]="com_ui_none",Dx[Wu.low]="com_ui_low",Dx[Wu.medium]="com_ui_medium",Dx[Wu.high]="com_ui_high",Dx),optionType:"model",columnSpan:4},disableStreaming:{key:"disableStreaming",label:"com_endpoint_disable_streaming_label",labelCode:!0,description:"com_endpoint_disable_streaming",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},Zx={maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,range:{min:dm.maxOutputTokens.min,max:dm.maxOutputTokens.max,step:dm.maxOutputTokens.step},optionType:"model",columnSpan:2},temperature:Qx(qx.temperature,{default:dm.temperature.default,range:{min:dm.temperature.min,max:dm.temperature.max,step:dm.temperature.step}}),topP:Qx(qx.topP,{default:dm.topP.default,range:{min:dm.topP.min,max:dm.topP.max,step:dm.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_anthropic_topk",descriptionCode:!0,type:"number",default:dm.topK.default,range:{min:dm.topK.min,max:dm.topK.max,step:dm.topK.step},component:"slider",optionType:"model",columnSpan:4},promptCache:{key:"promptCache",label:"com_endpoint_prompt_cache",labelCode:!0,description:"com_endpoint_anthropic_prompt_cache",descriptionCode:!0,type:"boolean",default:dm.promptCache.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_anthropic_thinking",descriptionCode:!0,type:"boolean",default:dm.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_anthropic_thinking_budget",descriptionCode:!0,type:"number",component:"input",default:dm.thinkingBudget.default,range:{min:dm.thinkingBudget.min,max:dm.thinkingBudget.max,step:dm.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_anthropic_use_web_search",descriptionCode:!0,type:"boolean",default:dm.web_search.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2}},Jx={system:{key:"system",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},region:{key:"region",type:"string",label:"com_ui_region",labelCode:!0,component:"combobox",optionType:"conversation",selectPlaceholder:"com_ui_select_region",searchPlaceholder:"com_ui_select_search_region",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:2},maxTokens:{key:"maxTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},temperature:Qx(qx.temperature,{default:1,range:{min:0,max:1,step:.01}}),topK:Qx(Zx.topK,{range:{min:0,max:500,step:1}}),topP:Qx(qx.topP,{default:.999,range:{min:0,max:1,step:.01}})},ev={temperature:Qx(qx.temperature,{default:.7,range:{min:0,max:1,step:.01}}),topP:Qx(qx.topP,{range:{min:0,max:1,step:.01}})},tv={temperature:Qx(qx.temperature,{default:.3,range:{min:0,max:1,step:.01}}),topP:Qx(qx.topP,{default:.75,range:{min:.01,max:.99,step:.01}})},nv={temperature:Qx(qx.temperature,{default:.5,range:{min:0,max:1,step:.01}}),topP:Qx(qx.topP,{default:.9,range:{min:0,max:1,step:.01}})},sv={temperature:Qx(qx.temperature,{default:lm.temperature.default,range:{min:lm.temperature.min,max:lm.temperature.max,step:lm.temperature.step}}),topP:Qx(qx.topP,{default:lm.topP.default,range:{min:lm.topP.min,max:lm.topP.max,step:lm.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_google_topk",descriptionCode:!0,type:"number",default:lm.topK.default,range:{min:lm.topK.min,max:lm.topK.max,step:lm.topK.step},component:"slider",optionType:"model",columnSpan:4},maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_google_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,default:lm.maxOutputTokens.default,range:{min:lm.maxOutputTokens.min,max:lm.maxOutputTokens.max,step:lm.maxOutputTokens.step},optionType:"model",columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_google_thinking",descriptionCode:!0,type:"boolean",default:lm.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_google_thinking_budget",descriptionCode:!0,placeholder:"com_ui_auto",placeholderCode:!0,type:"number",component:"input",range:{min:lm.thinkingBudget.min,max:lm.thinkingBudget.max,step:lm.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_endpoint_use_search_grounding",labelCode:!0,description:"com_endpoint_google_use_search_grounding",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},av=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,sv.maxOutputTokens,sv.temperature,sv.topP,sv.topK,Yx.resendFiles,sv.thinking,sv.thinkingBudget,sv.web_search,Yx.fileTokenLimit],rv=[qx.model,Yx.modelLabel,Yx.promptPrefix],ov=[Yx.maxContextTokens,sv.maxOutputTokens,sv.temperature,sv.topP,sv.topK,Yx.resendFiles,sv.thinking,sv.thinkingBudget,sv.web_search,Yx.fileTokenLimit],iv=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,Xx.max_tokens,Xx.temperature,Xx.top_p,Xx.frequency_penalty,Xx.presence_penalty,qx.stop,Yx.resendFiles,qx.imageDetail,Xx.web_search,Xx.reasoning_effort,Xx.useResponsesApi,Xx.reasoning_summary,Xx.verbosity,Xx.disableStreaming,Yx.fileTokenLimit],lv=[qx.model,Yx.modelLabel,Yx.promptPrefix],cv=[Yx.maxContextTokens,Xx.max_tokens,Xx.temperature,Xx.top_p,Xx.frequency_penalty,Xx.presence_penalty,qx.stop,Yx.resendFiles,qx.imageDetail,Xx.reasoning_effort,Xx.reasoning_summary,Xx.verbosity,Xx.useResponsesApi,Xx.web_search,Xx.disableStreaming,Yx.fileTokenLimit],dv=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,Zx.maxOutputTokens,Zx.temperature,Zx.topP,Zx.topK,Yx.resendFiles,Zx.promptCache,Zx.thinking,Zx.thinkingBudget,Zx.web_search,Yx.fileTokenLimit],uv=[qx.model,Yx.modelLabel,Yx.promptPrefix],mv=[Yx.maxContextTokens,Zx.maxOutputTokens,Zx.temperature,Zx.topP,Zx.topK,Yx.resendFiles,Zx.promptCache,Zx.thinking,Zx.thinkingBudget,Zx.web_search,Yx.fileTokenLimit],pv=[Yx.modelLabel,Jx.system,Yx.maxContextTokens,Jx.maxTokens,Jx.temperature,Jx.topP,Jx.topK,qx.stop,Yx.resendFiles,Jx.region,Zx.thinking,Zx.thinkingBudget,Yx.fileTokenLimit],fv=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,Jx.maxTokens,ev.temperature,ev.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],hv=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,Jx.maxTokens,tv.temperature,tv.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],gv=[Yx.modelLabel,Yx.promptPrefix,Yx.maxContextTokens,nv.temperature,nv.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],xv=[qx.model,Yx.modelLabel,Jx.system,qx.stop],vv=[Yx.maxContextTokens,Jx.maxTokens,Jx.temperature,Jx.topP,Jx.topK,Yx.resendFiles,Jx.region,Zx.thinking,Zx.thinkingBudget,Yx.fileTokenLimit],bv=[qx.model,Yx.modelLabel,Yx.promptPrefix],_v=[Yx.maxContextTokens,Jx.maxTokens,ev.temperature,ev.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],yv=[qx.model,Yx.modelLabel,Yx.promptPrefix],jv=[Yx.maxContextTokens,Jx.maxTokens,tv.temperature,tv.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],wv=[qx.model,Yx.modelLabel,Yx.promptPrefix],Nv=[Yx.maxContextTokens,nv.temperature,nv.topP,Yx.resendFiles,Jx.region,Yx.fileTokenLimit],Cv=((Fx={})[Uu.openAI]=iv,Fx[Uu.azureOpenAI]=iv,Fx[Uu.custom]=iv,Fx[Uu.anthropic]=dv,Fx["".concat(Uu.bedrock,"-").concat(Bu.Anthropic)]=pv,Fx["".concat(Uu.bedrock,"-").concat(Bu.MistralAI)]=fv,Fx["".concat(Uu.bedrock,"-").concat(Bu.Cohere)]=hv,Fx["".concat(Uu.bedrock,"-").concat(Bu.Meta)]=gv,Fx["".concat(Uu.bedrock,"-").concat(Bu.AI21)]=gv,Fx["".concat(Uu.bedrock,"-").concat(Bu.Amazon)]=gv,Fx["".concat(Uu.bedrock,"-").concat(Bu.DeepSeek)]=gv,Fx[Uu.google]=av,Fx),kv={col1:lv,col2:cv},Sv={col1:wv,col2:Nv},Ev=((zx={})[Uu.openAI]=kv,zx[Uu.azureOpenAI]=kv,zx[Uu.custom]=kv,zx[Uu.anthropic]={col1:uv,col2:mv},zx["".concat(Uu.bedrock,"-").concat(Bu.Anthropic)]={col1:xv,col2:vv},zx["".concat(Uu.bedrock,"-").concat(Bu.MistralAI)]={col1:bv,col2:_v},zx["".concat(Uu.bedrock,"-").concat(Bu.Cohere)]={col1:yv,col2:jv},zx["".concat(Uu.bedrock,"-").concat(Bu.Meta)]=Sv,zx["".concat(Uu.bedrock,"-").concat(Bu.AI21)]=Sv,zx["".concat(Uu.bedrock,"-").concat(Bu.Amazon)]=Sv,zx["".concat(Uu.bedrock,"-").concat(Bu.DeepSeek)]=Sv,zx[Uu.google]={col1:rv,col2:ov},zx),Tv=Object.entries(Ev).reduce((function(e,t){var n=t[0],s=t[1];return s&&(e[n]=s.col2),e}),{});const Iv=["text/x-"],Rv={paths:function(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19.6663 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V14.6666L19.6663 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M19.667 9.66663V14.6666H24.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M21.3337 18.8334H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M21.3337 22.1666H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M16.3337 15.5H15.5003H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#FF5588",title:"Document"},Pv={paths:function(){return s.jsx(s.Fragment,{children:s.jsx("path",{d:"M15.5 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V13.5V18M15.5 10.5H23.8333C24.7538 10.5 25.5 11.2462 25.5 12.1667V13.5V18M15.5 10.5V25.5M15.5 25.5H18H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V18M15.5 25.5H12.1667C11.2462 25.5 10.5 24.7538 10.5 23.8333V18M10.5 18H25.5",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},fill:"#10A37F",title:"Spreadsheet"},Av={file:{paths:function(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M18.833 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V15.5L18.833 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M18.833 9.66663V15.5H24.6663",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#0000FF",title:"File"},text:Rv,txt:Rv,csv:Pv,"application/pdf":Rv,pdf:Rv,"text/x-":{paths:Jc,fill:"#FF6E3C",title:"Code"},artifact:{paths:Jc,fill:"#2D305C",title:"Code"}},Mv=(e="")=>{if(Av[e])return Av[e];if(Qm.test(e))return Pv;const t=Iv.find((t=>e.includes(t)));if(t&&Av[t])return Av[t];const n=e.split("/")[0]||"text";return Av[n]?Av[n]:Av.file};function Lv(e,t=!1){if(!e)return"";const n=new Date(e);if(t)return n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"2-digit"});return`${n.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getFullYear()}`}function Ov(e,t){const n=e.getQueryData([xx.files]);if(!n)return void console.warn("No current files found in cache, skipped updating file query cache");n.findIndex((e=>e.file_id===t.file_id))>-1?console.warn("File already exists in cache, skipped updating file query cache"):e.setQueryData([xx.files],[{...t},...n])}function Dv(e,t=2){if(0===e)return 0;const n=t<0?0:t,s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(n))}const{checkType:Fv}=cp,zv=/\$\\ce\{/g,Uv=/\$\\pu\{/g,Vv=/\$\\\\ce\{[^}]*\}\$/g,Bv=/\$\\\\pu\{[^}]*\}\$/g,$v=new RegExp("(?<![\\\\$])\\$(?!\\$)(?=\\d+(?:,\\d{3})*(?:\\.\\d+)?(?:[KMBkmb])?(?:\\s|$|[^a-zA-Z\\d]))","g"),Hv=new RegExp("(?<!\\\\)\\$(?!\\$)((?:[^$\\n]|\\\\[$])+?)(?<!\\\\)(?<!`)\\$(?!\\$)","g");function Gv(e,t){let n=0,s=t.length-1;for(;n<=s;){const a=Math.floor((n+s)/2),[r,o]=t[a];if(e>=r&&e<=o)return!0;e<r?s=a-1:n=a+1}return!1}function Kv(e){if(!e.includes("$"))return e;let t=e;(e.includes("\\ce{")||e.includes("\\pu{"))&&(t=function(e){let t=e.replace(zv,"$\\\\ce{");return t=t.replace(Uv,"$\\\\pu{"),t=t.replace(Vv,(e=>`$${e}$`)),t=t.replace(Bv,(e=>`$${e}$`)),t}(e));const n=function(e){const t=[];let n=-1,s=-1;for(let a=0;a<e.length;a++){const r=e[a];"`"===r&&a+2<e.length&&"`"===e[a+1]&&"`"===e[a+2]?-1===s?(s=a,a+=2):(t.push([s,a+2]),s=-1,a+=2):"`"===r&&-1===s&&(-1===n?n=a:(t.push([n,a]),n=-1))}return t}(t),s=[];let a,r=0;for($v.lastIndex=0;null!==(a=$v.exec(t));)Gv(a.index,n)||(s.push(t.substring(r,a.index)),s.push("\\$"),r=a.index+1);s.push(t.substring(r)),t=s.join("");const o=[];for(r=0,Hv.lastIndex=0;null!==(a=Hv.exec(t));)Gv(a.index,n)||(o.push(t.substring(r,a.index)),o.push(`$$${a[1]}$$`),r=a.index+a[0].length);return o.push(t.substring(r)),o.join("")}const Wv=e=>t=>{t?"string"!=typeof t?t.value&&e(t.value+""):e(t):e("")},qv=e=>({label:uh[e]??e,value:e}),Qv=()=>({...am,model:localStorage.getItem(Eh.LAST_AGENT_MODEL)??"",provider:qv(localStorage.getItem(Eh.LAST_AGENT_PROVIDER)??"")}),Yv=({agent:e,fileMap:t})=>{var n,a,r,o,i,l,c,d,u,m,p,f;const h=(null==e?void 0:e.isPublic)??!1,g={...e??{},label:(null==e?void 0:e.name)??"",value:(null==e?void 0:e.id)??"",icon:h?s.jsx(we,{className:"icon-md text-green-400"}):null,context_files:(null==(a=null==(n=null==e?void 0:e.tool_resources)?void 0:n.ocr)?void 0:a.file_ids)?[]:void 0,knowledge_files:(null==(o=null==(r=null==e?void 0:e.tool_resources)?void 0:r.file_search)?void 0:o.file_ids)?[]:void 0,code_files:(null==(l=null==(i=null==e?void 0:e.tool_resources)?void 0:i.execute_code)?void 0:l.file_ids)?[]:void 0};if(!t)return g;const x=({file_id:e,tool_resource:n,list:s})=>{const a=t[e],r=n===gu.file_search?Om.vectordb:(null==a?void 0:a.source)??Om.local;a?null==s||s.push([e,{file_id:a.file_id,type:a.type,filepath:a.filepath,filename:a.filename,width:a.width,height:a.height,size:a.bytes,preview:a.filepath,metadata:a.metadata,progress:1,source:r}]):null==s||s.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:Uu.agents,source:r}])};return g.context_files&&(null==(d=null==(c=null==e?void 0:e.tool_resources)?void 0:c.ocr)?void 0:d.file_ids)&&e.tool_resources.ocr.file_ids.forEach((e=>x({file_id:e,list:g.context_files,tool_resource:gu.ocr}))),g.knowledge_files&&(null==(m=null==(u=null==e?void 0:e.tool_resources)?void 0:u.file_search)?void 0:m.file_ids)&&e.tool_resources.file_search.file_ids.forEach((e=>x({file_id:e,list:g.knowledge_files,tool_resource:gu.file_search}))),g.code_files&&(null==(f=null==(p=null==e?void 0:e.tool_resources)?void 0:p.execute_code)?void 0:f.file_ids)&&e.tool_resources.execute_code.file_ids.forEach((e=>x({file_id:e,list:g.code_files,tool_resource:gu.execute_code}))),g},Xv=(e,t={})=>{const{size:n="md",className:a="",showBorder:r=!0}=t,o=(e=>(null==e?void 0:e.avatar)?"string"==typeof e.avatar?e.avatar:e.avatar&&"object"==typeof e.avatar&&"filepath"in e.avatar?e.avatar.filepath:null:null)(e),i={sm:"h-12 w-12 sm:h-14 sm:w-14",md:"h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24",lg:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28",xl:"h-24 w-24"},l=r?"border-1 border-border-medium":"";return o?s.jsx("div",{className:`flex items-center justify-center ${i[n]} ${a}`,children:s.jsx("img",{src:o,alt:`${(null==e?void 0:e.name)||"Agent"} avatar`,className:`${i[n]} rounded-full object-cover shadow-lg ${l}`,loading:"lazy"})}):s.jsxs("div",{className:`relative flex items-center justify-center ${i[n]} ${a}`,children:[s.jsx("div",{className:"absolute inset-0 rounded-full border border-border-medium bg-surface-secondary"}),s.jsx("div",{className:`relative flex items-center justify-center rounded-full ${{sm:"h-10 w-10 sm:h-12 sm:w-12",md:"h-12 w-12 sm:h-16 sm:w-16 md:h-20 md:w-20",lg:"h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24",xl:"h-20 w-20"}[n]}`,children:s.jsx(Ne,{className:`text-text-primary ${{sm:"h-6 w-6 sm:h-7 sm:w-7",md:"h-6 w-6 sm:h-8 sm:w-8 md:h-10 md:w-10",lg:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12",xl:"h-10 w-10"}[n]}`,strokeWidth:1.5})})]})},Zv=ko((e=>{localStorage.removeItem(`${Eh.TEXT_DRAFT}${e??""}`)}),2500),Jv=({id:e,value:t})=>{t&&t.length>1?localStorage.setItem(`${Eh.TEXT_DRAFT}${e}`,(e=>{try{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))}catch{return""}})(t)):localStorage.removeItem(`${Eh.TEXT_DRAFT}${e}`)},eb=e=>(e=>{try{const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return(new TextDecoder).decode(n)}catch{return""}})((localStorage.getItem(`${Eh.TEXT_DRAFT}${e??""}`)??"")||""),tb={today:"com_ui_date_today",yesterday:"com_ui_date_yesterday",previous7Days:"com_ui_date_previous_7_days",previous30Days:"com_ui_date_previous_30_days",january:"com_ui_date_january",february:"com_ui_date_february",march:"com_ui_date_march",april:"com_ui_date_april",may:"com_ui_date_may",june:"com_ui_date_june",july:"com_ui_date_july",august:"com_ui_date_august",september:"com_ui_date_september",october:"com_ui_date_october",november:"com_ui_date_november",december:"com_ui_date_december"},nb=new Map([["december",11],["november",10],["october",9],["september",8],["august",7],["july",6],["june",5],["may",4],["april",3],["march",2],["february",1],["january",0]]),sb=Object.fromEntries(Object.entries(tb).map((([e,t])=>[t,e]))),ab=new Set([tb.today,tb.yesterday,tb.previous7Days,tb.previous30Days]),rb=e=>{if(!Array.isArray(e))return[];const t=new Set,n=new Map,s=new Date(Date.now());e.forEach((e=>{if(!e||t.has(e.conversationId))return;let a;t.add(e.conversationId),a=e.updatedAt?Io(e.updatedAt):s;const r=(e=>{const t=new Date(Date.now());if(Ro(e))return tb.today;if(Po(e,{start:Ao(Mo(t,1)),end:t}))return tb.yesterday;if(Po(e,{start:Mo(t,7),end:t}))return tb.previous7Days;if(Po(e,{start:Mo(t,30),end:t}))return tb.previous30Days;if(Po(e,{start:Lo(t),end:t})){const t=Oo(e,"MMMM").toLowerCase();return tb[t]}return" "+Do(e).toString()})(a);n.has(r)||n.set(r,[]),n.get(r).push(e)}));const a=new Map;ab.forEach((e=>{n.has(e)&&a.set(e,n.get(e))}));return Array.from(n.keys()).filter((e=>!ab.has(e))).sort(((e,t)=>{const[n,s]=[parseInt(e.trim()),parseInt(t.trim())];if(n!==s)return s-n;const[a,r]=[sb[e],sb[t]];return(nb.get(r)??-1)-(nb.get(a)??-1)})).forEach((e=>{a.set(e,n.get(e))})),a.forEach((e=>{e.sort(((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))})),Array.from(a,(([e,t])=>[e,t]))};function ob(e,t){if(e)for(const n of e.pages){const e=n.conversations.find((e=>e.conversationId===t));if(e)return e}}function ib(e,t){const n=e.getQueryCache().findAll([xx.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,(e=>e?e.pages.some((e=>e.conversations.some((e=>e.conversationId===t.conversationId))))?e:{...e,pages:[{...e.pages[0],conversations:[t,...e.pages[0].conversations]},...e.pages.slice(1)]}:e))}function lb(e,t,n){const s=e.getQueryCache().findAll([xx.allConversations],{exact:!1});for(const a of s)e.setQueryData(a.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===t?n(e):e))})))}:e))}function cb(e,t){const n=e.getQueryCache().findAll([xx.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==t))}))).filter((e=>e.conversations.length>0))}:e))}const db=(e,t)=>{const{endpoint:n,title:s,model:a,tools:r,promptPrefix:o,chatGptLabel:i,modelLabel:l}=e,c=a??"";let d="",u="";return l&&(u=l),u&&null!=s&&s&&u.toLowerCase().includes(s.toLowerCase())?(d=u+": ",u=""):null!=s&&s&&"New Chat"!==s.trim()&&(d=s+": "),!0===t?`${c}${u?` | ${u}`:""}${null!=o&&o?` | ${o}`:""}${r?` | ${r.map((e=>"string"==typeof e?e:e.pluginKey)).join(", ")}`:""}`:`${d}${c}${u?` (${u})`:""}`.trim()},ub=(e,t)=>{const n={...e};return n.tools&&n.tools.length>0&&(n.tools=n.tools.filter((e=>{let n;return"string"==typeof e?n=e:({pluginKey:n}=e),!!t[n]})).map((e=>"string"==typeof e?e:e.pluginKey))),n},mb=e=>Array.from(e.matchAll(/{{([^{}]+?)}}/gi)).map((e=>e[1].trim().toLowerCase())).some((e=>!Oh[e])),pb=e=>`{{${e}}}`;function fb(e,t){if(e.focus(),window.getSelection()&&document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,t);else{console.warn("insertTextAtCursor: document.execCommand is not supported");const n=e.selectionStart,s=e.selectionEnd,a=e.value.substring(0,n),r=e.value.substring(s);e.value=a+t+r,e.selectionStart=e.selectionEnd=n+t.length;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}}const hb=e=>{e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)};function gb(e,t){e.value.endsWith(t)&&(e.value=e.value.slice(0,-1),e.setSelectionRange(e.value.length,e.value.length),e.dispatchEvent(new Event("input",{bubbles:!0}))),e.focus()}const xb=e=>!!e&&e.scrollHeight>e.clientHeight,vb=(e,t)=>{if(!e)return"";if(e.text)return e.text;if(e.content&&e.content.length>0)for(let n=e.content.length-1;n>=0;n--){const s=e.content[n];if(s&&s.type!==Ph.TEXT)continue;const a=("string"==typeof(null==s?void 0:s.text)?s.text:null==s?void 0:s.text.value)??"";if(a.length>0)return!0===t?`${a}-${n}`:a}return""},bb=e=>e?e.text?e.text:e.content&&e.content.length>0?e.content.filter((e=>e.type===Ph.TEXT)).map((e=>("string"==typeof e.text?e.text:e.text.value)||"")).filter((e=>e.length>0)).join("\n"):"":"",_b=(e,t)=>{if(!e)return"";const n=vb(e,!0);return`${e.messageId??""}${Sh.COMMON_DIVIDER}${s=n,"string"!=typeof s||0===s.length?"0":`${s.length}${s.slice(-10)}`}${Sh.COMMON_DIVIDER}${e.conversationId??t}`;var s},yb=e=>{const t=document.getElementById("messages-end");t&&(t.scrollIntoView({behavior:"instant"}),e&&e())},jb=["python","javascript","java","go","bash","c","cpp","csharp","css","diff","graphql","json","kotlin","less","lua","makefile","markdown","objectivec","perl","php","php-template","plaintext","python-repl","r","ruby","rust","scss","shell","sql","swift","typescript","vbnet","wasm","xml","yaml"],wb={c:"c",cpp:"cpp","c++":"cpp",cplusplus:"cpp",d:"d",f90:"f90",fortran:"f90",fortran90:"f90",go:"go",golang:"go",java:"java",js:"js",javascript:"js",node:"js",nodejs:"js",php:"php",py:"py",python:"py",python3:"py",rs:"rs",rust:"rs",ts:"ts",typescript:"ts"};const Nb=e=>{const t={};if(!e)return t;for(const n of Object.keys(e))t[n]=!!e[n];return t},Cb=(e,t)=>{var n,s;const a=new Set(dh),r=[];for(const o in t)(e[o]||(null==(n=t[o])?void 0:n.type)&&a.has(null==(s=t[o])?void 0:s.type))&&r.push(o);return r};function kb(e,t,n){if(!e||null==t)return;const s=e[t];return s?s[n]:void 0}function Sb(e){const t=Nb(e);return Cb(t,e).sort(((t,n)=>{var s,a;return((null==(s=null==e?void 0:e[t])?void 0:s.order)??0)-((null==(a=null==e?void 0:e[n])?void 0:a.order)??0)}))}const Eb=Eh.LAST_CONVO_SETUP+"_0";function Tb(e){const{conversation:t,newEndpoint:n,endpointsConfig:s,modularChat:a=!1}=e,r=null==t?void 0:t.endpoint,o={...t,endpoint:n,conversationId:"new"},i=Yu(n)&&Yu(r)&&r===n,l=(null==t?void 0:t.conversationId)??"",c=!(!l||"new"===l),d=kb(s,r,"type")??r,u=kb(s,n,"type")??n,m=gh.has(r??""),p=gh.has(d??""),f=m||p||i,h=gh.has(n??""),g=gh.has(u??"");return{template:o,shouldSwitch:r===n||a||i,isExistingConversation:c,isCurrentModular:f,newEndpointType:u,isNewModular:h||g||i}}function Ib(e){const{modelSpecs:t,interface:n}=e??{},{list:s,prioritize:a}=t??{};if(!s)return;const r=null==s?void 0:s.find((e=>e.default));if(!0===a||!(null==n?void 0:n.modelSelect)){const e=localStorage.getItem(Eh.LAST_SPEC),t=null==s?void 0:s.find((t=>t.name===e));return r||t||(null==s?void 0:s[0])}if(r)return r;const o=JSON.parse(localStorage.getItem(Eh.LAST_CONVO_SETUP+"_0")??"{}");return o.spec?null==s?void 0:s.find((e=>e.name===o.spec)):void 0}function Rb(e){if(e)return{...e.preset,spec:e.name,iconURL:Pb(e)}}function Pb(e){return e.iconURL??e.preset.iconURL??e.preset.endpoint??""}function Ab({endpointsConfig:e,iconURL:t,endpoint:n}){return((null==e?void 0:e[t??""])?t??n:n)??""}function Mb({endpoint:e,endpointType:t,endpointsConfig:n,endpointIconURL:s}){const a=t??kb(n,e,"type")??"",r=s??kb(n,e,"iconURL")??"";return r&&null!=Uu[r]?r:a?"unknown":e??"unknown"}const Lb=({endpoint:e,assistant_id:t,agent_id:n,agentsMap:s,assistantMap:a})=>{var r;const o=Xu(e),i=Yu(e);if(o){return{entity:null==s?void 0:s[n??""],isAgent:o,isAssistant:i}}if(i){return{entity:null==(r=null==a?void 0:a[e??""])?void 0:r[t??""],isAgent:o,isAssistant:i}}return{entity:null,isAgent:o,isAssistant:i}},Ob={[mx.AGENT]:{resourceType:mx.AGENT,defaultViewerRoleId:fx.AGENT_VIEWER,defaultEditorRoleId:fx.AGENT_EDITOR,defaultOwnerRoleId:fx.AGENT_OWNER,getResourceUrl:e=>`${window.location.origin}/c/new?agent_id=${e}`,getResourceName:e=>e&&""!==e?`"${e}"`:"agent",getShareMessage:e=>e&&""!==e?`"${e}"`:"agent",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"agent"),getCopyUrlMessage:()=>"Agent URL copied"},[mx.PROMPTGROUP]:{resourceType:mx.PROMPTGROUP,defaultViewerRoleId:fx.PROMPTGROUP_VIEWER,defaultEditorRoleId:fx.PROMPTGROUP_EDITOR,defaultOwnerRoleId:fx.PROMPTGROUP_OWNER,getResourceName:e=>e&&""!==e?`"${e}"`:"prompt",getShareMessage:e=>e&&""!==e?`"${e}"`:"prompt",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"prompt"),getCopyUrlMessage:()=>"Prompt URL copied"}},Db={agent_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},agent_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},agent_manager:{name:"com_ui_role_manager",description:"com_ui_role_manager_desc"},agent_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"},promptGroup_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},promptGroup_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},promptGroup_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"}},Fb=e=>Db[e]||{name:"com_ui_unknown",description:"com_ui_unknown"};function zb(){const e={lastSelectedModel:localStorage.getItem(Eh.LAST_MODEL)??"",lastSelectedTools:localStorage.getItem(Eh.LAST_TOOLS)??"",lastConversationSetup:localStorage.getItem(Eh.LAST_CONVO_SETUP+"_0")??""};return{lastSelectedModel:e.lastSelectedModel?JSON.parse(e.lastSelectedModel):{},lastSelectedTools:e.lastSelectedTools?JSON.parse(e.lastSelectedTools):[],lastConversationSetup:e.lastConversationSetup?JSON.parse(e.lastConversationSetup):{}}}function Ub(){Object.keys(localStorage).forEach((e=>{(e.startsWith(Eh.LAST_MCP_)||e.startsWith(Eh.LAST_CODE_TOGGLE_)||e.startsWith(Eh.TEXT_DRAFT)||e.startsWith(Eh.ASST_ID_PREFIX)||e.startsWith(Eh.AGENT_ID_PREFIX)||e.startsWith(Eh.LAST_CONVO_SETUP))&&localStorage.removeItem(e)}))}function Vb(e,t){for(let n=0;n<e.pages.length;n++){const s=t(e.pages[n]);if(-1!==s)return{pageIndex:n,index:s}}return{pageIndex:-1,index:-1}}const Bb=(e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Vb(e,s);return-1!==r&&-1!==o&&(a.pages[r][t].splice(o,1),a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()})),a};const $b=(e,t)=>((e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Vb(e,s);return-1!==r&&-1!==o?Bb(e,t,n,s):(a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()}),a)})(e,xh.PROMPT_GROUPS,t,(e=>e.promptGroups.findIndex((e=>e._id===t._id)))),Hb=(e,t)=>((e,t,n)=>{const s=JSON.parse(JSON.stringify(e)),{pageIndex:a,index:r}=Vb(s,n);return-1!==a&&-1!==r&&s.pages[a][t].splice(r,1),s})(e,xh.PROMPT_GROUPS,(e=>e.promptGroups.findIndex((e=>e._id===t)))),Gb=(e,t,n)=>((e,t,n,s,a)=>{const r=JSON.parse(JSON.stringify(e)),{pageIndex:o,index:i}=Vb(r,(e=>e[n].findIndex((e=>e[s]===t[s]))));if(-1!==o&&-1!==i){const e={...r.pages[o][n].splice(i,1)[0],...t,updatedAt:(new Date).toISOString()};a&&a(e),r.pages[0][n].unshift(e)}return r})(e,t,xh.PROMPT_GROUPS,"_id",n),Kb=(e,t)=>((e,t,n)=>{const{pageIndex:s,index:a}=Vb(e,(e=>e[t].findIndex(n)));if(-1!==s&&-1!==a)return e.pages[s][t][a]})(e,xh.PROMPT_GROUPS,t),Wb=(e,t)=>{!function({queryClient:e,queryKey:t,searchProperty:n,updateData:s,searchValue:a}){e.setQueryData(t,(e=>e?e.map((e=>e[n]===a?{...e,...s}:e)):e))}({queryClient:e,queryKey:[xx.allPromptGroups],searchProperty:"_id",updateData:t,searchValue:t._id})},qb=(e,t)=>{!function(e,t,n,s){e.setQueryData(t,(e=>e?e.filter((e=>e[n]!==s)):e))}(e,[xx.allPromptGroups],"_id",t)},Qb=po().email(),Yb=(e,t)=>{var n;if(!e||""===e.trim())return!0;const s=Qb.safeParse(e);return s.success||t||(null==(n=s.error.errors[0])?void 0:n.message)||"Please enter a valid email address"},Xb="_TIMESTAMP",Zb=1728e5,Jb=[Eh.LAST_MCP_,Eh.LAST_CODE_TOGGLE_,Eh.LAST_WEB_SEARCH_TOGGLE_,Eh.LAST_FILE_SEARCH_TOGGLE_,Eh.LAST_ARTIFACTS_TOGGLE_,Eh.PIN_MCP_];function e_(e){localStorage.setItem(`${e}${Xb}`,Date.now().toString())}function t_(e){const t=`${e}${Xb}`,n=localStorage.getItem(t);if(!n)return localStorage.getItem(e);return Date.now()-parseInt(n,10)>Zb?(localStorage.removeItem(e),localStorage.removeItem(t),null):localStorage.getItem(e)}function n_(...e){return a(H(e))}const s_={log:(...e)=>{},dir:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},error:(...e)=>{},debug:(...e)=>{}};function a_({originalWidth:e,originalHeight:t,containerRef:n}){var s;const a=(null==(s=n.current)?void 0:s.offsetWidth)??0;if(0===a||null==e||null==t)return{width:"auto",height:"auto"};const r=e/t,o=Math.min(a,e);return{width:`${o}px`,height:`${o/r}px`}}const r_=e=>{const t="com_auth_error_login";if(!e)return t;switch(!0){case e.includes("429"):return"com_auth_error_login_rl";case e.includes("403"):return"com_auth_error_login_ban";case e.includes("500"):return"com_auth_error_login_server";case e.includes("422"):return"com_auth_error_login_unverified";default:return t}},o_=({preset:e})=>{const{endpoint:t,endpointType:n}=e??{};if(null==t||""===t)return console.error(`Unknown endpoint ${t}`,e),{endpoint:null,presetId:(null==e?void 0:e.presetId)??null,title:(null==e?void 0:e.title)??"New Preset"};const{presetOverride:s={},...a}=e??{},r={...a,...s};r.chatGptLabel&&r.modelLabel?delete r.chatGptLabel:r.chatGptLabel&&!r.modelLabel?(r.modelLabel=r.chatGptLabel,delete r.chatGptLabel):"chatGptLabel"in r&&delete r.chatGptLabel;const o=Hh({endpoint:t,endpointType:n,conversation:r});return{presetId:(null==e?void 0:e.presetId)??null,...o,endpoint:t,endpointType:n,title:(null==e?void 0:e.title)??"New Preset"}},i_=({models:e,conversation:t,endpoint:n=null,lastConversationSetup:s})=>{var a;const{lastSelectedModel:r,lastSelectedTools:o}=zb(),i=(null==s?void 0:s.endpointType)??t.endpointType;if(!n)return{...t,endpointType:i,endpoint:n};const l=e,c=(null==s?void 0:s.model)??(null==r?void 0:r[n])??"",d=n===Uu.gptPlugins?(null==(a=null==s?void 0:s.agentOptions)?void 0:a.model)??(null==r?void 0:r.secondaryModel)??null:null;let u,m;u=l.includes(c)?[c,...l]:[...l],m=null!=d&&""!==d&&l.includes(d)?[d,...l]:[...l];const p=Hh({endpoint:n,endpointType:i,conversation:s,possibleValues:{models:u,secondaryModels:m}}),f={...t,...p,endpointType:i,endpoint:n},h=(null==p?void 0:p.assistant_id)??(null==t?void 0:t.assistant_id)??"",g=(null==s?void 0:s.assistant_id)??"";Yu(n)&&!g&&h&&(f.assistant_id=h);const x=(null==p?void 0:p.agent_id)??"",v=(null==s?void 0:s.agent_id)??"";return Xu(n)&&!v&&x&&(f.agent_id=x),f.tools=(null==s?void 0:s.tools)??o??f.tools,f},l_=({convoSetup:e,endpointsConfig:t})=>((e,t)=>{let{endpoint:n=""}=e||{};return n=n??"",n&&(null==t?void 0:t[n])?n:(n&&console.warn(`Illegal target endpoint ${n}`,t),null)})(e,t)||(e=>{try{const{lastConversationSetup:t}=zb(),{endpoint:n}=t??{endpoint:null},s=Object.values(e??{}).every((e=>!e));return s&&n||s&&n||n&&null!=(null==e?void 0:e[n])?n:null}catch(t){return console.error(t),null}})(t)||(e=>Sb(e).find((t=>Object.hasOwn(e??{},t))))(t),c_=Object.keys(Em.shape);var d_={};const u_="",m_="focus:outline-none focus:ring-0 focus:ring-opacity-0 focus:ring-offset-0",p_="transition-colors rounded-md min-w-[75px] border font-normal bg-white hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700 dark:bg-gray-800 text-black dark:text-gray-600 focus:outline-none data-[state=open]:bg-gray-50 dark:data-[state=open]:bg-gray-700",f_="rounded-md border border-gray-200 focus:border-gray-400 focus:bg-gray-50 bg-transparent text-sm shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none focus-within:placeholder:text-text-primary focus:placeholder:text-text-primary placeholder:text-text-secondary focus:outline-none focus:ring-gray-400 focus:ring-opacity-20 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:focus:bg-gray-600 dark:focus:border-gray-600 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:outline-none",h_="p-0 shadow-none text-right pr-1 h-8 border-transparent hover:bg-gray-800/10 dark:hover:bg-white/10 dark:focus:bg-white/10 transition-colors",g_=e=>{const t=document.createRange();t.selectNodeContents(e.target);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))},x_=e=>"string"==typeof e?e:S.isValidElement(e)?x_(e.props.children):Array.isArray(e)?e.map(x_).join(""):"",v_=e=>{const t=e.reduce(((e,t)=>e+t),0);if(Math.abs(t-100)<.01)return e.map((e=>Number(e.toFixed(2))));const n=100/t,s=e.map((e=>Number((e*n).toFixed(2)))),a=s.reduce(((t,n,s)=>s===e.length-1?t:t+n),0);return s[s.length-1]=Number((100-a).toFixed(2)),s},b_=Ce({key:"artifactsState",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{s_.log("artifacts","Recoil Effect: Setting artifactsState",{key:t.key,newValue:e})}))}]}),__=Ce({key:"currentArtifactId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{s_.log("artifacts","Recoil Effect: Setting currentArtifactId",{key:t.key,newValue:e})}))}]}),y_=Ce({key:"artifactsVisibility",default:!0,effects:[({onSet:e,node:t})=>{e((async e=>{s_.log("artifacts","Recoil Effect: Setting artifactsVisibility",{key:t.key,newValue:e})}))}]}),j_=Ce({key:"visibleArtifacts",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{s_.log("artifacts","Recoil Effect: Setting `visibleArtifacts`",{key:t.key,newValue:e})}))}]}),w_=Object.freeze(Object.defineProperty({__proto__:null,artifactsState:b_,artifactsVisibility:y_,currentArtifactId:__,visibleArtifacts:j_},Symbol.toStringTag,{value:"Module"})),N_=n.createContext({}),C_=({children:e})=>{const t=n.useRef(!1);return s.jsx(N_.Provider,{value:t,children:e})},k_=Ce({key:"latestMessageKeys",default:[]}),S_=Ce({key:"submissionKeys",default:[]}),E_=ke({key:"latestMessageByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Sh.COMMON_DIVIDER)[1]);s_.log("Recoil Effect: Setting latestMessage",{key:n,newValue:e})}))}]}),T_=ke({key:"submissionByIndex",default:null}),I_=Se({key:"latestMessageKeysSelector",get:({get:e})=>e(M_).filter((t=>null!==e(E_(t)))),set:({set:e},t)=>{s_.log("setting latestMessageKeys",{newKeys:t}),e(k_,t)}}),R_=Se({key:"submissionKeysSelector",get:({get:e})=>e(M_).filter((t=>null!==e(T_(t)))),set:({set:e},t)=>{s_.log("setting submissionKeysAtom",t),e(S_,t)}}),P_=ke({key:"conversationByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async(e,n)=>{const s=Number(t.key.split("__")[1]);if(s_.log("conversation","Setting conversation:",{index:s,newValue:e,oldValue:n}),null!=(null==e?void 0:e.assistant_id)&&e.assistant_id&&localStorage.setItem(`${Eh.ASST_ID_PREFIX}${s}${e.endpoint}`,e.assistant_id),null!=(null==e?void 0:e.agent_id)&&e.agent_id&&localStorage.setItem(`${Eh.AGENT_ID_PREFIX}${s}`,e.agent_id),null!=(null==e?void 0:e.spec)&&e.spec&&localStorage.setItem(Eh.LAST_SPEC,e.spec),(null==e?void 0:e.tools)&&Array.isArray(e.tools)&&localStorage.setItem(Eh.LAST_TOOLS,JSON.stringify(e.tools.filter((e=>!!e)))),!e)return;!function(e){if(!e)return;const{endpoint:t,model:n,agentOptions:s}=e;if(!t)return;const a=JSON.parse(localStorage.getItem(Eh.LAST_MODEL)??"{}");a[t]=n,t===Uu.gptPlugins&&(a.secondaryModel=(null==s?void 0:s.model)??n??""),localStorage.setItem(Eh.LAST_MODEL,JSON.stringify(a))}(e),localStorage.setItem(`${Eh.LAST_CONVO_SETUP}_${s}`,JSON.stringify(e));const a=!0===e.disableParams;if(0===s&&!a&&""===e.createdAt&&JSON.stringify(e)!==JSON.stringify(n)&&(null==n?void 0:n.conversationId)===Sh.NEW_CONVO){const t=function(e){if(null==e)return new URLSearchParams;const t=new URLSearchParams;if(e&&"object"==typeof e&&!("endpoint"in e)&&!("model"in e))return Object.entries(e).forEach((([e,n])=>{null!=n&&c_.includes(e)&&t.set(e,n)})),t;const n=e,s=n.endpoint;if(n.spec)return new URLSearchParams({spec:n.spec});if(Xu(s)&&n.agent_id&&n.agent_id!==Sh.EPHEMERAL_AGENT_ID)return new URLSearchParams({agent_id:String(n.agent_id)});if(Yu(s)&&n.assistant_id)return new URLSearchParams({assistant_id:String(n.assistant_id)});if(Xu(s)&&!n.agent_id)return t;if(Yu(s)&&!n.assistant_id)return t;s&&t.set("endpoint",s),n.model&&t.set("model",n.model);const a={};return c_.forEach((e=>{"agent_id"===e&&n.agent_id===Sh.EPHEMERAL_AGENT_ID||"endpoint"!==e&&"model"!==e&&(a[e]=n[e])})),Object.entries(a).reduce(((e,[t,n])=>(null!=n&&(Array.isArray(n)?e.set(t,"stop"===t?n.join(","):JSON.stringify(n)):e.set(t,String(n))),e)),t)}(e),n=Rs(t),s=`${window.location.pathname}?${n.toString()}`;window.history.pushState({},"",s)}}))}]}),A_=ke({key:"filesByIndex",default:new Map}),M_=Ce({key:"conversationKeys",default:[]}),L_=Se({key:"allConversationsSelector",get:({get:e})=>e(M_).map((t=>e(P_(t)))).map((e=>null==e?void 0:e.conversationId))}),O_=ke({key:"presetByIndex",default:null}),D_=ke({key:"textByIndex",default:""}),F_=ke({key:"showStopButtonByIndex",default:!1}),z_=ke({key:"abortScrollByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Sh.COMMON_DIVIDER)[1]);s_.log("message_scrolling","Recoil Effect: Setting abortScrollByIndex",{key:n,newValue:e})}))}]}),U_=ke({key:"isSubmittingByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Sh.COMMON_DIVIDER)[1]);s_.log("message_stream","Recoil Effect: Setting isSubmittingByIndex",{key:n,newValue:e})}))}]}),V_=ke({key:"optionSettingsByIndex",default:{}}),B_=ke({key:"showAgentSettingsByIndex",default:!1}),$_=ke({key:"showPopoverByIndex",default:!1}),H_=ke({key:"activePromptByIndex",default:void 0}),G_=ke({key:"showMentionPopoverByIndex",default:!1}),K_=ke({key:"showPlusPopoverByIndex",default:!1}),W_=ke({key:"showPromptsPopoverByIndex",default:!1}),q_=ke({key:"globalAudioURLByIndex",default:null}),Q_=ke({key:"globalAudioisFetchingByIndex",default:!1}),Y_=ke({key:"globalAudioisPlayingByIndex",default:!1}),X_=ke({key:"activeRunByIndex",default:null}),Z_=ke({key:"audioRunByIndex",default:null}),J_=ke({key:"messagesSiblingIdx",default:0});const ey=Ee({key:"conversationByKeySelector",get:e=>({get:t})=>t(P_(e))});const ty=Ee({key:"updateConversationSelector",get:()=>()=>null,set:e=>({set:t,get:n},s)=>{if(s instanceof Te)return;n(M_).forEach((n=>{t(P_(n),(t=>t&&t.conversationId===e?{...t,...s}:t))}))}}),ny={conversationKeysAtom:M_,conversationByIndex:P_,filesByIndex:A_,presetByIndex:O_,submissionByIndex:T_,textByIndex:D_,showStopButtonByIndex:F_,abortScrollFamily:z_,isSubmittingFamily:U_,optionSettingsFamily:V_,showAgentSettingsFamily:B_,showPopoverFamily:$_,latestMessageFamily:E_,messagesSiblingIdxFamily:J_,allConversationsSelector:L_,conversationByKeySelector:ey,useClearConvoState:function(){return Ie((({reset:e,snapshot:t})=>async n=>{const s=await t.getPromise(M_);for(const a of s){if(!0===n&&0==a)continue;e(P_(a));await t.getPromise(P_(a))&&e(E_(a))}e(M_)}),[])},useCreateConversationAtom:function(e){const t=n.useContext(N_),[s,a]=Re(M_),r=Pe(P_(e)),o=Ae(P_(e));return n.useEffect((()=>{s.includes(e)||a([...s,e])}),[e,s,a]),{hasSetConversation:t,conversation:o,setConversation:r}},showMentionPopoverFamily:G_,globalAudioURLFamily:q_,activeRunFamily:X_,audioRunFamily:Z_,globalAudioPlayingFamily:Y_,globalAudioFetchingFamily:Q_,showPlusPopoverFamily:K_,activePromptByIndex:H_,useClearSubmissionState:function(){return Ie((({reset:e,set:t,snapshot:n})=>async s=>{const a=await n.getPromise(R_);s_.log("submissionKeys",a);for(const t of a)!0===s&&0==t||(s_.log("resetting submission",t),e(T_(t)));t(R_,[])}),[])},useClearLatestMessages:function(e){return Ie((({reset:t,set:n,snapshot:s})=>async a=>{const r=await s.getPromise(I_);s_.log("[clearAllLatestMessages] latestMessageKeys",r),null!=e&&e&&s_.log(`[clearAllLatestMessages] context: ${e}`);for(const e of r)!0===a&&0==e||(s_.log(`[clearAllLatestMessages] resetting latest message; key: ${e}`),t(E_(e)));n(I_,[])}),[])},showPromptsPopoverFamily:W_,updateConversationSelector:ty},sy={[Uu.azureOpenAI]:null,[Uu.azureAssistants]:null,[Uu.assistants]:null,[Uu.agents]:null,[Uu.openAI]:null,[Uu.chatGPTBrowser]:null,[Uu.gptPlugins]:null,[Uu.google]:null,[Uu.anthropic]:null,[Uu.custom]:null},ay=Ce({key:"endpointsConfig",default:sy}),ry=Ce({key:"endpointsQueryEnabled",default:!0}),oy=Se({key:"plugins",get:({get:e})=>{var t;return(null==(t=(e(ay)||{}).gptPlugins)?void 0:t.plugins)||{}}}),iy=Se({key:"endpointsFilter",get:({get:e})=>{const t=e(ay)||{},n={};for(const s of Object.keys(t))n[s]=!!t[s];return n}}),ly={plugins:oy,endpointsConfig:ay,endpointsFilter:iy,defaultConfig:sy,endpointsQueryEnabled:ry},cy={user:Ce({key:"user",default:void 0}),availableTools:Ce({key:"availableTools",default:{}})},dy={text:Ce({key:"text",default:""})},uy={toastState:Ce({key:"toastState",default:{open:!1,message:"",severity:eu.SUCCESS,showIcon:!0}})},my={submission:Ce({key:"submission",default:null}),isSubmitting:Ce({key:"isSubmitting",default:!1})},py={search:Ce({key:"search",default:{enabled:null,query:"",debouncedQuery:"",isSearching:!1,isTyping:!1}})},fy={defaultPreset:Ce({key:"defaultPreset",default:null}),presetModalVisible:Ce({key:"presetModalVisible",default:!1})};function hy(e,t){return Ce({key:e,default:t,effects_UNSTABLE:[({setSelf:n,onSet:s})=>{const a=localStorage.getItem(e);if(null!==a)try{n(JSON.parse(a))}catch(Di){console.error(`Error parsing localStorage key "${e}", \`savedValue\`: defaultValue, error:`,Di),localStorage.setItem(e,JSON.stringify(t)),n(t)}s((t=>{localStorage.setItem(e,JSON.stringify(t))}))}]})}const gy={...{promptsName:Ce({key:"promptsName",default:""}),promptsCategory:Ce({key:"promptsCategory",default:""}),promptsPageNumber:Ce({key:"promptsPageNumber",default:1}),promptsPageSize:Ce({key:"promptsPageSize",default:10})},...{autoSendPrompts:hy("autoSendPrompts",!0),alwaysMakeProd:hy("alwaysMakeProd",!0),promptsEditorMode:hy("promptsEditorMode",Kd.SIMPLE)}},xy={lang:hy("lang",(()=>{const e=navigator.language||navigator.languages[0];return Me.get("lang")||localStorage.getItem("lang")||e})())},vy={...{abortScroll:Ce({key:"abortScroll",default:!1}),showFiles:Ce({key:"showFiles",default:!1}),optionSettings:Ce({key:"optionSettings",default:{}}),showPluginStoreDialog:Ce({key:"showPluginStoreDialog",default:!1}),showAgentSettings:Ce({key:"showAgentSettings",default:!1}),currentSettingsView:Ce({key:"currentSettingsView",default:Dp.default}),showPopover:Ce({key:"showPopover",default:!1})},...{autoScroll:hy("autoScroll",!1),hideSidePanel:hy("hideSidePanel",!1),fontSize:hy("fontSize","text-base"),enableUserMsgMarkdown:hy(Eh.ENABLE_USER_MSG_MARKDOWN,!0),enterToSend:hy("enterToSend",!0),maximizeChatSpace:hy("maximizeChatSpace",!1),chatDirection:hy("chatDirection","LTR"),showCode:hy(Eh.SHOW_ANALYSIS_CODE,!0),saveDrafts:hy("saveDrafts",!0),showScrollButton:hy("showScrollButton",!0),forkSetting:hy("forkSetting",""),splitAtTarget:hy("splitAtTarget",!1),rememberDefaultFork:hy(Eh.REMEMBER_FORK_OPTION,!1),showThinking:hy("showThinking",!1),saveBadgesState:hy("saveBadgesState",!1),modularChat:hy("modularChat",!0),LaTeXParsing:hy("LaTeXParsing",!0),centerFormOnLanding:hy("centerFormOnLanding",!0),showFooter:hy("showFooter",!0),atCommand:hy("atCommand",!0),plusCommand:hy("plusCommand",!0),slashCommand:hy("slashCommand",!0),conversationMode:hy("conversationMode",!1),advancedMode:hy("advancedMode",!1),speechToText:hy("speechToText",!0),engineSTT:hy("engineSTT","browser"),languageSTT:hy("languageSTT",""),autoTranscribeAudio:hy("autoTranscribeAudio",!1),decibelValue:hy("decibelValue",-45),autoSendText:hy("autoSendText",-1),textToSpeech:hy("textToSpeech",!0),engineTTS:hy("engineTTS","browser"),voice:hy("voice",void 0),cloudBrowserVoices:hy("cloudBrowserVoices",!1),languageTTS:hy("languageTTS",""),automaticPlayback:hy("automaticPlayback",!1),playbackRate:hy("playbackRate",null),cacheTTS:hy("cacheTTS",!0),UsernameDisplay:hy("UsernameDisplay",!0)}},by={hideBannerHint:hy("hideBannerHint",[]),messageAttachmentsMap:Ce({key:"messageAttachmentsMap",default:{}}),queriesEnabled:Ce({key:"queriesEnabled",default:!0}),isEditingBadges:Ce({key:"isEditingBadges",default:!1}),chatBadges:hy("chatBadges",[{id:"1"}])},_y={isTemporary:hy("isTemporary",!1)},yy=ke({key:"ephemeralAgentByConvoId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{var n;const s=null==(n=t.key.split("__")[1])?void 0:n.replaceAll('"',"");s_.log("agents","Setting ephemeral agent:",{conversationId:s,newValue:e})}))}]});const jy=Le((e=>{const t=e??Sh.NEW_CONVO,n=`${Eh.LAST_MCP_}${t}`;return E(n,[],void 0,{getOnInit:!0})})),wy=E(Eh.PIN_MCP_,!0,void 0,{getOnInit:!0}),Ny={...w_,...ny,...ly,...cy,...dy,...uy,...my,...py,...gy,...fy,...xy,...vy,...by,..._y};function Cy(e=0){const t=Pe(Ny.audioRunFamily(e)),s=Pe(Ny.activeRunFamily(e)),a=Pe(Ny.globalAudioPlayingFamily(e)),r=Pe(Ny.globalAudioFetchingFamily(e)),[o,i]=Re(Ny.globalAudioURLFamily(e));return{pauseGlobalAudio:n.useCallback((()=>{if(null!=o&&""!==o){const e=document.getElementById(Qd);e&&(console.log("Pausing global audio",o),e.pause(),a(!1)),URL.revokeObjectURL(o),r(!1),i(null),s(null),t(null)}}),[t,s,o,i,a,r])}}const ky=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.user],(()=>Rx.getUser()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Sy=(e={},t)=>{const{scopes:n,enabled:s=!1}=e;return mr({queryKey:[xx.graphToken,n],queryFn:()=>Rx.getGraphApiToken({scopes:n}),enabled:s,staleTime:3e6,retry:1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})};function Ey(){const e=Ny.useClearConvoState(),t=Ny.useClearSubmissionState(),n=Ny.useClearLatestMessages();return Ie((({reset:s,snapshot:a})=>async r=>{await t(r),await e(r),await n(r);const o=await a.getPromise(Ny.conversationKeysAtom);for(const e of o)!0===r&&0===e||(s(Ny.filesByIndex(e)),s(Ny.presetByIndex(e)),s(Ny.textByIndex(e)),s(Ny.showStopButtonByIndex(e)),s(Ny.abortScrollFamily(e)),s(Ny.isSubmittingFamily(e)),s(Ny.optionSettingsFamily(e)),s(Ny.showAgentSettingsFamily(e)),s(Ny.showPopoverFamily(e)),s(Ny.showMentionPopoverFamily(e)),s(Ny.showPlusPopoverFamily(e)),s(Ny.showPromptsPopoverFamily(e)),s(Ny.activePromptByIndex(e)),s(Ny.globalAudioURLFamily(e)),s(Ny.globalAudioFetchingFamily(e)),s(Ny.globalAudioPlayingFamily(e)),s(Ny.activeRunFamily(e)),s(Ny.audioRunFamily(e)),s(Ny.messagesSiblingIdxFamily(e.toString())));!function(e){Object.keys(localStorage).forEach((t=>{!0===e&&t.endsWith("0")||(t.startsWith(Eh.LAST_MCP_)||t.startsWith(Eh.LAST_CODE_TOGGLE_)||t.startsWith(Eh.ASST_ID_PREFIX)||t.startsWith(Eh.AGENT_ID_PREFIX)||t.startsWith(Eh.LAST_CONVO_SETUP)||t===Eh.LAST_SPEC||t===Eh.LAST_TOOLS||t===Eh.LAST_MODEL||t===Eh.FILES_TO_DELETE)&&localStorage.removeItem(t)}))}(r)}),[])}const Ty={limit:10,requiredPermission:px.EDIT},Iy=()=>{const e=pr().getQueryData([xx.endpoints]),t=!!(null==e?void 0:e[Uu.agents]);return mr([xx.tools],(()=>Rx.getAvailableAgentTools()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:t})},Ry=(e=Ty,t)=>{const n=pr().getQueryData([xx.endpoints]),s=!!(null==n?void 0:n[Uu.agents]);return mr([xx.agents,e],(()=>Rx.listAgents(e)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&s:s})},Py=(e,t)=>mr([xx.agent,e],(()=>Rx.getAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),Ay=(e,t)=>mr([xx.agent,e,"expanded"],(()=>Rx.getExpandedAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),My=e=>mr([xx.agentCategories],(()=>Rx.getAgentCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5,...e}),Ly=[{requiredPermission:px.VIEW},{requiredPermission:px.EDIT}],Oy=e=>{const t=pr();return fr((e=>Rx.createAgent(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return Ly.forEach((r=>{var o;const i=t.getQueryData([xx.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];t.setQueryData([xx.agents,r],{...i,data:l})})),Hy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Dy=e=>{const t=pr();return fr((({agent_id:e,data:t})=>Rx.updateAgent({data:t,agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return Ly.forEach((r=>{var o;const i=t.getQueryData([xx.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a);t.setQueryData([xx.agents,r],{...i,data:i.data.map((e=>e.id===s.agent_id?n:e))})})),t.setQueryData([xx.agent,s.agent_id],n),t.setQueryData([xx.agent,s.agent_id,"expanded"],n),Hy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Fy=e=>{const t=pr();return fr((({agent_id:e})=>Rx.deleteAgent({agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;const o=(r=>{let o=[];return Ly.forEach((r=>{var i;const l=t.getQueryData([xx.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,s,a);o=l.data.filter((e=>e.id!==s.agent_id)),t.setQueryData([xx.agents,r],{...l,data:o})})),o})();return t.removeQueries([xx.agent,s.agent_id]),t.removeQueries([xx.agent,s.agent_id,"expanded"]),Hy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,o)}})},zy=e=>{const t=pr();return fr((e=>Rx.duplicateAgent(e)),{onMutate:null==e?void 0:e.onMutate,onError:null==e?void 0:e.onError,onSuccess:({agent:n,actions:s},a,r)=>{var o;Ly.forEach((e=>{const s=t.getQueryData([xx.agents,e]);if(s){const a=[n,...s.data];t.setQueryData([xx.agents,e],{...s,data:a})}}));const i=t.getQueryData([xx.actions])||[];return t.setQueryData([xx.actions],i.concat(s)),Hy(t),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,{agent:n,actions:s},a,r)}})},Uy=e=>fr([yx.agentAvatarUpload],{mutationFn:e=>Rx.uploadAgentAvatar(e),...e||{}}),Vy=e=>{const t=pr();return fr([yx.updateAgentAction],{mutationFn:e=>Rx.updateAgentAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;const o=n[0];return Ly.forEach((r=>{var i;const l=t.getQueryData([xx.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,s,a);t.setQueryData([xx.agents,r],{...l,data:l.data.map((e=>e.id===s.agent_id?o:e))})})),t.setQueryData([xx.actions],(e=>e?s.action_id?e.map((e=>e.action_id===s.action_id?n[1]:e)):[...e,n[1]]:[n[1]])),t.setQueryData([xx.agent,s.agent_id],o),t.setQueryData([xx.agent,s.agent_id,"expanded"],o),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},By=e=>{const t=pr();return fr([yx.deleteAgentAction],{mutationFn:e=>Rx.deleteAgentAction({...e}),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";t.setQueryData([xx.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==s.action_id))))),Ly.forEach((e=>{t.setQueryData([xx.agents,e],(e=>e?{...e,data:e.data.map((e=>{var t;return e.id===s.agent_id?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e}))}:e))}));const i=e=>{var t;return e?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e};return t.setQueryData([xx.agent,s.agent_id],i),t.setQueryData([xx.agent,s.agent_id,"expanded"],i),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},$y=e=>{const t=pr();return fr((({agent_id:e,version_index:t})=>Rx.revertAgentVersion({agent_id:e,version_index:t})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return t.setQueryData([xx.agent,s.agent_id],n),Ly.forEach((e=>{const a=t.getQueryData([xx.agents,e]);a&&t.setQueryData([xx.agents,e],{...a,data:a.data.map((e=>e.id===s.agent_id?n:e))})})),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Hy=e=>{e.invalidateQueries([xx.marketplaceAgents])},Gy=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.endpoints],(()=>Rx.getAIEndpoints()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Ky=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.startupConfig],(()=>Rx.getStartupConfig()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Wy=e=>{const t=pr(),{showToast:n}=Bd(),s=Fk(),{onSuccess:a,onError:r,...o}=e||{};return fr([yx.fileDelete],{mutationFn:e=>Rx.deleteFiles(e),...o,onError:(e,t,a)=>{var o;if(e&&"object"==typeof e&&"response"in e){403===(null==(o=e.response)?void 0:o.status)&&n({message:s("com_ui_delete_not_allowed"),status:"error"})}null==r||r(e,t,a)},onSuccess:(e,r,o)=>{t.setQueryData([xx.files],(e=>{const{files:t}=r,n=t.reduce(((e,t)=>(e.set(t.file_id,t),e)),new Map);return(e??[]).filter((e=>!n.has(e.file_id)))})),n({message:s("com_ui_delete_success"),status:"success"}),null==a||a(e,r,o),null!=r.agent_id&&r.agent_id&&t.refetchQueries([xx.agent,r.agent_id])}})},qy=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.files],(()=>Rx.getFiles()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Qy=(e,t)=>{const n=Ae(Ny.queriesEnabled);return mr(jx(e??""),(()=>e?Rx.getAgentFiles(e):Promise.resolve([])),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:n&&!!e})},Yy=e=>mr([xx.fileConfig],(()=>Rx.getFileConfig()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Xy=(e,t)=>{const n=pr();return mr([xx.fileDownload,t],(async()=>{if(!e||!t)return void console.warn("No user ID provided for file download");const s=await Rx.getFileDownload(e,t),a=s.data,r=window.URL.createObjectURL(a);try{const e=JSON.parse(s.headers["x-file-metadata"]);if(!e)return console.warn("No metadata found for file download",s.headers),r;Ov(n,e)}catch(Di){console.error("Error parsing file metadata, skipped updating file query cache",Di)}return r}),{enabled:!1,retry:!1})},Zy=()=>fr({mutationFn:async({files:e,accessToken:t,onProgress:n})=>{const s=[],a=[];let r=0;const o=[];for(let i=0;i<e.length;i+=3)o.push(e.slice(i,i+3));for(const i of o){const o=i.map((async s=>{try{const o=s.downloadUrl||`https://graph.microsoft.com/v1.0/drives/${s.driveId}/items/${s.itemId}/content`,i=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);const l=await i.blob(),c=i.headers.get("content-type")||Jy(s.name),d=new File([l],s.name,{type:c,lastModified:Date.now()});return r++,null==n||n({completed:r,total:e.length,currentFile:s.name,failed:a}),d}catch(o){throw console.error(`Failed to download ${s.name}:`,o),a.push(s.name),r++,null==n||n({completed:r,total:e.length,currentFile:`Error: ${s.name}`,failed:a}),o}}));(await Promise.allSettled(o)).forEach((e=>{"fulfilled"===e.status&&s.push(e.value)}))}return a.length>0&&console.warn(`Failed to download ${a.length} files:`,a),s},retry:1});function Jy(e){var t;return{pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",zip:"application/zip",rar:"application/x-rar-compressed",mp4:"video/mp4",mp3:"audio/mpeg",wav:"audio/wav"}[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"application/octet-stream"}const ej=e=>mr([xx.memories],(()=>Rx.getMemories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),tj=e=>{const t=pr();return fr([yx.updateMemoryPreferences],(e=>Rx.updateMemoryPreferences(e)),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([xx.user]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})},nj=e=>{const t=pr();return fr((({key:e,value:t})=>Rx.createMemory({key:e,value:t})),{...e,onSuccess:(n,s,a)=>{var r;t.setQueryData([xx.memories],(e=>{if(!e)return e;const t=[...e.memories,n.memory],s=t.reduce(((e,t)=>e+(t.tokenCount||0)),0),a=e.tokenLimit;let r=e.usagePercentage;return a&&a>0&&(r=Math.min(100,Math.round(s/a*100))),{...e,memories:t,totalTokens:s,usagePercentage:r}})),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},sj=(e,t)=>{const n=De(),s=pr();return mr([xx.messages,e],(async()=>{const t=await Rx.getMessagesByConvoId(e);if(!n.pathname.includes("/c/new")&&1===(null==t?void 0:t.length)){const a=s.getQueryData([xx.messages,e]);if(1===(null==a?void 0:a.length))return t;if(a&&(null==a?void 0:a.length)>1)return s_.warn("messages",`Messages query for convo ${e} returned fewer than cache; path: "${n.pathname}"`,t,a),a}return t}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})},aj=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.balance],(()=>Rx.getUserBalance()),{refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},rj=e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.searchEnabled],(()=>Rx.getSearchEnabled()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},oj=(e,t)=>mr([xx.toolAuth,e.toolId],(()=>Rx.getVerifyAgentToolAuth(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t}),ij=(e,t)=>{const{conversationId:n=""}=e;return mr([xx.toolCalls,n],(()=>Rx.getToolCalls(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:n.length>0&&n!==Sh.NEW_CONVO&&n!==Sh.PENDING_CONVO&&n!==Sh.SEARCH,...t})},lj=e=>mr([xx.mcpConnectionStatus],(()=>Rx.getMCPConnectionStatus()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1e4,...e}),cj=(e,t)=>mr([xx.mcpAuthValues,e],(()=>Rx.getMCPAuthValues(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:!!e,...t}),dj=()=>{const e=pr();return{updateTagsInConversation:(t,n)=>{const s=e.getQueryData([xx.conversation,t]);if(!s)return;const a={...s,tags:n};e.setQueryData([xx.conversation,t],a),e.setQueryData([xx.allConversations],(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===(s.conversationId??"")?{...e,tags:a.tags}:e))})))}:e))},replaceTagsInAllConversations:(t,n)=>{const s=e.getQueryData([xx.allConversations]);if(s){const a=JSON.parse(JSON.stringify(s));for(let e=0;e<a.pages.length;e++){const s=a.pages[e];s.conversations=s.conversations.map((e=>{var s;return e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&(null==(s=e.tags)?void 0:s.includes(t))&&(e.tags=e.tags.map((e=>e===t?n:e))),e}))}e.setQueryData([xx.allConversations],a)}const a=[];for(let r=0;r<a.length;r++){const s=a[r],o=e.getQueryData([xx.conversation,s]);if(o&&o.tags){const a={...o,tags:o.tags.map((e=>e===t?n:e))};e.setQueryData([xx.conversation,s],a)}}}}},uj=e=>mr([xx.presets],(()=>Rx.getPresets()),{staleTime:1e4,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),mj=(e,t)=>{const{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}=e;return hr({queryKey:[n?xx.archivedConversations:xx.allConversations,{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}],queryFn:({pageParam:e})=>Rx.listConversations({isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},pj=(e,t)=>{const{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}=e;return hr({queryKey:[xx.sharedLinks,{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}],queryFn:({pageParam:e})=>Rx.listSharedLinks({cursor:null==e?void 0:e.toString(),pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},fj=e=>mr([xx.conversationTags],(()=>Rx.getConversationTags()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),hj=(e,t)=>{var n,s;const a=pr(),r=a.getQueryData([xx.endpoints]),o=a.getQueryData([xx.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!Xu(e)||!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??Nf[e];return mr([xx.tools],(()=>Rx.getAvailableTools(e,c)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:l,...t})},gj=(e,t=Su,n)=>{var s,a;const r=pr(),o=r.getQueryData([xx.endpoints]),i=r.getQueryData([xx.name,e]),l=!!!(null==(s=null==o?void 0:o[e])?void 0:s.userProvide)||!!(null==i?void 0:i.expiresAt),c=!!(null==o?void 0:o[e])&&l,d=(null==(a=null==o?void 0:o[e])?void 0:a.version)??Nf[e];return mr([xx.assistants,e,t],(()=>Rx.listAssistants({...t,endpoint:e},d)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...n,enabled:void 0!==(null==n?void 0:n.enabled)?n.enabled&&c:c})},xj=(e,t)=>{var n;const s=pr(),a=s.getQueryData([xx.endpoints]),r=s.getQueryData([xx.name,e]),o=!!!(null==(n=null==a?void 0:a[e])?void 0:n.userProvide)||!!(null==r?void 0:r.expiresAt),i=!!(null==a?void 0:a[e])&&o||e===Uu.agents;return mr([xx.actions],(()=>Rx.getActions()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&i:i})},vj=(e,t)=>{var n,s;const a=pr(),r=a.getQueryData([xx.endpoints]),o=a.getQueryData([xx.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??Nf[e];return mr([xx.assistantDocs,e],(()=>Rx.getAssistantDocs({endpoint:e,version:c})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&l:l})},bj=()=>{const e=pr();return fr((e=>Rx.genTitle(e)),{onSuccess:(t,n)=>{e.setQueryData([xx.conversation,n.conversationId],(e=>e?{...e,title:t.title}:e)),lb(e,n.conversationId,(e=>({...e,title:t.title}))),document.title=t.title}})},_j=e=>{const t=pr(),n=[xx.allConversations],s=[xx.archivedConversations],{onMutate:a,onError:r,onSettled:o,onSuccess:i,...l}=e||{};return fr((e=>Rx.archiveConversation(e)),{onMutate:a,onSuccess:(e,n,s)=>{const a=!0===n.isArchived;cb(t,n.conversationId);const r=t.getQueryCache().findAll([xx.archivedConversations],{exact:!1});for(const o of r)t.setQueryData(o.queryKey,(t=>t?a?{...t,pages:[{...t.pages[0],conversations:[e,...t.pages[0].conversations]},...t.pages.slice(1)]}:{...t,pages:t.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==n.conversationId))})))}:t));t.setQueryData([xx.conversation,n.conversationId],a?null:e),null==i||i(e,n,s)},onError:r,onSettled:()=>{t.invalidateQueries({queryKey:n,refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:s,refetchPage:(e,t)=>0===t})},...l})},yj=e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((({conversationId:e})=>{if(!e)throw new Error("Conversation ID is required");return Rx.createSharedLink(e)}),{onSuccess:(e,s,a)=>{t.setQueryData([xx.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})},jj=e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((({shareId:e})=>{if(!e)throw new Error("Share ID is required");return Rx.updateSharedLink(e)}),{onSuccess:(e,s,a)=>{t.setQueryData([xx.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})},wj=e=>{const t=pr(),{onSuccess:n}=e||{};return fr((e=>Rx.deleteSharedLink(e.shareId)),{onMutate:async e=>{await t.cancelQueries({queryKey:[xx.sharedLinks],exact:!1});const n=new Map;return t.getQueryCache().findAll([xx.sharedLinks]).forEach((s=>{const a=t.getQueryData(s.queryKey);n.set(s.queryKey,a),t.setQueryData(s.queryKey,(t=>{if(!(null==t?void 0:t.pages))return t;const n=t.pages.map((t=>({...t,links:t.links.filter((t=>t.shareId!==e.shareId))}))).filter((e=>e.links.length>0));return{...t,pages:n}}))})),{previousQueries:n}},onError:(e,n,s)=>{(null==s?void 0:s.previousQueries)&&s.previousQueries.forEach(((e,n)=>{t.setQueryData(n,e)}))},onSettled:()=>{t.invalidateQueries({queryKey:[xx.sharedLinks],exact:!1})},onSuccess:(e,s)=>{n&&n(e,s),t.refetchQueries({queryKey:[xx.sharedLinks],exact:!0})}})},Nj=({context:e,tag:t,options:n})=>{const s=pr(),{onSuccess:a,...r}=n||{},{updateTagsInConversation:o,replaceTagsInAllConversations:i}=dj();return fr((e=>null!=t?Rx.updateConversationTag(t,e):Rx.createConversationTag(e)),{onSuccess:(...n)=>{((n,a)=>{if(s.setQueryData([xx.conversationTags],(s=>{if(!s)return[{count:1,position:0,tag:Sh.SAVED_TAG,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}];if(void 0===t||!t.length){const t=s.findIndex((e=>e.tag===n.tag));if(-1!==t){s_.log("tag_mutation",`"Created" tag exists, updating from ${e}`,s,n);const a=[...s];return a[t]={...a[t],...n},a.sort(((e,t)=>e.position-t.position))}return s_.log("tag_mutation",`"Created" tag is new, adding from ${e}`,s,n),[...s,n].sort(((e,t)=>e.position-t.position))}return s_.log("tag_mutation",`Updating tag from ${e}`,s,n),((e,t,n,s)=>{if(0===e.length)return[n];const a=e.find((e=>e.tag===s));if(!a)return[e[0],n,...e.slice(1)].map(((e,t)=>({...e,position:t})));const r=a.position,o=n.position,i=e.filter((e=>e.tag!==s));if(void 0===o||r===o)return e.map((e=>e.tag===s?n:e));const l=[...i.slice(0,o),n,...i.slice(o)];if(o>r)for(let c=r;c<o;c++)l[c].position=c;else for(let c=o+1;c<l.length;c++)l[c].position=c;return l})(s,0,n,t)})),!0===a.addToConversation&&null!=a.conversationId&&n.tag){const t=s.getQueryData([xx.conversation,a.conversationId]);if(!t)return;s_.log("tag_mutation",`\`updateTagsInConversation\` Update from ${e}`,t),o(a.conversationId,[...t.tags||[],n.tag])}null!=t&&i(t,n.tag)})(...n),null==a||a(...n)},...r})},Cj=e=>{const t=pr(),n=(()=>{const e=pr();return t=>{const n=e.getQueryData([xx.allConversations]);if(!n||!Array.isArray(n.pages)||0===n.pages.length)return;const s=[],a={pageParams:Array.isArray(n.pageParams)?[...n.pageParams]:[],pages:n.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&e.tags.includes(t)?(s.push(e.conversationId),{...e,tags:e.tags.filter((e=>e!==t))}):e))})))};e.setQueryData([xx.allConversations],a);for(let r=0;r<s.length;r++){const n=s[r],a=e.getQueryData([xx.conversation,n]);a&&Array.isArray(a.tags)&&e.setQueryData([xx.conversation,n],{...a,tags:a.tags.filter((e=>e!==t))})}}})(),{onSuccess:s,...a}=e||{};return fr((e=>Rx.deleteConversationTag(e)),{onSuccess:(e,a,r)=>{t.setQueryData([xx.conversationTags],(e=>e?e.filter((e=>e.tag!==a)):e)),n(a),null==s||s(e,a,r)},...a})},kj=e=>{const t=pr();return fr((e=>Rx.deleteConversation(e)),{onMutate:async()=>{await t.cancelQueries([xx.allConversations]),await t.cancelQueries([xx.archivedConversations])},onError:()=>{},onSuccess:(n,s,a)=>{var r;s.conversationId&&cb(t,s.conversationId);const o=t.getQueryCache().findAll([xx.archivedConversations],{exact:!1});for(const e of o)t.setQueryData(e.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==s.conversationId))}))).filter((e=>e.conversations.length>0))}:e));t.removeQueries({queryKey:[xx.conversation,s.conversationId],exact:!0}),t.invalidateQueries({queryKey:[xx.allConversations],refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:[xx.archivedConversations],refetchPage:(e,t)=>0===t}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},Sj=e=>{const t=pr(),{onSuccess:n,onError:s,onMutate:a}=e||{};return fr({mutationFn:e=>Rx.importConversationsFile(e),onSuccess:(e,s,a)=>{t.invalidateQueries([xx.allConversations]),n&&n(e,s,a)},onError:(e,t,n)=>{s&&s(e,t,n)},onMutate:a})},Ej=e=>fr([yx.avatarUpload],{mutationFn:e=>Rx.uploadAvatar(e),...e||{}}),Tj=e=>{const t=pr();return fr((e=>Rx.createAssistant(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([xx.assistants,s.endpoint,Su]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];return t.setQueryData([xx.assistants,s.endpoint,Su],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Ij=e=>{const t=pr();return fr((({assistant_id:e,data:n})=>{const{endpoint:s}=n,a=t.getQueryData([xx.endpoints]),r=null==a?void 0:a[s],o=(null==r?void 0:r.version)??Nf[s];return Rx.updateAssistant({data:n,version:o,assistant_id:e})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([xx.assistants,s.data.endpoint,Su]);return i?(t.setQueryData([xx.assistantDocs,s.data.endpoint],(e=>e?e.map((e=>e.assistant_id===s.assistant_id?{...e,conversation_starters:n.conversation_starters,append_current_datetime:s.data.append_current_datetime}:e)):e)),t.setQueryData([xx.assistants,s.data.endpoint,Su],{...i,data:i.data.map((e=>e.id===s.assistant_id?n:e))}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)):null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Rj=e=>{const t=pr();return fr((({assistant_id:e,model:n,endpoint:s})=>{var a;const r=t.getQueryData([xx.endpoints]),o=(null==(a=null==r?void 0:r[s])?void 0:a.version)??Nf[s];return Rx.deleteAssistant({assistant_id:e,model:n,version:o,endpoint:s})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([xx.assistants,s.endpoint,Su]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=i.data.filter((e=>e.id!==s.assistant_id));return t.setQueryData([xx.assistants,s.endpoint,Su],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,l)}})},Pj=e=>fr([yx.assistantAvatarUpload],{mutationFn:({postCreation:e,...t})=>Rx.uploadAssistantAvatar(t),...e||{}}),Aj=e=>{const t=pr();return fr([yx.updateAction],{mutationFn:e=>Rx.updateAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([xx.assistants,s.endpoint,Su]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=n[1];return t.setQueryData([xx.assistants,s.endpoint,Su],{...i,data:i.data.map((e=>e.id===s.assistant_id?l:e))}),t.setQueryData([xx.actions],(e=>null==e?void 0:e.map((e=>e.action_id===s.action_id?n[2]:e)).concat(null!=s.action_id&&s.action_id?[]:[n[2]]))),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Mj=e=>{const t=pr();return fr([yx.deleteAction],{mutationFn:e=>{var n;const{endpoint:s}=e,a=t.getQueryData([xx.endpoints]),r=(null==(n=null==a?void 0:a[s])?void 0:n.version)??Nf[s];return Rx.deleteAction({...e,version:r})},onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";return t.setQueryData([xx.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==s.action_id))))),t.setQueryData([xx.assistants,s.endpoint,Su],(e=>e?{...e,data:e.data.map((e=>e.id===s.assistant_id?{...e,tools:(e.tools??[]).filter((e=>{var t;return!(null==(t=e.function)?void 0:t.name.includes(o??""))}))}:e))}:e)),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Lj=e=>fr({mutationFn:e=>Rx.resendVerificationEmail(e),...e||{}}),Oj=e=>{const{onMutate:t,onError:n,onSuccess:s}=e||{},a=pr(),r=Ae(Ny.promptsName),o=Ae(Ny.promptsPageSize),i=Ae(Ny.promptsCategory);return fr({mutationFn:e=>Rx.updatePromptGroup(e),onMutate:e=>{const n=a.getQueryData([xx.promptGroup,e.id]),s=n?structuredClone(n):void 0,l=a.getQueryData([xx.promptGroups,r,i,o]),c=l?structuredClone(l):void 0;let d=e.payload;if(d.removeProjectIds&&(null==s?void 0:s.projectIds)&&(d=structuredClone(d),d.projectIds=s.projectIds.filter((e=>{var t;return!(null==(t=d.removeProjectIds)?void 0:t.includes(e))})),delete d.removeProjectIds),l){const t=Gb(l,{_id:e.id,...d},(t=>a.setQueryData([xx.promptGroup,e.id],t)));a.setQueryData([xx.promptGroups,r,i,o],t)}return t&&t(e),{group:s,previousListData:c}},onError:(e,t,s)=>{(null==s?void 0:s.group)&&a.setQueryData([xx.promptGroups,t.id],s.group),(null==s?void 0:s.previousListData)&&a.setQueryData([xx.promptGroups,r,i,o],s.previousListData),n&&n(e,t,s)},onSuccess:(e,t,n)=>{Wb(a,{_id:t.id,...e}),s&&s(e,t,n)}})},Dj=e=>{const t=pr(),{onSuccess:n,...s}=e||{},a=Ae(Ny.promptsName),r=Ae(Ny.promptsPageSize),o=Ae(Ny.promptsCategory);return fr({mutationFn:e=>Rx.createPrompt(e),...s,onSuccess:(e,s,i)=>{const{prompt:l,group:c}=e;t.setQueryData([xx.prompts,s.prompt.groupId],(e=>[l,...e??[]])),c&&(t.setQueryData([xx.promptGroups,a,o,r],(e=>e?$b(e,c):e)),((e,t)=>{!function(e,t,n){e.setQueryData(t,(e=>e?[...e,n]:[n]))}(e,[xx.allPromptGroups],t)})(t,c)),n&&n(e,s,i)}})},Fj=e=>{const t=pr(),{onSuccess:n,onError:s,onMutate:a}={},r=Ae(Ny.promptsName),o=Ae(Ny.promptsPageSize),i=Ae(Ny.promptsCategory);return fr({mutationFn:e=>Rx.makePromptProduction(e.id),onMutate:e=>{const n=JSON.parse(JSON.stringify(t.getQueryData([xx.promptGroup,e.groupId]))),s=t.getQueryData([xx.promptGroups,r,i,o]),l=JSON.parse(JSON.stringify(s));if(s){const n=Gb(s,{_id:e.groupId,productionId:e.id,productionPrompt:e.productionPrompt},(n=>t.setQueryData([xx.promptGroup,e.groupId],n)));t.setQueryData([xx.promptGroups,r,i,o],n)}return a&&a(e),{group:n,previousListData:l}},onError:(e,n,a)=>{(null==a?void 0:a.group)&&t.setQueryData([xx.promptGroups,n.groupId],a.group),(null==a?void 0:a.previousListData)&&t.setQueryData([xx.promptGroups,r,i,o],a.previousListData),s&&s(e,n,a)},onSuccess:(e,s,a)=>{Wb(t,{_id:s.groupId,productionId:s.id,productionPrompt:s.productionPrompt}),n&&n(e,s,a)}})},zj=(e,t)=>mr([xx.roles,e],(()=>Rx.getRole(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t});function Uj({setIsSpeaking:e,audioRef:t,messageId:s,isLast:a,index:r=0}){const o=Fk(),{showToast:i}=Bd(),l=Ae(Ny.voice),c=Ae(Ny.cacheTTS),d=Ae(Ny.playbackRate),[u,m]=n.useState(!1),p=n.useRef(null),f=Ae(Ny.globalAudioFetchingFamily(r)),h=Ae(Ny.globalAudioPlayingFamily(r)),g=e=>{const t=document.createElement("a");t.href=e,t.download="audio.mp3",t.click(),m(!1)},{mutate:x,isLoading:v}=(b={onMutate:e=>{(e.get("input")??"").length>=4096&&i({message:o("com_nav_long_audio_warning"),status:"warning"})},onSuccess:async(e,n)=>{try{const s=n.get("input")??"",a=new Blob([e],{type:"audio/mpeg"});if(c&&s){const e=await caches.open("tts-responses"),t=new Request(s),n=new Response(a);e.put(t,n)}const r=URL.createObjectURL(a);u&&g(r),(e=>{const n=new Audio(e);t.current=n})(r)}catch(s){i({message:`Error processing audio: ${s.message}`,status:"error"})}},onError:e=>{i({message:o("com_nav_audio_process_error",{0:e.message}),status:"error"})}},fr([yx.textToSpeech],{mutationFn:e=>Rx.textToSpeech(e),...b||{}}));var b;const _=(e,t)=>{const n=((e,t)=>{const n=new FormData;return n.append("input",e),n.append("voice",t),n})(e,l??"");m(t),x(n)},y=async(t,n)=>{const s=await caches.match(t);if(!s)return _(t,n);const a=await s.blob(),r=URL.createObjectURL(a);n?g(r):(t=>{const n=new Audio(t),s=()=>{null!=d&&1!==d&&d>0&&(n.playbackRate=d)};s();const a=()=>n.play().then((()=>e(!0)));a().catch((e=>{if(e.message&&e.message.includes("The play() request was interrupted by a call to pause()"))return console.log("Play request was interrupted by a call to pause()"),s(),a().catch(console.error);console.error(e),i({message:o("com_nav_audio_play_error",{0:e.message}),status:"error"})})),n.onended=()=>{console.log("Cached message audio ended"),URL.revokeObjectURL(t),e(!1)},p.current=n})(r)},j=n.useCallback((()=>{p.current&&(p.current.pause(),p.current.src&&URL.revokeObjectURL(p.current.src),p.current=null,e(!1))}),[e]);n.useEffect((()=>j),[j]);const w=n.useMemo((()=>a&&f&&!h),[f,h,a]),{data:N=[]}=mr([xx.voices],(()=>Rx.getVoices()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...C});var C;return{generateSpeechExternal:(e,t)=>{c?y(e,t):_(e,t)},cancelSpeech:()=>{const n=e=>{e&&(e.pause(),e.src&&URL.revokeObjectURL(e.src),t.current=null)};n(document.getElementById(`audio-${s}`)),n(p.current),e(!1)},isLoading:w||v,audioRef:t,voices:N}}function Vj({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect((()=>{const n=()=>{e(!1),console.log("message audio ended"),t.current&&URL.revokeObjectURL(t.current.src)},s=()=>{e(!0),console.log("message audio started")},a=()=>{e(!1),console.log("message audio paused")},r=t.current;return t.current&&(t.current.muted=!0,t.current.addEventListener("ended",n),t.current.addEventListener("play",s),t.current.addEventListener("pause",a)),()=>{r&&(r.removeEventListener("ended",n),r.removeEventListener("play",s),r.removeEventListener("pause",a),URL.revokeObjectURL(r.src))}}),[e]),{audioRef:t}}const Bj=e=>{const{messageId:t,content:s,isLast:a=!1,index:r=0}=e??{},o=n.useRef(!1),i=n.useRef(void 0),[l,c]=n.useState(!1),{audioRef:d}=Vj({setIsPlaying:c}),{pauseGlobalAudio:u}=Cy(r),[m,p]=Re(Ny.voice),f=Ae(Ny.globalAudioPlayingFamily(r)),h=l||a&&f,{cancelSpeech:g,generateSpeechExternal:x,isLoading:v,voices:b}=Uj({setIsSpeaking:c,audioRef:d,messageId:t,isLast:a,index:r});n.useEffect((()=>{const e=b[0];if(b.length){const t=b.find((e=>e===m));if(null!=t)return s_.log("useTextToSpeech.ts - Effect:",{voices:b,voice:t}),void p(t.toString());s_.log("useTextToSpeech.ts - Effect:",{voices:b,voice:e}),p(e.toString())}}),[p,m,b]);return{handleMouseDown:()=>{o.current=!0,i.current=window.setTimeout((()=>{if(o.current){const e=s??"",t="string"==typeof e?e:Yh(e);x(t,!1)}}),1e3)},handleMouseUp:()=>{o.current=!1,null!=i.current&&window.clearTimeout(i.current)},toggleSpeech:()=>{if(!0===h)g(),u();else{const e=s??"",t="string"==typeof e?e:Yh(e);x(t,!1)}},isSpeaking:h,isLoading:v,audioRef:d,voices:b}};const $j=e=>{const{content:t,isLast:s=!1,index:a=0}=e??{},r=n.useRef(!1),o=n.useRef(void 0),[i,l]=n.useState(!1),{audioRef:c}=Vj({setIsPlaying:l}),{pauseGlobalAudio:d}=Cy(a),[u,m]=Re(Ny.voice),p=Ae(Ny.globalAudioPlayingFamily(a)),f=i||s&&p,{generateSpeechLocal:h,cancelSpeechLocal:g,voices:x}=function({setIsSpeaking:e}){const t=Ae(Ny.voice),[s,a]=n.useState([]),r=Ae(Ny.cloudBrowserVoices),[o,i]=n.useState(!0),l=n.useCallback((()=>{const e=window.speechSynthesis;if(e)try{const t=e.getVoices();if(!Array.isArray(t))return void console.error("getVoices() did not return an array");const n=t.filter((e=>r||!0===e.localService)).map((e=>({value:e.name,label:e.name})));a(n)}catch(t){console.error("Error updating voices:",t),i(!1)}else i(!1)}),[r]);return n.useEffect((()=>{const e=window.speechSynthesis;if(e){try{e.getVoices().length?l():e.onvoiceschanged=l}catch(t){console.error("Error in useEffect:",t),i(!1)}return()=>{e.onvoiceschanged&&(e.onvoiceschanged=null)}}i(!1)}),[l]),{generateSpeechLocal:n=>{if(!o)return void console.warn("Speech synthesis is not supported");const a=window.speechSynthesis,r=s.find((e=>e.value===t));if(r)try{a.cancel();const t=new SpeechSynthesisUtterance(n);t.voice=a.getVoices().find((e=>e.name===r.value))||null,t.onend=()=>{e(!1)},t.onerror=t=>{console.error("Speech synthesis error:",t),e(!1)},e(!0),a.speak(t)}catch(i){console.error("Error generating speech:",i),e(!1)}else console.warn("Selected voice not found")},cancelSpeechLocal:()=>{if(o)try{window.speechSynthesis.cancel()}catch(t){console.error("Error cancelling speech:",t)}finally{e(!1)}},voices:s,isSpeechSynthesisSupported:o}}({setIsSpeaking:l});n.useEffect((()=>{const e=x[0];if(x.length&&"object"==typeof e){const t=x.find((e=>"object"==typeof e?e.value===u:e===u));if(null!=t){const e="object"==typeof t?t.value:t;return s_.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e}),void m(e)}s_.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e.value}),m(e.value)}}),[m,u,x]);return{handleMouseDown:()=>{r.current=!0,o.current=window.setTimeout((()=>{if(r.current){const e=t??"",n="string"==typeof e?e:Yh(e);h(n)}}),1e3)},handleMouseUp:()=>{r.current=!1,null!=o.current&&window.clearTimeout(o.current)},toggleSpeech:()=>{if(!0===f)g(),d();else{const e=t??"",n="string"==typeof e?e:Yh(e);h(n)}},isSpeaking:f,isLoading:!1,audioRef:c,voices:x}};var Hj,Gj,Kj,Wj,qj,Qj,Yj,Xj={},Zj=function(){return Zj=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Zj.apply(this,arguments)};function Jj(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n}function ew(e,t,n,s){return new(n||(n=Promise))((function(t,a){function r(e){try{i(s.next(e))}catch(t){a(t)}}function o(e){try{i(s.throw(e))}catch(t){a(t)}}function i(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(r,o)}i((s=s.apply(e,[])).next())}))}function tw(e,t){var n,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&i[0]?s.return:i[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function nw(e,t,n){if(n||2===arguments.length)for(var s,a=0,r=t.length;a<r;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.execute_code="execute_code",e.code_interpreter="code_interpreter",e.file_search="file_search",e.web_search="web_search",e.retrieval="retrieval",e.function="function",e.memory="memory"}(Hj||(Hj={})),function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.ocr="ocr"}(Gj||(Gj={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(Kj||(Kj={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(Wj||(Wj={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(qj||(qj={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(Qj||(Qj={})),function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(Yj||(Yj={}));var sw,aw={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(sw||(sw={}));var rw,ow,iw,lw,cw=uo(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),dw=uo(["thumbsUp","thumbsDown"]),uw=mo({rating:dw,tag:cw,text:po().max(1024).optional()});po().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(lw||(lw={}));var mw,pw,fw,hw,gw,xw,vw=fo(lw);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock",e.chatGPTBrowser="chatGPTBrowser",e.gptPlugins="gptPlugins"}(mw||(mw={})),mw.agents,mw.openAI,mw.bedrock,mw.azureOpenAI,mw.anthropic,mw.custom,mw.google,function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(pw||(pw={})),function(e){e.low="low",e.auto="auto",e.high="high"}(fw||(fw={})),function(e){e.none="",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(hw||(hw={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(gw||(gw={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(xw||(xw={})),(rw={})[fw.low]=0,rw[fw.auto]=1,rw[fw.high]=2,fw.low,fw.auto,fw.high;var bw=fo(fw),_w=fo(hw),yw=fo(gw),jw=fo(xw);(ow={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[Hj.execute_code]=!1,ow[Hj.file_search]=!1,ow[Hj.web_search]=!1,ow.category="general",ow.support_contact={name:"",email:""},{type:Hj.function}[Hj.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}};var ww,Nw={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:fw.auto,min:0,max:2,step:1}},Cw=4096,kw={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:128e3,step:1,default:8192,reset:function(e){return/claude-3[-.]5-sonnet/.test(e)||/claude-3[-.]7/.test(e)?8192:4096},set:function(e,t){return!/claude-3[-.]5-sonnet/.test(t)&&!/claude-3[-.]7/.test(t)&&e>Cw?Cw:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:Cw,step:1,default:Cw}},web_search:{default:!1}},Sw={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:fw.auto}},Ew=((iw={})[mw.openAI]=Nw,iw[mw.google]={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32768,step:1,default:-1}},iw[mw.anthropic]=kw,iw[mw.agents]=Sw,iw[mw.bedrock]=Sw,iw)[mw.google],Tw=fo(mw),Iw=ho([Tw,po()]),Rw=mo({authField:po(),label:po(),description:po()}),Pw=mo({name:po(),pluginKey:po(),description:po().optional(),icon:po().optional(),authConfig:xo(Rw).optional(),authenticated:go().optional(),chatMenu:go().optional(),isButton:go().optional(),toolkit:go().optional()}),Aw=mo({input:mo({content:po()}),output:mo({content:po()})});!function(e){e.functions="functions",e.classic="classic"}(ww||(ww={}));var Mw=(ww.functions,ww.functions,ww.classic,{default:!0});fo(ww);var Lw=mo({agent:po().default(ww.functions),skipCompletion:go().default(Mw.default),model:po(),temperature:vo().default(0)});mo({messageId:po(),endpoint:po().optional(),clientId:po().nullable().optional(),conversationId:po().nullable(),parentMessageId:po().nullable(),responseMessageId:po().nullable().optional(),overrideParentMessageId:po().nullable().optional(),bg:po().nullable().optional(),model:po().nullable().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),sender:po().optional(),text:po(),generation:po().nullable().optional(),isCreatedByUser:go(),error:go().optional(),clientTimestamp:po().optional(),createdAt:po().optional().default((function(){return(new Date).toISOString()})),updatedAt:po().optional().default((function(){return(new Date).toISOString()})),current:go().optional(),unfinished:go().optional(),searchResult:go().optional(),finish_reason:po().optional(),thread_id:po().optional(),iconURL:po().nullable().optional(),feedback:uw.optional()});var Ow=ho([vo(),po()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),Dw=_o((function(){return ho([yo(),go(),vo(),po(),xo(_o((function(){return Dw}))),jo(_o((function(){return Dw})))])})),Fw=mo({conversationId:po().nullable(),endpoint:Tw.nullable(),endpointType:Tw.nullable().optional(),isArchived:go().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),user:po().optional(),messages:xo(po()).optional(),tools:ho([xo(Pw),xo(po())]).optional(),modelLabel:po().nullable().optional(),userLabel:po().optional(),model:po().nullable().optional(),promptPrefix:po().nullable().optional(),temperature:vo().nullable().optional(),topP:vo().optional(),topK:vo().optional(),top_p:vo().optional(),frequency_penalty:vo().optional(),presence_penalty:vo().optional(),parentMessageId:po().optional(),maxOutputTokens:Ow.nullable().optional(),maxContextTokens:Ow.optional(),max_tokens:Ow.optional(),promptCache:go().optional(),system:po().optional(),thinking:go().optional(),thinkingBudget:Ow.optional(),stream:go().optional(),artifacts:po().optional(),context:po().nullable().optional(),examples:xo(Aw).optional(),tags:xo(po()).optional(),createdAt:po(),updatedAt:po(),resendFiles:go().optional(),file_ids:xo(po()).optional(),imageDetail:bw.optional(),reasoning_effort:_w.optional().nullable(),reasoning_summary:yw.optional().nullable(),verbosity:jw.optional().nullable(),useResponsesApi:go().optional(),web_search:go().optional(),disableStreaming:go().optional(),assistant_id:po().optional(),agent_id:po().optional(),region:po().optional(),maxTokens:Ow.optional(),additionalModelRequestFields:Dw.optional(),instructions:po().optional(),additional_instructions:po().optional(),append_current_datetime:go().optional(),presetOverride:jo(wo()).optional(),stop:xo(po()).optional(),greeting:po().optional(),spec:po().nullable().optional(),iconURL:po().nullable().optional(),expiredAt:po().nullable().optional(),fileTokenLimit:Ow.optional(),resendImages:go().optional(),agentOptions:Lw.nullable().optional(),chatGptLabel:po().nullable().optional()}),zw=Fw.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(mo({conversationId:po().nullable().optional(),presetId:po().nullable().optional(),title:po().nullable().optional(),defaultPreset:go().optional(),order:vo().optional(),endpoint:Iw.nullable()}));Fw.merge(mo({endpoint:Iw.nullable(),createdAt:po().optional(),updatedAt:po().optional()})),Fw.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(mo({endpoint:Iw.nullable()})),mo({conversationId:po(),shareId:po(),messages:xo(po()),isPublic:go(),title:po(),createdAt:po(),updatedAt:po()}),mo({_id:po(),user:po(),tag:po(),description:po().optional(),createdAt:po(),updatedAt:po(),count:vo(),position:vo()});var Uw=Fw.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0});Uw.transform((function(e){return Bw(e)})).catch((function(){return{}})),mo({maxOutputTokens:Ow.optional(),temperature:Ow.optional(),topP:Ow.optional(),topK:Ow.optional(),presencePenalty:Ow.optional(),frequencyPenalty:Ow.optional(),stopSequences:xo(po()).optional(),thinkingConfig:mo({includeThoughts:go().optional(),thinkingBudget:Ow.optional()}).optional(),web_search:go().optional()}).strip().optional();var Vw=Fw.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,artifacts:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0});function Bw(e,t){var n=Zj({},e);return Object.keys(n).forEach((function(e){var s=n[e];null==s&&delete n[e],t&&"string"==typeof s&&""===s&&delete n[e]})),n}Vw.transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h=Zj(Zj({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(s=null!==(n=e.chatGptLabel)&&void 0!==n?n:e.modelLabel)&&void 0!==s?s:null,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:.8,top_p:null!==(o=e.top_p)&&void 0!==o?o:1,presence_penalty:null!==(i=e.presence_penalty)&&void 0!==i?i:0,frequency_penalty:null!==(l=e.frequency_penalty)&&void 0!==l?l:0,tools:null!==(c=e.tools)&&void 0!==c?c:[],agentOptions:null!==(d=e.agentOptions)&&void 0!==d?d:{agent:ww.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,spec:null!==(p=e.spec)&&void 0!==p?p:void 0,maxContextTokens:null!==(f=e.maxContextTokens)&&void 0!==f?f:void 0});return null!=e.modelLabel&&""!==e.modelLabel&&(h.modelLabel=null),h})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:ww.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:void 0,greeting:void 0,spec:void 0,maxContextTokens:void 0}})),Fw.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,s,a,r,o,i,l;return Zj(Zj({},e),{model:null!==(t=e.model)&&void 0!==t?t:Nw.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(s=e.instructions)&&void 0!==s?s:void 0,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:Nw.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),Fw.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return Bw(e)})).catch((function(){return{}})),Fw.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p;return Zj(Zj({},e),{model:null!==(t=e.model)&&void 0!==t?t:Sw.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(s=e.temperature)&&void 0!==s?s:1,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:Sw.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:fw.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:Sw.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:Sw.resendFiles.default,imageDetail:fw.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}})),Fw.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return Bw(e,!0)})).catch((function(){return{}})),Uw.transform((function(e){var t=Zj({},e);return t.temperature===Ew.temperature.default&&delete t.temperature,t.maxOutputTokens===Ew.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Ew.topP.default&&delete t.topP,t.topK===Ew.topK.default&&delete t.topK,Bw(t)})).catch((function(){return{}})),Fw.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return Bw(e)})).catch((function(){return{}})),Vw.transform((function(e){var t,n=Zj({},e);return null===n.modelLabel&&delete n.modelLabel,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&n.agentOptions.agent===ww.functions&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,Bw(n)})).catch((function(){return{}})),mo({bannerId:po(),message:po(),displayFrom:po(),displayTo:po(),createdAt:po(),updatedAt:po(),isPublic:go()}),Fw.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return Bw(e)})).catch((function(){return{}}));var $w,Hw,Gw=mo({name:po(),label:po(),preset:zw,order:vo().optional(),default:go().optional(),description:po().optional(),showIconInMenu:go().optional(),showIconInHeader:go().optional(),iconURL:ho([po(),Tw]).optional(),authType:vw.optional()}),Kw=mo({enforce:go().default(!1),prioritize:go().default(!0),list:xo(Gw).min(1),addedEndpoints:xo(ho([po(),Tw])).optional()});($w={})[mw.openAI]=!0,$w[mw.google]=!0,$w[mw.assistants]=!0,$w[mw.azureAssistants]=!0,$w[mw.agents]=!0,$w[mw.azureOpenAI]=!0,$w[mw.anthropic]=!0,$w[mw.custom]=!0,$w[mw.bedrock]=!0;var Ww=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];nw(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip","image/svg","image/svg+xml"],Ww,!0),nw(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],Ww,!0);var qw=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/,/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,/^(application\/(epub\+zip|csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,/^image\/(jpeg|gif|png|webp|heic|heif)$/,/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|x-m4a|flac|x-flac|webm)$/,/^image\/(svg|svg\+xml)$/],Qw=536870912,Yw={fileLimit:10,fileSizeLimit:Qw,totalSizeLimit:Qw,supportedMimeTypes:qw,disabled:!1};(Hw={})[mw.assistants]=Yw,Hw[mw.azureAssistants]=Yw,Hw[mw.agents]=Yw,Hw.default={fileLimit:10,fileSizeLimit:Qw,totalSizeLimit:Qw,supportedMimeTypes:qw,disabled:!1};var Xw,Zw,Jw,eN,tN,nN=xo(No()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),sN=mo({disabled:go().optional(),fileLimit:vo().min(0).optional(),fileSizeLimit:vo().min(0).optional(),totalSizeLimit:vo().min(0).optional(),supportedMimeTypes:nN.optional()}),aN=mo({endpoints:jo(sN).optional(),serverFileSizeLimit:vo().min(0).optional(),avatarSizeLimit:vo().min(0).optional(),fileTokenLimit:vo().min(0).optional(),imageGeneration:mo({percentage:vo().min(0).max(100).optional(),px:vo().min(0).optional()}).optional(),clientImageResize:mo({enabled:go().optional(),maxWidth:vo().min(0).optional(),maxHeight:vo().min(0).optional(),quality:vo().min(0).max(1).optional()}).optional(),ocr:mo({supportedMimeTypes:nN.optional()}).optional(),text:mo({supportedMimeTypes:nN.optional()}).optional()});!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(Xw||(Xw={})),function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(Zw||(Zw={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(Jw||(Jw={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(eN||(eN={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(tN||(tN={}));var rN=/^\${(.+)}$/;function oN(e){if(!e)return e;var t=e.trim(),n=t.match(rN);if(n){var s=n[1];return Xj[s]||t}for(var a,r=/\${([^}]+)}/g,o=t,i=[];null!==(a=r.exec(t));)i.push({fullMatch:a[0],varName:a[1],index:a.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(s=c.varName,c.index),m=Xj[s]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}var iN=mo({startup:go().optional(),iconPath:po().optional(),timeout:vo().optional(),initTimeout:vo().optional(),chatMenu:go().optional(),serverInstructions:ho([go(),po()]).optional(),requiresOAuth:go().optional(),oauth:mo({authorization_url:po().url().optional(),token_url:po().url().optional(),client_id:po().optional(),client_secret:po().optional(),scope:po().optional(),redirect_uri:po().url().optional(),token_exchange_method:fo(tN).optional(),grant_types_supported:xo(po()).optional(),token_endpoint_auth_methods_supported:xo(po()).optional(),response_types_supported:xo(po()).optional(),code_challenge_methods_supported:xo(po()).optional()}).optional(),customUserVars:jo(po(),mo({title:po(),description:po()})).optional()}),lN=iN.extend({type:bo("stdio").optional(),command:po(),args:xo(po()),env:jo(po(),po()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,s=Object.entries(e);n<s.length;n++){var a=s[n],r=a[0],o=a[1];t[r]=oN(o)}return t})),stderr:No().optional()}),cN=iN.extend({type:bo("websocket").optional(),url:po().transform((function(e){return oN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),dN=iN.extend({type:bo("sse").optional(),headers:jo(po(),po()).optional(),url:po().transform((function(e){return oN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),uN=iN.extend({type:ho([bo("streamable-http"),bo("http")]),headers:jo(po(),po()).optional(),url:po().transform((function(e){return oN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),mN=ho([lN,cN,dN,uN]),pN=jo(po(),mN),fN="";if(void 0===xe||!0===xe.browser){var hN=document.querySelector("base");fN=(null==hN?void 0:hN.getAttribute("href"))||"/"}fN&&fN.endsWith("/")&&(fN=fN.slice(0,-1));var gN,xN,vN,bN,_N,yN,jN,wN,NN,CN=function(){return fN},kN="".concat(fN,"/api/messages"),SN=function(e){var t,n,s=e.conversationId,a=e.messageId,r=Jj(e,["conversationId","messageId"]);return s&&a?"".concat(kN,"/").concat(s,"/").concat(a):s?"".concat(kN,"/").concat(s):"".concat(kN).concat((t=r,(n=Object.entries(t).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&"))?"?".concat(n):""))},EN="".concat(fN,"/api/share"),TN="".concat(fN,"/api/keys"),IN="".concat(fN,"/api/convos");!function(e){e.default="default",e.advanced="advanced"}(NN||(NN={}));var RN,PN,AN=fo(Xw),MN=mo({default:AN.optional(),avatar:AN.optional(),image:AN.optional(),document:AN.optional()}).optional(),LN=mo({deploymentName:po().optional(),version:po().optional(),assistants:go().optional()}).or(go()),ON=mo({apiKey:po(),serverless:go().optional(),instanceName:po().optional(),deploymentName:po().optional(),assistants:go().optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),forcePrompt:go().optional(),version:po().optional(),baseURL:po().optional(),additionalHeaders:jo(No()).optional()}),DN=mo({group:po(),models:jo(po(),LN)}).required().and(ON),FN=xo(DN).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(RN||(RN={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.tools="tools",e.chain="chain",e.ocr="ocr"}(PN||(PN={})),(gN={})[mw.assistants]=2,gN[mw.azureAssistants]=1;var zN=mo({streamRate:vo().optional(),baseURL:po().optional(),titlePrompt:po().optional(),titleModel:po().optional(),titleConvo:go().optional(),titleMethod:ho([bo("completion"),bo("functions"),bo("structured")]).optional(),titleEndpoint:po().optional(),titlePromptTemplate:po().optional()});zN.merge(mo({availableRegions:xo(po()).optional()}));var UN,VN=zN.merge(mo({disableBuilder:go().optional(),pollIntervalMs:vo().optional(),timeoutMs:vo().optional(),version:ho([po(),vo()]).default(2),supportedIds:xo(po()).min(1).optional(),excludedIds:xo(po()).min(1).optional(),privateAssistants:go().optional(),retrievalModels:xo(po()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:xo(fo(RN)).optional().default([RN.code_interpreter,RN.image_vision,RN.retrieval,RN.actions,RN.tools]),apiKey:po().optional(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}).optional(),headers:jo(No()).optional()})),BN=[PN.execute_code,PN.file_search,PN.web_search,PN.artifacts,PN.actions,PN.tools,PN.chain,PN.ocr],$N=zN.merge(mo({recursionLimit:vo().optional(),disableBuilder:go().optional().default(!1),maxRecursionLimit:vo().optional(),maxCitations:vo().min(1).max(50).optional().default(30),maxCitationsPerFile:vo().min(1).max(10).optional().default(7),minRelevanceScore:vo().min(0).max(1).optional().default(.45),allowedProviders:xo(ho([po(),Tw])).optional(),capabilities:xo(fo(PN)).optional().default(BN)})).default({disableBuilder:!1,capabilities:BN,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),HN=zN.merge(mo({name:po().refine((function(e){return!Tw.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(mw).join(", "))}),apiKey:po(),baseURL:po(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}),summarize:go().optional(),summaryModel:po().optional(),iconURL:po().optional(),forcePrompt:go().optional(),modelDisplayLabel:po().optional(),headers:jo(No()).optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),customParams:mo({defaultParamsEndpoint:po().default("custom"),paramDefinitions:xo(jo(No())).optional()}).strict(),customOrder:vo().optional(),directEndpoint:go().optional(),titleMessageRole:po().optional()})),GN=mo({groups:FN,plugins:go().optional(),assistants:go().optional()}).and(HN.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),KN=mo({url:po().optional(),apiKey:po(),model:po(),voices:xo(po())}),WN=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po(),model:po(),voices:xo(po())}),qN=mo({url:po().optional(),websocketUrl:po().optional(),apiKey:po(),model:po(),voices:xo(po()),voice_settings:mo({similarity_boost:vo().optional(),stability:vo().optional(),style:vo().optional(),use_speaker_boost:go().optional()}).optional(),pronunciation_dictionary_locators:xo(po()).optional()}),QN=mo({url:po(),apiKey:po().optional(),voices:xo(po()),backend:po()}),YN=mo({openai:KN.optional(),azureOpenAI:WN.optional(),elevenlabs:qN.optional(),localai:QN.optional()}),XN=mo({url:po().optional(),apiKey:po(),model:po()}),ZN=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po()}),JN=mo({openai:XN.optional(),azureOpenAI:ZN.optional()}),eC=mo({conversationMode:go().optional(),advancedMode:go().optional(),speechToText:go().optional().or(mo({engineSTT:po().optional(),languageSTT:po().optional(),autoTranscribeAudio:go().optional(),decibelValue:vo().optional(),autoSendText:vo().optional()})).optional(),textToSpeech:go().optional().or(mo({engineTTS:po().optional(),voice:po().optional(),languageTTS:po().optional(),automaticPlayback:go().optional(),playbackRate:vo().optional(),cacheTTS:go().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(UN||(UN={}));var tC,nC=mo({fileUploads:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),conversationsImport:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),tts:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),stt:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(tC||(tC={}));var sC,aC,rC,oC,iC,lC,cC=mo({externalUrl:po().optional(),openNewTab:go().optional(),modalAcceptance:go().optional(),modalTitle:po().optional(),modalContent:po().or(xo(po())).optional()}),dC=mo({placeholder:po().optional()}),uC=mo({privacyPolicy:mo({externalUrl:po().optional(),openNewTab:go().optional()}).optional(),termsOfService:cC.optional(),customWelcome:po().optional(),mcpServers:dC.optional(),endpointsMenu:go().optional(),modelSelect:go().optional(),parameters:go().optional(),sidePanel:go().optional(),multiConvo:go().optional(),bookmarks:go().optional(),memories:go().optional(),presets:go().optional(),prompts:go().optional(),agents:go().optional(),temporaryChat:go().optional(),temporaryChatRetention:vo().min(1).max(8760).optional(),runCode:go().optional(),webSearch:go().optional(),peoplePicker:mo({users:go().optional(),groups:go().optional(),roles:go().optional()}).optional(),marketplace:mo({use:go().optional()}).optional(),fileSearch:go().optional(),fileCitations:go().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},fileSearch:!0,fileCitations:!0}),mC=mo({language:po().default("auto"),size:uo(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),pC=mo({siteKey:po(),options:mC.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(sC||(sC={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}(aC||(aC={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(rC||(rC={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(oC||(oC={})),function(e){e.JINA="jina",e.COHERE="cohere"}(iC||(iC={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(lC||(lC={}));var fC,hC,gC=mo({serperApiKey:po().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:po().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:po().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:po().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:po().optional().default("${FIRECRAWL_API_URL}"),jinaApiKey:po().optional().default("${JINA_API_KEY}"),jinaApiUrl:po().optional().default("${JINA_API_URL}"),cohereApiKey:po().optional().default("${COHERE_API_KEY}"),searchProvider:fo(rC).optional(),scraperType:fo(oC).optional(),rerankerType:fo(iC).optional(),scraperTimeout:vo().optional(),safeSearch:fo(lC).default(lC.MODERATE),firecrawlOptions:mo({formats:xo(po()).optional(),includeTags:xo(po()).optional(),excludeTags:xo(po()).optional(),headers:jo(po()).optional(),waitFor:vo().optional(),timeout:vo().optional(),maxAge:vo().optional(),mobile:go().optional(),skipTlsVerification:go().optional(),blockAds:go().optional(),removeBase64Images:go().optional(),parsePDF:go().optional(),storeInCache:go().optional(),zeroDataRetention:go().optional(),location:mo({country:po().optional(),languages:xo(po()).optional()}).optional(),onlyMainContent:go().optional(),changeTrackingOptions:mo({modes:xo(po()).optional(),schema:jo(wo()).optional(),prompt:po().optional(),tag:po().nullable().optional()}).optional()}).optional()}),xC=mo({mistralModel:po().optional(),apiKey:po().optional().default("${OCR_API_KEY}"),baseURL:po().optional().default("${OCR_BASEURL}"),strategy:fo(sC).default(sC.MISTRAL_OCR)}),vC=mo({enabled:go().optional().default(!1),startBalance:vo().optional().default(2e4),autoRefillEnabled:go().optional().default(!1),refillIntervalValue:vo().optional().default(30),refillIntervalUnit:uo(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:vo().optional().default(1e4)}),bC=mo({enabled:go().optional().default(!0)}),_C=mo({disabled:go().optional(),validKeys:xo(po()).optional(),tokenLimit:vo().optional(),charLimit:vo().optional().default(1e4),personalize:go().default(!0),messageWindowSize:vo().optional().default(5),agent:ho([mo({id:po()}),mo({provider:po(),model:po(),instructions:po().optional(),model_parameters:jo(No()).optional()})]).optional()}),yC=xo(HN.partial()).optional();mo({version:po(),cache:go().default(!0),ocr:xC.optional(),webSearch:gC.optional(),memory:_C.optional(),secureImageLinks:go().optional(),imageOutputType:fo(tC).default(tC.PNG),includedTools:xo(po()).optional(),filteredTools:xo(po()).optional(),mcpServers:pN.optional(),interface:uC,turnstile:pC.optional(),fileStrategy:AN.default(Xw.local),fileStrategies:MN,actions:mo({allowedDomains:xo(po()).optional()}).optional(),registration:mo({socialLogins:xo(po()).optional(),allowedDomains:xo(po()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:vC.optional(),transactions:bC.optional(),speech:mo({tts:YN.optional(),stt:JN.optional(),speechTab:eC.optional()}).optional(),rateLimits:nC.optional(),fileConfig:aN.optional(),modelSpecs:Kw.optional(),endpoints:mo((xN={all:zN.optional()},xN[mw.openAI]=zN.optional(),xN[mw.google]=zN.optional(),xN[mw.anthropic]=zN.optional(),xN[mw.gptPlugins]=zN.optional(),xN[mw.azureOpenAI]=GN.optional(),xN[mw.azureAssistants]=VN.optional(),xN[mw.assistants]=VN.optional(),xN[mw.agents]=$N.optional(),xN[mw.custom]=yC.optional(),xN[mw.bedrock]=zN.optional(),xN)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.xai="xai"}(fC||(fC={})),(hC||(hC={})).openrouter="openrouter",mw.openAI,mw.assistants,mw.azureAssistants,mw.azureOpenAI,mw.agents,mw.chatGPTBrowser,mw.gptPlugins,mw.google,mw.anthropic,mw.custom,mw.bedrock,(vN={})[mw.openAI]="OpenAI",vN[mw.assistants]="Assistants",vN[mw.agents]="My Agents",vN[mw.azureAssistants]="Azure Assistants",vN[mw.azureOpenAI]="Azure OpenAI",vN[mw.chatGPTBrowser]="ChatGPT",vN[mw.gptPlugins]="Plugins",vN[mw.google]="Google",vN[mw.anthropic]="Anthropic",vN[mw.custom]="Custom",vN[mw.bedrock]="AWS Bedrock",vN[fC.ollama]="Ollama",vN[fC.deepseek]="DeepSeek",vN[fC.xai]="xAI";var jC,wC,NC,CC,kC,SC,EC,TC,IC,RC,PC,AC,MC,LC,OC,DC,FC=["gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],zC=((bN={})[mw.azureAssistants]=FC,bN[mw.assistants]=nw(nw([],FC,!0),["chatgpt-4o-latest"],!1),bN[mw.agents]=FC,bN[mw.google]=["gemini-2.0-flash-001","gemini-2.0-flash-exp","gemini-2.0-flash-lite","gemini-2.0-pro-exp-02-05","gemini-1.5-flash-001","gemini-1.5-flash-002","gemini-1.5-pro-001","gemini-1.5-pro-002","gemini-1.0-pro-001"],bN[mw.anthropic]=["claude-sonnet-4-20250514","claude-sonnet-4-latest","claude-opus-4-20250514","claude-opus-4-latest","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],bN[mw.openAI]=nw(nw([],FC,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),bN[mw.bedrock]=["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],bN),UC=zC[mw.openAI],VC=((_N={initial:[]})[mw.openAI]=UC,_N[mw.assistants]=UC.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),_N[mw.agents]=UC,_N[mw.gptPlugins]=UC,_N[mw.azureOpenAI]=UC,_N[mw.chatGPTBrowser]=["text-davinci-002-render-sha"],_N[mw.google]=zC[mw.google],_N[mw.anthropic]=zC[mw.anthropic],_N[mw.bedrock]=zC[mw.bedrock],_N);function BC(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}(yN={})[mw.assistants]="".concat(CN(),"/api/assistants/v2/chat"),yN[mw.azureAssistants]="".concat(CN(),"/api/assistants/v1/chat"),yN[mw.agents]="".concat(CN(),"/api/").concat(mw.agents,"/chat"),mw.gptPlugins,mw.anthropic,mw.google,mw.openAI,mw.azureOpenAI,mw.custom,mw.agents,mw.bedrock,(jN={})[mw.custom]=!0,jN[mw.openAI]=!0,jN[mw.anthropic]=!0,jN[mw.gptPlugins]=!0,jN[mw.assistants]=!0,jN[mw.agents]=!0,jN[mw.azureAssistants]=!0,jN[mw.azureOpenAI]=!0,jN[mw.bedrock]=!0,function(e){e.generative="generative",e.agents="agents"}(jC||(jC={})),function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(wC||(wC={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(NC||(NC={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.PLUGINS="PLUGINS",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.LIBRECHAT_YAML_CONFIG="LIBRECHAT_YAML_CONFIG",e.STATIC_CONFIG="STATIC_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(CC||(CC={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(kC||(kC={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed"}(SC||(SC={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(EC||(EC={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(TC||(TC={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(IC||(IC={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(RC||(RC={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}(PC||(PC={})),function(e){e.VERSION="v0.8.0-rc3",e.CONFIG_VERSION="1.2.8",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_server="sys__server__sys",e.EPHEMERAL_AGENT_ID="ephemeral"}(AC||(AC={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(MC||(MC={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(LC||(LC={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(OC||(OC={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(DC||(DC={})),(wN={})[mw.openAI]=mw.openAI,wN[mw.bedrock]=mw.bedrock,wN[mw.anthropic]=mw.anthropic,wN[mw.azureOpenAI]=mw.azureOpenAI;var $C=!1,HC=[],GC=function(e){return BC((t=e,"".concat(fN,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},KC=function(e){var t;t=e,co.defaults.headers.common.Authorization="Bearer "+t,window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},WC=function(e,t){void 0===t&&(t=null),HC.forEach((function(n){e?n.reject(e):n.resolve(t)})),HC=[]};co.interceptors.response.use((function(e){return e}),(function(e){return ew(void 0,0,void 0,(function(){var t,n,s,a,r,o,i,l,c;return tw(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!$C)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){HC.push({resolve:e,reject:t})}))];case 2:return a=d.sent(),t.headers.Authorization="Bearer "+a,[4,co(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:$C=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,GC(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return s=d.sent(),(a=null!==(c=null==s?void 0:s.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+a,KC(a),WC(null,a),[4,co(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href="/login",d.label=10;case 10:return[3,13];case 11:return r=d.sent(),WC(r,null),[2,Promise.reject(r)];case 12:return $C=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var qC={get:function(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.get(e,Zj({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.get(e,Zj({},t))];case 1:return[2,n.sent()]}}))}))},post:BC,postMultiPart:function(e,t,n){return ew(this,0,void 0,(function(){return tw(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,Zj(Zj({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,s.sent().data]}}))}))},postTTS:function(e,t,n){return ew(this,0,void 0,(function(){return tw(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,Zj(Zj({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,s.sent().data]}}))}))},put:function(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return ew(this,0,void 0,(function(){return tw(this,(function(t){switch(t.label){case 0:return[4,co.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.delete(e,Zj({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return ew(this,0,void 0,(function(){return tw(this,(function(n){switch(n.label){case 0:return[4,co.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:GC,dispatchTokenUpdatedEvent:KC};var QC,YC,XC,ZC,JC,ek,tk,nk=function(){return qC.get("".concat("".concat("".concat(fN,"/api/files"),"/speech"),"/config/get"))};!function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken"}(QC||(QC={})),function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}(YC||(YC={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(XC||(XC={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(ZC||(ZC={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup"}(JC||(JC={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(ek||(ek={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner"}(tk||(tk={}));var sk=mo({type:fo(XC),id:po().optional(),name:po().optional(),email:po().optional(),source:uo(["local","entra"]).optional(),avatar:po().optional(),description:po().optional(),idOnTheSource:po().optional(),accessRoleId:fo(tk).optional(),memberCount:vo().optional()}),ak=mo({accessRoleId:fo(tk),name:po(),description:po().optional(),resourceType:fo(JC).default(JC.AGENT),permBits:vo()}),rk=mo({id:po(),principalType:fo(XC),principalId:po().optional(),principalName:po().optional(),role:ak,grantedBy:po(),grantedAt:po(),inheritedFrom:po().optional(),source:uo(["local","entra"]).optional()});mo({resourceType:fo(JC),resourceId:po(),permissions:xo(rk)}),mo({updated:sk.array(),removed:sk.array(),public:go(),publicAccessRoleId:po().optional()}),mo({message:po(),results:mo({principals:sk.array(),public:go(),publicAccessRoleId:po().optional()})}),mo({resourceType:fo(JC),resourceId:fo(tk),principals:xo(sk),public:go(),publicAccessRoleId:fo(tk).optional()}),mo({permissionBits:vo()});var ok=function(e,t){return mr([QC.sharedMessages,e],(function(){return function(e){return qC.get((t=e,"".concat(EN,"/").concat(t)));var t}(e)}),Zj({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},t))},ik=function(e,t){var n=pr();return mr([QC.sharedLinks,e],(function(){return function(e){return qC.get((t=e,"".concat(EN,"/link/").concat(t)));var t}(e)}),Zj({enabled:!!e&&e!==AC.NEW_CONVO&&e!==AC.PENDING_CONVO,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,onSuccess:function(t){n.setQueryData([QC.sharedLinks,e],{conversationId:t.conversationId,shareId:t.shareId})}},t))},lk=function(){var e=pr();return fr((function(e){return function(e){if(!e.value)throw new Error("value is required");return qC.put(TN,e)}(e)}),{onSuccess:function(t,n){e.invalidateQueries([QC.name,n.name])}})},ck=function(){var e=pr();return fr((function(){return qC.delete("".concat(IN,"/all"))}),{onSuccess:function(){e.invalidateQueries([QC.allConversations])}})},dk=function(e){var t=pr();return fr((function(){return function(e){return qC.delete((t=e,"".concat(TN,"/").concat(t)));var t}(e)}),{onSuccess:function(){var n,s;t.invalidateQueries([QC.name,e]),(s=null!=(n=e)?n:"")&&s.toLowerCase().endsWith(mw.assistants)&&(t.invalidateQueries([QC.assistants,e,aw]),t.invalidateQueries([QC.assistantDocs]),t.invalidateQueries([QC.assistants]),t.invalidateQueries([QC.assistant]),t.invalidateQueries([QC.actions]),t.invalidateQueries([QC.tools]))}})},uk=function(){var e=pr();return fr((function(){return qC.delete("".concat(TN,"?all=true"))}),{onSuccess:function(){e.invalidateQueries([QC.name]),e.invalidateQueries([QC.assistants,mw.assistants,aw]),e.invalidateQueries([QC.assistants,mw.azureAssistants,aw]),e.invalidateQueries([QC.assistantDocs]),e.invalidateQueries([QC.assistants]),e.invalidateQueries([QC.assistant]),e.invalidateQueries([QC.actions]),e.invalidateQueries([QC.tools])}})},mk=function(e){return mr([QC.models],(function(){return ew(void 0,0,void 0,(function(){return tw(this,(function(e){return[2,qC.get("".concat(fN,"/api/models"))]}))}))}),Zj({initialData:VC,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1/0},e))},pk=function(){var e=pr();return fr((function(e){return function(e){return qC.post("".concat(fN,"/api/presets"),e)}(e)}),{onSuccess:function(){e.invalidateQueries([QC.presets])}})},fk=function(e){var t=pr();return fr((function(e){return function(e){return qC.post("".concat(fN,"/api/auth/register"),e)}(e)}),Zj(Zj({},e),{onSuccess:function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];t.invalidateQueries([QC.user]),(null==e?void 0:e.onSuccess)&&e.onSuccess.apply(e,n)}}))},hk=function(e,t){return mr([QC.name,e],(function(){return e?function(e){return qC.get((t=e,"".concat(TN,"?name=").concat(t)));var t}(e):Promise.resolve({expiresAt:""})}),Zj({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},t))},gk=function(){return fr((function(e){return function(e){return qC.post("".concat(fN,"/api/auth/requestPasswordReset"),e)}(e)}))},xk=function(){return fr((function(e){return function(e){return qC.post("".concat(fN,"/api/auth/resetPassword"),e)}(e)}))},vk=function(e){return mr([QC.availablePlugins],(function(){return qC.get("".concat(fN,"/api/plugins"))}),Zj({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},bk=function(e){var t=pr(),n=null!=e?e:{},s=n.onSuccess,a=Jj(n,["onSuccess"]);return fr((function(e){return function(e){return qC.post("".concat(fN,"/api/user/plugins"),e)}(e)}),Zj(Zj({},a),{onSuccess:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.invalidateQueries([QC.user]),null==s||s.apply(void 0,e)}}))},_k=function(){var e=pr();return fr((function(e){return function(e){return qC.post((t=e,"".concat(fN,"/api/mcp/").concat(t,"/reinitialize")));var t}(e)}),{onSuccess:function(){e.refetchQueries([QC.tools])}})},yk=function(){var e=pr();return fr((function(e){return function(e){return qC.post((t=e,"".concat(fN,"/api/mcp/oauth/cancel/").concat(t)),{});var t}(e)}),{onSuccess:function(){e.invalidateQueries([QC.mcpConnectionStatus])}})},jk=function(e){return mr([QC.customConfigSpeech],(function(){return nk()}),Zj({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},wk=function(e,t){var n=pr();return fr((function(n){return function(e,t,n){return qC.put((s=e,a=t,"".concat(fN,"/api/messages/").concat(s,"/").concat(a,"/feedback")),n);var s,a}(e,t,n)}),{onSuccess:function(){n.invalidateQueries([QC.messages,t])}})},Nk=function(e,t){return mr([QC.principalSearch,e],(function(){return function(e){return qC.get((n=(t=e).q,s=t.limit,a=t.types,r="".concat(fN,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==s&&(r+="&limit=".concat(s)),a&&a.length>0&&(r+="&types=".concat(a.join(","))),r));var t,n,s,a,r}(e)}),Zj({enabled:!!e.q&&e.q.length>=2,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e4},t))},Ck=function(e,t){return mr([QC.accessRoles,e],(function(){return function(e){return qC.get((t=e,"".concat(fN,"/api/permissions/").concat(t,"/roles")));var t}(e)}),Zj({enabled:!!e,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5},t))},kk=function(e,t,n){return mr([QC.resourcePermissions,e,t],(function(){return function(e,t){return qC.get((n=e,s=t,"".concat(fN,"/api/permissions/").concat(n,"/").concat(s)));var n,s}(e,t)}),Zj({enabled:!!e&&!!t,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:12e4},n))},Sk=function(){var e=pr();return fr({mutationFn:function(e){return function(e,t,n){return qC.put((s=e,a=t,"".concat(fN,"/api/permissions/").concat(s,"/").concat(a)),n);var s,a}(e.resourceType,e.resourceId,e.data)},onSuccess:function(t,n){e.invalidateQueries({queryKey:[QC.accessRoles,n.resourceType]}),e.invalidateQueries({queryKey:[QC.resourcePermissions,n.resourceType,n.resourceId]}),e.invalidateQueries({queryKey:[QC.effectivePermissions,n.resourceType,n.resourceId]})}})},Ek=function(e,t,n){return mr(Zj({queryKey:[QC.effectivePermissions,e,t],queryFn:function(){return function(e,t){return qC.get((n=e,s=t,"".concat(fN,"/api/permissions/").concat(n,"/").concat(s,"/effective")));var n,s}(e,t)},enabled:!!e&&!!t,refetchOnWindowFocus:!1,staleTime:3e4},n))};const Tk=new Set(["spec","iconURL"]),Ik=()=>{const{data:e={}}=Gy(),{data:t={}}=mk();return({conversation:n,preset:s,cleanInput:a,cleanOutput:r})=>{const o=l_({convoSetup:s,endpointsConfig:e}),i=t[o??""]||[],l={...n};if(!0===a)for(const e in l)ff.has(e)&&!Tk.has(e)||null!=l[e]&&(l[e]=void 0);const c=i_({conversation:l,endpoint:o,lastConversationSetup:s,models:i});if(!r)return c;for(const e in c)ff.has(e)&&!Tk.has(e)||null!=c[e]&&(c[e]=void 0);return c}},Rk=n.createContext({}),Pk=()=>n.useContext(Rk),Ak=e=>e.data.map((({id:e,name:t,metadata:n,model:s})=>({id:e,name:t??"",metadata:n,model:s})));function Mk(e=Ak){const{data:t=null}=gj(Uu.assistants,void 0,{select:e}),{data:s=null}=gj(Uu.azureAssistants,void 0,{select:e});return n.useMemo((()=>({[Uu.assistants]:t,[Uu.azureAssistants]:s})),[t,s])}function Lk({isAuthenticated:e}){const{data:t=null}=Ry({requiredPermission:px.VIEW},{select:e=>function(e){const t={};for(const n of e)t[n.id]=n;return t}(e.data),enabled:e});return n.useMemo((()=>null!==t?t:void 0),[t])}const Ok=n.createContext({}),Dk=()=>n.useContext(Ok);function Fk(){const e=Ae(Ny.lang),{t:t,i18n:s}=lo();return n.useEffect((()=>{s.language!==e&&s.changeLanguage(e)}),[e,s]),(e,n)=>t(e,n)}const zk="",Uk="com_ui_agent_category_general",Vk=()=>{const e=Fk(),t=My({staleTime:9e5});return{categories:n.useMemo((()=>t.data?t.data.filter((e=>"promoted"!==e.value&&"all"!==e.value)).map((e=>({label:e.label||e.value,value:e.value,className:"w-full"}))):[]),[t.data]),emptyCategory:n.useMemo((()=>({label:e(Uk),value:zk,className:"w-full"})),[e]),isLoading:t.isLoading,error:t.error}};function Bk(e){const t=n.useMemo((()=>(null==e?void 0:e.includes(vf.tools))??!1),[e]),s=n.useMemo((()=>(null==e?void 0:e.includes(vf.actions))??!1),[e]),a=n.useMemo((()=>(null==e?void 0:e.includes(vf.artifacts))??!1),[e]),r=n.useMemo((()=>(null==e?void 0:e.includes(vf.ocr))??!1),[e]),o=n.useMemo((()=>(null==e?void 0:e.includes(vf.file_search))??!1),[e]),i=n.useMemo((()=>(null==e?void 0:e.includes(vf.web_search))??!1),[e]);return{ocrEnabled:r,codeEnabled:n.useMemo((()=>(null==e?void 0:e.includes(vf.execute_code))??!1),[e]),toolsEnabled:t,actionsEnabled:s,artifactsEnabled:a,webSearchEnabled:i,fileSearchEnabled:o}}function $k(e){const{endpointsConfig:t}={},{data:s}=Gy({enabled:!t}),a=t||s;return{agentsConfig:n.useMemo((()=>{const e=(null==a?void 0:a[Uu.agents])??null;return e?{...e,capabilities:Array.isArray(e.capabilities)?e.capabilities.map((e=>e)):[]}:null}),[a]),endpointsConfig:a}}const Hk=n.createContext(void 0),Gk=({authConfig:e,children:t})=>{const[a,r]=Re(Ny.user),[o,i]=n.useState(void 0),[l,c]=n.useState(void 0),[d,u]=n.useState(!1),m=n.useRef(void 0),{data:p=null}=zj(Qg.USER,{enabled:!(!d||!(null==a?void 0:a.role))}),{data:f=null}=zj(Qg.ADMIN,{enabled:!(!d||(null==a?void 0:a.role)!==Qg.ADMIN)}),h=Fe(),g=n.useMemo((()=>So.debounce((e=>{const{token:t,isAuthenticated:n,user:s,redirect:a}=e;r(s),i(t),wx(t),u(n);const o=m.current||a;m.current=void 0,null!=o&&(o.startsWith("http://")||o.startsWith("https://")?window.location.href=o:h(o,{replace:!0}))}),50)),[h,r]),x=function({callback:e,delay:t=400}){const s=n.useRef(null);return n.useEffect((()=>()=>{null!==s.current&&clearTimeout(s.current)}),[]),n=>{null!==s.current&&clearTimeout(s.current),null!=n&&n&&(console.log(n),s.current=setTimeout((()=>{e(n)}),t))}}({callback:e=>c(e)}),v=(e=>{const t=pr(),n=Ey(),s=Oe(Ny.defaultPreset),a=Pe(Ny.queriesEnabled);return fr([yx.loginUser],{mutationFn:e=>Rx.login(e),...e||{},onMutate:a=>{var r;s(),n(),t.removeQueries(),null==(r=null==e?void 0:e.onMutate)||r.call(e,a)},onSuccess:(...t)=>{var n;a(!0),null==(n=null==e?void 0:e.onSuccess)||n.call(e,...t)}})})({onSuccess:e=>{const{user:t,token:n,twoFAPending:s,tempToken:a}=e;s?h(`/login/2fa?tempToken=${a}`,{replace:!0}):(c(void 0),g({token:n,isAuthenticated:!0,user:t,redirect:"/c/new"}))},onError:e=>{x(e.message),h("/login",{replace:!0})}}),b=(e=>{const t=pr(),n=Ey(),s=Oe(Ny.defaultPreset),a=Pe(Ny.queriesEnabled);return fr([yx.logoutUser],{mutationFn:()=>Rx.logout(),...e||{},onSuccess:(...r)=>{var o;a(!1),s(),n(),t.removeQueries(),null==(o=null==e?void 0:e.onSuccess)||o.call(e,...r)}})})({onSuccess:e=>{g({token:void 0,isAuthenticated:!1,user:void 0,redirect:e.redirect??"/login"})},onError:e=>{x(e.message),g({token:void 0,isAuthenticated:!1,user:void 0,redirect:"/login"})}}),_=(e=>{const t=pr();return fr([yx.refreshToken],{mutationFn:()=>Ix.refreshToken(),onMutate:e=>{t.removeQueries()}})})(),y=n.useCallback((e=>{e&&(m.current=e),b.mutate(void 0)}),[b]),j=ky({enabled:!!o}),w=e=>{v.mutate(e)},N=n.useCallback((()=>{!0!==(null==e?void 0:e.test)?_.mutate(void 0,{onSuccess:t=>{const{user:n,token:s=""}=t??{};if(s)g({token:s,isAuthenticated:!0,user:n});else{if(console.log("Token is not present. User is not authenticated."),!0===(null==e?void 0:e.test))return;h("/login")}},onError:t=>{console.log("refreshToken mutation error:",t),!0!==(null==e?void 0:e.test)&&h("/login")}}):console.log("Test mode. Skipping silent refresh.")}),[]);n.useEffect((()=>{j.data?r(j.data):j.isError&&(x(j.error.message),h("/login",{replace:!0})),null!=l&&l&&d&&x(void 0),null!=o&&o&&d||N()}),[o,d,j.data,j.isError,j.error,l,r,h,N,g]),n.useEffect((()=>{const e=e=>{console.log("tokenUpdated event received event");const t=e.detail;g({token:t,isAuthenticated:!0,user:a})};return window.addEventListener("tokenUpdated",e),()=>{window.removeEventListener("tokenUpdated",e)}}),[g,a]);const C=n.useMemo((()=>({user:a,token:o,error:l,login:w,logout:y,setError:c,roles:{[Qg.USER]:p,[Qg.ADMIN]:f},isAuthenticated:d})),[a,l,d,o,p,f]);return s.jsx(Hk.Provider,{value:C,children:t})},Kk=()=>{const e=n.useContext(Hk);if(void 0===e)throw new Error("useAuthContext should be used inside AuthProvider");return e},Wk=({permissionType:e,permission:t})=>{const s=n.useContext(Hk),a=null==s?void 0:s.user,r=null==s?void 0:s.roles,o=(null==s?void 0:s.isAuthenticated)||!1,i=n.useCallback((({user:e,permissionType:t,permission:n})=>{var a,i,l;return!!s&&(!!(o&&null!=(null==e?void 0:e.role)&&r&&r[e.role])&&!0===(null==(l=null==(i=null==(a=r[e.role])?void 0:a.permissions)?void 0:i[t])?void 0:l[n]))}),[s,o,r]);return n.useMemo((()=>i({user:a,permissionType:e,permission:t})),[a,e,t,i])},qk=()=>Wk({permissionType:hg.MARKETPLACE,permission:gg.USE})?px.EDIT:px.VIEW;n.createContext({}),n.createContext({});const Qk=n.createContext(void 0);function Yk({children:e,defaultActive:t}){const[a,r]=n.useState(t);return s.jsx(Qk.Provider,{value:{active:a,setActive:e=>{localStorage.setItem("side:active-panel",e),r(e)}},children:e})}const Xk=n.createContext(void 0);function Zk(){const e=n.useContext(Xk);if(void 0===e)throw new Error("useAgentPanelContext must be used within an AgentPanelProvider");return e}function Jk({children:e}){const t=Fk(),[a,r]=n.useState(void 0),[o,i]=n.useState(void 0),[l,c]=n.useState(void 0),[d,u]=n.useState(Xd.builder),[m,p]=n.useState(void 0),{data:f}=xj(Uu.agents,{enabled:!!m}),{data:h}=hj(Uu.agents,{enabled:!!m}),{data:g}=Ky(),x=n.useMemo((()=>Object.keys((null==g?void 0:g.mcpServers)??{})),[g]),{connectionStatus:v}=OE({enabled:!!m&&x.length>0}),b=n.useMemo((()=>{var e,n;if(!h)return{tools:[],groupedTools:{},mcpServersMap:new Map};const s=[],a={},r=new Set(x),o=new Map;for(const i of h){const n={tool_id:i.pluginKey,metadata:i};if(s.push(n),n.tool_id.includes(Sh.mcp_delimiter)){const[s,a]=n.tool_id.split(Sh.mcp_delimiter);if(!o.has(a)){const n={name:a,pluginKey:a,description:`${t("com_ui_tool_collection_prefix")} ${a}`,icon:i.icon||""};o.set(a,{serverName:a,tools:[],isConfigured:r.has(a),isConnected:"connected"===(null==(e=null==v?void 0:v[a])?void 0:e.connectionState),metadata:n})}o.get(a).tools.push(n)}else a[n.tool_id]={tool_id:n.tool_id,metadata:n.metadata}}for(const i of x){if(o.has(i))continue;const e={icon:"",name:i,pluginKey:i,description:`${t("com_ui_tool_collection_prefix")} ${i}`};o.set(i,{tools:[],metadata:e,isConfigured:!0,serverName:i,isConnected:"connected"===(null==(n=null==v?void 0:v[i])?void 0:n.connectionState)})}return{tools:s,groupedTools:a,mcpServersMap:o}}),[h,t,x,v]),{agentsConfig:_,endpointsConfig:y}=$k(),j={mcp:a,mcps:o,action:l,setMcp:r,actions:f,setMcps:i,agent_id:m,setAction:c,pluginTools:h,activePanel:d,agentsConfig:_,startupConfig:g,setActivePanel:u,endpointsConfig:y,setCurrentAgentId:p,tools:b.tools,groupedTools:b.groupedTools,mcpServersMap:b.mcpServersMap};return s.jsx(Xk.Provider,{value:j,children:e})}const eS=n.createContext({}),tS=n.createContext({}),nS=()=>n.useContext(tS),sS=n.createContext({}),aS=()=>n.useContext(sS),rS=n.createContext(void 0);function oS({children:e}){const[t,a]=n.useState(!1),[r,o]=n.useState();return s.jsx(rS.Provider,{value:{isMutating:t,setIsMutating:a,currentCode:r,setCurrentCode:o},children:e})}function iS(){const e=n.useContext(rS);if(void 0===e)throw new Error("useEditorContext must be used within an EditorProvider");return e}const{CustomFormProvider:lS,useCustomFormContext:cS}=function(){const e=n.createContext(void 0);return{CustomFormProvider:({register:t,control:a,setValue:r,getValues:o,handleSubmit:i,reset:l,children:c})=>{const d=n.useMemo((()=>({register:t,control:a,getValues:o,setValue:r,handleSubmit:i,reset:l})),[t,a,r,o,i,l]);return s.jsx(e.Provider,{value:d,children:c})},useCustomFormContext:()=>{const t=n.useContext(e);if(!t)throw new Error("useCustomFormContext must be used within a CustomFormProvider");return t}}}(),dS=n.createContext({bookmarks:[]}),uS=()=>n.useContext(dS),mS=n.createContext({}),pS=()=>n.useContext(mS),fS=n.createContext({}),hS=()=>n.useContext(fS),gS=n.createContext({}),xS=()=>n.useContext(gS),vS={announceAssertive:()=>console.warn("Announcement failed, LiveAnnouncer context is missing"),announcePolite:()=>console.warn("Announcement failed, LiveAnnouncer context is missing")},bS=S.createContext(vS),_S=()=>S.useContext(bS),yS=n.createContext({});function jS({children:e}){const t=n.useRef(0),a=n.useCallback((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),r=n.useCallback((()=>{t.current=0}),[]);return s.jsx(yS.Provider,{value:{getNextIndex:a,resetCounter:r},children:e})}const wS=n.createContext({});function NS({children:e}){const t=n.useRef(0),a=n.useCallback((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),r=n.useCallback((()=>{t.current=0}),[]);return s.jsx(wS.Provider,{value:{getNextIndex:a,resetCounter:r},children:e})}const CS=n.createContext({});function kS({children:e,conversationId:t}){const a=function({conversationId:e}){const{data:t=null}=ij({conversationId:e},{select:e=>function(e=[]){return e.reduce(((e,t)=>{const n=`${t.messageId}_${t.partIndex??0}_${t.blockIndex??0}_${t.toolId}`,s=e[n]??[];return s.push(t),e[n]=s,e}),{})}(e)}),s=n.useMemo((()=>null!==t?t:void 0),[t]);return s_.log("tools","tool calls map:",s),s}({conversationId:t});return s.jsx(CS.Provider,{value:a,children:e})}const SS=n.createContext({}),ES=()=>n.useContext(SS),TS=n.createContext(void 0);function IS(){const e=n.useContext(TS);if(void 0===e)throw new Error("useBadgeRowContext must be used within a BadgeRowProvider");return e}function RS({children:e,isSubmitting:t,conversationId:a}){const r=n.useRef(""),o=n.useRef(!1),{mcpToolDetails:i}=LE(),{agentsConfig:l}=$k(),c=a??Sh.NEW_CONVO,d=Pe(yy(c));n.useEffect((()=>{if(!(t||o.current&&r.current===c)){o.current=!0,r.current=c;const e=`${Eh.LAST_CODE_TOGGLE_}${c}`,t=`${Eh.LAST_WEB_SEARCH_TOGGLE_}${c}`,n=`${Eh.LAST_FILE_SEARCH_TOGGLE_}${c}`,s=`${Eh.LAST_ARTIFACTS_TOGGLE_}${c}`,a=t_(e),i=t_(t),l=t_(n),u=t_(s),m={};if(null!==a)try{m[hu.execute_code]=JSON.parse(a)}catch(Di){console.error("Failed to parse code toggle value:",Di)}if(null!==i)try{m[hu.web_search]=JSON.parse(i)}catch(Di){console.error("Failed to parse web search toggle value:",Di)}if(null!==l)try{m[hu.file_search]=JSON.parse(l)}catch(Di){console.error("Failed to parse file search toggle value:",Di)}if(null!==u)try{m[vf.artifacts]=JSON.parse(u)}catch(Di){console.error("Failed to parse artifacts toggle value:",Di)}const p={[hu.execute_code]:m[hu.execute_code]??!1,[hu.web_search]:m[hu.web_search]??!1,[hu.file_search]:m[hu.file_search]??!1,[vf.artifacts]:m[vf.artifacts]??!1};d((e=>({...e||{},...p}))),Object.entries(p).forEach((([a,r])=>{if(!1!==r){let o=s;a===hu.execute_code?o=e:a===hu.web_search?o=t:a===hu.file_search&&(o=n),localStorage.setItem(o,JSON.stringify(r)),e_(o)}}))}}),[c,t,d]);const u=nT({}),{setIsDialogOpen:m}=u,p=eT({conversationId:a,setIsDialogOpen:m,toolKey:hu.execute_code,localStorageKey:Eh.LAST_CODE_TOGGLE_,authConfig:{toolId:hu.execute_code,queryOptions:{retry:1}}}),f=aT({}),{setIsDialogOpen:h}=f,g=eT({conversationId:a,toolKey:hu.web_search,localStorageKey:Eh.LAST_WEB_SEARCH_TOGGLE_,setIsDialogOpen:h,authConfig:{toolId:hu.web_search,queryOptions:{retry:1}}}),x=eT({conversationId:a,toolKey:hu.file_search,localStorageKey:Eh.LAST_FILE_SEARCH_TOGGLE_,isAuthenticated:!0}),v=eT({conversationId:a,toolKey:vf.artifacts,localStorageKey:Eh.LAST_ARTIFACTS_TOGGLE_,isAuthenticated:!0}),b=DE({conversationId:a}),_={webSearch:g,artifacts:v,fileSearch:x,agentsConfig:l,mcpServerNames:n.useMemo((()=>(i??[]).map((e=>e.name))),[i]),conversationId:a,codeApiKeyForm:u,codeInterpreter:p,searchApiKeyForm:f,mcpServerManager:b};return s.jsx(TS.Provider,{value:_,children:e})}const PS=n.createContext(void 0);function AS({children:e}){const{conversation:t}=Pk(),a=n.useMemo((()=>({endpoint:null==t?void 0:t.endpoint})),[null==t?void 0:t.endpoint]);return s.jsx(PS.Provider,{value:a,children:e})}const MS=n.createContext(void 0);function LS({children:e}){const{conversation:t}=Pk(),a=n.useMemo((()=>({conversationId:(null==t?void 0:t.conversationId)??Sh.NEW_CONVO})),[null==t?void 0:t.conversationId]);return s.jsx(MS.Provider,{value:a,children:e})}const OS=n.createContext(void 0);function DS({children:e}){const{isSubmitting:t,latestMessage:a,conversation:r}=Pk(),o=n.useMemo((()=>vb({messageId:(null==a?void 0:a.messageId)??null,text:(null==a?void 0:a.text)??null,content:(null==a?void 0:a.content)??null})),[null==a?void 0:a.messageId,null==a?void 0:a.text,null==a?void 0:a.content]),i=n.useMemo((()=>({isSubmitting:t,latestMessageText:o,latestMessageId:(null==a?void 0:a.messageId)??null,conversationId:(null==r?void 0:r.conversationId)??null})),[t,null==a?void 0:a.messageId,o,null==r?void 0:r.conversationId]);return s.jsx(OS.Provider,{value:i,children:e})}function FS(){const e=n.useContext(OS);if(!e)throw new Error("useArtifactsContext must be used within ArtifactsProvider");return e}const zS={misc:He,roleplay:Ye,write:Qe,idea:qe,shop:We,finance:Ue,code:Ve,travel:Ke,teach_or_explain:Ge,general:He,hr:$e,rd:Be,it:Ve,sales:Ue,aftersales:ze},US={code:"text-red-500",misc:"text-blue-300",shop:"text-purple-400",idea:"text-yellow-500/90 dark:text-yellow-300 ",write:"text-purple-400",travel:"text-yellow-500/90 dark:text-yellow-300 ",finance:"text-orange-400",roleplay:"text-orange-400",teach_or_explain:"text-blue-300",general:"text-blue-500",hr:"text-green-500",rd:"text-purple-500",it:"text-red-500",sales:"text-orange-500",aftersales:"text-yellow-500"};function VS({category:e,className:t=""}){const n=zS[e],a=US[e]+" "+t;return n?s.jsx(n,{className:n_(a,t),"aria-hidden":"true"}):null}const BS=n.createContext(null),$S=({children:e})=>{const t=function(){var e,t,s;const[a]=Re(Ny.promptsPageSize),[r]=Re(Ny.promptsCategory),[o,i]=Re(Ny.promptsName),[l,c]=n.useState(0),d=n.useRef([null]),u=n.useRef({name:o,category:r}),m=((e,t)=>{const{name:n,pageSize:s,category:a}=e||{};return hr([xx.promptGroups,n,a,s],(({pageParam:e})=>{const t={name:n,category:a||"",limit:(s||10).toString()};return e&&"string"==typeof e&&(t.cursor=e),Rx.getPromptGroups(t)}),{getNextPageParam:e=>e.has_more&&e.after?e.after:void 0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})({name:o,pageSize:a,category:r}),p=n.useMemo((()=>{var e;if(!(null==(e=m.data)?void 0:e.pages)||0===m.data.pages.length)return null;const t=Math.min(l,m.data.pages.length-1);return m.data.pages[t]}),[null==(e=m.data)?void 0:e.pages,l]),f=n.useMemo((()=>(null==p?void 0:p.promptGroups)||[]),[p]),h=n.useMemo((()=>{var e,t;return!!p&&(l<((null==(t=null==(e=m.data)?void 0:e.pages)?void 0:t.length)||0)-1||(p.has_more||!1))}),[p,l,null==(s=null==(t=m.data)?void 0:t.pages)?void 0:s.length]),g=l>0,x=l+1,v=h?x+1:x,b=n.useCallback((async()=>{var e,t,n;if(!h)return;const s=l+1;if(s>=((null==(t=null==(e=m.data)?void 0:e.pages)?void 0:t.length)||0)){const e=await m.fetchNextPage();if(e.isSuccess&&(null==(n=e.data)?void 0:n.pages)){const t=e.data.pages[e.data.pages.length-2];(null==t?void 0:t.after)&&!d.current.includes(t.after)&&d.current.push(t.after)}}c(s)}),[l,h,m]),_=n.useCallback((()=>{g&&c(l-1)}),[l,g]);return n.useEffect((()=>{(u.current.name!==o||u.current.category!==r)&&(c(0),d.current=[null],u.current={name:o,category:r})}),[o,r]),{promptGroups:f,groupsQuery:m,currentPage:x,totalPages:v,hasNextPage:h,hasPreviousPage:g,nextPage:b,prevPage:_,isFetching:m.isFetching,name:o,setName:i}}(),{data:a,isLoading:r}=(o={select:e=>{const t=e.map((e=>{var t,n;return{id:e._id??"",type:"prompt",value:e.command??e.name,label:`${null!=e.command&&e.command?`/${e.command} - `:""}${e.name}: ${((null==(t=e.oneliner)?void 0:t.length)??0)>0?e.oneliner:(null==(n=e.productionPrompt)?void 0:n.prompt)??""}`,icon:s.jsx(VS,{category:e.category??"",className:"h-5 w-5"})}}));return{promptsMap:e.reduce(((e,t)=>t._id?(e[t._id]=t,e):e),{}),promptGroups:t}}},mr([xx.allPromptGroups],(()=>Rx.getAllPromptGroups()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...o}));var o;const i=n.useMemo((()=>({...t,allPromptGroups:{data:a,isLoading:r}})),[t,a,r]);return s.jsx(BS.Provider,{value:i,children:e})},HS=()=>{const e=n.useContext(BS);if(!e)throw new Error("usePromptGroupsContext must be used within a PromptGroupsProvider");return e};function GS(e){const t=Dk(),s=n.useMemo((()=>null!=e&&""!==e?null==t?void 0:t[e]:void 0),[e,t]),{data:a}=Py(e??"",{enabled:!!e}),r=n.useMemo((()=>(null==a?void 0:a.tools)||(null==s?void 0:s.tools)),[null==a?void 0:a.tools,null==s?void 0:s.tools]);return{fileSearchAllowedByAgent:n.useMemo((()=>!e||!!s&&((null==r?void 0:r.includes(hu.file_search))??!1)),[e,s,r]),codeAllowedByAgent:n.useMemo((()=>!e||!!s&&((null==r?void 0:r.includes(hu.execute_code))??!1)),[e,s,r]),tools:r}}function KS(){return e=>localStorage.setItem(Eh.FILES_TO_DELETE,JSON.stringify(e))}function WS(){const{data:e={}}=Gy();return n.useCallback((t=>{const{modelDisplayLabel:n}=(null==e?void 0:e[t.endpoint??""])??{};return Wh({...t,modelDisplayLabel:n})}),[e])}const qS=e=>{const{data:t}=Gy(),s=null==t?void 0:t[e??""],{azure:a}=s??{};let r=e;a?r=Uu.azureOpenAI:r===Uu.gptPlugins&&(r=Uu.openAI);const o=lk(),i=hk(r),l=n.useCallback((()=>{if(i.data)return i.data.expiresAt||"never"}),[i.data]),c=n.useCallback((()=>{const e=l();if(!e)return!0;return!(new Date(e)<new Date)}),[l]),d=n.useCallback(((e,t)=>{const n=t?new Date(t).toISOString():"";o.mutate({name:r,value:e,expiresAt:n})}),[o,r]);return n.useMemo((()=>({getExpiry:l,checkExpiry:c,saveUserKey:d})),[l,c,d])},QS=e=>{s_.log("=====================================\nAsk function called with:"),s_.dir(e),s_.log("=====================================")};function YS({index:e=0,files:t,setFiles:n,getMessages:s,setMessages:a,isSubmitting:r,latestMessage:o,setSubmission:i,setLatestMessage:l,conversation:c}){const d=Fe(),u=WS(),{user:m}=Kk(),p=pr(),f=KS(),h=Ie((({snapshot:e})=>t=>(s_.log("agents",`[useGetEphemeralAgent] Getting loadable for ID: ${t}`),e.getLoadable(yy(t)).contents)),[]),g=Ae(Ny.isTemporary),{getExpiry:x}=qS((null==c?void 0:c.endpoint)??""),v=Pe(Ny.showStopButtonByIndex(e)),b=Oe(Ny.latestMessageFamily(e+1)),_=({text:_,overrideConvoId:y,overrideUserMessageId:j,parentMessageId:w=null,conversationId:N=null,messageId:C=null},{editedContent:k=null,editedMessageId:S=null,isRegenerate:E=!1,isContinued:T=!1,isEdited:I=!1,overrideMessages:R,overrideFiles:P}={})=>{var A;if(v(!1),b(),r||""===_)return;const M=So.cloneDeep(c),L=null==M?void 0:M.endpoint;if(null===L)return void console.error("No endpoint available");if("search"==(N=N??(null==M?void 0:M.conversationId)??null))return void console.error("cannot send any message under search view!");if(T&&!o)return void console.error("cannot continue AI message without latestMessage!");const O=h(N??Sh.NEW_CONVO),D=I||T;let F=R??s()??[];(null==M?void 0:M.promptPrefix)&&(M.promptPrefix=Xh({text:M.promptPrefix,user:m})),_=_.trim();const z=j??Xe();w=w??(null==o?void 0:o.messageId)??Sh.NO_PARENT,QS({index:e,conversation:M,latestMessage:o,conversationId:N,intermediateId:z,parentMessageId:w,currentMessages:F}),N==Sh.NEW_CONVO&&(w=Sh.NO_PARENT,F=[],N=null,d("/c/new",{state:{focusChat:!0}}));const U=E?C:null==o?void 0:o.parentMessageId,V=F.find((e=>e.messageId===U));let B=(null==V?void 0:V.thread_id)??(null==o?void 0:o.thread_id);null==B&&(B=null==(A=F.find((e=>e.thread_id)))?void 0:A.thread_id);const $=p.getQueryData([xx.endpoints]),H=kb($,L,"type"),G=Qh({endpoint:L,endpointType:H,conversation:M??{}}),{modelDisplayLabel:K}=(null==$?void 0:$[L??""])??{},W=Object.assign({endpoint:L,endpointType:H,overrideConvoId:y,overrideUserMessageId:j},G);L!==Uu.agents?(W.key=x(),W.thread_id=B,W.modelDisplayLabel=K):W.key=new Date(Date.now()+36e5).toISOString();const q=u({model:null==M?void 0:M.model,...W}),Q={text:_,sender:"User",clientTimestamp:(new Date).toLocaleString("sv").replace(" ","T"),isCreatedByUser:!0,parentMessageId:w,conversationId:N,messageId:T&&null!=C&&C?C:z,thread_id:B,error:!1},Y=P??(null==V?void 0:V.files),X=(E||null!=P&&P.length)&&Y&&Y.length>0;n&&!0===X?(Q.files=[...Y],n(new Map),f({})):n&&t&&t.size>0&&(Q.files=Array.from(t.values()).map((e=>({file_id:e.file_id,filepath:e.filepath,type:e.type??"",height:e.height,width:e.width}))),n(new Map),f({}));const Z=S??((null==o?void 0:o.messageId)&&E?o.messageId.replace(/_+$/,"")+"_":null)??null,J={sender:q,text:"",endpoint:L??"",parentMessageId:E?C:z,messageId:Z??`${E?C:z}`.replace(/_+$/,"")+"_",thread_id:B,conversationId:N,unfinished:!1,isCreatedByUser:!1,iconURL:null==G?void 0:G.iconURL,model:null==G?void 0:G.model,error:!1};if(Yu(L))J.model=(null==M?void 0:M.assistant_id)??"",J.text="",J.content=[{type:Ph.TEXT,[Ph.TEXT]:{value:""}}];else if(null!=L){if(J.model=Xu(L)?(null==M?void 0:M.agent_id)??"":(null==M?void 0:M.model)??"",J.text="",k&&(null==o?void 0:o.content)){J.content=So.cloneDeep(o.content);const{index:e,type:t,...n}=k;if(J.content&&e>=0&&e<J.content.length){const s=J.content[e];t===Ph.THINK&&s.type===Ph.THINK?s[Ph.THINK]=n[Ph.THINK]:t===Ph.TEXT&&s.type===Ph.TEXT&&(s[Ph.TEXT]=n[Ph.TEXT])}}else J.content=[{type:Ph.TEXT,[Ph.TEXT]:{value:""}}];v(!0)}T&&(F=F.filter((e=>e.messageId!==Z))),s_.log("message_state",J);const ee={conversation:{...M,conversationId:N},endpointOption:W,userMessage:{...Q,responseMessageId:Z,overrideParentMessageId:E?C:null},messages:F,isEdited:D,isContinued:T,isRegenerate:E,initialResponse:J,isTemporary:g,ephemeralAgent:O,editedContent:k};a(E?[...ee.messages,J]:[...ee.messages,Q,J]),0===e&&l&&l(J),i(ee),s_.dir("message_stream",ee,{depth:null})};return{ask:_,regenerate:({parentMessageId:e})=>{const t=s(),n=null==t?void 0:t.find((t=>t.messageId==e));n&&n.isCreatedByUser?_({...n},{isRegenerate:!0}):console.error("Failed to regenerate the message: parentMessage not found or not created by user.")}}}const XS=[];function ZS(){const e=Fk(),t=Ae(Ny.chatBadges),s=n.useMemo((()=>new Set(t.map((e=>e.id)))),[t]);return n.useMemo((()=>XS.map((t=>({id:t.id,label:e(t.label),icon:t.icon,atom:t.atom,isAvailable:s.has(t.id)})))||[]),[s,e])}const JS=(e=0)=>{const t=Fe(),[s]=Ps(),{data:a}=Ky(),r=Ny.useClearConvoState(),o=Ae(Ny.defaultPreset),{setConversation:i}=Ny.useCreateConversationAtom(e),[l,c]=Re(Ny.filesByIndex(e)),d=Ae(Ny.saveBadgesState),u=Ny.useClearLatestMessages(`useNewConvo ${e}`),m=Pe(Ny.submissionByIndex(e)),{data:p={}}=Gy(),f=mk(),h=Mk(),{pauseGlobalAudio:g}=Cy(e),x=Ae(Ny.saveDrafts),v=Ie((({reset:e})=>()=>{XS.forEach((({atom:t})=>e(t))),e(Ny.chatBadges)}),[]),{mutateAsync:b}=Wy({onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),_=Ie((()=>async(n,a=null,l,c,d,g,x,v)=>{var b,_,y;const j=l??f.data,{endpoint:w=null}=n,N=(null===w||c)??!1,C=!o||a||o.endpoint!==w&&w||!N?a:o,k=v??(null!=(null==C?void 0:C.presetId)&&C.presetId&&C.presetId===(null==o?void 0:o.presetId));if(N){let t=l_({convoSetup:C??n,endpointsConfig:p});t||(t=Object.keys(p??{})[0]);const s=kb(p,t,"type");!n.endpointType&&s?n.endpointType=s:n.endpointType&&!s&&(n.endpointType=void 0);const a=Yu(t),r=h[t]??[],o=n.assistant_id??"",i=null==(b=h[t])?void 0:b[o];if(o&&!i&&(n.assistant_id=void 0),!o&&a&&(n.assistant_id=localStorage.getItem(`${Eh.ASST_ID_PREFIX}${e}${t}`)??(null==(_=r[0])?void 0:_.id)),o&&a&&n.conversationId===Sh.NEW_CONVO){const e=r.find((e=>e.id===o));n.model=null==e?void 0:e.model,function({endpoint:e,model:t=""}){if(!t)return;const n=JSON.parse((localStorage.getItem(Eb)??"{}")||"{}");n.endpoint===e&&(n.model=t,localStorage.setItem(Eb,JSON.stringify(n)));const s=JSON.parse((localStorage.getItem(Eh.LAST_MODEL)??"{}")||"{}");s[e]=t,localStorage.setItem(Eh.LAST_MODEL,JSON.stringify(s))}({endpoint:t,model:n.model})}o&&!a&&(n.assistant_id=void 0);const l=(null==j?void 0:j[t])??[];n=i_({conversation:n,lastConversationSetup:C,endpoint:t,models:l})}!0===k&&(n.disableParams=!0),g||r(!0);const S=null==(y=n.conversationId)?void 0:y.startsWith("_");if(S?(s_.log("conversation","Cancelled conversation, setting to `new` in `useNewConvo`",n),i({...n,conversationId:Sh.NEW_CONVO})):(s_.log("conversation","Setting conversation from `useNewConvo`",n),i(n)),m({}),d||u(),S)return;const E=null==s?void 0:s.toString(),T=()=>E?`?${E}`:"";if(n.conversationId===Sh.NEW_CONVO&&!l){const e=localStorage.getItem(Eh.APP_TITLE)??"";e&&(document.title=e);const n=`/c/${Sh.NEW_CONVO}${T()}`;return void t(n,{state:{focusChat:!0}})}const I=`/c/${n.conversationId}${T()}`;t(I,{replace:!0,state:x?{}:{focusChat:!0}})}),[p,o,h,f.data]),y=n.useCallback((function({template:e={},preset:t,modelsData:n,disableFocus:s,buildDefault:r=!0,keepLatestMessage:o=!1,keepAddedConvos:i=!1,disableParams:u}={}){var m,p;g(),d||v();const f=e.conversationId??"",h=!0===(!0===Zu(e.endpoint??"",e.endpointType??"")||Zu((null==t?void 0:t.endpoint)??"",(null==t?void 0:t.endpointType)??""))&&f&&f===Sh.NEW_CONVO?{endpoint:e.endpoint}:e,y={conversationId:Sh.NEW_CONVO,title:"New Chat",endpoint:null,...h,createdAt:"",updatedAt:""};let j=t;const w=Ib(a);if(j||!a||!0!==(null==(m=a.modelSpecs)?void 0:m.prioritize)&&!0===((null==(p=a.interface)?void 0:p.modelSelect)??!0)||!w||(j=Rb(w)),"new"===y.conversationId&&!n){const e=Array.from(l.values()).filter((e=>null!=e.filepath&&""!==e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,embedded:!!e.embedded,filepath:e.filepath,source:e.source})));c(new Map),localStorage.setItem(Eh.FILES_TO_DELETE,JSON.stringify({})),!x&&e.length>0&&b({files:e})}_(y,j,n,r,o,i,s,u)}),[l,c,x,b,v,a,d,g,_]);return{switchToConversation:_,newConversation:y}};function eE(e=0,t){const s=Ny.useClearSubmissionState(),[a,r]=Re(Ny.filesByIndex(e)),[o,i]=n.useState(!1),l=pr(),{isAuthenticated:c}=Kk(),{newConversation:d}=JS(e),{useCreateConversationAtom:u}=Ny,{conversation:m,setConversation:p}=u(e),{conversationId:f}=m??{},h="new"===t?t:f??t??"",{data:g}=sj(f??"",{enabled:c}),x=Oe(Ny.latestMessageFamily(e)),[v,b]=Re(Ny.isSubmittingFamily(e)),[_,y]=Re(Ny.latestMessageFamily(e)),j=Pe(Ny.messagesSiblingIdxFamily((null==_?void 0:_.parentMessageId)??null)),w=n.useCallback((e=>{l.setQueryData([xx.messages,h],e),"new"===h&&f&&"new"!==f&&l.setQueryData([xx.messages,f],e)}),[h,l,f]),N=n.useCallback((()=>l.getQueryData([xx.messages,h])),[h,l]),C=Pe(Ny.submissionByIndex(e)),{ask:k,regenerate:S}=YS({index:e,files:a,setFiles:r,getMessages:N,setMessages:w,isSubmitting:v,conversation:m,latestMessage:_,setSubmission:C,setLatestMessage:y}),E=()=>s(),[T,I]=Re(Ny.showPopoverFamily(e)),[R,P]=Re(Ny.abortScrollFamily(e)),[A,M]=Re(Ny.presetByIndex(e)),[L,O]=Re(Ny.optionSettingsFamily(e)),[D,F]=Re(Ny.showAgentSettingsFamily(e));return{newConversation:d,conversation:m,setConversation:p,isSubmitting:v,setIsSubmitting:b,getMessages:N,setMessages:w,setSiblingIdx:j,latestMessage:_,setLatestMessage:y,resetLatestMessage:x,ask:k,index:e,regenerate:S,stopGenerating:E,handleStopGenerating:e=>{e.preventDefault(),E()},handleRegenerate:e=>{e.preventDefault();const t=(null==_?void 0:_.parentMessageId)??"";t?S({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleContinue:e=>{e.preventDefault(),(()=>{if(!_)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=N(),t=null==e?void 0:e.find((e=>e.messageId==_.parentMessageId));t&&t.isCreatedByUser?k({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),j(0)},showPopover:T,setShowPopover:I,abortScroll:R,setAbortScroll:P,preset:A,setPreset:M,optionSettings:L,setOptionSettings:O,showAgentSettings:D,setShowAgentSettings:F,files:a,setFiles:r,filesLoading:o,setFilesLoading:i}}function tE({rootIndex:e=0,currentIndex:t,paramId:s}){const a=pr(),r=Ny.useClearSubmissionState(),[o,i]=Re(Ny.filesByIndex(e)),l=Ae(Ny.latestMessageFamily(e)),c=Pe(Ny.latestMessageFamily(t)),{useCreateConversationAtom:d}=Ny,{conversation:u,setConversation:m}=d(t),[p,f]=Re(Ny.isSubmittingFamily(t)),h=Pe(Ny.messagesSiblingIdxFamily((null==l?void 0:l.parentMessageId)??null)),g="new"===s?s:(null==u?void 0:u.conversationId)??s??"",x=n.useCallback((e=>{a.setQueryData([xx.messages,g,t],e);const n=e[e.length-1];n&&c({...n,depth:-1})}),[g,a,t,c]),v=n.useCallback((()=>a.getQueryData([xx.messages,g,t])),[g,a,t]),b=Pe(Ny.submissionByIndex(t)),{ask:_,regenerate:y}=YS({index:t,files:o,setFiles:i,getMessages:v,setMessages:x,isSubmitting:p,conversation:u,setSubmission:b,latestMessage:l}),j=()=>r();return{ask:_,regenerate:y,getMessages:v,setMessages:x,conversation:u,isSubmitting:p,setSiblingIdx:h,latestMessage:l,stopGenerating:j,handleContinue:e=>{e.preventDefault(),(()=>{if(!l)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=v(),t=null==e?void 0:e.find((e=>e.messageId==l.parentMessageId));t&&t.isCreatedByUser?_({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),h(0)},setConversation:m,setIsSubmitting:f,handleRegenerate:e=>{e.preventDefault();const t=null==l?void 0:l.parentMessageId;t?y({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleStopGenerating:e=>{e.preventDefault(),j()}}}const nE=({index:e=0,rootIndex:t,setConversation:s})=>{const a=mk(),r=Mk(),{data:o={}}=Gy(),i=n.useRef(),l=Ae(Ny.conversationByKeySelector(t));n.useEffect((()=>{null!=(null==l?void 0:l.conversationId)&&s&&s((e=>{if(!e)return e;const t={...e,conversationId:l.conversationId};return s_.log("conversation","Setting conversation from `useNewConvo`",t),t}))}),[null==l?void 0:l.conversationId,s]);return{generateConversation:n.useCallback((({template:t={},preset:n,modelsData:c}={})=>{var d,u;let m={conversationId:"new",title:"New Chat",endpoint:null,...t,createdAt:"",updatedAt:""};(null==l?void 0:l.conversationId)&&(m.conversationId=l.conversationId);const p=c??a.data,f=l_({convoSetup:n??m,endpointsConfig:o}),h=kb(o,f,"type");!m.endpointType&&h?m.endpointType=h:m.endpointType&&!h&&(m.endpointType=void 0);const g=Yu(f),x=r[f??""]??[];if(m.assistant_id&&!(null==(d=r[f??""])?void 0:d[m.assistant_id])&&(m.assistant_id=void 0),!m.assistant_id&&g&&(m.assistant_id=localStorage.getItem(`${Eh.ASST_ID_PREFIX}${e}${f}`)??(null==(u=x[0])?void 0:u.id)),null!=m.assistant_id&&g&&"new"===m.conversationId){const e=x.find((e=>e.id===m.assistant_id));m.model=null==e?void 0:e.model}null==m.assistant_id||g||(m.assistant_id=void 0);const v=(null==p?void 0:p[f??""])??[];return m=i_({conversation:m,lastConversationSetup:n,endpoint:f??"",models:v}),null!=(null==n?void 0:n.title)&&""!==n.title&&(m.title=n.title),s&&s(m),clearTimeout(i.current),i.current=setTimeout((()=>{const e=document.getElementById(qd);e&&e.focus()}),150),m}),[r,o,e,a.data,l,s])}};const sE={name:"Plugin store",pluginKey:"pluginStore",isButton:!0,description:"",icon:"",authConfig:[],authenticated:!1};function aE({startupConfig:e,user:t}){var s;const a=Pe(Ny.availableTools),[r,o]=Re(Ny.defaultPreset),{data:i}=vk({enabled:!!(null==t?void 0:t.plugins),select:ru});!function(e){const{data:t}=jk({enabled:e}),s=n.useRef({conversationMode:Pe(Ny.conversationMode),advancedMode:Pe(Ny.advancedMode),speechToText:Pe(Ny.speechToText),textToSpeech:Pe(Ny.textToSpeech),cacheTTS:Pe(Ny.cacheTTS),engineSTT:Pe(Ny.engineSTT),languageSTT:Pe(Ny.languageSTT),autoTranscribeAudio:Pe(Ny.autoTranscribeAudio),decibelValue:Pe(Ny.decibelValue),autoSendText:Pe(Ny.autoSendText),engineTTS:Pe(Ny.engineTTS),voice:Pe(Ny.voice),cloudBrowserVoices:Pe(Ny.cloudBrowserVoices),languageTTS:Pe(Ny.languageTTS),automaticPlayback:Pe(Ny.automaticPlayback),playbackRate:Pe(Ny.playbackRate)}).current;n.useEffect((()=>{e&&t&&"not_found"!==t.message&&(s_.log("Initializing speech settings from config:",t),Object.entries(t).forEach((([e,t])=>{if("sttExternal"===e||"ttsExternal"===e)return;if(null!==localStorage.getItem(e))return;const n=s[e];n&&(s_.log(`Setting default speech setting: ${e} = ${t}`),n(t))})))}),[e,t,s])}(!!t),n.useEffect((()=>{!function(){try{const e=[],t=Date.now();for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s&&(s!==Eh.PIN_MCP_&&Jb.some((e=>s.startsWith(e)))&&!s.endsWith(Xb))){const n=`${s}${Xb}`,a=localStorage.getItem(n);if(!a){e.push(s);continue}t-parseInt(a,10)>Zb&&(e.push(s),e.push(n))}}e.forEach((e=>localStorage.removeItem(e))),e.length>0&&console.log(`Cleaned up ${e.length} old localStorage entries`)}catch(e){console.error("Error during cleanup of timestamped storage:",e)}}()}),[]),n.useEffect((()=>{const t=(null==e?void 0:e.appTitle)??"";t&&(document.title=t,localStorage.setItem(Eh.APP_TITLE,t))}),[e]),n.useEffect((()=>{var t;if(r&&null!=r.spec)return;const n=null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list;if(!n||!n.length)return;const s=n.find((e=>e.default));s&&o({...s.preset,iconURL:s.iconURL,spec:s.name})}),[r,o,null==(s=null==e?void 0:e.modelSpecs)?void 0:s.list]),n.useEffect((()=>{if(!t)return;if(!i)return;const e=t.plugins??[];if(0===e.length)return void a({pluginStore:sE});const n=[...e].map((e=>i.map[e])).filter((e=>void 0!==e)),s=localStorage.getItem(Eh.LAST_TOOLS)??"";if(!s)return a({pluginStore:sE,...au(n)});const r=ou(JSON.parse(s)??[],i.map).filter((e=>n.some((t=>t.pluginKey===e.pluginKey)))).filter((e=>!!e));localStorage.setItem(Eh.LAST_TOOLS,JSON.stringify(r)),a({pluginStore:sE,...au(n)})}),[i,t,a]),n.useEffect((()=>{if(null!=(null==e?void 0:e.analyticsGtmId)&&void 0===window.google_tag_manager){const t={gtmId:e.analyticsGtmId};Ze.initialize(t)}}),[null==e?void 0:e.analyticsGtmId])}function rE(){const e=Fk(),t=n.useRef(!1),s=pr(),{showToast:a}=Bd(),{user:r,isAuthenticated:o}=Kk(),i=Ae(Ny.modularChat),l=Ae(Ny.availableTools),c=Pe(Ny.presetModalVisible),[d,u]=Re(Ny.defaultPreset),m=uj({enabled:!!r&&o}),{preset:p,conversation:f,index:h,setPreset:g}=Pk(),{data:x}=mk(),{newConversation:v}=JS(h);n.useEffect((()=>{if(null==x?void 0:x.initial)return;const{data:e}=m;if(d||!e||t.current)return;if(e&&e.length>0&&r&&e[0].user!==r.id)return void m.refetch();const n=e.find((e=>e.defaultPreset));n?(u(n),(null==f?void 0:f.conversationId)&&"new"!==f.conversationId||v({preset:n,modelsData:x,disableParams:!0}),t.current=!0):t.current=!0}),[m.data,r,x]);const b=n.useCallback((e=>{s.setQueryData([xx.presets],e)}),[s]),_=(y={onMutate:e=>{if(!e)return void b([]);const t=m.data??[];t&&b(t.filter((t=>t.presetId!==e.presetId)))},onSuccess:()=>{s.invalidateQueries([xx.presets])},onError:t=>{s.invalidateQueries([xx.presets]),console.error("Error deleting the preset:",t),a({message:e("com_endpoint_preset_delete_error"),severity:eu.ERROR})}},fr([yx.deletePreset],{mutationFn:e=>Rx.deletePreset(e),...y||{}}));var y;const j=pk(),w=(e=>fr([yx.updatePreset],{mutationFn:e=>Rx.updatePreset(e),...e||{}}))({onSuccess:(t,n)=>{const r=t.title?`"${t.title}"`:e("com_endpoint_preset_title");let o=`${r} ${e("com_ui_saved")}`;t.defaultPreset&&t.presetId!==(null==d?void 0:d.presetId)?(o=`${r} ${e("com_endpoint_preset_default")}`,u(t),v({preset:t,disableParams:!0})):!1===n.defaultPreset&&(u(null),o=`${r} ${e("com_endpoint_preset_default_removed")}`),a({message:o}),s.invalidateQueries([xx.presets])},onError:t=>{console.error("Error updating the preset:",t),a({message:e("com_endpoint_preset_save_error"),severity:eu.ERROR})}}),N=Ik();return{presetsQuery:m,onSetDefaultPreset:(e,t=!1)=>{w.mutate({...e,defaultPreset:!t})},onFileSelected:t=>{(t=>{j.mutate({...t},{onSuccess:()=>{a({message:e("com_endpoint_preset_import")}),s.invalidateQueries([xx.presets])},onError:t=>{console.error("Error uploading the preset:",t),a({message:e("com_endpoint_preset_import_error"),severity:eu.ERROR})}})})({...o_({preset:t}),presetId:null})},onSelectPreset:t=>{if(!t)return;const n=ub(t,l),r=n.title?`"${n.title}"`:e("com_endpoint_preset_title");a({message:`${r} ${e("com_endpoint_preset_selected_title")}`,showIcon:!1,duration:750});const o=s.getQueryData([xx.endpoints]),{shouldSwitch:c,isNewModular:d,newEndpointType:u,isCurrentModular:m,isExistingConversation:p}=Tb({newEndpoint:n.endpoint??"",modularChat:i,conversation:f,endpointsConfig:o});n.spec=null,n.iconURL=n.iconURL??null,n.modelLabel=n.modelLabel??null;const h=m&&d&&c,g=!0===n.defaultPreset;if(p&&h){const e=N({conversation:{...f??{},spec:null,iconURL:null,modelLabel:null,endpointType:u},preset:{...n,endpointType:u},cleanInput:!0});v({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:g})}else v({preset:n,keepAddedConvos:h,disableParams:g})},onChangePreset:e=>{g(e),c(!0)},clearAllPresets:()=>_.mutate(void 0),onDeletePreset:t=>{confirm(e("com_endpoint_preset_delete_confirm"))&&_.mutate(t)},submitPreset:()=>{p&&w.mutate(o_({preset:p}))},exportPreset:()=>{if(!p)return;const e=Je(p.title||"preset");et({data:o_({preset:p}),fileName:e,exportType:et.types.json})}}}function oE({setOption:e,setter:t,optionKey:s,initialValue:a,delay:r=Zd}){const[o,i]=n.useState(a),l=n.useMemo((()=>ko(e&&s?e(s):t||(()=>{}),r)),[e,s,t,r]),c=n.useCallback(((e,t)=>{let n="object"!=typeof e?e:e.target.value;!0===t&&void 0!==n&&""!==n&&(n=Number(n)),i(n),l(n)}),[l]);return[c,o,i]}const iE=(e=0)=>{const t=Fe(),n=pr(),s=Ny.useClearConvoState(),a=Pe(Ny.submissionByIndex(e)),r=Ny.useClearLatestMessages(`useNavigateToConvo ${e}`),{hasSetConversation:o,setConversation:i}=Ny.useCreateConversationAtom(e);return{navigateToConvo:(e,l)=>{if(!e)return void s_.warn("conversation","Conversation not provided to `navigateToConvo`");const{resetLatestMessage:c=!0,currentConvoId:d}=l||{};s_.log("conversation","Navigating to conversation",e),o.current=!0,a(null),c&&r();let u={...e};const m=n.getQueryData([xx.endpoints]);if(!u.endpoint||!(null==m?void 0:m[u.endpoint])){const t=n.getQueryData([xx.models]),s=l_({convoSetup:e,endpointsConfig:m}),a=kb(m,s,"type");!e.endpointType&&a&&(e.endpointType=a);const r=(null==t?void 0:t[s??""])??[];u=i_({models:r,conversation:e,endpoint:s,lastConversationSetup:e})}s(!0),n.setQueryData([xx.messages,d],[]),u.conversationId!==Sh.NEW_CONVO&&u.conversationId?(n.invalidateQueries([xx.conversation,u.conversationId]),(async e=>{const s=null==e?void 0:e.conversationId;if(s)try{const e=await n.fetchQuery([xx.conversation,s],(()=>Rx.getConversationById(s)));s_.log("conversation","Fetched fresh conversation data",e),i(e),t(`/c/${s??Sh.NEW_CONVO}`,{state:{focusChat:!0}})}catch(a){console.error("Error fetching conversation data on navigation",a),e&&(i(e),t(`/c/${s}`,{state:{focusChat:!0}}))}})(u)):(i(u),t(`/c/${u.conversationId??Sh.NEW_CONVO}`,{state:{focusChat:!0}}))}}},lE=(e=!1)=>{const t=Pe(Ny.showPluginStoreDialog),n=Ae(Ny.availableTools),{conversation:s,setConversation:a}=Pk(),r=(e=>{const t=Pe(Ny.showPluginStoreDialog),n=Ae(Ny.availableTools),{preset:s,setPreset:a}=Pk();if(!e)return!1;function r(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find((t=>"string"==typeof t?t===e:t.pluginKey===e))}return{setOption:e=>t=>{const n={};n[e]=t,a((e=>o_({preset:{...e,...n}})))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a((e=>o_({preset:{...e,...o}})))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a((e=>o_({preset:{...e,...t}})))},setOptions:e=>{const t={...e};a((e=>o_({preset:{...e,...t}})))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a((e=>o_({preset:{...e,...t}})));n.pop(),t.examples=n,a((e=>o_({preset:{...e,...t}})))},getConversation:()=>s,checkPluginSelection:r,setAgentOption:t=>n=>{const s=JSON.parse(JSON.stringify(e)),{agentOptions:r}=s;r[t]=n,a((e=>o_({preset:{...e,agentOptions:r}})))},setTools:(e,o)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map((e=>"string"==typeof e?n[e]:e)).filter((e=>!!e)))||[],d=r(e),u=n[e];l.tools=d||o?c.filter((t=>t.pluginKey!==e)):[...c,u],a((e=>o_({preset:{...e,...l}})))}}})(e);if(r&&"boolean"!=typeof r)return r;function o(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find((t=>"string"==typeof t?t===e:t.pluginKey===e))}return{setTools:(e,r)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map((e=>"string"==typeof e?n[e]:e)).filter((e=>!!e)))||[],d=o(e),u=n[e];l.tools=d||r?c.filter((t=>t.pluginKey!==e)):[...c,u],a((e=>Sm.parse({...e,...l})))},setOption:e=>t=>{const n={};if(n[e]=t,"presetOverride"===e){const e=(null==s?void 0:s.presetOverride)||{};n.presetOverride={...e,...t}}if("web_search"===e&&!0===t){const e=null==s?void 0:s.endpoint;if(e===Uu.openAI||e===Uu.azureOpenAI||e===Uu.custom){((null==s?void 0:s.useResponsesApi)??!1)||(n.useResponsesApi=!0)}}a((e=>Sm.parse({...e,...n})))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a((e=>Sm.parse({...e,...o})))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a((e=>Sm.parse({...e,...t})))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a((e=>Sm.parse({...e,...t})));n.pop(),t.examples=n,a((e=>Sm.parse({...e,...t})))},setAgentOption:e=>t=>{const n=JSON.stringify(s),r=JSON.parse(n),{agentOptions:o}=r;o[e]=t,a((e=>Sm.parse({...e,agentOptions:o})))},checkPluginSelection:o}};function cE({preset:e,settingKey:t,defaultValue:s,conversation:a,inputValue:r,setInputValue:o,preventDelayedUpdate:i=!1}){const l=n.useRef(null),c=n.useRef(null);n.useEffect((()=>{if(i)return;const e=setTimeout((()=>{(null==a?void 0:a[t])!==r&&o(null==a?void 0:a[t])}),1.25*Zd);return()=>clearTimeout(e)}),[o,i,a,r,t]),n.useEffect((()=>{const e=(null==a?void 0:a.conversationId)??"";e&&l.current!==e&&(l.current=e,o(s))}),[o,null==a?void 0:a.conversationId,s]),n.useEffect((()=>{const t=(null==e?void 0:e.presetId)??"";t&&c.current!==t&&(c.current=t,o(s))}),[o,null==e?void 0:e.presetId,s])}const dE=n.createContext({}),uE=()=>{const{ref:e}=n.useContext(dE),{theme:t}=n.useContext(Td);return{screenshotTargetRef:e,captureScreenshot:async()=>{if(e instanceof Function)throw new Error("Ref callback is not supported.");if(null==e?void 0:e.current)return(async e=>{if(!e)throw new Error("You should provide correct html node.");const n=Id(t)?"#171717":"white",s=await tt(e,{backgroundColor:n,imagePlaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="}),a=document.createElement("canvas"),r=a.getContext("2d"),o=s.width,i=s.height;return a.width=o,a.height=i,r.fillStyle=n,r.fillRect(0,0,o,i),r.drawImage(s,0,0),a.toDataURL("image/png",1)})(e.current);throw new Error("Ref is not attached to any element.")}}},mE=({children:e})=>{const t=n.useRef(null);return s.jsx(dE.Provider,{value:{ref:t},children:e})};function pE({conversation:e,filename:t,type:s,includeOptions:a,exportBranches:r,recursive:o}){const i=pr(),{captureScreenshot:l}=uE(),c=function(){const e=Ie((({snapshot:e})=>async t=>await e.getPromise(Ny.messagesSiblingIdxFamily(t))),[]),t=async({messageId:n,message:s,messages:a,branches:r=!1,recursive:o=!1})=>{let i=[];if(null!=(null==a?void 0:a.length)&&a.length>0)if(r)for(const e of a)i.push(await t({messageId:null==e?void 0:e.messageId,message:e,messages:(null==e?void 0:e.children)||[],branches:r,recursive:o}));else{let s=a[0];if(a.length>1){const t=await e(n);s=a[a.length-t-1]}i=[await t({messageId:null==s?void 0:s.messageId,message:s,messages:(null==s?void 0:s.children)||[],branches:r,recursive:o})]}if(o&&s)return{...s,children:i};{let e=[];if(s){const t={...s};delete t.children,e=[t]}for(const t of i)e=e.concat(t);return e}};return t}(),{conversationId:d}=nt(),u=n.useCallback((()=>{const t="new"===d?d:(null==e?void 0:e.conversationId)??d??"",n=Zh({messages:i.getQueryData([xx.messages,t])??[]});return 0===(null==n?void 0:n.length)?null:n??null}),[d,null==e?void 0:e.conversationId,i]),m=(e,t="text")=>{if(!e)return"";const n=(e,n)=>"text"===t?`>> ${e}:\n${n}`:`**${e}**\n${n}`;return e.content?e.content.map((t=>p(e.sender||"",t))).map((e=>n(e[0],e[1]))).join("\n\n\n"):n(e.sender||"",e.text||"")},p=(e,t)=>{if(!t)return[];if(t.type===Ph.ERROR)return[e,"object"==typeof t[Ph.TEXT]?t[Ph.TEXT].value??"":t[Ph.TEXT]??""];if(t.type===Ph.TEXT){const n=t[Ph.TEXT];return[e,"string"==typeof n?n:n.value]}if(t.type===Ph.TOOL_CALL){const e=t[Ph.TOOL_CALL].type;if(e===Mh.CODE_INTERPRETER){const e=t[Ph.TOOL_CALL][Mh.CODE_INTERPRETER];return["Code Interpreter",JSON.stringify(e)]}if(e===Mh.RETRIEVAL){const e=t[Ph.TOOL_CALL];return["Retrieval",JSON.stringify(e)]}if(e===Mh.FUNCTION&&Lh.has(t[Ph.TOOL_CALL].function.name)){const e=t[Ph.TOOL_CALL];return["Tool",JSON.stringify(e)]}if(e===Mh.FUNCTION){const e=t[Ph.TOOL_CALL];return om(e),["Tool",JSON.stringify(e)]}}if(t.type===Ph.IMAGE_FILE){const e=t[Ph.IMAGE_FILE];return["Image",JSON.stringify(e)]}return[e,JSON.stringify(t)]};return{exportConversation:()=>{"json"===s?(async()=>{const n={conversationId:null==e?void 0:e.conversationId,endpoint:null==e?void 0:e.endpoint,title:null==e?void 0:e.title,exportAt:(new Date).toTimeString(),branches:r,recursive:o};!0===a&&(n.options=o_({preset:e}));const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:Boolean(o)});!0!==o||Array.isArray(s)?n.messages=s:n.messagesTree=s.children,et({data:n,fileName:t,extension:"json",exportType:et.types.json})})():"text"==s?(async()=>{let n=`Conversation\n########################\nconversationId: ${null==e?void 0:e.conversationId}\nendpoint: ${null==e?void 0:e.endpoint}\ntitle: ${null==e?void 0:e.title}\nexportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\nOptions\n########################\n";const t=o_({preset:e});for(const e of Object.keys(t))n+=`${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\nHistory\n########################\n",Array.isArray(s))for(const e of s)n+=`${m(e)}\n`,(null==e?void 0:e.error)&&(n+="(This is an error message)\n"),!0===(null==e?void 0:e.unfinished)&&(n+="(This is an unfinished message)\n"),n+="\n\n";else n+=`${m(s)}\n`,s.error&&(n+="(This is an error message)\n"),!0===s.unfinished&&(n+="(This is an unfinished message)\n");et({data:n,fileName:t,extension:"txt",exportType:et.types.txt})})():"markdown"==s?(async()=>{let n=`# Conversation\n- conversationId: ${null==e?void 0:e.conversationId}\n- endpoint: ${null==e?void 0:e.endpoint}\n- title: ${null==e?void 0:e.title}\n- exportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\n## Options\n";const t=o_({preset:e});for(const e of Object.keys(t))n+=`- ${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\n## History\n",Array.isArray(s))for(const e of s)n+=`${m(e,"md")}\n`,(null==e?void 0:e.error)&&(n+="*(This is an error message)*\n"),!0===(null==e?void 0:e.unfinished)&&(n+="*(This is an unfinished message)*\n"),n+="\n\n";else n+=`${m(s,"md")}\n`,s.error&&(n+="*(This is an error message)*\n"),!0===s.unfinished&&(n+="*(This is an unfinished message)*\n");et({data:n,fileName:t,extension:"md",exportType:et.types.txt})})():"csv"==s?(async()=>{const n=[],s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:!1});if(Array.isArray(s))for(const e of s)e&&n.push(e);else n.push(s);et({data:n,fileName:t,extension:"csv",exportType:et.types.csv,beforeTableEncode:e=>{var t,n,s,a,r,o,i,l;return[{fieldName:"sender",fieldValues:(null==(t=null==e?void 0:e.find((e=>"sender"==e.fieldName)))?void 0:t.fieldValues)??[]},{fieldName:"text",fieldValues:(null==(n=null==e?void 0:e.find((e=>"text"==e.fieldName)))?void 0:n.fieldValues)??[]},{fieldName:"isCreatedByUser",fieldValues:(null==(s=null==e?void 0:e.find((e=>"isCreatedByUser"==e.fieldName)))?void 0:s.fieldValues)??[]},{fieldName:"error",fieldValues:(null==(a=null==e?void 0:e.find((e=>"error"==e.fieldName)))?void 0:a.fieldValues)??[]},{fieldName:"unfinished",fieldValues:(null==(r=null==e?void 0:e.find((e=>"unfinished"==e.fieldName)))?void 0:r.fieldValues)??[]},{fieldName:"messageId",fieldValues:(null==(o=null==e?void 0:e.find((e=>"messageId"==e.fieldName)))?void 0:o.fieldValues)??[]},{fieldName:"parentMessageId",fieldValues:(null==(i=null==e?void 0:e.find((e=>"parentMessageId"==e.fieldName)))?void 0:i.fieldValues)??[]},{fieldName:"createdAt",fieldValues:(null==(l=null==e?void 0:e.find((e=>"createdAt"==e.fieldName)))?void 0:l.fieldValues)??[]}]}})})():"screenshot"==s&&(async()=>{let e;try{e=await l()}catch(n){return console.error("Failed to capture screenshot"),console.error(n)}st(e,`${t}.png`,"image/png")})()}}}function fE({nextCursor:e,isFetchingNext:t,setShowLoading:s,fetchNextPage:a}){const r=n.useRef(null),o=n.useRef(null),i=n.useCallback(Eo((()=>a?a():Promise.resolve()),750,{leading:!0}),[a]),l=n.useCallback((()=>{if(o.current){const{scrollTop:n,clientHeight:a,scrollHeight:r}=o.current;n+a>=.97*r&&null!=e&&!t?(s(!0),i()):s(!1)}}),[e,t,i,s]);n.useEffect((()=>{const e=o.current;return e&&e.addEventListener("scroll",l),()=>{e&&e.removeEventListener("scroll",l)}}),[l]);const c=n.useCallback((()=>{const e=o.current;e&&(r.current=e.scrollTop)}),[]);return{containerRef:o,moveToTop:c}}function hE(e,t){const s=Fe(),a=De();return n.useCallback((n=>{t&&t(n),0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),s(e,{state:{prevLocation:a}}))}),[s,e,t,a])}const gE=({mutateAsync:e,agent_id:t,assistant_id:s,tool_resource:a})=>{const[r,o]=n.useState([]),i=KS(),l=n.useCallback((({filesToDelete:t,agent_id:n,assistant_id:s,tool_resource:a})=>{const r=Am({agent_id:n,assistant_id:s,tool_resource:a});console.log("Deleting files:",t,r),e({files:t,...r}),o([])}),[e]),c=n.useCallback(ko(l,1e3),[]);n.useEffect((()=>()=>c.cancel()),[c]);return{deleteFile:n.useCallback((({file:e,setFiles:n})=>{const{file_id:r,temp_file_id:l="",filepath:d="",source:u=Om.local,embedded:m,attached:p=!1}=e;if((e.progress??1)<1)return;const f={file_id:r,embedded:m,filepath:d,source:u};n&&n((e=>{const t=new Map(e);t.delete(r),t.delete(l);const n=Object.fromEntries(t);return i(n),t})),p||o((e=>{const n=[...e,f];return c({filesToDelete:n,agent_id:t,assistant_id:s,tool_resource:a}),n}))}),[c,i,t,s,a]),deleteFiles:n.useCallback((({files:e,setFiles:n})=>{const a=[];for(const t of e){const{file_id:e,embedded:n,temp_file_id:s,filepath:r="",source:o=Om.local}=t;a.push({source:o,file_id:e,filepath:r,temp_file_id:s,embedded:n??!1})}n&&n((e=>{const t=new Map(e);a.forEach((e=>{t.delete(e.file_id),e.temp_file_id&&t.delete(e.temp_file_id)}));const n=Object.fromEntries(t);return i(n),t})),o((e=>{const n=[...e,...a];return c({filesToDelete:n,agent_id:t,assistant_id:s}),n}))}),[c,i,t,s])}},xE=()=>{const e=Fk(),{showToast:t}=Bd(),[s,a]=n.useState({});return{startUploadTimer:(n,r,o)=>{const i=(e=>5e3+2e3*Math.floor(e/1e6))(o);s[n]&&clearTimeout(s[n]);const l=setTimeout((()=>{const n=e("com_ui_upload_delay",{0:r});t({message:n,status:"warning",duration:1e4})}),i);a((e=>({...e,[n]:l})))},clearUploadTimer:e=>{s[e]&&(clearTimeout(s[e]),a((t=>{const{[e]:n,...s}=t;return s})))}}},vE=async(e,t=.9,n)=>{const s=await(async e=>{try{return await qo(e)}catch(t){return console.warn("Error checking if file is HEIC:",t),"image/heic"===e.type||"image/heif"===e.type}})(e);return s?(console.log("HEIC file detected, converting to JPEG..."),(async(e,t=.9,n)=>{try{null==n||n(.3);const s=await Qo({blob:e,type:"image/jpeg",quality:t});null==n||n(.8);const a=new File([s],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:e.lastModified});return null==n||n(1),a}catch(s){throw console.error("Error converting HEIC to JPEG:",s),new Error("Failed to convert HEIC image to JPEG")}})(e,t,n)):e},bE={maxWidth:1900,maxHeight:1900,quality:.92,format:"jpeg"};function _E(){try{if("undefined"==typeof HTMLCanvasElement)return!1;if("undefined"==typeof FileReader)return!1;if("undefined"==typeof Image)return!1;const e=document.createElement("canvas"),t=e.getContext("2d");return!!(t&&t.drawImage&&e.toBlob)}catch{return!1}}function yE(e,t={}){return new Promise(((n,s)=>{if(!_E())return void s(new Error("Browser does not support client-side image resizing"));if(!e.type.startsWith("image/"))return void s(new Error("File is not an image"));const a={...bE,...t},r=new FileReader;r.onload=t=>{var r;const o=new Image;o.onload=()=>{try{const t={width:o.width,height:o.height},r=function(e,t,n,s){const{width:a,height:r}={width:e,height:t};if(a<=n&&r<=s)return{width:a,height:r};const o=n/a,i=s/r,l=Math.min(o,i);return{width:Math.round(a*l),height:Math.round(r*l)}}(o.width,o.height,a.maxWidth,a.maxHeight);if(r.width===t.width&&r.height===t.height)return void n({file:e,originalSize:e.size,newSize:e.size,originalDimensions:t,newDimensions:r,compressionRatio:1});const i=document.createElement("canvas"),l=i.getContext("2d");i.width=r.width,i.height=r.height,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(o,0,0,r.width,r.height),i.toBlob((o=>{if(!o)return void s(new Error("Failed to create blob from canvas"));const i="jpeg"===a.format?".jpg":`.${a.format}`,l=e.name.replace(/\.[^/.]+$/,""),c=new File([o],`${l}${i}`,{type:`image/${a.format}`,lastModified:Date.now()});n({file:c,originalSize:e.size,newSize:c.size,originalDimensions:t,newDimensions:r,compressionRatio:c.size/e.size})}),`image/${a.format}`,a.quality)}catch(t){s(t)}},o.onerror=()=>s(new Error("Failed to load image")),o.src=null==(r=t.target)?void 0:r.result},r.onerror=()=>s(new Error("Failed to read file")),r.readAsDataURL(e)}))}function jE(e){const t=KS();return{addFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},replaceFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},updateFileById:(n,s,a=!1)=>{e((e=>{if(!e.has(n))return console.warn(`File with id ${n} not found.`),e;const r=new Map(e),o=r.get(n);if(!o)return console.warn(`File with id ${n} not found.`),e;r.set(n,{...o,...s});if((s.filepath??"")&&1!==s.progress&&!a){const e=Object.fromEntries(r);t(e)}return r}))},deleteFileById:n=>{e((e=>{const s=new Map(e);s.has(n)?s.delete(n):console.warn(`File with id ${n} not found.`);const a=Object.fromEntries(s);return t(a),s}))}}}const wE=e=>{var t,s,a;const r=Fk(),o=pr(),{showToast:i}=Bd(),[l,c]=n.useState([]),d=n.useRef(null),{startUploadTimer:u,clearUploadTimer:m}=xE(),{files:p,setFiles:f,setFilesLoading:h,conversation:g}=Pk(),x=Pe(yy((null==g?void 0:g.conversationId)??Sh.NEW_CONVO)),v=e=>c((t=>[...t,e])),{addFile:b,replaceFile:_,updateFileById:y,deleteFileById:j}=jE((null==e?void 0:e.fileSetter)??f),{resizeImageIfNeeded:w}=(()=>{const{data:e=null}=Yy({select:e=>fp(e)}),t=(null==e?void 0:e.clientImageResize)??{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},s=(null==t?void 0:t.enabled)??!1,a=n.useCallback((async(e,n)=>{if(!s)return{file:e,resized:!1};if(!_E())return console.warn("Client-side image resizing not supported in this browser"),{file:e,resized:!1};if(!function(e,t=536870912){return!(e.size<.1*t||!e.type.startsWith("image/")||"image/gif"===e.type)}(e))return{file:e,resized:!1};try{const s={maxWidth:null==t?void 0:t.maxWidth,maxHeight:null==t?void 0:t.maxHeight,quality:null==t?void 0:t.quality,...n},a=await yE(e,s);return{file:a.file,resized:!0,result:a}}catch(a){return console.warn("Client-side image resizing failed:",a),{file:e,resized:!1}}}),[s,t]);return{isEnabled:s,isSupported:_E(),config:t,resizeImageIfNeeded:a}})(),N=(null==(t=null==e?void 0:e.additionalMetadata)?void 0:t.agent_id)??"",C=(null==(s=null==e?void 0:e.additionalMetadata)?void 0:s.assistant_id)??"",{data:k=null}=Yy({select:e=>fp(e)}),S=n.useMemo((()=>(null==e?void 0:e.overrideEndpoint)??(null==g?void 0:g.endpointType)??(null==g?void 0:g.endpoint)??"default"),[null==e?void 0:e.overrideEndpoint,null==g?void 0:g.endpointType,null==g?void 0:g.endpoint]),E=n.useCallback((()=>{if(l.length>1){const e=Array.from(new Set(l)).map(((e,t)=>`${t>0?"• ":""}${r(e)||e}\n`)).join("");i({message:e,status:"error",duration:5e3})}else if(1===l.length){const e=r(l[0])||l[0];i({message:e,status:"error",duration:5e3})}c([])}),[l,i,r]),T=ko(E,250);n.useEffect((()=>(l.length>0&&T(),()=>T.cancel())),[l,T]);const I=((e,t)=>{const n=pr(),{onSuccess:s,...a}=e||{};return fr([yx.fileUpload],{mutationFn:e=>{const n=e.get("width")??"",s=e.get("height")??"",a=e.get("version")??"",r=e.get("endpoint")??"";return Yu(r)&&"2"===a?Rx.uploadFile(e,t):""!==n&&""!==s?Rx.uploadImage(e,t):Rx.uploadFile(e,t)},...a,onSuccess:(e,t,a)=>{n.setQueryData([xx.files],(t=>[e,...t??[]]));const r=t.get("endpoint"),o=t.get("message_file"),i=t.get("agent_id")??"",l=t.get("assistant_id")??"",c=t.get("tool_resource")??"";"true"!==o?(i&&c&&n.setQueryData([xx.agent,i],(t=>{var n,s;if(!t)return t;const a={},r=t.tool_resources??{},o=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};return o.file_ids||(o.file_ids=[]),o.file_ids.push(e.file_id),a.tool_resources={...r,[c]:o},(null==(s=t.tools)?void 0:s.includes(c))||(a.tools=[...t.tools??[],c]),{...t,...a}})),l?(n.setQueryData([xx.assistants,r,Su],(t=>t?{...t,data:t.data.map((t=>{var n;if(t.id!==l)return t;const s={};if(c||(s.file_ids=[...t.file_ids??[],e.file_id]),c===gu.code_interpreter){const a=t.tool_resources??{},r=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};r.file_ids||(r.file_ids=[]),r.file_ids.push(e.file_id),s.tool_resources={...a,[c]:r}}return{...t,...s}}))}:t)),null==s||s(e,t,a)):null==s||s(e,t,a)):null==s||s(e,t,a)}})})({onSuccess:e=>{m(e.temp_file_id),console.log("upload success",e),N?o.refetchQueries([xx.agent,N]):(y(e.temp_file_id,{progress:.9,filepath:e.filepath},!!C),setTimeout((()=>{y(e.temp_file_id,{progress:1,file_id:e.file_id,temp_file_id:e.temp_file_id,filepath:e.filepath,type:e.type,height:e.height,width:e.width,filename:e.filename,source:e.source,embedded:e.embedded},!!C)}),300))},onError:(e,t)=>{var n,s;const a=e;console.log("upload error",a);const r=t.get("file_id");t.get("tool_resource")===gu.execute_code&&x((e=>({...e,[gu.execute_code]:!1}))),m(r),j(r);let o="com_error_files_upload";"ERR_CANCELED"===(null==a?void 0:a.code)?o="com_error_files_upload_canceled":(null==(s=null==(n=null==a?void 0:a.response)?void 0:n.data)?void 0:s.message)&&(o=a.response.data.message),v(o)}},null==(a=d.current)?void 0:a.signal),R=async t=>{var n,s;const a=(null==(n=t.file)?void 0:n.name)??"File";u(t.file_id,a,t.size);const r=new FormData;r.append("endpoint",S),r.append("original_endpoint",(null==g?void 0:g.endpointType)||(null==g?void 0:g.endpoint)||""),r.append("file",t.file,encodeURIComponent(a)),r.append("file_id",t.file_id);const i=t.width??0,l=t.height??0;i&&r.append("width",i.toString()),l&&r.append("height",l.toString());const c=(null==e?void 0:e.additionalMetadata)??{};if(null==e?void 0:e.additionalMetadata)for(const[e,o=""]of Object.entries(c))o&&r.append(e,o);if(Xu(S)){N||r.append("message_file","true");const e=t.tool_resource;null!=e&&r.append("tool_resource",e),null!=(null==g?void 0:g.agent_id)&&null==r.get("agent_id")&&r.append("agent_id",g.agent_id)}if(!Yu(S))return void I.mutate(r);const d=(null==g?void 0:g.model)??"",m=(null==g?void 0:g.assistant_id)??"";C||r.append("message_file","true");const p=o.getQueryData([xx.endpoints]),f=(null==(s=null==p?void 0:p[S])?void 0:s.version)??Nf[S];!C&&m&&(r.append("version",f),r.append("model",d),r.append("assistant_id",m));(r.get("version")??"")||r.append("version",f);(r.get("model")??"")||r.append("model",d),I.mutate(r)},P=(e,t)=>{const n=new Image;n.onload=async()=>{e.width=n.width,e.height=n.height,e={...e,progress:.6},_(e),await R(e),URL.revokeObjectURL(t)},n.src=t},A=async(t,n)=>{var s,a,o;d.current=new AbortController;const l=Array.from(t);let c;try{c=(({files:e,fileList:t,setError:n,endpointFileConfig:s,toolResource:a,fileConfig:r})=>{var o,i,l;const{fileLimit:c,fileSizeLimit:d,totalSizeLimit:u,supportedMimeTypes:m}=s,p=Array.from(e.values()),f=t.reduce(((e,t)=>e+t.size),0);if(0===f)return n("com_error_files_empty"),!1;const h=p.reduce(((e,t)=>e+t.size),0);if(c&&t.length+e.size>c)return n(`You can only upload up to ${c} files at a time.`),!1;for(let x=0;x<t.length;x++){let e=t[x],s=e.type;const c=e.name.split(".").pop()??"",u=sp[c];if(!u||s&&s===u||(s=u),!s)return n("Unable to determine file type for: "+e.name),!1;if(e.type!==s){const n=new File([e],e.name,{type:s});e=n,t[x]=n}let p=m;if(a===gu.ocr&&(p=[...(null==(o=null==r?void 0:r.text)?void 0:o.supportedMimeTypes)||[],...(null==(i=null==r?void 0:r.ocr)?void 0:i.supportedMimeTypes)||[],...(null==(l=null==r?void 0:r.stt)?void 0:l.supportedMimeTypes)||[]]),!Fv(e.type,p))return console.log(e),n("Currently, unsupported file type: "+e.type),!1;if(d&&e.size>=d)return n(`File size exceeds ${d/rp} MB.`),!1}if(u&&h+f>u)return n(`The total size of the files cannot exceed ${u/rp} MB.`),!1;const g=[...p.map((e=>{var t,n;return`${(null==(t=e.file)?void 0:t.name)??e.filename}-${e.size}-${(null==(n=e.type)?void 0:n.split("/")[0])??"file"}`})),...t.map((e=>`${null==e?void 0:e.name}-${null==e?void 0:e.size}-${(null==e?void 0:e.type.split("/")[0])??"file"}`))];return new Set(g).size===g.length||(n("com_error_files_dupe"),!1)})({files:p,fileList:l,setError:v,endpointFileConfig:(null==e?void 0:e.overrideEndpointFileConfig)??(null==(s=null==k?void 0:k.endpoints)?void 0:s[S])??(null==(a=null==k?void 0:k.endpoints)?void 0:a.default)??cp.endpoints[S]??cp.endpoints.default,toolResource:n,fileConfig:k})}catch(u){return console.error("file validation error",u),void v("com_error_files_validation")}if(c)for(const d of l){const t=Xe();try{const s=URL.createObjectURL(d),a={file_id:t,file:d,type:d.type,preview:s,progress:.1,size:d.size};null!=n&&""!==n&&(a.tool_resource=n),b(a);("image/heic"===d.type||"image/heif"===d.type||d.name.toLowerCase().match(/\.(heic|heif)$/))&&i({message:r("com_info_heic_converting"),status:"info",duration:3e3});const l=await vE(d,.9,(e=>{const t=.1+.4*e;_({...a,progress:t})}));let c=l;if(l.type.startsWith("image/"))try{const e=await w(l);if(c=e.file,e.resized&&e.result){const{originalSize:t,newSize:n,compressionRatio:s}=e.result,a=(t/1048576).toFixed(1),r=(n/1048576).toFixed(1),o=Math.round(100*(1-s));i({message:`Image resized: ${a}MB → ${r}MB (${o}% smaller)`,status:"success",duration:3e3})}}catch(m){console.warn("Image resize failed, using original:",m)}if(c!==d){URL.revokeObjectURL(s);const e=URL.createObjectURL(c),t={...a,file:c,type:c.type,preview:e,progress:.5,size:c.size};_(t);if("image"===c.type.split("/")[0]){P(t,e);continue}await R(t)}else{const t="image"===d.type.split("/")[0],n=a.tool_resource??(null==(o=null==e?void 0:e.additionalMetadata)?void 0:o.tool_resource);if(Xu(S)&&!t&&null==n){v("com_error_files_unsupported_capability");continue}const r={...a,progress:.2};if(_(r),t){P(r,s);continue}await R(r)}}catch(u){j(t),console.log("file handling error",u),u instanceof Error&&u.message.includes("HEIC")?v("com_error_heic_conversion"):v("com_error_files_process")}}else h(!1)};return{handleFileChange:(e,t)=>{e.stopPropagation(),e.target.files&&(h(!0),A(e.target.files,t),e.target.value="")},handleFiles:A,abortUpload:()=>{d.current&&(s_.log("files","Aborting upload"),d.current.abort("User aborted upload"),d.current=null)},setFiles:f,files:p}};function NE({enabled:e=!0,purpose:t}){const{user:n}=Kk(),{data:s}=Ky(),a=null==s?void 0:s.sharePointBaseUrl,r=null==s?void 0:s.sharePointPickerGraphScope,o=null==s?void 0:s.sharePointPickerSharePointScope,i="openid"===(null==n?void 0:n.provider),l="Pick"===t?o:r,{data:c,isLoading:d,error:u,refetch:m}=Sy({scopes:l,enabled:e&&i&&!!a});return{token:c,isLoading:d,error:u,refetch:m}}function CE(e){const{handleFiles:t}=wE(e),{downloadSharePointFiles:s,isDownloading:a,downloadProgress:r,error:o}=function({onFilesDownloaded:e,onError:t}={}){const{showToast:s}=Bd(),[a,r]=n.useState(null),[o,i]=n.useState(null),{token:l,refetch:c}=NE({enabled:!1,purpose:"Download"}),d=Zy();return{downloadSharePointFiles:n.useCallback((async n=>{var a;if(!n||0===n.length)throw new Error("No files provided for download");i(null),r({completed:0,total:n.length,failed:[]});try{let t=null==l?void 0:l.access_token;if(!t&&(s({message:"Getting SharePoint access token...",status:"info",duration:2e3}),t=null==(a=(await c()).data)?void 0:a.access_token,!t))throw new Error("Failed to obtain SharePoint access token");s({message:`Downloading ${n.length} file(s) from SharePoint...`,status:"info",duration:3e3});const o=await d.mutateAsync({files:n,accessToken:t,onProgress:e=>{r(e),n.length>5&&e.completed%3==0&&s({message:`Downloaded ${e.completed}/${e.total} files...`,status:"info",duration:1e3})}});if(o.length>0){const t=n.length-o.length,a=t>0?`Downloaded ${o.length}/${n.length} files from SharePoint (${t} failed)`:`Successfully downloaded ${o.length} file(s) from SharePoint`;s({message:a,status:t>0?"warning":"success",duration:4e3}),e&&await e(o)}return r(null),o}catch(o){const e=o instanceof Error?o.message:"Unknown download error";throw i(e),s({message:`SharePoint download failed: ${e}`,status:"error",duration:5e3}),t&&t(o instanceof Error?o:new Error(e)),r(null),o}}),[l,s,d,e,t,c]),isDownloading:d.isLoading,downloadProgress:a,error:o}}({onFilesDownloaded:async n=>{const s=Array.from(n);await t(s,null==e?void 0:e.toolResource)},onError:e=>{console.error("SharePoint download failed:",e)}});return{handleSharePointFiles:n.useCallback((async e=>{try{await s(e)}catch(t){throw console.error("SharePoint file handling error:",t),t}}),[s]),isProcessing:a,downloadProgress:r,error:o}}function kE(e,t=[],s=300){const a=n.useRef(),r=n.useRef();r.current=n.useCallback(e,t);const o=n.useCallback(ko((()=>{var e;return a.current=null==(e=r.current)?void 0:e.call(r)}),s),[]);n.useEffect(o,t),n.useEffect((()=>()=>a.current instanceof Function?a.current():void 0),[])}function SE({textAreaRef:e,submitButtonRef:t,setIsScrollable:s,disabled:a=!1}){const r=Fk(),o=WS(),i=n.useRef(!1),l=Dk(),{handleFiles:c}=wE(),d=xS(),u=(()=>{const e=pr(),t=n.useRef(Date.now());return n.useCallback((()=>{const n=Date.now();n-t.current>vh.FIVE_MINUTES&&(s_.log("Checking health on interaction. Time elapsed:",n-t.current),e.invalidateQueries([xx.health]),t.current=n)}),[e])})(),m=Ae(Ny.enterToSend),{index:p,conversation:f,isSubmitting:h,filesLoading:g,latestMessage:x,setFilesLoading:v}=Pk(),[b,_]=Re(Ny.activePromptByIndex(p)),{endpoint:y=""}=f||{},{entity:j,isAgent:w,isAssistant:N}=Lb({endpoint:y,agentsMap:l,assistantMap:d,agent_id:null==f?void 0:f.agent_id,assistant_id:null==f?void 0:f.assistant_id}),C=(null==j?void 0:j.name)??"",k=(((null==x?void 0:x.unfinished)??!1)&&!h||((null==x?void 0:x.error)??!1))&&!N;n.useEffect((()=>{const t=b??"";t&&e.current&&(fb(e.current,t),hb(e.current),_(void 0))}),[b,_,e]),n.useEffect((()=>{var t,n;if((null==(t=e.current)?void 0:t.value)??"")return;const s=()=>{var e;if(a)return r("com_endpoint_config_placeholder");const t=(null==f?void 0:f.endpoint)??"",n=(null==f?void 0:f.agent_id)??"",s=(null==f?void 0:f.assistant_id)??"";if(!(!w||n&&(null==l?void 0:l[n])))return r("com_endpoint_agent_placeholder");if(N&&(!s||!(null==(e=null==d?void 0:d[t])?void 0:e[s])))return r("com_endpoint_assistant_placeholder");if(k)return r("com_endpoint_message_not_appendable");const i=N||w?(({name:e="",localize:t,isAgent:n})=>e&&e.length>0?e:t(!0===n?"com_ui_agent":"com_ui_assistant"))({name:C,isAgent:w,localize:r}):o(f);return`${r("com_endpoint_message_new",{0:i||r("com_endpoint_ai")})}`},i=s();if((null==(n=e.current)?void 0:n.getAttribute("placeholder"))===i)return;const c=ko((()=>{var t,n;const a=s();(null==(t=e.current)?void 0:t.getAttribute("placeholder"))!==a&&(null==(n=e.current)||n.setAttribute("placeholder",a),hb(e.current))}),80);return c(),()=>c.cancel()}),[w,r,a,o,l,C,e,N,d,f,x,k]);const S=n.useCallback((n=>{var a;if(e.current&&xb(e.current)){const t=xb(e.current);t&&s(t)}if("Enter"===n.key&&h)return;u();const r="Enter"===n.key&&!n.shiftKey,o="Enter"===n.key&&(n.ctrlKey||n.metaKey),l=i.current||"Process"===n.key||229===n.keyCode;if(r&&g&&n.preventDefault(),r&&n.preventDefault(),"Enter"===n.key&&!m&&!o&&e.current&&!l)return n.preventDefault(),fb(e.current,"\n"),void hb(e.current);if((r||o)&&!l){const e=document.getElementById(Qd);e&&(console.log("Unmuting global audio"),e.muted=!1),null==(a=t.current)||a.click()}}),[h,u,g,m,s,e,t]),E=n.useCallback((t=>{if(!e.current)return;const n=t.clipboardData;if(n&&n.files.length>0){v(!0);const e=[];for(const t of n.files){const n=new File([t],`clipboard_${+new Date}_${t.name}`,{type:t.type});e.push(n)}c(e)}}),[c,v,e]);return{textAreaRef:e,handlePaste:E,handleKeyDown:S,isNotAppendable:k,handleCompositionEnd:()=>{i.current=!1},handleCompositionStart:()=>{i.current=!0}}}const EE=e=>{const t={};return Object.entries(e).forEach((([e,n])=>{try{const s=Em.shape[e];if(s){const a=(e=>"true"===e||"false"!==e&&(isNaN(Number(e))?e:Number(e)))(n),r=s.parse(a);t[e]=r}}catch(s){console.warn(`Invalid value for setting ${e}:`,s)}})),null!=t.assistant_id&&t.assistant_id&&!Yu(t.endpoint)&&(t.endpoint=Uu.assistants),null!=t.agent_id&&t.agent_id&&!Xu(t.endpoint)&&(t.endpoint=Uu.agents),t};function TE({textAreaRef:e}){const t=n.useRef(0),s=n.useRef(!1),a=n.useRef(!1),r=n.useRef(!1),o=n.useRef(!1),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),d=cS(),[u,m]=Ps(),p=Ik(),f=Ae(Ny.modularChat),h=Ae(Ny.availableTools),{submitMessage:g}=VE(),x=pr(),{conversation:v,newConversation:b}=Pk(),_=u.get("agent_id")||"",{data:y}=Py(_,{enabled:!!_}),j=n.useCallback((e=>{var t;if(!e)return;let n=ub(e,h);if(null!=n.spec&&""!==n.spec){const e=x.getQueryData([xx.startupConfig]),s=((null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list)??[]).find((e=>e.name===n.spec));if(!s)return;const{preset:a}=s;a.iconURL=Pb(s),a.spec=s.name,n=a}let s=n.endpoint??"";const a=x.getQueryData([xx.endpoints]);if(s&&a&&!a[s]){const e=s.toLowerCase();for(const[t,r]of Object.entries(a))if(r&&r.type===Uu.custom&&t.toLowerCase()===e){s=t,n.endpoint=t,n.endpointType=Uu.custom;break}}const{template:r,shouldSwitch:o,isNewModular:i,newEndpointType:l,isCurrentModular:c,isExistingConversation:d}=Tb({newEndpoint:s,modularChat:f,conversation:v,endpointsConfig:a});let u={};null==n.spec&&(r.spec=null,r.iconURL=null,r.modelLabel=null,u={spec:null,iconURL:null,modelLabel:null},n={...n,...u});if(d&&(c&&i&&o)){r.endpointType=l;const e=p({conversation:{...v??{},endpointType:r.endpointType,...u},preset:r,cleanOutput:null!=n.spec&&""!==n.spec});return s_.log("conversation","Switching conversation from query params",e),void b({template:e,preset:n,keepLatestMessage:!0,keepAddedConvos:!0})}b({preset:n,keepAddedConvos:!0})}),[x,f,v,h,b,p]),w=n.useCallback((()=>{if(!l.current||!v)return!1;for(const[e,t]of Object.entries(l.current))if(!["presetOverride","iconURL","spec","modelLabel"].includes(e)&&v[e]!==t)return!1;return!0}),[v]),N=n.useCallback((()=>{!o.current&&a.current&&i.current&&(o.current=!0,a.current=!1,d.setValue("text",i.current,{shouldValidate:!0}),d.handleSubmit((e=>{var t;if(null==(t=e.text)?void 0:t.trim()){g(e);const t=window.location.pathname;window.history.replaceState({},"",t),console.log("Message submitted with conversation state:",v)}}))())}),[d,g,v]);n.useEffect((()=>{const n=setInterval((()=>{if(s.current||t.current>=50)return clearInterval(n),void(t.current>=50&&console.warn("Max attempts reached, failed to process parameters"));if(t.current+=1,!e.current)return;if(!x.getQueryData([xx.startupConfig]))return;const{decodedPrompt:r,validSettings:p,shouldAutoSubmit:f}=(()=>{var e;const t={};u.forEach(((e,n)=>{t[n]=e}));const n=t.prompt||t.q||"",s="true"===(null==(e=t.submit)?void 0:e.toLowerCase());return delete t.prompt,delete t.q,delete t.submit,{decodedPrompt:n,validSettings:EE(t),shouldAutoSubmit:s}})();f||(o.current=!0);Object.keys(p).length>0&&(l.current=p),r&&(i.current=r),f&&r?Object.keys(p).length>0?(a.current=!0,c.current=setTimeout((()=>{!o.current&&a.current&&(console.warn("Settings application timeout reached, proceeding with submission anyway"),N())}),3e3)):(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length),d.handleSubmit((e=>{var t;(null==(t=e.text)?void 0:t.trim())&&g(e)}))()):r?(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length)):o.current=!0,Object.keys(p).length>0&&j(p),(()=>{const e=u.toString(),t=new URLSearchParams(e);if(t.delete("prompt"),t.delete("q"),t.delete("submit"),m(t,{replace:!0}),s.current=!0,console.log("Parameters processed successfully",e),clearInterval(n),!a.current){const e=window.location.pathname;window.history.replaceState({},"",e)}})()}),100);return()=>{clearInterval(n),c.current&&clearTimeout(c.current)}}),[u,d,e,j,b,g,m,x,N]),n.useEffect((()=>{if(!s.current||o.current||r.current||!l.current||!v)return;w()&&(r.current=!0,a.current&&(c.current&&(clearTimeout(c.current),c.current=null),console.log("Settings fully applied, processing submission"),N()))}),[v,N,w]);const{isAuthenticated:C}=Kk(),k=Lk({isAuthenticated:C});n.useEffect((()=>{y&&((e,t)=>{const n=[xx.agents,{requiredPermission:px.EDIT}],s=e.getQueryData(n);if((null==s?void 0:s.data)&&!s.data.some((e=>e.id===t.id))){const a={...s,data:[t,...s.data]};e.setQueryData(n,a),s_.log("agent","Injected URL agent into cache:",t)}})(x,y)}),[y,x,k])}const IE={Escape:!0,Backspace:!0,Enter:!0},RE=(e,t)=>{var n,s;const a=null==(n=e.current)?void 0:n.value;if("string"!=typeof a||0===a.length||a[0]!==t)return!1;const r=null==(s=e.current)?void 0:s.selectionStart;return"number"==typeof r&&1===r};const PE=()=>{const e=Ae(Ny.engineSTT),t=Ae(Ny.engineTTS),s=e,a=t;return n.useMemo((()=>({speechToTextEndpoint:s,textToSpeechEndpoint:a})),[s,a])},AE=(e,t)=>{const{showToast:s}=Bd(),{speechToTextEndpoint:a}=PE(),r="external"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(!1),[m,p]=n.useState(!1),[f,h]=n.useState([]),[g,x]=n.useState(!1),[v,b]=n.useState((()=>E())),[_]=Re(Ny.decibelValue),[y]=Re(Ny.autoSendText),[j]=Re(Ny.languageSTT),[w]=Re(Ny.speechToText),[N]=Re(Ny.autoTranscribeAudio),{mutate:C,isLoading:k}=(S={onSuccess:n=>{const s=n.text;e(s),x(!1),y>-1&&w&&s.length>0&&setTimeout((()=>{t(s)}),1e3*y)},onError:()=>{s({message:"An error occurred while processing the audio, maybe the audio was too short",status:"error"}),x(!1)}},fr([yx.speechToText],{mutationFn:e=>Rx.speechToText(e),...S||{}}));var S;function E(){const e=["audio/webm","audio/webm;codecs=opus","audio/mp4","audio/ogg;codecs=opus","audio/ogg","audio/wav"];for(const t of e)if("undefined"!=typeof MediaRecorder&&MediaRecorder.isTypeSupported(t))return t;if("undefined"!=typeof navigator){const e=navigator.userAgent.toLowerCase();if(-1!==e.indexOf("safari")&&-1===e.indexOf("chrome"))return"audio/mp4";if(-1!==e.indexOf("firefox"))return"audio/ogg"}return"audio/webm"}const T=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});u(!0),o.current=e??null}catch{u(!1)}},I=()=>{if(f.length>0){const t=new Blob(f,{type:v}),n=(e=v).includes("mp4")?"m4a":e.includes("ogg")?"ogg":e.includes("wav")?"wav":"webm";h([]);const s=new FormData;s.append("audio",t,`audio.${n}`),j&&s.append("language",j),x(!0),c.current&&(c.current.removeEventListener("dataavailable",(e=>{f.push(e.data)})),c.current.removeEventListener("stop",I),c.current=null),C(s)}else s({message:"The audio was too short",status:"warning"});var e},R=async()=>{if(g)s({message:"A request is already being made. Please wait.",status:"warning"});else if(o.current||await T(),o.current)try{h([]);const e=E();b(e),c.current=new MediaRecorder(o.current,{mimeType:v}),c.current.addEventListener("dataavailable",(e=>{f.push(e.data)})),c.current.addEventListener("stop",I),c.current.start(100),!l.current&&N&&w&&((e,t)=>{const n=new AudioContext,s=n.createMediaStreamSource(e),a=n.createAnalyser();a.minDecibels=_,s.connect(a);const r=a.frequencyBinCount,o=new Uint8Array(r);let l=Date.now();const c=()=>{a.getByteFrequencyData(o),o.some((e=>e>0))&&(l=Date.now()),Date.now()-l>3e3?t():i.current=window.requestAnimationFrame(c)};i.current=window.requestAnimationFrame(c)})(o.current,P),p(!0)}catch(e){s({message:`Error starting recording: ${e}`,status:"error"})}else s({message:"Microphone permission not granted",status:"error"})},P=()=>{var e;c.current&&("recording"===c.current.state?(c.current.stop(),null==(e=o.current)||e.getTracks().forEach((e=>e.stop())),o.current=null,null!==i.current&&(window.cancelAnimationFrame(i.current),i.current=null),p(!1)):s({message:"MediaRecorder is not recording",status:"error"}))},A=async e=>{if(e.shiftKey&&e.altKey&&"KeyL"===e.code&&r){if(!window.MediaRecorder)return void s({message:"MediaRecorder is not supported in this browser",status:"error"});!1===d&&await T(),m?P():R(),e.preventDefault()}};return n.useEffect((()=>(window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)})),[m]),{isListening:m,externalStopRecording:()=>{m?P():s({message:"Not currently recording. Please start recording first.",status:"warning"})},externalStartRecording:()=>{m?s({message:"Already listening. Please stop recording first.",status:"warning"}):R()},isLoading:k}},ME=(e,t)=>{const{speechToTextEndpoint:s}=PE(),a="external"===s,{isListening:r,isLoading:o,startRecording:i,stopRecording:l}=((e,t)=>{const{showToast:s}=Bd(),{speechToTextEndpoint:a}=PE(),r="browser"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(),[c]=Re(Ny.autoSendText),[d]=Re(Ny.languageSTT),[u]=Re(Ny.autoTranscribeAudio),{listening:m,finalTranscript:p,resetTranscript:f,interimTranscript:h,isMicrophoneAvailable:g,browserSupportsSpeechRecognition:x}=at.useSpeechRecognition(),v=n.useMemo((()=>m),[m]);n.useEffect((()=>{null!=h&&""!==h&&i.current!==h&&(e(h),i.current=h)}),[e,h]),n.useEffect((()=>{if(null!=p&&""!==p&&o.current!==p)return e(p),o.current=p,c>-1&&p.length>0&&(l.current=setTimeout((()=>{t(p),f()}),1e3*c)),()=>{l.current&&clearTimeout(l.current)}}),[e,t,f,p,c]);const b=()=>{x?g?!0===v?rt.stopListening():rt.startListening({language:d,continuous:u}):s({message:"Microphone is not available",status:"error"}):s({message:"Browser does not support SpeechRecognition",status:"error"})};return n.useEffect((()=>{const e=e=>{e.shiftKey&&e.altKey&&"KeyL"===e.code&&!r&&b()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[]),{isListening:v,isLoading:!1,startRecording:b,stopRecording:b}})(e,t),{isListening:c,isLoading:d,externalStartRecording:u,externalStopRecording:m}=AE(e,t);return{isLoading:a?d:o,isListening:a?c:r,stopRecording:a?m:l,startRecording:a?u:i}};function LE(){const{data:e}=Ky(),{data:t}=hj(Uu.agents,{select:e=>{const t=new Map;return e.forEach((e=>{if(e.pluginKey.includes(Sh.mcp_delimiter)){const n=e.pluginKey.split(Sh.mcp_delimiter),s=n[n.length-1];t.has(s)||t.set(s,{name:s,pluginKey:e.pluginKey,authConfig:e.authConfig,authenticated:e.authenticated})}})),Array.from(t.values())}});return{mcpToolDetails:n.useMemo((()=>t&&(null==e?void 0:e.mcpServers)?t.filter((t=>{var n;const s=null==(n=null==e?void 0:e.mcpServers)?void 0:n[t.name];return!1!==(null==s?void 0:s.chatMenu)})):t),[t,null==e?void 0:e.mcpServers])}}function OE({enabled:e}={}){const{data:t}=lj({enabled:e});return{connectionStatus:null==t?void 0:t.connectionStatus}}function DE({conversationId:e}={}){var t,s;const a=Fk(),r=pr(),{showToast:o}=Bd(),{mcpToolDetails:i}=LE(),{data:l}=Ky(),{mcpValues:c,setMCPValues:d,isPinned:u,setIsPinned:m}=function({conversationId:e}){const t=e??Sh.NEW_CONVO,[s,a]=ge(wy),[r,o]=ge(jy(t)),[i,l]=Re(yy(t));n.useEffect((()=>{(null==i?void 0:i.mcp)&&i.mcp.length>0&&o(i.mcp)}),[null==i?void 0:i.mcp,o]),n.useEffect((()=>{r.length>0&&JSON.stringify(r)!==JSON.stringify(null==i?void 0:i.mcp)&&l((e=>({...e,mcp:r})))}),[r,null==i?void 0:i.mcp,l]),n.useEffect((()=>{const e=`${Eh.LAST_MCP_}${t}`;r.length>0&&e_(e)}),[r,t]);const c=n.useCallback((e=>{Array.isArray(e)&&o(e)}),[o]);return{isPinned:s,mcpValues:r,setIsPinned:a,setMCPValues:c}}({conversationId:e}),[p,f]=n.useState(!1),[h,g]=n.useState(null),x=n.useRef(null),v=n.useRef(c);n.useEffect((()=>{v.current=c}),[c]);const b=n.useMemo((()=>(null==l?void 0:l.mcpServers)?Object.entries(l.mcpServers).filter((([,e])=>!1!==e.chatMenu)).map((([e])=>e)):[]),[null==l?void 0:l.mcpServers]),_=_k(),y=yk(),j=bk({onSuccess:async()=>{o({message:a("com_nav_mcp_vars_updated"),status:"success"}),await Promise.all([r.refetchQueries([xx.tools]),r.refetchQueries([xx.mcpAuthValues]),r.refetchQueries([xx.mcpConnectionStatus])])},onError:e=>{console.error("Error updating MCP auth:",e),o({message:a("com_nav_mcp_vars_update_error"),status:"error"})}}),[w,N]=n.useState((()=>{const e={};return b.forEach((t=>{e[t]={isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null}})),e})),{connectionStatus:C}=OE({enabled:!!(null==l?void 0:l.mcpServers)&&Object.keys(l.mcpServers).length>0}),k=n.useRef(!1);n.useEffect((()=>{if(!C||0===Object.keys(C).length)return;if(!k.current)return void(k.current=!0);if(!(null==c?void 0:c.length))return;const e=c.filter((e=>{var t;return"connected"===(null==(t=C[e])?void 0:t.connectionState)}));e.length!==c.length&&d(e)}),[C,c,d]);const S=n.useCallback(((e,t)=>{N((n=>{const s={...n},a=s[e]||{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null};return s[e]={...a,...t},s}))}),[]),E=n.useCallback((e=>{const t=w[e];(null==t?void 0:t.pollInterval)&&clearInterval(t.pollInterval),S(e,{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null})}),[w,S]),T=n.useCallback((e=>{const t=setInterval((async()=>{try{await r.refetchQueries([xx.mcpConnectionStatus]);const n=r.getQueryData([xx.mcpConnectionStatus]),s=(null==n?void 0:n.connectionStatus)||{},i=w[e],l=s[e];if("connected"===(null==l?void 0:l.connectionState)){clearInterval(t),o({message:a("com_ui_mcp_authenticated_success",{0:e}),status:"success"});const n=v.current??[];return n.includes(e)||d([...n,e]),await r.invalidateQueries([xx.tools]),void setTimeout((()=>{E(e)}),1e3)}if((null==i?void 0:i.oauthStartTime)&&Date.now()-i.oauthStartTime>18e4)return o({message:a("com_ui_mcp_oauth_timeout",{0:e}),status:"error"}),clearInterval(t),void E(e);if("error"===(null==l?void 0:l.connectionState))return o({message:a("com_ui_mcp_init_failed"),status:"error"}),clearInterval(t),void E(e)}catch(n){return console.error(`[MCP Manager] Error polling server ${e}:`,n),clearInterval(t),void E(e)}}),3500);S(e,{pollInterval:t})}),[r,w,o,a,d,E,S]),I=n.useCallback((async(e,t=!0)=>{S(e,{isInitializing:!0});try{const n=await _.mutateAsync(e);if(!n.success)return o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),E(e),n;if(n.oauthRequired&&n.oauthUrl)S(e,{oauthUrl:n.oauthUrl,oauthStartTime:Date.now(),isCancellable:!0,isInitializing:!0}),t&&window.open(n.oauthUrl,"_blank","noopener,noreferrer"),T(e);else{await r.invalidateQueries([xx.mcpConnectionStatus]),o({message:a("com_ui_mcp_initialized_success",{0:e}),status:"success"});const t=c??[];t.includes(e)||d([...t,e]),E(e)}return n}catch(n){console.error(`[MCP Manager] Failed to initialize ${e}:`,n),o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),E(e)}}),[S,_,T,r,o,a,c,E,d]),R=n.useCallback((e=>{y.mutate(e,{onSuccess:()=>{E(e),r.invalidateQueries([xx.mcpConnectionStatus]),o({message:a("com_ui_mcp_oauth_cancelled",{0:e}),status:"warning"})},onError:t=>{console.error(`[MCP Manager] Failed to cancel OAuth for ${e}:`,t),o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"})}})}),[r,E,o,a,y]),P=n.useCallback((e=>{var t;return(null==(t=w[e])?void 0:t.isInitializing)||!1}),[w]),A=n.useCallback((e=>{var t;return(null==(t=w[e])?void 0:t.isCancellable)||!1}),[w]),M=n.useCallback((e=>{var t;return(null==(t=w[e])?void 0:t.oauthUrl)||null}),[w]),L=n.useMemo((()=>{var e,t;return(null==(t=null==(e=null==l?void 0:l.interface)?void 0:e.mcpServers)?void 0:t.placeholder)||a("com_ui_mcp_servers")}),[null==(s=null==(t=null==l?void 0:l.interface)?void 0:t.mcpServers)?void 0:s.placeholder,a]),O=n.useCallback((e=>{const t=[],n=[];e.forEach((e=>{if(P(e))return;const s=null==C?void 0:C[e];"connected"===(null==s?void 0:s.connectionState)?t.push(e):n.push(e)})),d(t),n.forEach((e=>{I(e)}))}),[C,d,I,P]),D=n.useCallback((e=>{if(P(e))return;const t=c??[];if(t.includes(e)){const n=t.filter((t=>t!==e));d(n)}else{const n=null==C?void 0:C[e];"connected"===(null==n?void 0:n.connectionState)?d([...t,e]):I(e)}}),[c,d,C,I,P]),F=n.useCallback(((e,t)=>{if(h&&h.name===e){const n={pluginKey:`${Sh.mcp_prefix}${e}`,action:"install",auth:t};j.mutate(n)}}),[h,j]),z=n.useCallback((e=>{if(h&&h.name===e){const t={pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{}};j.mutate(t);const n=(c??[]).filter((t=>t!==e));d(n)}}),[h,j,c,d]),U=n.useCallback((e=>{h&&F(h.name,e)}),[h,F]),V=n.useCallback((()=>{h&&z(h.name)}),[h,z]),B=n.useCallback((e=>{f(e),!e&&x.current&&setTimeout((()=>{x.current&&"function"==typeof x.current.focus&&x.current.focus(),x.current=null}),0)}),[]),$=n.useCallback((e=>{var t;const n=null==i?void 0:i.find((t=>t.name===e)),s=null==C?void 0:C[e],a=null==(t=null==l?void 0:l.mcpServers)?void 0:t[e],r=(null==a?void 0:a.customUserVars)&&Object.keys(a.customUserVars).length>0;return{serverName:e,serverStatus:s,tool:n,onConfigClick:t=>{t.stopPropagation(),t.preventDefault(),x.current=document.activeElement;const s=n||{name:e,pluginKey:`${Sh.mcp_prefix}${e}`,authConfig:(null==a?void 0:a.customUserVars)?Object.entries(a.customUserVars).map((([e,t])=>({authField:e,label:t.title,description:t.description}))):[],authenticated:!1};g(s),f(!0)},isInitializing:P(e),canCancel:A(e),onCancel:t=>{t.stopPropagation(),t.preventDefault(),R(e)},hasCustomUserVars:r}}),[A,i,P,R,C,null==l?void 0:l.mcpServers]),H=n.useCallback((()=>{if(!h)return null;const e={};(null==h?void 0:h.authConfig)&&h.authConfig.forEach((t=>{e[t.authField]={title:t.label||t.authField,description:t.description}}));const t={};return(null==h?void 0:h.authConfig)&&h.authConfig.forEach((e=>{t[e.authField]=""})),{serverName:h.name,serverStatus:null==C?void 0:C[h.name],isOpen:p,onOpenChange:B,fieldsSchema:e,initialValues:t,onSave:U,onRevoke:V,isSubmitting:j.isLoading}}),[h,C,p,B,U,V,j.isLoading]);return{configuredServers:b,initializeServer:I,cancelOAuthFlow:R,isInitializing:P,isCancellable:A,getOAuthUrl:M,mcpValues:c,setMCPValues:d,isPinned:u,setIsPinned:m,placeholderText:L,batchToggleServers:O,toggleServerSelection:D,localize:a,isConfigModalOpen:p,handleDialogOpenChange:B,selectedToolForConfig:h,setSelectedToolForConfig:g,handleSave:U,handleRevoke:V,getServerStatusIconProps:$,getConfigDialogProps:H}}function FE(e=.01,t=.007,s){const a=n.useCallback((e=>{const n=e?e/1048576:0;return e?n<=1?.1:Math.max(.05/Math.sqrt(n),.002):t}),[t]),r=n.useMemo((()=>a(s)),[s,a]),[o,i]=n.useState(e),l=n.useCallback((e=>r),[r,s]);return n.useEffect((()=>{let t,n;if(!(e>=1&&o>=1))return e>=1&&o<1?(i(.99),t=setTimeout((()=>{i(1)}),200)):n=setInterval((()=>{i((e=>{if(e>=1)return clearInterval(n),1;const t=l(e);return Math.min(e+t,.95)}))}),200),()=>{clearInterval(n),clearTimeout(t)}}),[o,e,r,s,l]),o}function zE({messageId:e,attachments:t}){const s=Ae(Ny.messageAttachmentsMap),a=n.useMemo((()=>t??s[e??""]??[]),[t,s,e]),r=function(e){const t=Fk();return n.useMemo((()=>{const n={};let s=0;return null==e||e.forEach((e=>{if(e.type===hu.web_search&&e[hu.web_search]){const t=e[hu.web_search];t&&"number"==typeof t.turn&&(n[t.turn.toString()]=t)}if(e.type===hu.file_search&&e[hu.file_search]){const a=e[hu.file_search].sources,r=new Map;a.forEach((e=>{const t=e.fileId;if(r.has(t)){const n=r.get(t);if(n){const t=[...n.pages||[],...e.pages||[]],s=[...new Set(t)].sort(((e,t)=>e-t)),a={...n.pageRelevance||{},...e.pageRelevance||{}};n.pages=s,n.relevance=Math.max(n.relevance||0,e.relevance||0),n.pageRelevance=a}}else r.set(t,{fileId:e.fileId,fileName:e.fileName,pages:e.pages||[],relevance:e.relevance||.5,pageRelevance:e.pageRelevance||{},metadata:e.metadata})}));const o={turn:s,organic:[],topStories:[],images:[],references:Array.from(r.values()).map((e=>({title:e.fileName||t("com_file_unknown"),link:`#file-${e.fileId}`,attribution:e.fileName||t("com_file_unknown"),snippet:e.pages&&e.pages.length>0?t("com_file_pages",{pages:e.pages.join(", ")}):"",type:"file",fileId:e.fileId,fileName:e.fileName,pages:e.pages,pageRelevance:e.pageRelevance,metadata:e.metadata})))};n[s.toString()]=o,s++}})),n}),[e,t])}(a);return{attachments:a,searchResults:r}}const UE=(e,t)=>t?`${t}${Sh.COMMON_DIVIDER}${e}`:t;function VE(){const{user:e}=Kk(),t=cS(),{ask:s,index:a,getMessages:r,setMessages:o,latestMessage:i}=Pk(),{addedIndex:l,ask:c,conversation:d}=aS(),u=Ae(Ny.autoSendPrompts),m=Ae(Ny.allConversationsSelector),p=Pe(Ny.activePromptByIndex(a)),f=n.useCallback((e=>{if(!e)return console.warn("No data provided to submitMessage");const n=r();!(null==n?void 0:n.some((e=>e.messageId===(null==i?void 0:i.messageId))))&&i&&o([...n||[],i]);const a=l&&m[l]&&d,u=a&&m.every((e=>e===Sh.NEW_CONVO))&&!(null==n?void 0:n.length)?Xe():void 0,p=a?Xe():void 0,f=l-1,h=(new Date).toISOString();s({text:e.text,overrideConvoId:UE(f,u),overrideUserMessageId:UE(f,p),clientTimestamp:h}),a&&c({text:e.text,overrideConvoId:UE(l,u),overrideUserMessageId:UE(l,p),clientTimestamp:h},{overrideMessages:n}),t.reset()}),[s,t,l,d,o,r,m,c,i]),h=n.useCallback((n=>{const s=Xh({text:n,user:e});if(u)return void f({text:s});const a=t.getValues("text").trim().length>1?`\n${s}`:s;p(a)}),[u,f,p,t,e]);return{submitMessage:f,submitPrompt:h}}const BE=/(\\ue203.*?\\ue204)/g,$E=/(\\ue200.*?\\ue201)/g,HE=/\\ue202turn(\d+)(search|image|news|video|ref|file)(\d+)/g,GE=/\\ue200|\\ue201|\\ue202|\\ue203|\\ue204|\\ue206/g,KE=/\s*\\ue202turn\d+(search|news|image|video|ref|file)\d+/g,WE={search:"organic",ref:"references",news:"topStories",image:"images",video:"videos"};function qE({text:e,content:t,searchResults:s}){const a=n.useRef(null);n.useEffect((()=>()=>{a.current&&clearTimeout(a.current)}),[]);return n.useCallback((n=>{a.current&&clearTimeout(a.current),n(!0);let r=e??"";if(t&&(r=t.reduce(((e,n,s)=>{if(n.type===Ph.TEXT){return e+("string"==typeof n.text?n.text:n.text.value)+(s===t.length-1?"":"\n")}return e}),"")),!s||0===Object.keys(s).length){const e=r.replace(KE,"").replace(GE,"");return ot(e,{format:"text/plain"}),void(a.current=setTimeout((()=>{n(!1)}),3e3))}const o=function(e,t){var n,s;const a=new Map,r=new Map;let o=1,i=e;i=i.replace(BE,(e=>`**${e.replace(/\\ue203|\\ue204/g,"")}**`));const l=[];let c;const d=new RegExp(HE.source,"g");for(;null!==(c=d.exec(i));)l.push({turn:c[1],type:c[2],index:c[3],position:c.index,fullMatch:c[0],isComposite:!1});let u;const m=new RegExp($E.source,"g");for(;null!==(u=m.exec(i));){const e=u[0],t=u.index;let n;const s=new RegExp(HE.source,"g");for(;null!==(n=s.exec(e));)l.push({turn:n[1],type:n[2],index:n[3],position:t+n.index,fullMatch:e,isComposite:!0})}l.sort(((e,t)=>e.position-t.position));const p=new Set,f=[],h=new Map;for(const g of l){const{turn:e,type:i,index:l,fullMatch:c,isComposite:d}=g,u=t[e];if(!u)continue;const m=WE[i.toLowerCase()]||i.toLowerCase(),x=parseInt(l,10);if(!u[m]||!u[m][x])continue;const v=u[m][x],b=v.link||"";if(!b)continue;let _=r.get(b);_||(_=`${e}-${m}-${x}`,r.set(b,_));const y={link:b,title:v.title||v.name||"",attribution:v.attribution||v.source||"",type:m,typeIndex:x,citationKey:_};if(d&&p.has(c))continue;let j="",w=a.get(_);if(w||(w={referenceNumber:o++,link:y.link,title:y.title,source:y},a.set(_,w)),w){if(d){if(!p.has(c)){const e=[];let i;const l=new RegExp(HE.source,"g");for(;null!==(i=l.exec(c));){const l=i[1],c=i[2],d=i[3],u=WE[c.toLowerCase()]||c.toLowerCase(),m=null==(s=null==(n=t[l])?void 0:n[u])?void 0:s[parseInt(d,10)];if(m&&m.link){const t=m.link;let n=r.get(t);n||(n=`${l}-${u}-${d}`,r.set(t,n));let s=a.get(n);s||(s={referenceNumber:o++,link:m.link,title:m.title||m.name||"",source:{link:m.link,title:m.title||m.name||"",attribution:m.attribution||m.source||"",type:u,typeIndex:parseInt(d,10),citationKey:n}},a.set(n,s)),s&&e.push(s.referenceNumber)}}const d=[...new Set(e)].sort(((e,t)=>e-t));j=d.length>0?d.map((e=>`[${e}]`)).join(""):"",p.add(c),h.set(c,d),f.push([c,j])}continue}j=`[${w.referenceNumber}]`,f.push([c,j])}}f.sort(((e,t)=>t[0].length-e[0].length));for(const[g,x]of f)i=i.replace(g,x);return i=i.replace(/\n\s*\[\d+\](\[\d+\])*\s*$/g,""),i=i.replace(KE,""),i=i.replace(GE,""),{formattedText:i,citations:a}}(r,s);let i=o.formattedText;if(o.citations.size>0){i+="\n\nCitations:\n";const e=Array.from(o.citations.entries()).sort(((e,t)=>e[1].referenceNumber-t[1].referenceNumber));for(const[t,n]of e)i+=`[${n.referenceNumber}] ${n.link}\n`}ot(i,{format:"text/plain"}),a.current=setTimeout((()=>{n(!1)}),3e3)}),[e,t,s])}function QE(e){const t=Fk(),{user:s}=Kk(),a=Ae(Ny.UsernameDisplay),{message:r,currentEditId:o,setCurrentEditId:i,isMultiMessage:l,searchResults:c}=e,{ask:d,index:u,regenerate:m,latestMessage:p,handleContinue:f,setLatestMessage:h,conversation:g,isSubmitting:x}=Pk(),{conversation:v,isSubmitting:b}=aS(),_=n.useMemo((()=>!0===l?v:g),[l,v,g]),y=Dk(),j=xS(),{text:w,content:N,messageId:C=null,isCreatedByUser:k}=r??{},S=n.useMemo((()=>C===o),[C,o]),[E,T]=n.useState((()=>{var e,t;if(null==r?void 0:r.feedback){const n=zu(null==(t=null==(e=r.feedback)?void 0:e.tag)?void 0:t.key);return{rating:r.feedback.rating,tag:n,text:r.feedback.text}}})),I=n.useCallback((e=>i&&i(!0===e?-1:C)),[C,i]),R=n.useMemo((()=>{if(!Yu(null==_?void 0:_.endpoint))return;const e=(null==_?void 0:_.endpoint)??"",t=(null==r?void 0:r.model)??"";return(null==j?void 0:j[e])?j[e][t]:void 0}),[null==_?void 0:_.endpoint,null==r?void 0:r.model,j]),P=n.useMemo((()=>{if(!Xu(null==_?void 0:_.endpoint))return;if(!y)return;const e=(null==r?void 0:r.model)??"";if(e)return y[e];const t=(null==_?void 0:_.agent_id)??"";return t?y[t]:void 0}),[y,null==_?void 0:_.agent_id,null==_?void 0:_.endpoint,null==r?void 0:r.model]),A=n.useMemo((()=>!0===l?b:x),[l,b,x]),M=n.useCallback((()=>{A&&!0===k||!r||m(r)}),[A,k,r,m]),L=qE({text:w,content:N,searchResults:c}),O=n.useMemo((()=>!0===(null==r?void 0:r.isCreatedByUser)?a?((null==s?void 0:s.name)??"")||(null==s?void 0:s.username):t("com_user_message"):P?P.name??"Assistant":R?R.name??"Assistant":null==r?void 0:r.sender),[r,P,R,a,s,t]),D=wk((null==_?void 0:_.conversationId)||"",(null==r?void 0:r.messageId)||""),F=n.useCallback((({feedback:e})=>{const t={feedback:e?Fu(e):void 0};D.mutate(t,{onSuccess:e=>{var t;if(e.feedback){const n=zu((null==(t=e.feedback)?void 0:t.tag)??void 0);T({rating:e.feedback.rating,tag:n,text:e.feedback.text})}else T(void 0)},onError:e=>{console.error("Failed to update feedback:",e)}})}),[D]);return{ask:d,edit:S,index:u,agent:P,assistant:R,enterEdit:I,conversation:_,messageLabel:O,isSubmitting:A,latestMessage:p,handleContinue:f,copyToClipboard:L,setLatestMessage:h,regenerateMessage:M,handleFeedback:F,feedback:E}}function YE({message:e}){const t=n.useRef(""),[s,a]=n.useState(null),r=n.useMemo((()=>{var t;return 0===((null==(t=null==e?void 0:e.children)?void 0:t.length)??0)}),[e]),{index:o,conversation:i,latestMessage:l,setAbortScroll:c,setLatestMessage:d,isSubmitting:u}=Pk(),{isSubmitting:m}=aS(),p=Ae(Ny.latestMessageFamily(o+1)),f=n.useMemo((()=>u||m),[u,m]);n.useEffect((()=>{const n=null==i?void 0:i.conversationId;if(n===Sh.NEW_CONVO)return;if(!e)return;if(!r)return;const s=_b(e,n),a={textKey:s,"latestText.current":t.current,messageId:e.messageId,convoId:n};s!==t.current||null!=n&&t.current&&n!==t.current.split(Sh.COMMON_DIVIDER)[2]?(s_.log("latest_message","[useMessageProcess] Setting latest message; logInfo:",a),t.current=s,d({...e})):s_.log("latest_message","No change in latest message; logInfo",a)}),[r,e,d,null==i?void 0:i.conversationId]);const h=n.useCallback((e=>{Eo((()=>{s_.log("message_scrolling",`useMessageProcess: setting abort scroll to ${f}, handleScroll event`,e),c(!!f)}),500)()}),[f,c]),g=n.useMemo((()=>{var e;return r&&p&&0===((null==(e=p.children)?void 0:e.length)??0)||!!s}),[r,p,s]);return n.useEffect((()=>{if(r&&p&&p.conversationId===(null==e?void 0:e.conversationId)){const t=Object.assign({},p,{parentMessageId:e.parentMessageId,depth:e.depth});a(t)}}),[r,p,e,a,l]),{showSibling:g,handleScroll:h,conversation:i,siblingMessage:s,setSiblingMessage:a,isSubmittingFamily:f,latestMultiMessage:p}}const XE=.85,ZE=150;function JE(e){const t=Ae(Ny.autoScroll),s=n.useRef(null),a=n.useRef(null),[r,o]=n.useState(!1),{conversation:i,setAbortScroll:l,isSubmitting:c,abortScroll:d}=Pk(),{conversationId:u}=i??{},m=n.useRef(),p=n.useCallback((e=>{clearTimeout(m.current),m.current=setTimeout((()=>{o(e)}),ZE)}),[]);n.useEffect((()=>{if(!a.current||!s.current)return;const e=new IntersectionObserver((([e])=>{p(!e.isIntersecting)}),{root:s.current,threshold:XE});return e.observe(a.current),()=>{e.disconnect(),clearTimeout(m.current)}}),[a,s,p]);const f=n.useCallback((()=>{if(a.current&&s.current){const e=new IntersectionObserver((([e])=>{p(!e.isIntersecting)}),{root:s.current,threshold:XE});return e.observe(a.current),()=>e.disconnect()}}),[p]),h=()=>p(!1),{scrollToRef:g,handleSmoothToRef:x}=function({targetRef:e,callback:t,smoothCallback:s}){const a=(t,n)=>{var s;null==(s=e.current)||s.scrollIntoView({behavior:t}),n()},r=n.useCallback(Eo((()=>a("instant",t)),145,{leading:!0}),[e]),o=n.useCallback(Eo((()=>a("smooth",s)),750,{leading:!0}),[e]);return{scrollToRef:r,handleSmoothToRef:e=>{e.preventDefault(),o()}}}({targetRef:a,callback:h,smoothCallback:()=>{h(),l(!1)}});return n.useEffect((()=>{if(e&&0!==e.length&&a.current&&s.current)return c&&g&&!0!==d&&g(),()=>{!0===d&&g&&g.cancel()}}),[c,e,g,d]),n.useEffect((()=>{a.current&&s.current&&g&&t&&u!==Sh.NEW_CONVO&&g()}),[t,u,g]),{conversation:i,scrollableRef:s,messagesEndRef:a,scrollToBottom:g,showScrollButton:r,handleSmoothToRef:x,debouncedHandleScroll:f}}function eT({conversationId:e,toolKey:t,localStorageKey:s,isAuthenticated:a,setIsDialogOpen:r,authConfig:o}){var i;const l=e??Sh.NEW_CONVO,[c,d]=Re(yy(l)),u=oj({toolId:(null==o?void 0:o.toolId)||""},{enabled:!!(null==o?void 0:o.toolId),...null==o?void 0:o.queryOptions}),m=n.useMemo((()=>{var e;return a??(!!o&&((null==(e=null==u?void 0:u.data)?void 0:e.authenticated)??!1))}),[a,o,null==(i=u.data)?void 0:i.authenticated]),p=n.useMemo((()=>t),[t]),f=n.useMemo((()=>`${s}${l}`),[s,l]),h=n.useMemo((()=>(null==c?void 0:c[p])??!1),[c,p]),g=n.useMemo((()=>"string"==typeof h?h.length>0:!0===h),[h]);n.useEffect((()=>{const e=null==c?void 0:c[p];void 0!==e&&(localStorage.setItem(f,JSON.stringify(e)),e_(f))}),[c,p,f]);const[x,v]=function(e,t,s,a){const[r,o]=n.useState(t);n.useEffect((()=>{const n=localStorage.getItem(e);n||localStorage.setItem(e,JSON.stringify(t));const s=n&&"undefined"!==n?JSON.parse(n):t;function a(t){if(t.key!==e)return;const n=localStorage.getItem(e);o(JSON.parse(n??""))}return o(s),window.addEventListener("storage",a),()=>{window.removeEventListener("storage",a)}}),[e,s]);const i=n.useCallback((t=>{try{o(t),a||(localStorage.setItem(e,JSON.stringify(t)),null==window||window.dispatchEvent(new StorageEvent("storage",{key:e}))),null==s||s(t)}catch(Di){console.error(Di)}}),[e,s,a]);return[r,i]}(`${s}pinned`,!1),b=n.useCallback((({e:e,value:t})=>{var n;if(void 0!==m&&!m&&r)return r(!0),null==(n=null==e?void 0:e.preventDefault)||n.call(e),void d((e=>({...e||{},[p]:!1})));d((e=>({...e||{},[p]:t})))}),[r,m,d,p]),_=n.useMemo((()=>ko(b,50,{leading:!0})),[b]);return{toggleState:h,handleChange:b,isToolEnabled:g,toolValue:h,setToggleState:e=>b({value:e}),ephemeralAgent:c,debouncedChange:_,setEphemeralAgent:d,authData:null==u?void 0:u.data,isPinned:x,setIsPinned:v}}const tT=e=>{const t=pr(),s=null==e?void 0:e.isEntityTool,a=bk({onMutate:e=>{t.setQueryData([xx.toolAuth,hu.execute_code],(()=>({authenticated:"install"===e.action,message:Mu.USER_PROVIDED})))},onSuccess:()=>{t.invalidateQueries([xx.toolAuth,hu.execute_code])},onError:()=>{t.invalidateQueries([xx.toolAuth,hu.execute_code])}}),r=n.useCallback((e=>{a.mutate({pluginKey:hu.execute_code,action:"install",auth:{LIBRECHAT_CODE_API_KEY:e},isEntityTool:s})}),[a,s]);return{removeTool:n.useCallback((()=>{a.mutate({pluginKey:hu.execute_code,action:"uninstall",auth:{LIBRECHAT_CODE_API_KEY:null},isEntityTool:s})}),[a,s]),installTool:r}};function nT({onSubmit:e,onRevoke:t}){const s=zo(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=tT({isEntityTool:!0}),{reset:d}=s,u=n.useCallback((t=>{d(),l(t.apiKey),i(!1),null==e||e()}),[e,d,l]),m=n.useCallback((()=>{d(),c(),i(!1),null==t||t()}),[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}const sT=e=>{const t=pr(),s=null==e?void 0:e.isEntityTool,a=bk({onMutate:e=>{t.setQueryData([xx.toolAuth,hu.web_search],(()=>({authenticated:"install"===e.action,authTypes:"install"===e.action?[["providers",Mu.USER_PROVIDED],["scrapers",Mu.USER_PROVIDED],["rerankers",Mu.USER_PROVIDED]]:[]})))},onSuccess:()=>{t.invalidateQueries([xx.toolAuth,hu.web_search])},onError:()=>{t.invalidateQueries([xx.toolAuth,hu.web_search])}}),r=n.useCallback((e=>{const t=Object.entries({serperApiKey:e.serperApiKey,searxngInstanceUrl:e.searxngInstanceUrl,searxngApiKey:e.searxngApiKey,firecrawlApiKey:e.firecrawlApiKey,firecrawlApiUrl:e.firecrawlApiUrl,jinaApiKey:e.jinaApiKey,jinaApiUrl:e.jinaApiUrl,cohereApiKey:e.cohereApiKey}).reduce(((e,[t,n])=>(n&&(e[t]=n),e)),{});a.mutate({pluginKey:hu.web_search,action:"install",auth:t,isEntityTool:s})}),[a,s]);return{removeTool:n.useCallback((()=>{a.mutate({pluginKey:hu.web_search,action:"uninstall",auth:{},isEntityTool:s})}),[a,s]),installTool:r}};function aT({onSubmit:e,onRevoke:t}){const s=zo(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=sT({isEntityTool:!0}),{reset:d}=s,u=n.useCallback((t=>{l(t),i(!1),null==e||e()}),[e,l]),m=n.useCallback((()=>{d(),c(),i(!1),null==t||t()}),[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}function rT(){const[e,t]=n.useState(1),[s,a]=n.useState(1),[r,o]=n.useState(1),[i,l]=n.useState(!1),[c,d]=n.useState(""),[u,m]=n.useState(!1),[p,f]=n.useState(""),[h,g]=n.useState(!1),[x,v]=n.useState(void 0),b=e=>{const t=e.offsetWidth;let n;t<501?o(8):(n=t<640?2:t<1024?3:4,o(2*n))},_=n.useCallback((e=>{if(null!==e){1===r&&b(e);new ResizeObserver((()=>b(e))).observe(e)}}),[r]);return{maxPage:e,setMaxPage:t,currentPage:s,setCurrentPage:a,itemsPerPage:r,setItemsPerPage:o,searchChanged:i,setSearchChanged:l,searchValue:c,setSearchValue:d,gridRef:_,handleSearch:e=>{d(e.target.value),l(!0)},handleChangePage:e=>{a(e)},error:u,setError:m,errorMessage:p,setErrorMessage:f,showPluginAuthForm:h,setShowPluginAuthForm:g,selectedPlugin:x,setSelectedPlugin:v}}const oT=[{label:"com_ui_loading",value:""}],iT={label:"com_ui_empty_category",value:""},lT=(e="")=>{const t=Fk(),{data:n=oT}=(a={select:n=>n.map((n=>({label:t(n.label),value:n.value,icon:n.value?s.jsx(VS,{category:n.value,className:e}):null})))},mr([xx.categories],(()=>Rx.getCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...a,enabled:void 0===(null==a?void 0:a.enabled)||a.enabled}));var a;return{categories:n,emptyCategory:iT}};const cT=()=>{const e=Wk({permissionType:hg.PEOPLE_PICKER,permission:gg.VIEW_USERS}),t=Wk({permissionType:hg.PEOPLE_PICKER,permission:gg.VIEW_GROUPS}),s=Wk({permissionType:hg.PEOPLE_PICKER,permission:gg.VIEW_ROLES}),a=e||t||s,r=n.useMemo((()=>{const n=[];return e&&n.push(dx.USER),t&&n.push(dx.GROUP),s&&n.push(dx.ROLE),0===n.length||3===n.length?null:n}),[e,t,s]);return{canViewUsers:e,canViewRoles:s,canViewGroups:t,hasPeoplePickerAccess:a,peoplePickerTypeFilter:r}},dT=(e,t,s=!1)=>{var a;const r=(e=>Ob[e])(e),o=!!t&&""!==t.trim(),{data:i,isLoading:l,error:c}=kk(e,t||"",{enabled:o}),d=Sk(),u=(null==(a=null==i?void 0:i.principals)?void 0:a.map((e=>({type:e.type,id:e.id,name:e.name,email:e.email,source:e.source,avatar:e.avatar,description:e.description,accessRoleId:e.accessRoleId,idOnTheSource:e.idOnTheSource}))))||[],m=(null==i?void 0:i.public)??!1,p=(null==i?void 0:i.publicAccessRoleId)||(null==r?void 0:r.defaultViewerRoleId),[f,h]=n.useState(!1),[g,x]=n.useState(null==r?void 0:r.defaultViewerRoleId);return n.useEffect((()=>{i&&s&&(h(m??!1),x(p))}),[i,s,m,p]),{config:r,permissionsData:i,isLoadingPermissions:l,permissionsError:c,updatePermissionsMutation:d,currentShares:u,currentIsPublic:m,currentPublicRole:p,isPublic:f,setIsPublic:h,publicRole:g,setPublicRole:x}};function uT(e){const t=Pe(Ny.messageAttachmentsMap);return({data:n})=>{const{messageId:s}=n;if(e&&(null==n?void 0:n.filepath)&&!n.filepath.includes("/api/files")&&e.setQueryData([xx.files],(e=>[n,...e||[]])),e&&n.type===hu.memory&&n[hu.memory]){const t=n[hu.memory];e.setQueryData([xx.memories],(e=>e&&function({memoryArtifact:e,currentData:t}){const{type:n,key:s,value:a,tokenCount:r=0}=e;if("update"===n&&!a)return;const o=t.memories,i=o.findIndex((e=>e.key===s));if("delete"===n){if(-1===i)return;const e=o[i],n=[...o];n.splice(i,1);const s=t.totalTokens-(e.tokenCount||0),a=t.tokenLimit?Math.min(100,Math.round(s/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:s,usagePercentage:a}}if("update"===n){const e=(new Date).toISOString();let n,l=t.totalTokens;i>=0?(l=l-(o[i].tokenCount||0)+r,n=[...o],n[i]={key:s,value:a,tokenCount:r,updated_at:e}):(l+=r,n=[...o,{key:s,value:a,tokenCount:r,updated_at:e}]);const c=t.tokenLimit?Math.min(100,Math.round(l/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:l,usagePercentage:c}}}({memoryArtifact:t,currentData:e})||e))}t((e=>{const t=e[s]||[];return{...e,[s]:[...t,n]}}))}}const mT=({errorMetadata:e,getMessages:t,submission:n,error:s})=>{const a=t(),r=null==a?void 0:a[a.length-1];let o;const i=n.initialResponse.text.length>45?n.initialResponse.text:"",l=((null==e?void 0:e.text)||i||(null==s?void 0:s.message))??"Error cancelling request",c=(null==r?void 0:r.content)??[];let d=!1;if(c.length>0){const e=c[c.length-1],t=null==e?void 0:e[e.type??""];d=e.type!==Ph.TEXT||e.type===Ph.TEXT&&"string"==typeof t||""!==(null==t?void 0:t.value)}if((null==r?void 0:r.conversationId)&&(null==r?void 0:r.messageId)&&c&&d){const t=[...c];return t.push({type:Ph.ERROR,error:l}),o={...r,...e,error:void 0,text:"",content:t},n.userMessage.messageId&&n.userMessage.messageId!==o.parentMessageId&&(o.parentMessageId=n.userMessage.messageId),o}return e||(o={...n,...n.initialResponse,text:l,unfinished:!!i.length,error:!0},jm.parse(o))},pT=({parentId:e,queryClient:t,currentTitle:n,conversationId:s})=>{if(e!==Sh.NO_PARENT&&(null==n?void 0:n.toLowerCase().includes("new chat"))){const e=t.getQueryData([xx.conversation,s]);if(null==e?void 0:e.title)return e.title;const n=ob(t.getQueryData([xx.allConversations]),s??"");return(null==n?void 0:n.title)??(null==e?void 0:e.title)??null}return n};function fT({genTitle:e,setMessages:t,getMessages:s,setCompleted:a,isAddedRequest:r=!1,setConversation:o,setIsSubmitting:i,newConversation:l,setShowStopButton:c,resetLatestMessage:d}){const u=pr(),{announcePolite:m}=_S(),p=Ie((({snapshot:e,set:t})=>async(n,s=Sh.NEW_CONVO,a)=>{const r=s||Sh.NEW_CONVO;if(s_.log("agents",`Attempting to apply template from "${r}" to "${n}"`),n!==r)try{const s=a??await e.getPromise(yy(r));s?(s_.log("agents",`Applying agent template to "${n}":`,s),t(yy(n),s)):(s_.warn("agents",`Agent template from "${r}" is null or unset. Setting agent for "${n}" to null.`),t(yy(n),null))}catch(o){s_.error("agents",`Error applying agent template from "${r}" to "${n}":`,o),t(yy(n),null)}else s_.warn("agents",`Attempted to apply template to itself ("${r}"). Skipping.`)}),[]),f=Pe(Ny.abortScroll),h=Fe(),g=De(),x=n.useRef(Date.now()),{conversationId:v}=nt(),{token:b}=Kk(),_=function({setMessages:e,getMessages:t}){const s=pr(),a=n.useMemo((()=>new Map),[]);return n.useCallback((({data:n,submission:r})=>{const{type:o,messageId:i,thread_id:l,conversationId:c,index:d}=n,u=t(),m=(null==u?void 0:u.filter((e=>e.messageId!==i)).map((e=>({...e,thread_id:l}))))??[],p=m[m.length-1],{initialResponse:f}=r;let h=a.get(i);h||(h={...f,parentMessageId:(null==p?void 0:p.messageId)??"",conversationId:c,messageId:i,thread_id:l},a.set(i,h));const g=n[Ph.TEXT],x=null!=g&&"string"==typeof g?{value:g}:n[o];o===Ph.IMAGE_FILE&&Ov(s,x),h.content=[...h.content??[]],h.content[d]={type:o,[o]:x},o!==Ph.TEXT&&f.content&&(h.content[h.content.length-1].type===Ph.TOOL_CALL&&1===h.content[h.content.length-1][Ph.TOOL_CALL].progress||h.content[h.content.length-1].type===Ph.IMAGE_FILE)&&h.content.push(f.content[0]),e([...m,h])}),[s,t,a,e])}({setMessages:t,getMessages:s}),{stepHandler:y,clearStepMaps:j}=function({setMessages:e,getMessages:t,setIsSubmitting:s,announcePolite:a,lastAnnouncementTimeRef:r}){const o=n.useRef(new Map),i=n.useRef(new Map),l=n.useRef(new Map),c=(e,t,n,s)=>{var a;if(t.length>0&&(n===Ph.TEXT||n===Ph.THINK)){const r=e+t.length-1;if((null==(a=null==s?void 0:s[r])?void 0:a.type)===n)return r}return e+t.length},d=(e,t,n,s=!1)=>{const a=n.type??"";if(!a)return console.warn("No content type found in content part"),e;const r=[...e.content||[]];if(r[t]||(r[t]={type:n.type}),a.startsWith(Ph.TEXT)&&Ph.TEXT in n&&"string"==typeof n.text){const e=r[t],s={type:Ph.TEXT,text:(e.text||"")+n.text};null!=n.tool_call_ids&&(s.tool_call_ids=n.tool_call_ids),r[t]=s}else if(a.startsWith(Ph.AGENT_UPDATE)&&Ph.AGENT_UPDATE in n&&n.agent_update){const e={type:Ph.AGENT_UPDATE,agent_update:n.agent_update};r[t]=e}else if(a.startsWith(Ph.THINK)&&Ph.THINK in n&&"string"==typeof n.think){const e=r[t],s={type:Ph.THINK,think:(e.think||"")+n.think};r[t]=s}else if(a===Ph.IMAGE_URL&&"image_url"in n){const e=r[t];r[t]={...e}}else if(a===Ph.TOOL_CALL&&"tool_call"in n){const e=r[t],a=null==e?void 0:e.tool_call,o=n.tool_call.args,i=s||"object"==typeof(null==a?void 0:a.args)||"object"==typeof o?n.tool_call.args:((null==a?void 0:a.args)??"")+(o??""),l={id:Bh([n.tool_call.id,null==a?void 0:a.id])??"",name:Bh([n.tool_call.name,null==a?void 0:a.name])??"",args:i,type:Mh.TOOL_CALL,auth:n.tool_call.auth,expires_at:n.tool_call.expires_at};s&&(l.progress=1,l.output=n.tool_call.output),r[t]={type:Ph.TOOL_CALL,tool_call:l}}return{...e,content:r}};return{stepHandler:n.useCallback((({event:n,data:u},m)=>{var p,f,h,g,x,v,b,_,y,j,w,N,C;const k=t()||[],{userMessage:S}=m;s(!0);let E=S.messageId;const T=Date.now();T-r.current>Gd&&(a({message:"composing",isStatus:!0}),r.current=T);let I=[];if(null!=(null==m?void 0:m.editedContent)&&(I=(null==(p=null==m?void 0:m.initialResponse)?void 0:p.content)??I),"on_run_step"===n){const t=u;let n=t.runId??"";if(n===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(n=(null==(f=null==m?void 0:m.initialResponse)?void 0:f.messageId)??"",E=(null==(h=null==m?void 0:m.initialResponse)?void 0:h.parentMessageId)??""),!n)return void console.warn("No message id found in run step event");l.current.set(t.id,t);let s=i.current.get(n);if(s||(s={...k[k.length-1],parentMessageId:E,conversationId:S.conversationId,messageId:n,content:I},i.current.set(n,s),e([...k.slice(0,-1),s])),t.stepDetails.type===Ah.TOOL_CALLS){let a={...s};t.stepDetails.tool_calls.forEach((e=>{const n=e.id??"";"id"in e&&n&&o.current.set(t.id,n);const s={type:Ph.TOOL_CALL,tool_call:{name:e.name??"",args:e.args,id:n}},r=t.index+I.length;a=d(a,r,s)})),i.current.set(n,a);const r=k.map((e=>e.messageId===n?a:e));e(r)}}else if("on_agent_update"===n){const{agent_update:n}=u;let s=n.runId||"";if(s===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(g=null==m?void 0:m.initialResponse)?void 0:g.messageId)??"",E=(null==(x=null==m?void 0:m.initialResponse)?void 0:x.parentMessageId)??""),!s)return void console.warn("No message id found in agent update event");const a=i.current.get(s);if(a){const r=n.index+I.length,o=d(a,r,u);i.current.set(s,o);const l=t()||[];e([...l.slice(0,-1),o])}}else if("on_message_delta"===n){const n=u,s=l.current.get(n.id);let a=(null==s?void 0:s.runId)??"";if(a===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(v=null==m?void 0:m.initialResponse)?void 0:v.messageId)??"",E=(null==(b=null==m?void 0:m.initialResponse)?void 0:b.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for message delta event");const r=i.current.get(a);if(r&&n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(s.index,I,o.type||"",r.content),u=d(r,l,o);i.current.set(a,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_reasoning_delta"===n){const n=u,s=l.current.get(n.id);let a=(null==s?void 0:s.runId)??"";if(a===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(_=null==m?void 0:m.initialResponse)?void 0:_.messageId)??"",E=(null==(y=null==m?void 0:m.initialResponse)?void 0:y.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for reasoning delta event");const r=i.current.get(a);if(r&&null!=n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(s.index,I,o.type||"",r.content),u=d(r,l,o);i.current.set(a,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_run_step_delta"===n){const t=u,n=l.current.get(t.id);let s=(null==n?void 0:n.runId)??"";if(s===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(j=null==m?void 0:m.initialResponse)?void 0:j.messageId)??"",E=(null==(w=null==m?void 0:m.initialResponse)?void 0:w.parentMessageId)??""),!n||!s)return void console.warn("No run step or runId found for run step delta event");const a=i.current.get(s);if(a&&t.delta.type===Ah.TOOL_CALLS&&t.delta.tool_calls){let r={...a};t.delta.tool_calls.forEach((e=>{const s=o.current.get(t.id)??"",a={type:Ph.TOOL_CALL,tool_call:{name:e.name??"",args:e.args??"",id:s}};null!=t.delta.auth&&(a.tool_call.auth=t.delta.auth,a.tool_call.expires_at=t.delta.expires_at);const i=n.index+I.length;r=d(r,i,a)})),i.current.set(s,r);const l=k.map((e=>e.messageId===s?r:e));e(l)}}else if("on_run_step_completed"===n){const{result:t}=u,{id:n}=t,s=l.current.get(n);let a=(null==s?void 0:s.runId)??"";if(a===Sh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(N=null==m?void 0:m.initialResponse)?void 0:N.messageId)??"",E=(null==(C=null==m?void 0:m.initialResponse)?void 0:C.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for completed tool call event");const r=i.current.get(a);if(r){let n={...r};const o={type:Ph.TOOL_CALL,tool_call:t.tool_call},l=s.index+I.length;n=d(n,l,o,!0),i.current.set(a,n);const c=k.map((e=>e.messageId===a?n:e));e(c)}}return()=>{o.current.clear(),i.current.clear(),l.current.clear()}}),[t,s,r,a,e]),clearStepMaps:n.useCallback((()=>{o.current.clear(),i.current.clear(),l.current.clear()}),[])}}({setMessages:t,getMessages:s,announcePolite:m,setIsSubmitting:i,lastAnnouncementTimeRef:x}),w=uT(u),N=n.useCallback(((e,n)=>{const{messages:s,userMessage:a,plugin:r,plugins:o,initialResponse:l,isRegenerate:c=!1}=n,d=e??"";i(!0);const u=Date.now();u-x.current>Gd&&(m({message:"composing",isStatus:!0}),x.current=u),t(c?[...s,{...l,text:d,plugin:r??null,plugins:o??[]}]:[...s,a,{...l,text:d,plugin:r??null,plugins:o??[]}])}),[t,m,i]),C=n.useCallback(((n,s)=>{const{requestMessage:a,responseMessage:l,conversation:c}=n,{messages:d,isRegenerate:m=!1}=s,p=c??s.conversation;if(m){const e=[...d,l].filter((e=>e));t(e)}else{const e=[...d,a,l].filter((e=>e));t(e)}const f=c.conversationId!==s.conversation.conversationId;f&&cb(u,s.conversation.conversationId),e&&f&&a.parentMessageId===Sh.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:p.conversationId})}),2500),o&&!r&&o((e=>({...e,...p}))),i(!1)}),[t,o,e,r,u,i]),k=n.useCallback(((e,n)=>{const{conversationId:s,thread_id:a,responseMessage:i,requestMessage:l}=e,{initialResponse:p,messages:f,userMessage:h}=n,g=f.filter((e=>e.messageId!==h.messageId));t([...g,l,{...p,...i}]),m({message:"start",isStatus:!0});let x={};o&&!r?(o((e=>{const t=l.parentMessageId,n=pT({parentId:t,queryClient:u,conversationId:s,currentTitle:null==e?void 0:e.title});return x=Sm.parse({...e,conversationId:s,thread_id:a,title:n,messages:[l.messageId,i.messageId]}),x})),l.parentMessageId===Sh.NO_PARENT?ib(u,x):lb(u,x.conversationId,(e=>x))):o&&o((e=>(x=Sm.parse({...e,conversationId:s,thread_id:a,messages:[l.messageId,i.messageId]}),x))),c(!0),d&&d()}),[u,t,r,m,o,c,d]),S=n.useCallback(((e,n)=>{const{messages:s,userMessage:a,isRegenerate:i=!1,isTemporary:l=!1}=n,c={...n.initialResponse,parentMessageId:a.messageId,messageId:a.messageId+"_"};t(i?[...s,c]:[...s,a,c]);const{conversationId:h,parentMessageId:g}=a;x.current=Date.now(),m({message:"start",isStatus:!0});let v={};o&&!r?(o((e=>{const t=i?a.overrideParentMessageId:g,n=pT({parentId:t,queryClient:u,conversationId:h,currentTitle:null==e?void 0:e.title});return v=Sm.parse({...e,conversationId:h,title:n}),v})),l||(g===Sh.NO_PARENT?ib(u,v):lb(u,v.conversationId,(e=>v)))):o&&o((e=>(v=Sm.parse({...e,conversationId:h}),v))),h&&p(h,n.conversation.conversationId,n.ephemeralAgent),d&&d(),yb((()=>f(!1)))}),[t,u,f,r,m,o,d,p]),E=n.useCallback(((n,l)=>{var d,f,x,v,b,_,y,j,N,C;const{requestMessage:k,responseMessage:S,conversation:E,runMessages:T}=n,{messages:I,conversation:R,isRegenerate:P=!1,isTemporary:A=!1}=l;(null==S?void 0:S.attachments)&&S.attachments.length>0&&S.attachments.forEach((e=>{const t={...e,messageId:S.messageId};w({data:t,submission:l})})),c(!1),a((e=>new Set(e.add(l.initialResponse.messageId))));const M=s();if(!M||0===M.length)return void i(!1);m({message:"end",isStatus:!0}),m({message:bb(S)});const L=E.conversationId!==R.conversationId,O=(e,n)=>{t(n),u.setQueryData([xx.messages,e],n)},D=(null==(x=null==(f=null==(d=null==S?void 0:S.content)?void 0:d[0])?void 0:f.text)?void 0:x.value)===(null==(y=null==(_=null==(b=null==(v=l.initialResponse)?void 0:v.content)?void 0:b[0])?void 0:_.text)?void 0:y.value)||!!(null==(C=null==(N=null==(j=null==S?void 0:S.content)?void 0:j[0])?void 0:N.tool_call)?void 0:C.auth);if(!E.conversationId&&D){const e=(R.conversationId??E.conversationId)||Sh.NEW_CONVO;L&&R.conversationId&&cb(u,R.conversationId);const t=g.pathname===`/c/${Sh.NEW_CONVO}`&&e===Sh.NEW_CONVO;return O(e,t?[]:[...I]),Jv({id:e,value:null==k?void 0:k.text}),i(!1),void(t&&h(`/c/${Sh.NEW_CONVO}`,{replace:!0,state:{focusChat:!0}}))}let F=[];T?F=[...T]:P&&S?F=[...I,S]:null!=k&&null!=S&&(F=[...I,k,S]),F.length>0?O(E.conversationId,F):!Yu(R.endpoint)||R.conversationId&&R.conversationId!==Sh.NEW_CONVO||u.setQueryData([xx.messages,E.conversationId],[...M]),L&&R.conversationId&&cb(u,R.conversationId),e&&L&&!A&&k&&k.parentMessageId===Sh.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:E.conversationId})}),2500),o&&!0!==r&&(o((e=>{const t={...e,...E};null!=(null==e?void 0:e.model)&&e.model!==R.model&&(t.model=e.model);return u.getQueryData([xx.conversation,E.conversationId])||u.setQueryData([xx.conversation,E.conversationId],t),t})),E.conversationId&&l.ephemeralAgent&&p(E.conversationId,R.conversationId,l.ephemeralAgent),g.pathname===`/c/${Sh.NEW_CONVO}`&&h(`/c/${E.conversationId}`,{replace:!0})),i(!1)}),[h,e,s,t,u,a,r,m,o,i,c,g.pathname,p,w]),T=n.useCallback((({data:e,submission:n})=>{var r;const{messages:o,userMessage:c,initialResponse:d}=n;a((e=>new Set(e.add(d.messageId))));const m=c.conversationId??(null==(r=n.conversation)?void 0:r.conversationId)??"",p=(e,n)=>{const s=[...o,c,n];t(s),u.setQueryData([xx.messages,e],s)},f=e=>{const t=e.responseMessage??e,n={...d,...t,error:!0,parentMessageId:c.messageId};return void 0!==n.messageId&&""!==n.messageId||(n.messageId=Xe()),jm.parse(n)};if(!e){const e=m||`_${Xe()}`,t=f({text:"Error connecting to server, try refreshing the page.",...n,conversationId:e});return p(e,mT({errorMetadata:t,getMessages:s,submission:n})),l&&l({template:{conversationId:e},preset:km.parse(n.conversation)}),void i(!1)}const h=e.conversationId??"";if(!m&&!h){const t=`_${Xe()}`;return p(t,f(e)),l&&l({template:{conversationId:t},preset:km.parse(n.conversation)}),void i(!1)}if(!h){return p(m,f(e)),void i(!1)}p(h,jm.parse({...e,error:!0,parentMessageId:c.messageId})),h&&v===Sh.NEW_CONVO&&l&&l({template:{conversationId:h},preset:km.parse(n.conversation)}),i(!1)}),[a,t,v,l,i,s,u]),I=n.useCallback((async(e="",n,a)=>{var r;const o=`${e}:${(null==(r=null==a?void 0:a[a.length-1])?void 0:r.messageId)??""}`,{endpoint:c,endpointType:d}=n.conversation??{},u=d??c;if(Yu(u)||null==(null==a?void 0:a[a.length-1])||null==a[a.length-2]){if(!Yu(u)){const t=e||`_${Xe()}`;return s_.log("conversation","Aborted conversation with minimal messages, ID: "+t),l&&l({template:{conversationId:t},preset:km.parse(n.conversation)}),void i(!1)}try{const e=await fetch(`${hh[u??""]}/abort`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({abortKey:o,endpoint:u})}),t=e.headers.get("content-type");if(null!=t&&t.includes("application/json")){const t=await e.json();if(404===e.status)return void i(!1);!0===t.final?E(t,n):C(t,n)}else{if(204!==e.status&&200!==e.status)throw new Error("Unexpected response from server; Status: "+e.status+" "+e.statusText);i(!1)}}catch(m){const a=mT({getMessages:s,submission:n,error:m});t([...n.messages,n.userMessage,a]),l&&l({template:{conversationId:e||a.conversationId||Xe()},preset:km.parse(n.conversation)}),i(!1)}}else{let t=a[a.length-2];const s=a[a.length-1];if(t.messageId!==s.parentMessageId)for(let e=a.length-3;e>=0;e--)if(a[e].messageId===s.parentMessageId){t=a[e];break}E({conversation:{conversationId:e},requestMessage:t,responseMessage:s},n)}}),[E,l,i,b,C,s,t]);return{clearStepMaps:j,stepHandler:y,syncHandler:k,finalHandler:E,errorHandler:T,messageHandler:N,contentHandler:_,createdHandler:S,attachmentHandler:w,abortConversation:I}}const hT=e=>{e?(localStorage.removeItem(`${Eh.TEXT_DRAFT}${e}`),localStorage.removeItem(`${Eh.FILES_DRAFT}${e}`)):(localStorage.removeItem(`${Eh.TEXT_DRAFT}${Sh.NEW_CONVO}`),localStorage.removeItem(`${Eh.FILES_DRAFT}${Sh.NEW_CONVO}`))};function gT(e,t,s=!1,a=0){var r;const o=bj(),i=Pe(Ny.activeRunFamily(a)),{token:l,isAuthenticated:c}=Kk(),[d,u]=n.useState(new Set),m=Pe(Ny.abortScrollFamily(a)),p=Pe(Ny.showStopButtonByIndex(a)),{setMessages:f,getMessages:h,setConversation:g,setIsSubmitting:x,newConversation:v,resetLatestMessage:b}=t,{clearStepMaps:_,stepHandler:y,syncHandler:j,finalHandler:w,errorHandler:N,messageHandler:C,contentHandler:k,createdHandler:S,attachmentHandler:E,abortConversation:T}=fT({genTitle:o,setMessages:f,getMessages:h,setCompleted:u,isAddedRequest:s,setConversation:g,setIsSubmitting:x,newConversation:v,setShowStopButton:p,resetLatestMessage:b}),{data:I}=Ky(),R=aj({enabled:!!c&&(null==(r=null==I?void 0:I.balance)?void 0:r.enabled)});n.useEffect((()=>{if(null==e||0===Object.keys(e).length)return;let{userMessage:t}=e;const n=function(e){var t=e.isEdited,n=e.userMessage,s=e.isContinued,a=e.isTemporary,r=e.isRegenerate,o=e.conversation,i=e.editedContent,l=e.ephemeralAgent,c=e.endpointOption,d=Sm.parse(o).conversationId,u=c,m=u.endpoint,p=u.endpointType,f=m,h="".concat(hh[Uu.agents],"/").concat(f);return Yu(f)&&(h=hh[null!=p?p:f]+(t?"/modify":"")),{server:h,payload:du(du(du({},n),c),{endpoint:f,isTemporary:a,isRegenerate:r,editedContent:i,conversationId:d,isContinued:!(!t||!s),ephemeralAgent:Yu(f)?void 0:l})}}(e);let{payload:s}=n;s=Am(s),_();const a=new it(n.server,{payload:JSON.stringify(s),headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});return a.addEventListener("attachment",(t=>{try{const n=JSON.parse(t.data);E({data:n,submission:e})}catch(n){console.error(n)}})),a.addEventListener("message",(n=>{var s,a;const r=JSON.parse(n.data);if(null!=r.final){hT(null==(s=e.conversation)?void 0:s.conversationId);const{plugins:t}=r;return w(r,{...e,plugins:t}),(null==(a=null==I?void 0:I.balance)?void 0:a.enabled)&&R.refetch(),void console.log("final",r)}if(null!=r.created){const n=Xe();i(n),t={...t,...r.message,overrideParentMessageId:t.overrideParentMessageId},S(r,{...e,userMessage:t})}else if(null!=r.event)y(r,{...e,userMessage:t});else if(null!=r.sync){const n=Xe();i(n),j(r,{...e,userMessage:t})}else if(null!=r.type){const{text:t,index:n}=r;k({data:r,submission:e})}else{const n=r.text??r.response,{plugin:s,plugins:a}=r,o={...e.initialResponse,parentMessageId:r.parentMessageId,messageId:r.messageId};null!=r.message&&C(n,{...e,plugin:s,plugins:a,userMessage:t,initialResponse:o})}})),a.addEventListener("open",(()=>{m(!1),console.log("connection is opened")})),a.addEventListener("cancel",(async()=>{var n,s,a;const r=null==(n=null==e?void 0:e.initialResponse)?void 0:n.messageId;if(d.has(r))return x(!1),void u((e=>(e.delete(r),new Set(e))));u((e=>new Set(e.add(r))));const o=h(),i=null==(s=null==o?void 0:o[o.length-1])?void 0:s.conversationId;return await T(i??t.conversationId??(null==(a=e.conversation)?void 0:a.conversationId)??"",e,o)})),a.addEventListener("error",(async n=>{var s;if(401===n.responseCode)try{const e=await Ix.refreshToken(),t=(null==e?void 0:e.token)??"";if(!t)throw new Error("Token refresh failed.");return a.headers={"Content-Type":"application/json",Authorization:`Bearer ${t}`},Ix.dispatchTokenUpdatedEvent(t),void a.stream()}catch(o){console.log(o)}let r;console.log("error in server stream."),(null==(s=null==I?void 0:I.balance)?void 0:s.enabled)&&R.refetch();try{r=JSON.parse(n.data)}catch(o){console.error(o),console.log(n),x(!1)}N({data:r,submission:{...e,userMessage:t}})})),x(!0),a.stream(),()=>{const e=a.readyState<=1;if(a.close(),e){const e=new Event("cancel");a.dispatchEvent(e)}}}),[e])}const xT=S.createContext(void 0),vT=({value:e,children:t})=>{const[a,r]=n.useState(!1);return s.jsx(xT.Provider,{value:e??{error:a,setError:r},children:t})},bT=()=>{const e=S.useContext(xT);if(void 0===e)throw new Error("useApiErrorBoundary must be used inside ApiErrorBoundaryProvider");return e},_T=()=>{const[e,t]=n.useState(!1),[s,a]=n.useState(null),r=n.useCallback(((e,n)=>{n.preventDefault(),n.stopPropagation(),a(e),t(!0)}),[]);return{keyDialogOpen:e,keyDialogEndpoint:s,onOpenChange:e=>{if(!e&&s){const e=document.getElementById(`endpoint-${s}-settings`);e&&setTimeout((()=>{e.focus()}),5)}t(e)},handleOpenKeyDialog:r}},yT={[Jf.anyscale]:"assets/anyscale.png",[Jf.apipie]:"assets/apipie.png",[Jf.cohere]:"assets/cohere.png",[Jf.deepseek]:"assets/deepseek.svg",[Jf.fireworks]:"assets/fireworks.png",[Jf.google]:"assets/google.svg",[Jf.groq]:"assets/groq.png",[Jf.huggingface]:"assets/huggingface.svg",[Jf.mistral]:"assets/mistral.png",[Jf.mlx]:"assets/mlx.png",[Jf.ollama]:"assets/ollama.png",[Jf.openai]:"assets/openai.svg",[Jf.openrouter]:"assets/openrouter.png",[Jf.perplexity]:"assets/perplexity.png",[Jf.qwen]:"assets/qwen.svg",[Jf.shuttleai]:"assets/shuttleai.png",[Jf["together.ai"]]:"assets/together.png",[Jf.unify]:"assets/unify.webp"},jT={[Jf.cohere]:{[Yd.landing]:"p-2"},[Jf.xai]:{[Yd.landing]:"p-2"}},wT=({currentEndpoint:e,context:t="",className:n})=>{var s;if(e===Jf.openrouter)return n;return n_((null==(s=jT[e])?void 0:s[t])??"",t===Yd.landing?"":n)};const NT=n.memo((function({className:e="",endpoint:t,iconURL:n="",context:a}){const r=t??"";if(!r)return s.jsx(lc,{className:e});const o=r.toLowerCase();if(o===Jf.xai)return s.jsx(qc,{className:wT({currentEndpoint:o,context:a,className:e})});if(n)return s.jsx("img",{className:e,src:n,alt:`${r} Icon`});const i=yT[o]??"";return i?s.jsx("img",{className:wT({currentEndpoint:o,context:a,className:e}),src:i,alt:`${o} Icon`}):s.jsx(lc,{className:e})})),CT=({className:e="",assistantName:t="",avatar:n="",context:a,size:r})=>t&&n?s.jsx("img",{src:n,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:t,width:"80",height:"80"}):t?s.jsx(Uc,{className:n_("text-token-secondary",e),size:r}):s.jsx(Vc,{className:n_("landing"===a?"icon-2xl":"",e)}),kT={[Uu.azureOpenAI]:Ec,[Uu.openAI]:Jl,[Uu.gptPlugins]:Sc,[Uu.anthropic]:yc,[Uu.chatGPTBrowser]:cc,[Uu.google]:Ac,[Uu.custom]:lc,[Uu.assistants]:CT,[Uu.azureAssistants]:CT,[Uu.agents]:({className:e="",avatar:t="",agentName:n,size:a})=>null!=n&&n&&t?s.jsx("img",{src:t,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:n,width:"80",height:"80"}):s.jsx(lt,{className:n_(""===n?"icon-2xl":"",e),size:a}),[Uu.bedrock]:({className:e=""})=>s.jsx(Gc,{className:n_(e,"h-full w-full")}),unknown:NT},ST=({agents:e,assistantsMap:t,endpointsConfig:s,startupConfig:a})=>{var r;const o=mk(),{data:i=[]}=Gy({select:Sb}),l=(null==a?void 0:a.interface)??{},c=n.useMemo((()=>{var e;return new Set((null==(e=null==a?void 0:a.modelSpecs)?void 0:e.addedEndpoints)??[])}),[null==(r=null==a?void 0:a.modelSpecs)?void 0:r.addedEndpoints]),d=Wk({permissionType:hg.AGENTS,permission:gg.USE}),u=n.useMemo((()=>Object.values((null==t?void 0:t[Uu.assistants])??{})),[t]),m=n.useMemo((()=>Object.values((null==t?void 0:t[Uu.azureAssistants])??{})),[t]),p=n.useMemo((()=>{if(!l.modelSelect)return[];const e=[];for(let t=0;t<i.length;t++)(i[t]!==Uu.agents||d)&&(c.size>0&&!c.has(i[t])||e.push(i[t]));return e}),[i,d,c,l.modelSelect]),f=n.useCallback((e=>!!kb(s,e,"userProvide")),[s]);return{mappedEndpoints:n.useMemo((()=>p.map((t=>{var n,a,r,i,l,c;const d=kb(s,t,"type"),p=Mb({endpoint:t,endpointsConfig:s,endpointType:d}),f=kT[p],h=kb(s,t,"iconURL"),g=t===Uu.agents&&((null==e?void 0:e.length)??0)>0||t===Uu.assistants&&(null==u?void 0:u.length)>0||t!==Uu.assistants&&t!==Uu.agents&&((null==(a=null==(n=o.data)?void 0:n[t])?void 0:a.length)??0)>0,x={value:t,label:uh[t]||t,hasModels:g,icon:f?S.createElement(f,{size:20,className:"text-text-primary shrink-0 icon-md",iconURL:h,endpoint:t}):null};return t===Uu.agents&&((null==e?void 0:e.length)??0)>0?(x.models=null==e?void 0:e.map((e=>({name:e.id,isGlobal:e.isPublic??!1}))),x.agentNames=null==e?void 0:e.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=null==e?void 0:e.reduce(((e,t)=>{var n;return e[t.id]=null==(n=null==t?void 0:t.avatar)?void 0:n.filepath,e}),{})):t===Uu.assistants&&u.length>0?(x.models=u.map((e=>({name:e.id,isGlobal:!1}))),x.assistantNames=u.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=u.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t===Uu.azureAssistants&&m.length>0?(x.models=m.map((e=>({name:e.id,isGlobal:!1}))),x.assistantNames=m.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=m.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t!==Uu.agents&&t!==Uu.assistants&&((null==(i=null==(r=o.data)?void 0:r[t])?void 0:i.length)??0)>0&&(x.models=null==(c=null==(l=o.data)?void 0:l[t])?void 0:c.map((e=>({name:e,isGlobal:!1})))),x}))),[p,s,o.data,e,u,m]),endpointRequiresUserKey:f}};function ET(e,t){const[s,a]=n.useState(t);n.useEffect((()=>{const n=localStorage.getItem(e);function s(t){if(t.key!==e)return;const n=localStorage.getItem(e);a(JSON.parse(n??""))}return n||localStorage.setItem(e,JSON.stringify(t)),a(n?JSON.parse(n):t),window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}),[]);return[s,t=>{try{a(t),localStorage.setItem(e,JSON.stringify(t)),"undefined"!=typeof window&&window.dispatchEvent(new StorageEvent("storage",{key:e}))}catch(Di){console.error(Di)}}]}function TT(e){n.useEffect((()=>{document.title=e}),[e])}const IT=(e,t)=>{const{data:n,isLoading:s}=Ek(e,t);return{hasPermission:e=>!!n&&function(e,t){return(e&t)===t}(n.permissionBits,e),isLoading:s,permissionBits:(null==n?void 0:n.permissionBits)||0}},RT=({statusMessage:e,logMessage:t})=>s.jsxs("div",{className:"sr-only",children:[s.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:e}),s.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:t})]}),PT=({children:e})=>{const[t,a]=n.useState(""),[r,o]=n.useState(""),i=n.useRef(null),l=Fk(),c=n.useMemo((()=>({start:l("com_a11y_start"),end:l("com_a11y_end"),composing:l("com_a11y_ai_composing")})),[l]),d=n.useCallback((e=>{i.current&&clearTimeout(i.current),a(e),i.current=setTimeout((()=>{a("")}),1e3)}),[]),u=n.useCallback((e=>{o(e)}),[]),m=n.useCallback((({message:e,isStatus:t=!1})=>{const n=(c[e]??e).replace(/[*`_]/g,"");t?d(n):u(n)}),[c,d,u]),p={announcePolite:m,announceAssertive:m};return n.useEffect((()=>()=>{i.current&&clearTimeout(i.current)}),[]),s.jsxs(bS.Provider,{value:p,children:[e,s.jsx(RT,{statusMessage:t,logMessage:r})]})},AT=({children:e})=>s.jsx("div",{role:"alert","aria-live":"assertive",className:"relative mt-6 rounded-xl border border-red-500/20 bg-red-50/50 px-6 py-4 text-red-700 shadow-sm transition-all dark:bg-red-950/30 dark:text-red-100",children:e}),MT=({id:e,enabled:t,serverDomain:n,oauthPath:a,Icon:r,label:o})=>t?s.jsx("div",{className:"mt-2 flex gap-x-2",children:s.jsxs("a",{"aria-label":`${o}`,className:"flex w-full items-center space-x-3 rounded-2xl border border-border-light bg-surface-primary px-5 py-3 text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",href:`${n}/oauth/${a}`,"data-testid":e,children:[s.jsx(r,{}),s.jsx("p",{children:o})]})}):null,LT=({onSubmit:e,startupConfig:t,error:a,setError:r})=>{var o,i;const l=Fk(),{theme:c}=n.useContext(Td),{register:d,getValues:u,handleSubmit:m,formState:{errors:p,isSubmitting:f}}=zo(),[h,g]=n.useState(!1),[x,v]=n.useState(null),{data:b}=Ky(),_=null==(o=null==b?void 0:b.ldap)?void 0:o.username,y=Id(c)?"dark":"light",j=Boolean(null==(i=t.turnstile)?void 0:i.siteKey);n.useEffect((()=>{a&&a.includes("422")&&!h&&g(!0)}),[a,h]);const w=Lj({onMutate:()=>{r(void 0),g(!1)}});if(!t)return null;const N=e=>{var t;const n=null==(t=p[e])?void 0:t.message;return n?s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:String(n)}):null};return s.jsxs(s.Fragment,{children:[h&&s.jsxs("div",{className:"mt-2 rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",children:[l("com_auth_email_verification_resend_prompt"),s.jsx("button",{type:"button",className:"ml-2 text-blue-600 hover:underline",onClick:()=>{const e=u("email");if(!e)return g(!1);w.mutate({email:e})},disabled:w.isLoading,children:l("com_auth_email_resend_link")})]}),s.jsxs("form",{className:"mt-6","aria-label":"Login form",method:"POST",onSubmit:m((t=>e(t))),children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",id:"email",autoComplete:_?"username":"email","aria-label":l("com_auth_email"),...d("email",{required:l("com_auth_email_required"),maxLength:{value:120,message:l("com_auth_email_max_length")},pattern:{value:_?/\S+/:/\S+@\S+\.\S+/,message:l("com_auth_email_pattern")}}),"aria-invalid":!!p.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"email",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:_?l("com_auth_username").replace(/ \(.*$/,""):l("com_auth_email_address")})]}),N("email")]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":l("com_auth_password"),...d("password",{required:l("com_auth_password_required"),minLength:{value:(null==t?void 0:t.minPasswordLength)||8,message:l("com_auth_password_min_length")},maxLength:{value:128,message:l("com_auth_password_max_length")}}),"aria-invalid":!!p.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:l("com_auth_password")})]}),N("password")]}),t.passwordResetEnabled&&s.jsx("a",{href:"/forgot-password",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_auth_password_forgot")}),j&&s.jsx("div",{className:"my-4 flex justify-center",children:s.jsx(Ko,{siteKey:t.turnstile.siteKey,options:{...t.turnstile.options,theme:y},onSuccess:v,onError:()=>v(null),onExpire:()=>v(null)})}),s.jsx("div",{className:"mt-6",children:s.jsx(ki,{"aria-label":l("com_auth_continue"),"data-testid":"login-button",type:"submit",disabled:j&&!x||f,variant:"submit",className:"h-12 w-full rounded-2xl",children:f?s.jsx(ac,{}):l("com_auth_continue")})})]})]})};function OT(){const e=Fk(),{showToast:t}=Bd(),{error:a,setError:r,login:o}=Kk(),{startupConfig:i}=ct(),[l,c]=Ps(),d="false"===l.get("redirect"),[u,m]=n.useState(d);n.useEffect((()=>{const n=null==l?void 0:l.get("error");if(n&&n===yh.AUTH_FAILED){t({message:e("com_auth_error_oauth_failed"),status:"error"});const n=new URLSearchParams(l);n.delete("error"),c(n,{replace:!0})}}),[l,c,t,e]),n.useEffect((()=>{if(d){m(!0);const e=new URLSearchParams(l);e.delete("redirect"),c(e,{replace:!0})}}),[d,l,c]);const p=(null==i?void 0:i.openidLoginEnabled)&&(null==i?void 0:i.openidAutoRedirect)&&(null==i?void 0:i.serverDomain)&&!u;return n.useEffect((()=>{p&&(console.log("Auto-redirecting to OpenID provider..."),window.location.href=`${i.serverDomain}/oauth/openid`)}),[p,i]),p?s.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:[s.jsx("p",{className:"text-lg font-semibold",children:e("com_ui_redirecting_to_provider",{0:i.openidLabel})}),s.jsx("div",{className:"mt-4",children:s.jsx(MT,{enabled:i.openidLoginEnabled,serverDomain:i.serverDomain,oauthPath:"openid",Icon:()=>i.openidImageUrl?s.jsx("img",{src:i.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):s.jsx(gc,{}),label:i.openidLabel,id:"openid"},"openid")})]}):s.jsxs(s.Fragment,{children:[null!=a&&s.jsx(AT,{children:e(r_(a))}),!0===(null==i?void 0:i.emailLoginEnabled)&&s.jsx(LT,{onSubmit:o,startupConfig:i,error:a,setError:r}),!0===(null==i?void 0:i.registrationEnabled)&&s.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[" ",e("com_auth_no_account")," ",s.jsx("a",{href:"/register",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:e("com_auth_sign_up")})]})]})}const DT=()=>{var e,t;const a=Fe(),r=Fk(),{theme:o}=n.useContext(Td),{startupConfig:i,startupConfigError:l,isFetching:c}=ct(),{watch:d,register:u,handleSubmit:m,formState:{errors:p}}=zo({mode:"onChange"}),f=d("password"),[h,g]=n.useState(""),[x,v]=n.useState(!1),[b,_]=n.useState(3),[y,j]=n.useState(null),w=De(),N=new URLSearchParams(w.search).get("token"),C=Id(o)?"dark":"light",k=Boolean(null==(e=null==i?void 0:i.turnstile)?void 0:e.siteKey),S=fk({onMutate:()=>{v(!0)},onSuccess:()=>{v(!1),_(3);const e=setInterval((()=>{_((t=>t<=1?(clearInterval(e),a("/c/new",{replace:!0}),0):t-1))}),1e3)},onError:e=>{var t,n,s,a;v(!1),(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)&&g((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)??"")}}),E=(e,t,n,a)=>{var o;return s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:e,type:n,autoComplete:e,"aria-label":r(t),...u(e,a),"aria-invalid":!!p[e],className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" ","data-testid":e}),s.jsx("label",{htmlFor:e,className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:r(t)})]}),p[e]&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500",children:String(null==(o=p[e])?void 0:o.message)??""})]})};return s.jsxs(s.Fragment,{children:[h&&s.jsxs(AT,{children:[r("com_auth_error_create")," ",h]}),S.isSuccess&&b>0&&s.jsx("div",{className:"rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",role:"alert",children:r((null==i?void 0:i.emailEnabled)?"com_auth_registration_success_generic":"com_auth_registration_success_insecure")+" "+r("com_auth_email_verification_redirecting",{0:b.toString()})}),!l&&!c&&s.jsxs(s.Fragment,{children:[s.jsxs("form",{className:"mt-6","aria-label":"Registration form",method:"POST",onSubmit:m((e=>S.mutate({...e,token:N??void 0}))),children:[E("name","com_auth_full_name","text",{required:r("com_auth_name_required"),minLength:{value:3,message:r("com_auth_name_min_length")},maxLength:{value:80,message:r("com_auth_name_max_length")}}),E("username","com_auth_username","text",{minLength:{value:2,message:r("com_auth_username_min_length")},maxLength:{value:80,message:r("com_auth_username_max_length")}}),E("email","com_auth_email","email",{required:r("com_auth_email_required"),minLength:{value:1,message:r("com_auth_email_min_length")},maxLength:{value:120,message:r("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:r("com_auth_email_pattern")}}),E("password","com_auth_password","password",{required:r("com_auth_password_required"),minLength:{value:(null==i?void 0:i.minPasswordLength)||8,message:r("com_auth_password_min_length")},maxLength:{value:128,message:r("com_auth_password_max_length")}}),E("confirm_password","com_auth_password_confirm","password",{validate:e=>e===f||r("com_auth_password_not_match")}),(null==(t=null==i?void 0:i.turnstile)?void 0:t.siteKey)&&s.jsx("div",{className:"my-4 flex justify-center",children:s.jsx(Ko,{siteKey:i.turnstile.siteKey,options:{...i.turnstile.options,theme:C},onSuccess:e=>j(e),onError:()=>j(null),onExpire:()=>j(null)})}),s.jsx("div",{className:"mt-6",children:s.jsx(ki,{disabled:Object.keys(p).length>0||x||k&&!y,type:"submit","aria-label":"Submit registration",variant:"submit",className:"h-12 w-full rounded-2xl",children:x?s.jsx(ac,{}):r("com_auth_continue")})})]}),s.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[r("com_auth_already_have_account")," ",s.jsx("a",{href:"/login","aria-label":"Login",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:r("com_auth_login")})]})]})]})};function FT(){const e=Fk(),{register:t,handleSubmit:n,watch:a,formState:{errors:r,isSubmitting:o}}=zo(),i=Fe(),[l]=Ps(),c=a("password"),d=xk(),{setError:u,setHeaderText:m,startupConfig:p}=ct();return d.isSuccess?s.jsx(s.Fragment,{children:s.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsx("p",{children:e("com_auth_login_with_new_password")}),s.jsx(ki,{onClick:()=>i("/login"),"aria-label":e("com_auth_sign_in"),variant:"submit",children:e("com_auth_continue")})]})})}):s.jsxs("form",{className:"mt-6","aria-label":"Password reset form",method:"POST",onSubmit:n((e=>{d.mutate(e,{onError:()=>{u("com_auth_error_invalid_reset_token")},onSuccess:()=>{m("com_auth_reset_password_success")}})})),children:[s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"hidden",id:"token",value:l.get("token")??"",...t("token",{required:"Unable to process: No valid reset token"})}),s.jsx("input",{type:"hidden",id:"userId",value:l.get("userId")??"",...t("userId",{required:"Unable to process: No valid user id"})}),s.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":e("com_auth_password"),...t("password",{required:e("com_auth_password_required"),minLength:{value:(null==p?void 0:p.minPasswordLength)||8,message:e("com_auth_password_min_length")},maxLength:{value:128,message:e("com_auth_password_max_length")}}),"aria-invalid":!!r.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password")})]}),r.password&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.password.message})]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"password",id:"confirm_password","aria-label":e("com_auth_password_confirm"),...t("confirm_password",{validate:t=>t===c||e("com_auth_password_not_match")}),"aria-invalid":!!r.confirm_password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"confirm_password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password_confirm")})]}),r.confirm_password&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.confirm_password.message}),r.token&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.token.message}),r.userId&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.userId.message})]}),s.jsx("div",{className:"mt-6",children:s.jsx(ki,{type:"submit","aria-label":e("com_auth_submit_registration"),disabled:!!r.password||!!r.confirm_password||o,variant:"submit",className:"h-12 w-full rounded-2xl",children:o?s.jsx(ac,{}):e("com_auth_continue")})})]})}function zT(){const e=Fe(),t=Fk(),[a]=Ps(),[r,o]=n.useState(3),[i,l]=n.useState(""),[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useMemo((()=>a.get("token")||""),[a]),f=n.useMemo((()=>a.get("email")||""),[a]),h=n.useCallback((()=>{o(3);const t=setInterval((()=>{o((n=>n<=1?(clearInterval(t),e("/c/new",{replace:!0}),0):n-1))}),1e3)}),[e]),g=fr({mutationFn:e=>Rx.verifyEmail(e),...{onSuccess:()=>{l(t("com_auth_email_verification_success")+" 🎉"),m(!0),h()},onError:e=>{l(t("com_auth_email_verification_failed")+" 😢"),d(!0),m(!0)}}||{}});const x=Lj({onSuccess:()=>{l(t("com_auth_email_resent_success")+" 📧"),h()},onError:()=>{l(t("com_auth_email_resent_failed")+" 😢")},onMutate:()=>d(!1)}),v=()=>{x.mutate({email:f})};n.useEffect((()=>{u||g.isLoading||(p&&f?g.mutate({email:f,token:p}):(l(f?t("com_auth_email_verification_failed_token_missing")+" 😢":t("com_auth_email_verification_invalid")+" 🤨"),d(!0),m(!0)))}),[p,f,u,g]);const b=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:i}),r>0&&s.jsx("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:t("com_auth_email_verification_redirecting",{0:r.toString()})}),c&&0===r&&s.jsxs("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:[t("com_auth_email_verification_resend_prompt"),s.jsx("button",{className:"ml-2 text-blue-600 hover:underline",onClick:v,disabled:x.isLoading,children:t("com_auth_email_resend_link")})]})]}),_=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:t("com_auth_email_verification_in_progress")}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsx(ac,{className:"h-8 w-8 text-green-500"})})]});return s.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[s.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:s.jsx(Ad,{})}),u?s.jsx(b,{}):s.jsx(_,{})]})}const UT=()=>{const{error:e}=bT(),t=Fe();return S.useEffect((()=>{var t;null==(t=null==e?void 0:e.response)||t.status}),[e,t]),null},VT=({children:e})=>s.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:e}),BT=()=>{const e=Fk();return s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsx("p",{children:e("com_auth_reset_password_if_email_exists")}),s.jsx("a",{className:"inline-flex text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",href:"/login",children:e("com_auth_back_to_login")})]})};function $T(){const e=Fk(),{register:t,handleSubmit:a,formState:{errors:r}}=zo(),[o,i]=n.useState(void 0),{startupConfig:l,setHeaderText:c}=ct(),d=gk(),{isLoading:u}=d;return o?s.jsx(VT,{children:o}):s.jsxs("form",{className:"mt-8 space-y-6","aria-label":"Password reset form",method:"POST",onSubmit:a((t=>{d.mutate(t,{onSuccess:t=>{t.link&&!(null==l?void 0:l.emailEnabled)?(c("com_auth_reset_password"),i(s.jsxs("span",{children:[e("com_auth_click")," ",s.jsx("a",{className:"text-green-500 hover:underline",href:t.link,children:e("com_auth_here")})," ",e("com_auth_to_reset_your_password")]}))):(c("com_auth_reset_password_link_sent"),i(s.jsx(BT,{})))},onError:()=>{c("com_auth_reset_password_link_sent"),i(s.jsx(BT,{}))}})})),children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"email",id:"email",autoComplete:"off","aria-label":e("com_auth_email"),...t("email",{required:e("com_auth_email_required"),minLength:{value:3,message:e("com_auth_email_min_length")},maxLength:{value:120,message:e("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:e("com_auth_email_pattern")}}),"aria-invalid":!!r.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"email",className:"absolute -top-2 left-2 z-10 bg-white px-2 text-sm text-gray-600 transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-green-600 dark:bg-gray-900 dark:text-gray-400 dark:peer-focus:text-green-500",children:e("com_auth_email_address")})]}),r.email&&s.jsx("p",{role:"alert",className:"text-sm font-medium text-red-600 dark:text-red-400",children:r.email.message})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(ki,{"aria-label":"Continue with password reset",type:"submit",disabled:!!r.email||u,variant:"submit",className:"h-12 w-full rounded-2xl",children:u?s.jsx(ac,{}):e("com_auth_continue")}),s.jsx("a",{href:"/login",className:"block text-center text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:e("com_auth_back_to_login")})]})]})}const HT=S.memo((()=>{const[e]=Ps(),t=e.get("tempToken"),a=null!==t&&""!==t?t:"",{control:r,handleSubmit:o,formState:{errors:i}}=zo(),l=Fk(),{showToast:c}=Bd(),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{mutate:f}=(e=>{const t=pr();return fr((e=>Rx.verifyTwoFactorTemp(e)),{...e||{},onSuccess:(n,...s)=>{var a;t.setQueryData([xx.user,"2fa"],n),null==(a=null==e?void 0:e.onSuccess)||a.call(e,n,...s)}})})({onSuccess:e=>{null!=e.token&&""!==e.token&&(window.location.href="/")},onMutate:()=>{p(!0)},onError:e=>{var t,n;p(!1);const s=e,a="string"==typeof(null==(n=null==(t=s.response)?void 0:t.data)?void 0:n.message)?s.response.data.message:"Error verifying 2FA";c({message:a,status:"error"})}}),h=n.useCallback((e=>{const t={tempToken:a};d&&null!=e.backupCode&&""!==e.backupCode?t.backupCode=e.backupCode:null!=e.token&&""!==e.token&&(t.token=e.token),f(t)}),[a,d,f]),g=n.useCallback((()=>{u(!0)}),[]),x=n.useCallback((()=>{u(!1)}),[]);return s.jsx("div",{className:"mt-4",children:s.jsxs("form",{onSubmit:o(h),children:[s.jsx(dl,{className:"flex justify-center break-keep text-center text-sm text-text-primary",children:l("com_auth_two_factor")}),!d&&s.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[s.jsx(Uo,{name:"token",control:r,render:({field:{onChange:e,value:t}})=>s.jsxs(Fl,{maxLength:6,value:null!=t?t:"",onChange:e,pattern:dt,children:[s.jsxs(zl,{children:[s.jsx(Ul,{index:0}),s.jsx(Ul,{index:1}),s.jsx(Ul,{index:2})]}),s.jsx(Vl,{}),s.jsxs(zl,{children:[s.jsx(Ul,{index:3}),s.jsx(Ul,{index:4}),s.jsx(Ul,{index:5})]})]})}),i.token&&s.jsx("span",{className:"text-sm text-red-500",children:i.token.message})]}),d&&s.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[s.jsx(Uo,{name:"backupCode",control:r,render:({field:{onChange:e,value:t}})=>s.jsx(Fl,{maxLength:8,value:null!=t?t:"",onChange:e,pattern:ut,children:s.jsxs(zl,{children:[s.jsx(Ul,{index:0}),s.jsx(Ul,{index:1}),s.jsx(Ul,{index:2}),s.jsx(Ul,{index:3}),s.jsx(Ul,{index:4}),s.jsx(Ul,{index:5}),s.jsx(Ul,{index:6}),s.jsx(Ul,{index:7})]})})}),i.backupCode&&s.jsx("span",{className:"text-sm text-red-500",children:i.backupCode.message})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("button",{type:"submit","aria-label":l("com_auth_continue"),"data-testid":"login-button",disabled:m,className:"w-full rounded-2xl bg-green-600 px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-green-700 disabled:opacity-80 dark:bg-green-600 dark:hover:bg-green-700",children:l(m?"com_auth_email_verifying_ellipsis":"com_ui_verify")})}),s.jsx("div",{className:"mt-4 flex justify-center",children:d?s.jsx("button",{type:"button",onClick:x,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_ui_use_2fa_code")}):s.jsx("button",{type:"button",onClick:g,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_ui_use_backup_code")})})]})})})),GT=({control:e,marketplacePerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Uo,{name:t,control:e,render:({field:e})=>s.jsx(Cl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),KT=()=>{const e=Fk(),{showToast:t}=Bd(),{user:a,roles:r}=Kk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(rx.partial().parse(e.updates),Rx.updateMarketplacePermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([xx.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update marketplace permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Qg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[hg.MARKETPLACE]:gx[d].permissions[hg.MARKETPLACE]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=zo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[hg.MARKETPLACE];p(n||gx[d].permissions[hg.MARKETPLACE])}),[r,d,p]),(null==a?void 0:a.role)!==Qg.ADMIN)return null;const b=[{marketplacePerm:gg.USE,label:e("com_ui_marketplace_allow_use")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Qg.USER,onClick:()=>{u(Qg.USER)}},{label:Qg.ADMIN,onClick:()=>{u(Qg.ADMIN)}}];return s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"outline",className:"relative h-12 rounded-xl border-border-medium font-medium",children:s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"})})}),s.jsxs(gl,{className:"w-11/12 max-w-md border-border-light bg-surface-primary text-text-primary",children:[s.jsx(bl,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_marketplace")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(wd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({marketplacePerm:e,label:t})=>s.jsx("div",{children:s.jsx(GT,{control:f,marketplacePerm:e,label:t,getValues:g,setValue:h})},e)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})},WT=({children:e})=>{const t=eE(0,"new");return s.jsx(Rk.Provider,{value:t,children:e})},qT=(e,t,n)=>{if(!n||0===n.length)return!1;if(!t){return 0===n.findIndex((t=>t.name===e.name&&t.instructions===e.instructions&&t.artifacts===e.artifacts))}const s=e.name===t.name,a=e.description===t.description,r=e.instructions===t.instructions,o=e.artifacts===t.artifacts;return s&&a&&r&&o&&(()=>{if(!e.tools&&!t.tools)return!0;if(!e.tools||!t.tools)return!1;if(e.tools.length!==t.tools.length)return!1;const n=[...e.tools].sort(),s=[...t.tools].sort();return n.every(((e,t)=>e===s[t]))})()&&(()=>{if(!e.capabilities&&!t.capabilities)return!0;if(!e.capabilities||!t.capabilities)return!1;if(e.capabilities.length!==t.capabilities.length)return!1;const n=[...e.capabilities].sort(),s=[...t.capabilities].sort();return n.every(((e,t)=>e===s[t]))})()};function QT({version:e,index:t,isActive:n,versionsLength:a,onRestore:r}){const o=Fk();return s.jsxs("div",{className:"rounded-md border border-border-light p-3",children:[s.jsxs("div",{className:"flex items-center justify-between font-medium",children:[s.jsx("span",{children:o("com_ui_agent_version_title",{versionNumber:a-t})}),n&&s.jsx("span",{className:"rounded-full border border-green-600 bg-green-600/20 px-2 py-0.5 text-xs font-medium text-green-700 dark:border-green-500 dark:bg-green-500/30 dark:text-green-300",children:o("com_ui_agent_version_active")})]}),s.jsx("div",{className:"text-sm text-text-secondary",children:(e=>{const t=e.updatedAt||e.createdAt;if(t)try{const e=new Date(t);return isNaN(e.getTime())||"Invalid Date"===e.toString()?o("com_ui_agent_version_unknown_date"):e.toLocaleString()}catch(n){return o("com_ui_agent_version_unknown_date")}return o("com_ui_agent_version_no_date")})(e)}),!n&&s.jsx("button",{className:"mt-2 text-sm text-blue-500 hover:text-blue-600",onClick:()=>{window.confirm(o("com_ui_agent_version_restore_confirm"))&&r(t)},"aria-label":o("com_ui_agent_version_restore"),children:o("com_ui_agent_version_restore")})]})}function YT({selectedAgentId:e,isLoading:t,error:n,versionContext:a,onRestore:r}){const{versions:o,versionIds:i}=a,l=Fk();return e?t?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(ac,{className:"h-6 w-6"})}):n?s.jsx("div",{className:"py-8 text-center text-red-500",children:l("com_ui_agent_version_error")}):i.length>0?s.jsx("div",{className:"flex flex-col gap-2",children:i.map((({id:e,version:t,isActive:n})=>s.jsx(QT,{version:t,index:e,isActive:n,versionsLength:o.length,onRestore:r},e)))}):s.jsx("div",{className:"py-8 text-center text-text-secondary",children:l("com_ui_agent_version_empty")}):s.jsx("div",{className:"py-8 text-center text-text-secondary",children:l("com_ui_agent_version_no_agent")})}function XT(){const e=Fk(),{showToast:t}=Bd(),{agent_id:a,setActivePanel:r}=Zk(),o=a??"",{data:i,isLoading:l,error:c,refetch:d}=Py(o,{enabled:!!o&&""!==o}),u=$y({onSuccess:()=>{t({message:e("com_ui_agent_version_restore_success"),status:"success"}),d()},onError:()=>{t({message:e("com_ui_agent_version_restore_error"),status:"error"})}}),m=i,p=n.useMemo((()=>m?{name:m.name,description:m.description,instructions:m.instructions,artifacts:m.artifacts,capabilities:m.capabilities,tools:m.tools}:null),[m]),f=n.useMemo((()=>[...(null==m?void 0:m.versions)||[]].sort(((e,t)=>{const n=e.updatedAt?new Date(e.updatedAt).getTime():0;return(t.updatedAt?new Date(t.updatedAt).getTime():0)-n}))),[null==m?void 0:m.versions]),h=n.useMemo((()=>f.length>0&&f.find((e=>qT(e,p,f)))||null),[f,p]),g=n.useMemo((()=>{if(0===f.length)return[];const e=f.filter((e=>qT(e,p,f))),t=e.length>0?f.findIndex((t=>t===e[0])):-1;return f.map(((e,n)=>{var s;return{id:n,originalIndex:(null==(s=null==m?void 0:m.versions)?void 0:s.findIndex((t=>t.updatedAt===e.updatedAt&&t.createdAt===e.createdAt&&t.name===e.name)))??n,version:e,isActive:n===t}}))}),[f,p,null==m?void 0:m.versions]),x=n.useMemo((()=>({versions:f,versionIds:g,currentAgent:p,selectedAgentId:o,activeVersion:h})),[f,g,p,o,h]),v=n.useCallback((e=>{const t=g.find((t=>t.id===e));if(t){const e=t.originalIndex;u.mutate({agent_id:o,version_index:e})}}),[u,o,g]);return s.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[s.jsxs("div",{className:"version-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{r(Xd.builder)},children:s.jsx("div",{className:"version-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_agent_version_history")})]}),s.jsx("div",{className:"flex flex-col gap-4 px-2",children:s.jsx(YT,{selectedAgentId:o,isLoading:l,error:c,versionContext:x,onRestore:v})})]})}function ZT({disableOAuth:e}){const t=Fk(),[a,r]=n.useState(!1),{watch:o,setValue:i,trigger:l}=Vo(),c=o("type");return s.jsxs(ul,{open:a,onOpenChange:r,children:[s.jsx(ml,{asChild:!0,children:s.jsxs("div",{className:"relative mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_authentication")})}),s.jsxs("div",{className:"border-token-border-medium flex rounded-lg border text-sm hover:cursor-pointer",children:[s.jsx("div",{className:"h-9 grow px-3 py-2",children:t(eI(c))}),s.jsx("div",{className:"bg-token-border-medium w-px"}),s.jsx("button",{type:"button",color:"neutral",className:"flex items-center gap-2 px-3",children:s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[s.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),s.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]})})]})]})}),s.jsxs(gl,{className:"w-full max-w-md border-none bg-surface-primary text-text-primary",children:[s.jsx(xl,{className:"border-b border-border-light sm:p-3",children:s.jsx(bl,{children:t("com_ui_authentication")})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-0",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_authentication_type")}),s.jsxs(Va,{defaultValue:gp.None,onValueChange:e=>i("type",e),value:c,role:"radiogroup","aria-required":"false",dir:"ltr",className:"flex gap-4",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rf8:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:gp.None,id:":rf8:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_none")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfa:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:gp.ServiceHttp,id:":rfa:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_api_key")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfc:",className:n_("flex items-center gap-1",!0===e?"cursor-not-allowed":"cursor-pointer"),children:[s.jsx(Ba,{type:"button",role:"radio",disabled:e,value:gp.OAuth,id:":rfc:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary",!0===e?"cursor-not-allowed":""),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_oauth")]})})]})]}),"none"===c?null:"service_http"===c?s.jsx(JT,{}):s.jsx(tI,{}),s.jsxs("div",{className:"mt-5 flex flex-col gap-3 sm:mt-4 sm:flex-row-reverse",children:[s.jsx("button",{className:"btn relative bg-surface-submit text-primary-foreground hover:bg-surface-submit-hover",onClick:async()=>{const e=await l(void 0,{shouldFocus:!0});i("saved_auth_fields",e),r(!e)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-white",children:t("com_ui_save")})}),s.jsx(fl,{className:"btn btn-neutral relative",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_ui_cancel")})})]})]})]})]})}const JT=()=>{const e=Fk(),{register:t,watch:n,setValue:a}=Vo(),r=n("authorization_type"),o=n("type");return s.jsxs(s.Fragment,{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_api_key")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"new-password",autoComplete:"new-password",className:n_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),...t("api_key",{required:o===gp.ServiceHttp})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_type")}),s.jsxs(Va,{defaultValue:xp.Basic,onValueChange:e=>a("authorization_type",e),value:r,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-2 flex gap-6 overflow-hidden rounded-lg",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfu:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:xp.Basic,id:":rfu:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rg0:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:xp.Bearer,id:":rg0:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_bearer")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rg2:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:xp.Custom,id:":rg2:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_custom")]})})]}),r===xp.Custom&&s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_custom_header_name")}),s.jsx("input",{className:n_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),placeholder:"X-Api-Key",...t("custom_auth_header",{required:r===xp.Custom})})]})]})};function eI(e){switch(e){case gp.ServiceHttp:return"com_ui_api_key";case gp.OAuth:return"com_ui_oauth";default:return"com_ui_none"}}const tI=()=>{const e=Fk(),{register:t,watch:n,setValue:a}=Vo(),r=n("token_exchange_method"),o=n("type"),i=n_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring");return s.jsxs(s.Fragment,{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_id")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:i,...t("oauth_client_id",{required:!1})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_secret")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:i,...t("oauth_client_secret",{required:!1})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_url")}),s.jsx("input",{className:i,...t("authorization_url",{required:o===gp.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_url")}),s.jsx("input",{className:i,...t("client_url",{required:o===gp.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_scope")}),s.jsx("input",{className:i,...t("scope",{required:o===gp.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_exchange_method")}),s.jsxs(Va,{defaultValue:xp.Basic,onValueChange:e=>a("token_exchange_method",e),value:r,role:"radiogroup","aria-required":"true",dir:"ltr",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rj1:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:vp.DefaultPost,id:":rj1:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_default_post_request")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rj3:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:vp.BasicAuthHeader,id:":rj3:",className:n_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic_auth_header")]})})]})]})};function nI({action_id:e}){const t=Fk(),{watch:a}=Vo(),{showToast:r}=Bd(),[o,i]=n.useState(!1),l=`${window.location.protocol}//${window.location.host}/api/actions/${e}/oauth/callback`,c=qE({text:l});if(!e)return null;return a("type")!==gp.OAuth?null:s.jsxs("div",{className:"mb-1.5 flex flex-col space-y-2",children:[s.jsx("label",{className:"font-semibold",children:t("com_ui_callback_url")}),s.jsx("div",{className:"relative flex items-center",children:s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-10 w-full rounded-lg border",children:[s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsx("div",{className:"relative w-full",children:s.jsx("input",{type:"text",readOnly:!0,value:l,className:"w-full border-0 bg-transparent px-3 py-2 pr-12 text-sm text-text-secondary-alt focus:outline-none",style:{direction:"rtl"}})})}),s.jsx("div",{className:"absolute right-0 flex h-full items-center pr-1",children:s.jsx(ki,{size:"sm",variant:"ghost",type:"button",onClick:()=>{o||(r({message:t("com_ui_copied_to_clipboard")}),c(i))},className:n_("h-8 rounded-md px-2",o?"cursor-default":""),"aria-label":t("com_ui_copy_link"),children:o?s.jsx(ft,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})})]})})]})}function sI({columns:e,data:t}){const n=lr({columns:e,data:t,getCoreRowModel:ur()});return s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>s.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>s.jsx("th",{className:"py-1 font-normal text-text-secondary-alt",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},t)))},t)))}),s.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>s.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>s.jsx("td",{className:"py-2",children:ir(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const aI=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],rI=ko(((e,t)=>{t(Wx(e))}),800);function oI({action:e,agent_id:t,setAction:a}){const r=e=>{e.status||(h(null),x(null)),u(e)},o=Fk(),{showToast:i}=Bd(),{handleSubmit:l,reset:c}=Vo(),[d,u]=n.useState(null),[m,p]=n.useState(""),[f,h]=n.useState(null),[g,x]=n.useState(null);n.useEffect((()=>{const t=(null==e?void 0:e.metadata.raw_spec)??"";t&&(p(t),rI(t,r))}),[null==e?void 0:e.metadata.raw_spec]),n.useEffect((()=>{if(!d||!d.status||!d.spec)return;const{functionSignatures:e,requestBuilders:t}=Kx(d.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));h(n),u(null),x(e.map((e=>e.toObjectTool())))}),[d]);const v=Vy({onSuccess(e){i({message:o("com_assistants_update_actions_success"),status:"success"}),c(),a(e[1])},onError(e){i({message:e.message||o("com_assistants_update_actions_error"),status:"error"})}}),b=l((n=>{s_.log("actions","saving action",n);const s=t??"";if(!s)return;if(!g)return;if(!f)return;let{metadata:a={}}=e??{};const r=null==e?void 0:e.action_id;a.raw_spec=m;const o=new URL(f[0].domain).hostname;if(!o)return;a.domain=o;const{type:i,saved_auth_fields:l}=n,c=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};l&&i===gp.ServiceHttp?a={...a,api_key:n.api_key,auth:{type:i,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:l&&i===gp.OAuth?a={...a,auth:{type:i,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:l?(c(a),a.auth={type:i}):c(a),v.mutate({action_id:r,metadata:a,functions:g,agent_id:s})}));return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"",children:[s.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[s.jsx("label",{htmlFor:"schemaInput",className:"text-token-text-primary whitespace-nowrap font-medium",children:"Schema"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{onChange:e=>s_.log("actions","selecting example action",e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[s.jsx("option",{value:"label",children:o("com_ui_examples")}),s.jsx("option",{value:"0",children:"Weather (JSON)"}),s.jsx("option",{value:"1",children:"Pet Store (YAML)"}),s.jsx("option",{value:"2",children:"Blank Template"})]})})]}),s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[s.jsx("div",{className:"relative",children:s.jsx("textarea",{id:"schemaInput",value:m,onChange:e=>{const t=e.target.value;if(p(t),!t)return h(null),x(null),u(null);rI(t,r)},spellCheck:"false",placeholder:o("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),d&&"OpenAPI spec is valid."!==d.message&&s.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:d.message.split("\n").map(((e,t)=>s.jsx("div",{children:e},t)))})]})]}),!!f&&s.jsxs("div",{className:"my-2",children:[s.jsx("div",{className:"flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:o("com_assistants_available_actions")})}),s.jsx(sI,{columns:aI,data:f})]}),s.jsxs("div",{className:"relative my-1",children:[s.jsx(nI,{action_id:null==e?void 0:e.action_id}),s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:o("com_ui_privacy_policy_url")})}),s.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:s.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{disabled:!g||!g.length,onClick:b,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:v.isLoading?s.jsx(ac,{className:"icon-md"}):null!=(null==e?void 0:e.action_id)&&e.action_id?o("com_ui_update"):o("com_ui_create")})})]})}function iI(){const e=Fk(),{showToast:t}=Bd(),{setActivePanel:a,action:r,setAction:o,agent_id:i}=Zk(),l=By({onSuccess:()=>{t({message:e("com_assistants_delete_actions_success"),status:"success"}),a(Xd.builder),o(void 0)},onError(n){t({message:n.message??e("com_assistants_delete_actions_error"),status:"error"})}}),c=zo({defaultValues:{type:gp.None,saved_auth_fields:!1,api_key:"",authorization_type:xp.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:vp.DefaultPost}}),{reset:d}=c;return n.useEffect((()=>{(null==r?void 0:r.metadata.auth)&&d({type:r.metadata.auth.type||gp.None,saved_auth_fields:!1,api_key:r.metadata.api_key??"",authorization_type:r.metadata.auth.authorization_type||xp.Basic,oauth_client_id:r.metadata.oauth_client_id??"",oauth_client_secret:r.metadata.oauth_client_secret??"",authorization_url:r.metadata.auth.authorization_url??"",client_url:r.metadata.auth.client_url??"",scope:r.metadata.auth.scope??"",token_exchange_method:r.metadata.auth.token_exchange_method??vp.DefaultPost})}),[r,d]),s.jsx(Bo,{...c,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{a(Xd.builder),o(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!r&&s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:!i||!r.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(kc,{className:"text-red-500"})})})}),s.jsx(zd,{showCloseButton:!1,title:e("com_ui_delete_action"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:e("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{if(!i)return t({message:e("com_agents_no_agent_id_error"),status:"error"});l.mutate({action_id:r.action_id,agent_id:i})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:(r?"Edit":"Add")+" actions"}),s.jsx("div",{className:"text-xs text-text-secondary",children:e("com_assistants_actions_info")})]}),s.jsx(ZT,{}),s.jsx(oI,{action:r,agent_id:i,setAction:o})]})})})}function lI(){return s.jsxs("div",{className:"h-auto bg-white dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Nl,{className:"relative h-20 w-20 rounded-full"})}),s.jsx(Nl,{className:"mb-2 h-5 w-1/5 rounded-lg"}),s.jsx(Nl,{className:"mb-1 h-[40px] w-full rounded-lg"}),s.jsx(Nl,{className:"h-3 w-1/4 rounded-lg"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(Nl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Nl,{className:"h-[40px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Nl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Nl,{className:"h-[100px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Nl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Nl,{className:"h-[40px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Nl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Nl,{className:"mb-2 h-5 w-36 rounded-lg"}),s.jsx(Nl,{className:"mb-4 h-[35px] w-full rounded-lg"}),s.jsx(Nl,{className:"mb-2 h-5 w-24 rounded-lg"}),s.jsx(Nl,{className:"h-[35px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Nl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Nl,{className:"mb-2 h-[35px] w-full rounded-lg"}),s.jsx(Nl,{className:"mb-2 h-[35px] w-full rounded-lg"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(Nl,{className:"h-8 w-1/2 rounded-lg"}),s.jsx(Nl,{className:"h-8 w-1/2 rounded-lg"})]})]}),s.jsx("div",{className:"mb-6",children:s.jsx(Nl,{className:"h-[35px] w-full rounded-lg"})}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Nl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Nl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Nl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Nl,{className:"h-[35px] w-full rounded-lg"})]})]})}function cI(){const e=Fk(),t=Vo(),{control:n}=t;return s.jsxs(al,{openDelay:50,children:[s.jsx(Uo,{name:"recursion_limit",control:n,render:({field:t})=>s.jsx(fd,{field:t,containerClass:"w-1/2",inputClass:"w-full",label:e("com_ui_agent_recursion_limit"),placeholder:e("com_nav_theme_system"),type:"number",labelClass:"w-fit",labelAdjacent:s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})})}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_agent_recursion_limit_info")})})})})]})}function dI(e){const t=(null==e?void 0:e.toLowerCase())??"";return t&&(/\b(o\d)\b/i.test(t)||/\bgpt-[5-9]\b/i.test(t))?"#000000":t.includes("gpt-4")?"#AB68FF":"#19C37D"}function uI(e,t){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?s.jsx(Rc,{size:.75*t}):/gemini|learnlm|gemma/.test((null==e?void 0:e.toLowerCase())??"")?s.jsx(Pc,{size:.7*t}):s.jsx(Ic,{size:.7*t})}function mI(e){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?"Codey":!0===(null==e?void 0:e.toLowerCase().includes("gemini"))||!0===(null==e?void 0:e.toLowerCase().includes("learnlm"))?"Gemini":!0===(null==e?void 0:e.toLowerCase().includes("gemma"))?"Gemma":"PaLM2"}const pI=n.memo((e=>{const{error:t,button:n,iconURL:a="",endpoint:r,size:o=30,model:i="",assistantName:l,agentName:c}=e,d={icon:a?s.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:s.jsx("div",{title:l,style:{width:o,height:o},className:n_("overflow-hidden rounded-full",e.className??""),children:s.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:a,alt:l,style:{height:"80",width:"80"}})})}):s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(Uc,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:r},u={icon:a?s.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:s.jsx("div",{title:c,style:{width:o,height:o},className:n_("overflow-hidden rounded-full",e.className??""),children:s.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:a,alt:c,style:{height:"80",width:"80"}})})}):s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(lt,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:r},m={[Uu.assistants]:d,[Uu.agents]:u,[Uu.azureAssistants]:d,[Uu.azureOpenAI]:{icon:s.jsx(Ec,{size:.5555555555555556*o}),bg:"linear-gradient(0.375turn, #61bde2, #4389d0)",name:"ChatGPT"},[Uu.openAI]:{icon:s.jsx(Jl,{size:.5555555555555556*o}),bg:dI(i),name:"ChatGPT"},[Uu.gptPlugins]:{icon:s.jsx(Zl,{size:.7*o}),bg:`rgba(69, 89, 164, ${!0===n?.75:1})`,name:"Plugins"},[Uu.google]:{icon:uI(i,o),name:mI(i)},[Uu.anthropic]:{icon:s.jsx(yc,{size:.5555555555555556*o}),bg:"#d09a74",name:"Claude"},[Uu.bedrock]:{icon:s.jsx(Gc,{className:"icon-xl text-white"}),bg:"#268672",name:uh[Uu.bedrock]},[Uu.custom]:{icon:s.jsx(lc,{size:.7*o}),name:"Custom"},null:{icon:s.jsx(Jl,{size:.7*o}),bg:"grey",name:"N/A"},default:{icon:s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"overflow-hidden rounded-full",children:s.jsx(NT,{iconURL:a,endpoint:r??"",className:"h-full w-full object-contain",context:"message"})})}),name:r}};let{icon:p,bg:f,name:h}=null!=r&&r&&m[r]?m[r]??{}:m.default;return a&&m[a]&&({icon:p,bg:f,name:h}=m[a]),Yu(r)?p:s.jsxs("div",{title:h??"",style:{background:null!=f&&f||"transparent",width:o,height:o},className:n_("relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",e.className??""),children:[p,!0===t&&s.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-3 w-3 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-white",children:"!"})]})})),fI=n.memo((({iconURL:e,altName:t,containerStyle:a={width:20,height:20},imageStyle:r={width:"100%",height:"100%"},className:o="icon-md mr-1 shrink-0 overflow-hidden rounded-full",endpoint:i})=>{const[l,c]=n.useState(!1),d=i&&kT[i]?kT[i]:kT.unknown;return l||!e?s.jsxs("div",{className:"relative",style:{...a,margin:"2px"},children:[s.jsx("div",{className:o,children:s.jsx(d,{endpoint:i,context:"menu-item",size:a.width})}),l&&e&&s.jsx("div",{className:"absolute flex items-center justify-center rounded-full bg-red-500",style:{width:"14px",height:"14px",top:0,right:0},children:s.jsx(gt,{size:10,className:"text-white"})})]}):s.jsx("div",{className:o,style:a,children:s.jsx("img",{src:e,alt:t??"Icon",style:r,className:"object-cover",onError:()=>{c(!0)},loading:"lazy",decoding:"async",width:Number(a.width)||20,height:Number(a.height)||20})})}));fI.displayName="URLIcon";const hI={"menu-item":"relative flex h-full items-center justify-center overflow-hidden rounded-full",message:"icon-md",default:"icon-xl relative flex h-full overflow-hidden rounded-full"},gI={"menu-item":{width:"20px",height:"20px"},default:{width:"100%",height:"100%"}},xI={default:{width:"100%",height:"100%"}},vI=n.memo((({iconURL:e="",modelLabel:t="",endpointIconURL:a,assistantAvatar:r,assistantName:o,agentAvatar:i,agentName:l,context:c})=>{const d=n.useMemo((()=>kT[e]??kT.unknown),[e]);return n.useMemo((()=>!(!e||!e.includes("http")&&!e.startsWith("/images/"))),[e])?s.jsx(fI,{iconURL:e,altName:t,className:hI[c??"default"]??hI.default,containerStyle:gI[c??"default"]??gI.default,imageStyle:xI[c??"default"]??xI.default}):s.jsx("div",{className:"shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white text-black",children:d&&s.jsx(d,{size:41,context:c,className:"h-2/3 w-2/3",agentName:l,iconURL:a,assistantName:o,avatar:r||i})})}));function bI(e){var t,a;const{message:r,conversation:o,assistant:i,agent:l}=e,c=n.useMemo((()=>({...o??{},...{...r,iconURL:(null==r?void 0:r.iconURL)??""}})),[o,r]),d=c.iconURL??"";let u=c.endpoint;u=Ab({endpointsConfig:void 0,iconURL:d,endpoint:u});const m=(i?i.name:"")??"",p=(i?null==(t=i.metadata)?void 0:t.avatar:"")??"",f=(l?l.name:"")??"",h=(l?null==(a=null==l?void 0:l.avatar)?void 0:a.filepath:"")??"",g=n.useMemo((()=>{let e="";return i?e=p:l&&(e=h),e}),[i,l,p,h]);return console.log("MessageIcon",{endpoint:u,iconURL:d,assistantName:m,assistantAvatar:p,agentName:f,agentAvatar:h}),!0!==(null==r?void 0:r.isCreatedByUser)&&d&&d.includes("http")?s.jsx(vI,{iconURL:d,modelLabel:c.chatGptLabel??c.modelLabel??"",context:"message",assistantAvatar:p,assistantName:m,agentAvatar:h,agentName:f}):!0===(null==r?void 0:r.isCreatedByUser)?s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:s.jsx(Dc,{})}):s.jsx(pI,{...c,endpoint:u,iconURL:g,model:(null==r?void 0:r.model)??(null==o?void 0:o.model),assistantName:m,agentName:f,size:28.8})}const _I=({field:e,currentAgentId:t})=>{var a;const r=Fk(),[o,i]=n.useState(""),l=Dk()||{},c=e.value||[],d=n.useMemo((()=>Object.values(l)),[l]),u=n.useMemo((()=>d.filter((e=>(null==e?void 0:e.id)!==t)).map((e=>({label:(null==e?void 0:e.name)||"",value:null==e?void 0:e.id,icon:s.jsx(bI,{message:{endpoint:Uu.agents,isCreatedByUser:!1},agent:e})})))),[d,t]),m=n.useCallback((e=>l[e]),[l]);n.useEffect((()=>{o&&c.length<10&&(e.onChange([...c,o]),i(""))}),[o,c,e]);return s.jsxs(al,{openDelay:50,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"font-semibold text-text-primary",children:r("com_ui_agent_chain")}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsxs("div",{className:"text-xs text-text-secondary",children:[c.length," / ",10]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex h-10 items-center justify-between rounded-md border border-border-medium bg-surface-primary-contrast px-3 py-2",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(bI,{message:{endpoint:Uu.agents,isCreatedByUser:!1},agent:t?l[t]:void 0})}),s.jsx("div",{className:"font-medium text-text-primary",children:null==(a=m(t))?void 0:a.name})]})}),s.jsx(xt,{className:"mx-auto text-text-secondary",size:14}),c.map(((t,n)=>{var a;return s.jsxs(S.Fragment,{children:[s.jsxs("div",{className:"flex h-10 items-center gap-2 rounded-md border border-border-medium bg-surface-tertiary pr-2",children:[s.jsx(Fd,{isCollapsed:!1,ariaLabel:r("com_ui_agent_var",{0:r("com_ui_select")}),selectedValue:t,setValue:t=>((t,n)=>{const s=[...c];s[t]=n,e.onChange(s)})(n,t),selectPlaceholder:r("com_ui_agent_var",{0:r("com_ui_select")}),searchPlaceholder:r("com_ui_agent_var",{0:r("com_ui_search")}),items:u,displayValue:(null==(a=m(t))?void 0:a.name)??"",SelectIcon:s.jsx(bI,{message:{endpoint:Uu.agents,isCreatedByUser:!1},agent:t?l[t]:void 0}),className:"flex-1 border-border-heavy",containerClassName:"px-0"}),s.jsx("button",{className:"rounded-xl p-1 transition hover:bg-surface-hover",onClick:()=>{return t=n,void e.onChange(c.filter(((e,n)=>n!==t)));var t},children:s.jsx(vt,{size:18,className:"text-text-secondary"})})]}),n<c.length-1&&s.jsx(xt,{className:"mx-auto text-text-secondary",size:14})]},t)})),c.length<10&&s.jsxs(s.Fragment,{children:[c.length>0&&s.jsx(xt,{className:"mx-auto text-text-secondary",size:14}),s.jsx(Fd,{isCollapsed:!1,ariaLabel:r("com_ui_agent_var",{0:r("com_ui_add")}),selectedValue:"",setValue:i,selectPlaceholder:r("com_ui_agent_var",{0:r("com_ui_add")}),searchPlaceholder:r("com_ui_agent_var",{0:r("com_ui_search")}),items:u,className:"h-10 w-full border-dashed border-border-heavy text-center text-text-secondary hover:text-text-primary",containerClassName:"px-0",SelectIcon:s.jsx(bt,{size:16,className:"text-text-secondary"})})]}),c.length>=10&&s.jsx("p",{className:"pt-1 text-center text-xs italic text-text-tertiary",children:r("com_ui_agent_chain_max",{0:10})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:r("com_ui_agent_chain_info")})})})})]})};function yI(){const e=Fk(),t=Vo(),{control:a,watch:r}=t,o=r("id"),{agentsConfig:i,setActivePanel:l}=Zk(),c=n.useMemo((()=>(null==i?void 0:i.capabilities.includes(vf.chain))??!1),[i]);return s.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[s.jsxs("div",{className:"advanced-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{l(Xd.builder)},children:s.jsx("div",{className:"advanced-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_advanced_settings")})]}),s.jsxs("div",{className:"flex flex-col gap-4 px-2",children:[s.jsx(cI,{}),c&&s.jsx(Uo,{name:"agent_ids",control:a,defaultValue:[],render:({field:e})=>s.jsx(_I,{field:e,currentAgentId:o})})]})]})}function jI({name:e,config:t,hasValue:n,control:a,errors:r}){var o;const i=Fk();return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(Ol,{enableHTML:!0,description:t.description||"",render:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(dl,{htmlFor:e,className:"text-sm font-medium",children:t.title}),s.jsx(Hc,{className:"h-6 w-6 cursor-help text-text-secondary transition-colors hover:text-text-primary"})]})}),n?s.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),s.jsx("span",{children:i("com_ui_set")})]}):s.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full border border-border-medium"}),s.jsx("span",{children:i("com_ui_unset")})]})]}),s.jsx(Uo,{name:e,control:a,defaultValue:"",render:({field:a})=>s.jsx(ll,{id:e,type:"text",...a,placeholder:i(n?"com_ui_mcp_update_var":"com_ui_mcp_enter_var",{0:t.title}),className:"w-full rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary placeholder:text-text-secondary focus:outline-none sm:text-sm"})}),r[e]&&s.jsx("p",{className:"text-xs text-red-500",children:null==(o=r[e])?void 0:o.message})]})}function wI({fields:e,onSave:t,onRevoke:a,serverName:r,isSubmitting:o=!1}){const i=Fk(),{data:l}=cj(r,{enabled:!!r}),{reset:c,control:d,handleSubmit:u,formState:{errors:m}}=zo({defaultValues:n.useMemo((()=>{const t={};return Object.keys(e).forEach((e=>{t[e]=""})),t}),[e])}),p=e=>{t(e)};return e&&0!==Object.keys(e).length?s.jsxs("div",{className:"flex-1 space-y-4",children:[s.jsx("form",{onSubmit:u(p),className:"space-y-4",children:Object.entries(e).map((([e,t])=>{var n;const a=(null==(n=null==l?void 0:l.authValueFlags)?void 0:n[e])||!1;return s.jsx(jI,{name:e,config:t,hasValue:a,control:d,errors:m},e)}))}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(ki,{type:"button",variant:"destructive",disabled:o,onClick:()=>{a(),c()},children:i("com_ui_revoke")}),s.jsx(ki,{type:"button",variant:"submit",disabled:o,onClick:u(p),children:i(o?"com_ui_saving":"com_ui_save")})]})]}):null}const NI=({currentPage:e,maxPage:t,onChangePage:n})=>{const a=Fk(),r=[...Array(t).keys()].map((e=>e+1)),o=e=>{e<1||e>t||n(e)};return s.jsxs("div",{className:"flex gap-2 text-sm text-black/60 dark:text-white/70",children:[s.jsxs("div",{role:"button",tabIndex:0,"aria-label":"Previous page",onClick:()=>o(e-1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e-1)},className:"flex cursor-default items-center text-sm "+(1===e?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})}),a("com_ui_prev")]}),r.map((t=>s.jsx("div",{role:"button",tabIndex:0,className:"flex h-5 w-5 items-center justify-center text-sm "+(e===t?"text-blue-600 hover:text-blue-600 dark:text-blue-600 dark:hover:text-blue-600":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},onClick:()=>n(t),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n(t)},children:t},t))),s.jsxs("div",{role:"button","aria-label":"Next page",tabIndex:0,onClick:()=>o(e+1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e+1)},className:"flex cursor-default items-center text-sm "+(e===t?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[a("com_ui_next"),s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})]})]})};function CI({content:e,position:t}){return s.jsx(ol,{children:s.jsx(il,{side:t,className:"w-80 ",children:s.jsx("div",{className:"space-y-2",children:s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e})})})})}function kI({plugin:e,onSubmit:t,isEntityTool:n}){const{register:a,handleSubmit:r,formState:{errors:o,isDirty:i,isValid:l,isSubmitting:c}}=zo(),d=Fk(),u=(null==e?void 0:e.authConfig)??[];return s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:s.jsxs("form",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",method:"POST",onSubmit:r((s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n}))),children:[u.map(((e,t)=>{const n=e.authField.split("||")[0];return s.jsxs("div",{className:"flex w-full flex-col gap-1",children:[s.jsx("label",{htmlFor:n,className:"mb-1 text-left text-sm font-medium text-gray-700/70 dark:text-gray-50/70",children:e.label}),s.jsxs(al,{openDelay:300,children:[s.jsx(rl,{className:"grid w-full items-center gap-2",children:s.jsx("input",{type:"text",autoComplete:"off",id:n,"aria-invalid":!!o[n],"aria-describedby":`${n}-error`,"aria-label":e.label,"aria-required":"true",...a(n,{required:`${e.label} is required.`,minLength:{value:1,message:`${e.label} must be at least 1 character long`}}),className:"flex h-10 max-h-10 w-full resize-none rounded-md border border-gray-200 bg-transparent px-3 py-2 text-sm text-gray-700 shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none placeholder:text-gray-400 focus:border-gray-400 focus:bg-gray-50 focus:outline-none focus:ring-0 focus:ring-gray-400 focus:ring-opacity-0 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:border-gray-400 focus:dark:bg-gray-600 dark:focus:outline-none dark:focus:ring-0 dark:focus:ring-gray-400 dark:focus:ring-offset-0"})}),s.jsx(CI,{content:e.description,position:"right"})]}),o[n]&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-400",children:o[n].message})]},`${n}-${t}`)})),s.jsx("button",{disabled:!i||!l||c,type:"button",className:"btn btn-primary relative",onClick:()=>{r((s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n})))()},children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d("com_ui_save"),s.jsx(_t,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})})})}function SI({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1,isConfiguring:r=!1,isInitializing:o=!1}){var i,l,c;const d=Fk(),u=(null==(i=e.metadata)?void 0:i.name)||e.tool_id,m=(null==(l=e.metadata)?void 0:l.description)||"",p=null==(c=e.metadata)?void 0:c.icon,f=a?{text:d("com_nav_tool_remove"),icon:s.jsx(jt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",disabled:!1}:r?{text:d("com_ui_confirm"),icon:s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative",disabled:!1}:o?{text:d("com_ui_initializing"),icon:s.jsx(yt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative opacity-75 cursor-not-allowed",disabled:!0}:{text:d("com_ui_add"),icon:s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative",disabled:!1};return s.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:s.jsxs("div",{className:"relative h-full w-full",children:[p?s.jsx("img",{src:p,alt:d("com_ui_logo",{0:u}),className:"h-full w-full rounded-[5px] bg-white"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:s.jsx(yt,{className:"h-8 w-8 text-text-secondary"})}),s.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),s.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[s.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:u}),s.jsx("button",{className:f.className,"aria-label":`${f.text} ${u}`,onClick:()=>{a?n():t()},disabled:f.disabled,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[f.text,f.icon]})})]})]}),s.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:m})]})}function EI({isOpen:e,agentId:t,setIsOpen:a,mcpServerNames:r}){var o,i;const l=Fk(),{mcpServersMap:c}=Zk(),{initializeServer:d}=DE(),{data:u}=Ky(),{getValues:m,setValue:p}=Vo(),{refetch:f}=hj(Uu.agents),[h,g]=n.useState(null),[x,v]=n.useState(null),{maxPage:b,setMaxPage:_,currentPage:y,setCurrentPage:j,itemsPerPage:w,searchChanged:N,setSearchChanged:C,searchValue:k,setSearchValue:S,gridRef:E,handleSearch:T,handleChangePage:I,error:R,setError:P,errorMessage:A,setErrorMessage:M}=rT(),L=bk(),O=e=>{var t,n;P(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&M(s),setTimeout((()=>{P(!1),M("")}),5e3)},D=async e=>{try{g(e);const t=c.get(e);if(!(null==t?void 0:t.isConnected)){const t=await d(e);if((null==t?void 0:t.success)&&t.oauthRequired&&t.oauthUrl)return void g(null)}L.mutate({pluginKey:`${Sh.mcp_prefix}${e}`,action:"install",auth:{},isEntityTool:!0},{onError:e=>{O(e),g(null)},onSuccess:async()=>{const{data:t}=await f(),n=m("tools")||[],s=[`${Sh.mcp_server}${Sh.mcp_delimiter}${e}`];t&&t.forEach((t=>{t.pluginKey.endsWith(`${Sh.mcp_delimiter}${e}`)&&s.push(t.pluginKey)}));const a=s.filter((e=>!n.includes(e)));a.length>0&&p("tools",[...n,...a]),g(null)}})}catch(t){console.error("Error adding MCP server:",t)}},F=n.useMemo((()=>new Set(r)),[r]),z=n.useMemo((()=>Array.from(c.values()).sort(((e,t)=>e.serverName.localeCompare(t.serverName)))),[c]),U=n.useMemo((()=>k?z.filter((e=>e.serverName.toLowerCase().includes(k.toLowerCase()))):z),[z,k]);return n.useEffect((()=>{_(Math.ceil(U.length/w)),N&&(j(1),C(!1))}),[_,w,N,j,C,U.length]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),j(1),S(""),v(null),g(null)},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:l("com_nav_tool_dialog_mcp_server_tools")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:l("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("button",{onClick:()=>{a(!1),j(1),v(null),g(null)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})]}),R&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[l("com_nav_plugin_auth_error")," ",A]}),x&&s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsx("div",{className:"mb-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:l("com_ui_mcp_configure_server_description",{0:x})})}),s.jsx(wI,{serverName:x,fields:(null==(i=null==(o=null==u?void 0:u.mcpServers)?void 0:o[x])?void 0:i.customUserVars)||{},onSave:e=>(async(e,t)=>{try{await L.mutateAsync({pluginKey:`${Sh.mcp_prefix}${e}`,action:"install",auth:t,isEntityTool:!0}),await D(e),v(null)}catch(n){console.error("Error saving custom vars:",n)}})(x,e),onRevoke:()=>{return e=x,void L.mutate({pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>O(e),onSuccess:()=>{v(null)}});var e},isSubmitting:L.isLoading})]}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",onClick:()=>v(null),children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:k,onChange:T,placeholder:l("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:E,className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:U.slice((y-1)*w,y*w).map((e=>{const n=F.has(e.serverName),a=x===e.serverName,r=h===e.serverName,o={agent_id:t,tool_id:e.serverName,metadata:{...e.metadata,description:`${l("com_ui_tool_collection_prefix")} ${e.serverName}`}};return s.jsx(SI,{tool:o,isInstalled:n,isConfiguring:a,isInitializing:r,onAddTool:()=>(async e=>{var t;if(x===e)return v(null),void(await D(e));const n=null==(t=null==u?void 0:u.mcpServers)?void 0:t[e];(null==n?void 0:n.customUserVars)&&Object.keys(n.customUserVars).length>0?v(e):await D(e)})(e.serverName),onRemoveTool:()=>{return t=e.serverName,void L.mutate({pluginKey:`${Sh.mcp_prefix}${t}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>O(e),onSuccess:()=>{const e=(m("tools")||[]).filter((e=>e!==t&&!e.endsWith(`${Sh.mcp_delimiter}${t}`)));p("tools",e)}});var t}},e.serverName)}))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:b>0?s.jsx(NI,{currentPage:y,maxPage:b,onChangePage:I}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}function TI({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1}){var r,o,i;const l=Fk(),c=()=>{a?n():t()},d=(null==(r=e.metadata)?void 0:r.name)||e.tool_id||e.name,u=(null==(o=e.metadata)?void 0:o.description)||e.description||"",m=(null==(i=e.metadata)?void 0:i.icon)||e.icon;return s.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:s.jsxs("div",{className:"relative h-full w-full",children:[m?s.jsx("img",{src:m,alt:l("com_ui_logo",{0:d}),className:"h-full w-full rounded-[5px] bg-white"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:s.jsx(yt,{className:"h-8 w-8 text-text-secondary"})}),s.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),s.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[s.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:d}),a?s.jsx("button",{className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",onClick:c,"aria-label":`${l("com_nav_tool_remove")} ${d}`,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l("com_nav_tool_remove"),s.jsx(jt,{className:"flex h-4 w-4 items-center stroke-2"})]})}):s.jsx("button",{className:"btn btn-primary relative","aria-label":`${l("com_ui_add")} ${d}`,onClick:c,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l("com_ui_add"),s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})]}),s.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:u})]})}function II({isOpen:e,endpoint:t,setIsOpen:a}){const r=Fk(),o=Xu(t),{getValues:i,setValue:l}=Vo(),{groupedTools:c,pluginTools:d}=Zk(),{maxPage:u,setMaxPage:m,currentPage:p,setCurrentPage:f,itemsPerPage:h,searchChanged:g,setSearchChanged:x,searchValue:v,setSearchValue:b,gridRef:_,handleSearch:y,handleChangePage:j,error:w,setError:N,errorMessage:C,setErrorMessage:k,showPluginAuthForm:S,setShowPluginAuthForm:E,selectedPlugin:T,setSelectedPlugin:I}=rT(),R=bk(),P=e=>{var t,n;N(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&k(s),setTimeout((()=>{N(!1),k("")}),5e3)},A=e=>{const t=()=>{const t=i("tools")||[];t.push(e.pluginKey);const n=null==c?void 0:c[e.pluginKey];if((null==n?void 0:n.tools)&&n.tools.length>0)for(const e of n.tools)t.includes(e.tool_id)||t.push(e.tool_id);l("tools",Array.from(new Set(t)))};if(!e.auth)return t();R.mutate(e,{onError:e=>{P(e)},onSuccess:t}),E(!1)},M=Object.values(c||{}).filter((e=>{var t,n;return!!(null==(n=null==(t=e.metadata)?void 0:t.name)?void 0:n.toLowerCase().includes(v.toLowerCase()))||!!e.tools&&e.tools.some((e=>{var t,n;return null==(n=null==(t=e.metadata)?void 0:t.name)?void 0:n.toLowerCase().includes(v.toLowerCase())}))}));return n.useEffect((()=>{M&&(m(Math.ceil(Object.keys(M||{}).length/h)),g&&(f(1),x(!1)))}),[d,v,h,M,g,m,f,x]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),f(1),b("")},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:r(o?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:r("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("div",{className:"sm:mt-0",children:s.jsx("button",{onClick:()=>{a(!1),f(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})})]}),w&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[r("com_nav_plugin_auth_error")," ",C]}),S&&s.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:s.jsx(kI,{plugin:T,onSubmit:e=>A(e),isEntityTool:!0})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:v,onChange:y,placeholder:r("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:_,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:M&&M.slice((p-1)*h,p*h).map(((e,t)=>{var n;return s.jsx(TI,{tool:e,isInstalled:(null==(n=i("tools"))?void 0:n.includes(e.tool_id))||!1,onAddTool:()=>(e=>{E(!1);const t=null==d?void 0:d.find((t=>t.pluginKey===e));I(t);const{authConfig:n,authenticated:s=!1}=t??{};n&&n.length>0&&!s?E(!0):A({pluginKey:e,action:"install",auth:{}})})(e.tool_id),onRemoveTool:()=>(e=>{const t=null==c?void 0:c[e],n=[e];(null==t?void 0:t.tools)&&t.tools.length>0&&n.push(...t.tools.map((e=>e.tool_id))),R.mutate({pluginKey:e,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>P(e),onSuccess:()=>{var e;const t=(null==(e=i("tools"))?void 0:e.filter((e=>!n.includes(e))))||[];l("tools",t)}})})(e.tool_id)},t)}))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:u>0?s.jsx(NI,{currentPage:p,maxPage:u,onChangePage:j}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}const RI=({className:e})=>{const t=Fk(),a=Vo(),{categories:r}=Vk(),o=$o({name:"id",control:a.control}),{syncCategory:i}=(e=>{const[t,s]=n.useState(!1);return{syncCategory:n=>{t||""!==e||n.value||(n.onChange("general"),s(!0))}}})(o),l=e=>e.label&&e.label.startsWith("com_")?t(e.label):e.label,c=r.map((e=>({label:l(e),value:e.value}))),d=t("com_ui_search_agent_category"),u=t("com_ui_agent_category_selector_aria");return s.jsx(Uo,{name:"category",control:a.control,defaultValue:"general",render:({field:t})=>{i(t);const n=(e=>{var t;const n=c.find((t=>t.value===e));return(null==n?void 0:n.label)||(null==(t=c.find((e=>"general"===e.value)))?void 0:t.label)})(t.value);return s.jsx(Fd,{selectedValue:t.value,displayValue:n,searchPlaceholder:d,setValue:e=>{t.onChange(e)},items:c,className:n_(e),ariaLabel:u,isCollapsed:!1,showCarat:!0})}})};function PI({action:e,onClick:t}){const[a,r]=n.useState(!1);return s.jsxs("div",{role:"button",tabIndex:0,onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},className:"group flex w-full rounded-lg border border-border-medium text-sm hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-text-primary",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),"aria-label":`Action for ${e.metadata.domain}`,children:[s.jsx("div",{className:"h-9 grow overflow-hidden text-ellipsis whitespace-nowrap px-3 py-2",style:{wordBreak:"break-all"},children:e.metadata.domain}),s.jsx("div",{className:n_("h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-tertiary focus:outline-none focus:ring-2 focus:ring-text-primary group-focus:flex",a?"flex":"hidden"),"aria-label":"Settings",children:s.jsx(Nc,{className:"icon-sm","aria-hidden":"true"})})]})}const AI=n_(f_,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",u_),MI=Object.keys(Oh).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function LI(){const e=n.useId(),t=Fk(),a=Vo(),{control:r,setValue:o,getValues:i}=a,[l,c]=n.useState(!1);return s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"mb-2 flex items-center",children:[s.jsx("label",{className:"text-token-text-primary flex-grow font-medium",htmlFor:"instructions",children:t("com_ui_instructions")}),s.jsx("div",{className:"ml-auto",title:"Add variables to instructions",children:s.jsx(wd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:l,setIsOpen:c,trigger:s.jsxs(ie,{id:"variables-menu-button","aria-label":"Add variable to instructions",className:"flex h-7 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[s.jsx(bt,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),t("com_ui_variables")]}),items:MI.map((e=>({label:t(e.label)||e.label,onClick:()=>((e,n)=>{const s=i("instructions")||"",a=s.length>0?"\n":"",r=t(e);o("instructions",s+a+r+": "+n),c(!1)})(e.label,e.value)}))),menuId:e,className:"z-30"})})]}),s.jsx(Uo,{name:"instructions",control:r,render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("textarea",{...e,value:e.value??"",className:n_(AI,"min-h-[100px] resize-y"),id:"instructions",placeholder:t("com_agents_instructions_placeholder"),rows:3,"aria-label":"Agent instructions","aria-required":"true","aria-invalid":n?"true":"false"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert",children:t("com_ui_field_required")})]})})]})}function OI(){return s.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const DI=({url:e,progress:t=1})=>{const n=2*Math.PI*55,a=n-t*n;return s.jsx("div",{children:s.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[s.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}},e||"default-key"),t<1&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:a,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function FI({handleFileChange:e}){const t=Fk(),a=n.useRef(null);return s.jsx(Ha,{children:s.jsxs(Ga,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[s.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded-lg p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;a.current&&(a.current.value=""),null==(e=a.current)||e.click()},children:t("com_ui_upload_image")}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:a,tabIndex:-1})]})})}function zI({agent_id:e="",avatar:t,createMutation:a}){const r=pr(),[o,i]=n.useState(!1),[l,c]=n.useState(""),[d,u]=n.useState(1),[m,p]=n.useState(null),f=n.useRef(null),{data:h=cp}=Yy({select:e=>fp(e)}),g=Fk(),{showToast:x}=Bd(),{mutate:v}=Uy({onMutate:()=>{u(.4)},onSuccess:t=>{var n,s,o;f.current!==(null==(n=a.data)?void 0:n.id)&&(f.current=(null==(s=a.data)?void 0:s.id)??""),x({message:g("com_ui_upload_agent_avatar")}),p(null);const i=(null==(o=t.avatar)?void 0:o.filepath)??"";c(i),Ly.forEach((n=>{const s=r.getQueryData([xx.agents,n]);if(!(null==s?void 0:s.data))return;const a=s.data.map((n=>n.id===e?{...n,...t}:n));r.setQueryData([xx.agents,n],{...s,data:a})})),Hy(r),u(1)},onError:e=>{console.error("Error:",e),p(null),c(""),x({message:g("com_ui_upload_error"),status:"error"}),u(1)}});n.useEffect((()=>{if(m){const e=new FileReader;e.onloadend=()=>{c(e.result)},e.readAsDataURL(m)}}),[m]),n.useEffect((()=>{t&&t.filepath?c(t.filepath):c("")}),[t]),n.useEffect((()=>{const e=!!(a.isSuccess&&m&&l&&l.includes("base64"));if((!e||f.current!==a.data.id)&&e&&a.data.id){const e=new FormData;e.append("file",m,m.name),e.append("agent_id",a.data.id),v({agent_id:a.data.id,formData:e})}}),[a.data,a.isSuccess,m,l,v]);return s.jsxs(Ka,{open:o,onOpenChange:i,children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Wa,{asChild:!0,children:s.jsx("button",{type:"button",className:"h-20 w-20",children:l?s.jsx(DI,{url:l,progress:d}):s.jsx(OI,{})})})}),s.jsx(FI,{handleFileChange:n=>{var s;const a=null==(s=n.target.files)?void 0:s[0],r=h.avatarSizeLimit??0;if(r&&a&&a.size<=r){p(a),i(!1);const n=e??"";if(!n)return;const s=new FormData;s.append("file",a,a.name),s.append("agent_id",n),"object"==typeof t&&s.append("avatar",JSON.stringify(t)),v({agent_id:n,formData:s})}else{const e=r?Dv(r):2;x({message:g("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}i(!1)}})]})}function UI({isOpen:e,onOpenChange:t,onFilesSelected:a,disabled:r=!1,isDownloading:o=!1,downloadProgress:i=null,maxSelectionCount:l}){const[c,d]=n.useState(null),u=Fk(),{openSharePointPicker:m,closeSharePointPicker:p,cleanup:f}=function({containerNode:e,onFilesSelected:t,onClose:s,disabled:a=!1,maxSelectionCount:r=10}){const[o]=Re(Ny.lang),{user:i}=Kk(),{showToast:l}=Bd(),c=Fk(),d=n.useRef(null),u=n.useRef(null),m=n.useRef(""),{data:p}=Ky(),f=null==p?void 0:p.sharePointBaseUrl,h="openid"===(null==i?void 0:i.provider),{token:g,isLoading:x,error:v}=NE({enabled:h&&!a&&!!f,purpose:"Pick"}),b=n.useCallback((()=>`sharepoint-picker-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),[]),_=n.useCallback((async e=>{const n=u.current;if(n)try{switch(e.data.type){case"notification":console.log("SharePoint picker notification:",e.data);break;case"command":{n.postMessage({type:"acknowledge",id:e.data.id});const a=e.data.data;switch(console.log("SharePoint picker command:",a),a.command){case"authenticate":console.log("Authentication requested, providing token"),console.log("Command details:",a),console.log("Token available:",!!(null==g?void 0:g.access_token)),(null==g?void 0:g.access_token)?n.postMessage({type:"result",id:e.data.id,data:{result:"token",token:g.access_token}}):(console.error("No token available for authentication"),n.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"noToken",message:"No authentication token available"}}}));break;case"close":console.log("Close command received"),n.postMessage({type:"result",id:e.data.id,data:{result:"success"}}),null==s||s();break;case"pick":{console.log("Files picked from SharePoint:",a);const s=a.items||a.files||[];if(console.log("Extracted items:",s),s&&s.length>0){const e=s.map((e=>{var t,n,s,a,r,o,i,l,c;return{id:e.id||e.shareId||(null==(t=e.driveItem)?void 0:t.id),name:e.name||(null==(n=e.driveItem)?void 0:n.name),size:e.size||(null==(s=e.driveItem)?void 0:s.size),webUrl:e.webUrl||(null==(a=e.driveItem)?void 0:a.webUrl),downloadUrl:e.downloadUrl||(null==(r=e.driveItem)?void 0:r["@microsoft.graph.downloadUrl"]),driveId:e.driveId||(null==(o=e.parentReference)?void 0:o.driveId)||(null==(l=null==(i=e.driveItem)?void 0:i.parentReference)?void 0:l.driveId),itemId:e.id||(null==(c=e.driveItem)?void 0:c.id),sharePointItem:e}}));console.log("Processed SharePoint files:",e),t&&t(e),l({message:`Selected ${e.length} file(s) from SharePoint`,status:"success"})}n.postMessage({type:"result",id:e.data.id,data:{result:"success"}});break}default:console.warn(`Unsupported command: ${a.command}`),n.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"unsupportedCommand",message:a.command}}})}break}default:console.log("Unknown message type:",e.data.type)}}catch(a){console.error("Error processing port message:",a)}else console.error("No port available for communication")}),[g,t,l,s]),y=n.useCallback((e=>{var t;if(console.log("=== SharePoint picker init message received ==="),console.log("Event source:",e.source),console.log("Event data:",e.data),console.log("Expected channelId:",m.current),e.source&&e.source===(null==(t=d.current)?void 0:t.contentWindow)){const t=e.data;"initialize"===t.type&&t.channelId===m.current&&(console.log("Establishing MessagePort communication"),u.current=e.ports[0],u.current?(u.current.addEventListener("message",_),u.current.start(),u.current.postMessage({type:"activate"}),console.log("MessagePort established and activated")):console.error("No MessagePort found in initialize event"))}}),[_]),j=n.useRef(null),w=n.useCallback((()=>{j.current&&(window.removeEventListener("message",j.current),j.current=null),u.current&&(u.current.close(),u.current=null),e&&(e.innerHTML=""),m.current=""}),[e]),N=n.useCallback((()=>{w()}),[w]);return{openSharePointPicker:(null==p?void 0:p.sharePointFilePickerEnabled)&&h&&!v?async()=>{if(g)if(e)try{const t=b();m.current=t,console.log("=== SharePoint File Picker v8 (MessagePort) ==="),console.log("Token available:",{hasToken:!!g.access_token,tokenType:g.token_type,expiresIn:g.expires_in,scopes:g.scope}),console.log("Channel ID:",t);const n={sdk:"8.0",entry:{sharePoint:{}},messaging:{origin:window.location.origin,channelId:t},authentication:{enabled:!1},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0,shared:!0,sharedLibraries:!0,myOrganization:!0,site:!0}},selection:{mode:"multiple",maximumCount:r},title:c("com_files_sharepoint_picker_title"),commands:{upload:{enabled:!1},createFolder:{enabled:!1}},search:{enabled:!0}},s=document.createElement("iframe");s.style.width="100%",s.style.height="100%",s.style.background="#F5F5F5",s.style.border="none",s.title="SharePoint File Picker",s.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"),d.current=s,e.innerHTML="",e.appendChild(s),j.current=y,window.addEventListener("message",y),s.src="about:blank",s.onload=()=>{const e=s.contentWindow;if(!e)return;const t=new URLSearchParams({filePicker:JSON.stringify(n),locale:o||"en-US"}),a=f+`/_layouts/15/FilePicker.aspx?${t}`,r=e.document.createElement("form");r.setAttribute("action",a),r.setAttribute("method","POST");const i=e.document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","access_token"),i.setAttribute("value",g.access_token),r.appendChild(i),e.document.body.appendChild(r),r.submit()}}catch(t){console.error("SharePoint file picker error:",t),l({message:"Failed to open SharePoint file picker.",status:"error"})}else console.error("No container ref provided for SharePoint picker");else l({message:"Unable to access SharePoint. Please ensure you are logged in with Microsoft.",status:"error"})}:()=>{},closeSharePointPicker:N,error:v?"Failed to authenticate with SharePoint":null,cleanup:w,isTokenLoading:x}}({containerNode:c,onFilesSelected:a,disabled:r,onClose:()=>h(!1),maxSelectionCount:l}),h=e=>{e||p(),t(e)},g=S.useCallback((e=>{d(e)}),[]);return n.useEffect((()=>(c&&e&&m(),()=>{e||f()})),[c,e]),s.jsx(ul,{open:e,onOpenChange:h,children:s.jsxs(pl,{children:[s.jsx(hl,{className:"bg-black/50"}),s.jsxs(gl,{className:"sharepoint-picker-bg fixed left-1/2 top-1/2 z-50 h-[680px] max-h-[90vh] max-w-[90vw] -translate-x-1/2 -translate-y-1/2 rounded-lg border bg-surface-primary p-2 shadow-lg focus:outline-none",showCloseButton:!0,children:[s.jsx(bl,{className:"sr-only",children:u("com_files_sharepoint_picker_title")}),s.jsx("div",{ref:g,className:"sharepoint-picker-bg relative flex p-2",children:o&&s.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-lg bg-black/30 backdrop-blur-sm",children:s.jsx("div",{className:"mx-4 w-full max-w-sm rounded-lg bg-surface-primary p-6 shadow-lg",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),s.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:u("com_files_downloading")}),i&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-sm text-text-secondary",children:u("com_files_download_progress",{0:i.completed,1:i.total})}),i.currentFile&&s.jsx("p",{className:"truncate text-xs text-text-tertiary",children:i.currentFile}),s.jsx("div",{className:"h-2 w-full rounded-full bg-surface-tertiary",children:s.jsx("div",{className:"h-2 rounded-full bg-blue-600 transition-all duration-300",style:{width:`${Math.round(i.completed/i.total*100)}%`}})}),s.jsx("p",{className:"text-xs text-text-tertiary",children:u("com_files_download_percent_complete",{0:Math.round(i.completed/i.total*100)})}),i.failed.length>0&&s.jsx("p",{className:"text-xs text-red-500",children:u("com_files_download_failed",{0:i.failed.length})})]}),!i&&s.jsx("p",{className:"text-sm text-text-secondary",children:u("com_files_preparing_download")})]})})})})]})]})})}const VI=n.memo((({size:e,user:t,avatarSrc:a,username:r,className:o})=>{const[i,l]=n.useState(!1);return s.jsx("div",{title:r,style:{width:e,height:e},className:n_("relative flex items-center justify-center",o??""),children:((null==t?void 0:t.avatar)||(null==t?void 0:t.username)&&""!==(null==t?void 0:t.username.trim()))&&!i?s.jsx("img",{className:"rounded-full",src:((null==t?void 0:t.avatar)??"")||a,alt:"avatar",onError:()=>{l(!0)}}):s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:s.jsx(Dc,{})})})}));VI.displayName="UserAvatar";const BI=n.memo((e=>{const{user:t}=Kk(),{size:n=30,isCreatedByUser:a}=e,r=$i(t),o=Fk();if(a){const a=(null==t?void 0:t.name)??(null==t?void 0:t.username)??o("com_nav_user");return s.jsx(VI,{size:n,user:t,avatarSrc:r,username:a,className:e.className})}return s.jsx(pI,{...e})}));BI.displayName="Icon";const $I=e=>{const{size:t=30,iconURL:n="",iconClassName:a,error:r}=e;let o="default";"string"==typeof e.endpoint&&(o=e.endpoint);const i={[Uu.azureOpenAI]:{icon:s.jsx(Ec,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Uu.openAI]:{icon:s.jsx(Tc,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Uu.gptPlugins]:{icon:s.jsx(Sc,{}),name:"Plugins"},[Uu.google]:{icon:s.jsx(Ac,{}),name:e.modelLabel??"Google"},[Uu.anthropic]:{icon:s.jsx(yc,{className:"icon-md shrink-0 dark:text-white"}),name:e.modelLabel??"Claude"},[Uu.custom]:{icon:s.jsx(lc,{}),name:"Custom"},[Uu.chatGPTBrowser]:{icon:s.jsx(cc,{}),name:"ChatGPT"},[Uu.assistants]:{icon:s.jsx(Vc,{className:"icon-sm"}),name:"Assistant"},[Uu.azureAssistants]:{icon:s.jsx(Vc,{className:"icon-sm"}),name:"Assistant"},[Uu.agents]:{icon:s.jsx(lt,{className:"icon-sm"}),name:e.modelLabel??uh[Uu.agents]},[Uu.bedrock]:{icon:s.jsx(Gc,{className:"icon-xl text-text-primary"}),name:e.modelLabel??uh[Uu.bedrock]},default:{icon:s.jsx(NT,{iconURL:n,endpoint:o,className:"icon-sm",context:"nav"}),name:o}};let{icon:l,name:c}=i[o]??i.default;return n&&null!=i[n]&&({icon:l,name:c}=i[n]),s.jsxs("div",{"data-testid":"convo-icon",title:c,"aria-hidden":"true",style:{width:t,height:t},className:n_("relative flex items-center justify-center rounded-sm text-text-secondary",e.className??""),children:[l,!0===r&&s.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-4 w-4 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-text-secondary",children:"!"})]})};function HI({conversation:e,endpointsConfig:t,assistantMap:a,agentsMap:r,className:o="",containerClassName:i="",context:l,size:c}){var d,u;const m=(null==e?void 0:e.iconURL)??"";let p=null==e?void 0:e.endpoint;p=Ab({endpointsConfig:t,iconURL:m,endpoint:p});const{entity:f,isAgent:h}=n.useMemo((()=>Lb({endpoint:p,agentsMap:r,assistantMap:a,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id})),[p,null==e?void 0:e.agent_id,null==e?void 0:e.assistant_id,r,a]),g=(null==f?void 0:f.name)??"",x=h?null==(d=null==f?void 0:f.avatar)?void 0:d.filepath:null==(u=null==f?void 0:f.metadata)?void 0:u.avatar,v=kb(t,p,"iconURL"),b=Mb({endpoint:p,endpointsConfig:t,endpointIconURL:v}),_=kT[b]??null;return s.jsx(s.Fragment,{children:m&&m.includes("http")?s.jsx(vI,{iconURL:m,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",endpointIconURL:v,assistantAvatar:x,assistantName:g,agentAvatar:x,agentName:g,context:l}):s.jsx("div",{className:i,children:p&&null!=_&&s.jsx(_,{size:c,context:l,endpoint:p,className:o,iconURL:v,assistantName:g,agentName:g,avatar:x})})})}function GI({conversation:e,endpointsConfig:t,className:n="mr-0",assistantMap:a,context:r}){var o,i;const l=(null==e?void 0:e.iconURL)??"";let c=null==e?void 0:e.endpoint;c=Ab({endpointsConfig:t,iconURL:l,endpoint:c});const d=kb(t,c,"type"),u=kb(t,c,"iconURL"),m=Yu(c)?null==(o=null==a?void 0:a[c])?void 0:o[(null==e?void 0:e.assistant_id)??""]:null,p=m&&(null==(i=m.metadata)?void 0:i.avatar)||"",f=m&&(m.name??""),h=p||l;return h&&(h.includes("http")||h.startsWith("/images/"))?s.jsx(vI,{iconURL:h,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",context:r,endpointIconURL:u,assistantAvatar:p,assistantName:f??""}):s.jsx($I,{size:20,iconURL:u,endpoint:c,endpointType:d,model:null==e?void 0:e.model,error:!1,className:n,isCreatedByUser:!1,chatGptLabel:void 0,modelLabel:void 0})}const KI={max:"com_endpoint_openai_max",temp:"com_endpoint_openai_temp",topp:"com_endpoint_openai_topp",freq:"com_endpoint_openai_freq",pres:"com_endpoint_openai_pres",resend:"com_endpoint_openai_resend_files",detail:"com_endpoint_openai_detail"},WI={anthropic:{temp:"com_endpoint_anthropic_temp",topp:"com_endpoint_anthropic_topp",topk:"com_endpoint_anthropic_topk",maxoutputtokens:"com_endpoint_anthropic_maxoutputtokens",resend:KI.resend,promptcache:"com_endpoint_anthropic_prompt_cache"},google:{temp:"com_endpoint_google_temp",topp:"com_endpoint_google_topp",topk:"com_endpoint_google_topk",maxoutputtokens:"com_endpoint_google_maxoutputtokens"},openAI:KI,azureOpenAI:KI,gptPlugins:{func:"com_endpoint_func_hover",skip:"com_endpoint_skip_hover",...KI}};function qI({endpoint:e,type:t,side:n}){var a;const r=Fk(),o=null==(a=WI[e])?void 0:a[t];return o?s.jsx(ol,{children:s.jsx(il,{side:n,className:"z-[999] w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r(o)})})})}):null}function QI({conversation:e,setOption:t,models:a,readonly:r}){const o=Fk(),i=n.useMemo((()=>({label:o("com_endpoint_use_active_assistant"),value:""})),[o]),l=Mk((e=>su(e.data))),{model:c,endpoint:d,assistant_id:u,endpointType:m,promptPrefix:p,instructions:f}=e??{},h=n.useMemo((()=>Object.values(l[d??""]??{})),[l,d]),g=n.useMemo((()=>{const e=h.map((({id:e,name:t})=>({label:t,value:e})));return[i,...e].filter(Boolean)}),[h,i]),[v,b]=oE({setOption:t,optionKey:"promptPrefix",initialValue:p}),[_,y]=oE({setOption:t,optionKey:"instructions",initialValue:f}),j=n.useMemo((()=>{var e;return null!=u&&u?null==(e=l[d??""])?void 0:e[u]:null}),[u,l,d]),w=n.useMemo((()=>a.map((e=>({label:e===(null==j?void 0:j.model)?`${e} (${o("com_endpoint_assistant_model")})`:e,value:e})))),[a,j,o]),[N,C]=n.useState(null!=j?{label:j.name??"",value:j.id}:i);if(n.useEffect((()=>{""===N.value&&t("presetOverride")({assistant_id:N.value})}),[N]),!e)return null;const k=t("model"),S=m??d;return s.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[s.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Dd,{value:c??"",title:o("com_ui_model"),setValue:Wv(k),availableValues:w,disabled:r,className:n_(f_,"flex w-full resize-none",m_),containerClassName:"flex w-full resize-none"})})}),s.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-3",children:s.jsxs(al,{openDelay:300,children:[s.jsx(rl,{className:"grid w-full items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Dd,{title:o("com_endpoint_assistant"),value:N,setValue:Wv((e=>{var n;if(!e)return void C(i);const s=null==(n=l[d??""])?void 0:n[e];s?(C({label:s.name??"",value:s.id||""}),t("assistant_id")(s.id),s.model&&k(s.model)):C(i)})),availableValues:g,disabled:r,className:n_(f_,"flex w-full resize-none",m_),containerClassName:"flex w-full resize-none"})})}),s.jsx(qI,{endpoint:S??"",type:"temp",side:Jd.Left})]})}),s.jsxs("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6",children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[o("com_endpoint_prompt_prefix_assistants")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"promptPrefix",disabled:r,value:b??"",onChange:v,placeholder:o("com_endpoint_prompt_prefix_assistants_placeholder"),className:n_(f_,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"instructions",className:"text-left text-sm font-medium",children:[o("com_endpoint_instructions_assistants")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"instructions",disabled:r,value:y??"",onChange:_,placeholder:o("com_endpoint_instructions_assistants_placeholder"),className:n_(f_,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]})]})]})}function YI({side:e,description:t,disabled:n,langCode:a,sideOffset:r=30,className:o}){const i=Fk();if(n)return null;const l=a?i(t):t;return s.jsx(ol,{children:s.jsx(il,{side:e,className:`z-[999] w-80 ${o}`,sideOffset:r,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"whitespace-pre-wrap text-sm text-text-secondary",children:l})})})})}const XI={[Jh.Slider]:function({label:e="",settingKey:t,defaultValue:a,range:r,description:o="",columnSpan:i,setOption:l,optionType:c,options:d,enumMappings:u,readonly:m=!1,showDefault:p=!1,includeInput:f=!0,labelCode:h=!1,descriptionCode:g=!1,conversation:x}){const v=Fk(),{preset:b}=Pk(),_=n.useMemo((()=>(!r&&d&&d.length>0)??!1),[d,r]),[y,j,w]=oE({optionKey:t,initialValue:c!==tg.Custom?null==x?void 0:x[t]:a,setter:()=>({}),setOption:l,delay:_?0:Zd});cE({preset:b,settingKey:t,defaultValue:a,conversation:x,inputValue:j,setInputValue:w});const N=n.useMemo((()=>_?(null==x?void 0:x[t])??a:j),[x,a,t,j,_]),C=n.useMemo((()=>_&&d?d.reduce(((e,t,n)=>(e[t]=n,e)),{}):{}),[_,d]),k=n.useMemo((()=>_&&d?d.reduce(((e,t,n)=>(e[n]=t,e)),{}):{}),[_,d]),S=n.useCallback((e=>{if(_&&u&&null!=e){const t=String(e);if(t in u){const e=String(u[t]);return e.startsWith("com_")?v(e)??e:e}}return String(null!=e?e:a??"")}),[_,u,a,v]),E=n.useCallback((()=>{if(null!=a&&u){const e=String(a);if(e in u){const t=String(u[e]);return t.startsWith("com_")?v(t)??t:t}}return String(a??"")}),[a,u,v]),T=n.useCallback((e=>{y(_?k[e]:e)}),[_,y,k]),I=n.useMemo((()=>_&&d?d.length-1:r?r.max:0),[_,d,r]);return r||_?s.jsx("div",{className:n_("flex flex-col items-center justify-start gap-2",null!=i?`col-span-${i}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsxs(dl,{htmlFor:`${t}-dynamic-setting`,className:"break-words text-left text-sm font-medium",children:[h?v(e)??e:e||t," ",p&&s.jsxs("small",{className:"opacity-40",children:["(",v("com_endpoint_default"),": ",E(),")"]})]}),f&&!_?s.jsx(cl,{id:`${t}-dynamic-setting-input-number`,disabled:m,value:j??a,onChange:e=>y(Number(e)),max:r?r.max:((null==d?void 0:d.length)??0)-1,min:r?r.min:0,step:r?r.step??1:1,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 py-1 text-xs group-hover/temp:border-gray-200"))}):s.jsx(ll,{id:`${t}-dynamic-setting-input`,disabled:m,value:S(N),onChange:()=>({}),className:n_(f_,n_(h_,"reset-rc-number-input h-auto w-14 border-0 py-1 pl-1 text-center text-xs group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{id:`${t}-dynamic-setting-slider`,disabled:m,value:[_?C[N??""]:j??a],onValueChange:e=>T(e[0]),onDoubleClick:()=>y(a),max:I,min:r?r.min:0,step:r?r.step??1:1,className:"flex h-4 w-full"})]}),o&&s.jsx(YI,{description:g?v(o)??o:o,side:Jd.Left})]})}):null},[Jh.Dropdown]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,optionType:l,options:c,readonly:d=!1,showLabel:u=!0,showDefault:m=!1,labelCode:p=!1,descriptionCode:f=!1,placeholder:h="",placeholderCode:g=!1,conversation:x}){const v=Fk(),{preset:b}=Pk(),[_,y]=n.useState(null),j=n.useMemo((()=>l===tg.Custom?_:(null==x?void 0:x[t])??a),[x,a,l,t,_]);return cE({preset:b,settingKey:t,defaultValue:a,conversation:x,inputValue:_,setInputValue:y,preventDelayedUpdate:!0}),c&&0!==c.length?s.jsx("div",{className:n_("flex flex-col items-center justify-start gap-6",null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[!0===u&&s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-dropdown`,className:"text-left text-sm font-medium",children:[p?v(e)??e:e||t,m&&s.jsxs("small",{className:"opacity-40",children:["(",v("com_endpoint_default"),": ",a,")"]})]})}),s.jsx(Dd,{showLabel:!1,emptyTitle:!0,disabled:d,value:j,setValue:e=>{l!==tg.Custom?i(t)(e):y(e)},availableValues:c,containerClassName:"w-full",id:`${t}-dynamic-dropdown`,placeholder:g?v(h)??h:h})]}),r&&s.jsx(YI,{description:f?v(r)??r:r,side:Jd.Left})]})}):null},[Jh.Switch]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,readonly:l=!1,showDefault:c=!1,labelCode:d=!1,descriptionCode:u=!1,conversation:m}){const p=Fk(),{preset:f}=Pk(),[h,g]=n.useState(!!a);cE({preset:f,settingKey:t,defaultValue:a,conversation:m,inputValue:h,setInputValue:g,preventDelayedUpdate:!0});const x=(null==m?void 0:m[t])??a;return s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-switch`,className:"break-words text-left text-sm font-medium",children:[d?p(e)??e:e||t," ",c&&s.jsxs("small",{className:"opacity-40",children:["(",p("com_endpoint_default"),":"," ",null!=a?"com_ui_on":"com_ui_off",")"]})]})}),s.jsx(Cl,{id:`${t}-dynamic-switch`,checked:x,onCheckedChange:e=>{g(e),i(t)(e)},disabled:l,className:"flex"})]}),r&&s.jsx(YI,{description:u?p(r)??r:r,side:Jd.Left})]})})},[Jh.Textarea]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:r,setOption:o,optionType:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:f}){const h=Fk(),{preset:g}=Pk(),[x,v,b]=oE({optionKey:t,initialValue:i!==tg.Custom?null==f?void 0:f[t]:n,setter:()=>({}),setOption:o});return cE({preset:g,settingKey:t,defaultValue:void 0===n?"":n,conversation:f,inputValue:v,setInputValue:b}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-textarea`,className:"text-left text-sm font-medium",children:[u?h(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${h("com_endpoint_default")}: ${n}`:h("com_endpoint_default_blank"),")"]})]})}),s.jsx(Ml,{id:`${t}-dynamic-textarea`,disabled:c,value:v??"",onChange:x,placeholder:p?h(l)??l:l,className:n_("flex max-h-[138px] min-h-[100px] w-full resize-none rounded-lg bg-surface-secondary px-3 py-2 focus:outline-none")})]}),a&&s.jsx(YI,{description:m?h(a)??a:a,side:Jd.Left})]})})},[Jh.Input]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:r,setOption:o,optionType:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:f}){const h=Fk(),{preset:g}=Pk(),[x,v,b]=oE({optionKey:t,initialValue:i!==tg.Custom?null==f?void 0:f[t]:n,setter:()=>({}),setOption:o});cE({preset:g,settingKey:t,defaultValue:void 0===n?"":n,conversation:f,inputValue:v,setInputValue:b});const _=p&&h(l)||l;return s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?h(e)||e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${h("com_endpoint_default")}: ${n}`:h("com_endpoint_default_blank"),")"]})]})}),s.jsx(ll,{id:`${t}-dynamic-input`,disabled:c,value:v??n??"",onChange:e=>{x(e,!isNaN(Number(e.target.value)))},placeholder:_,className:n_("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2")})]}),a&&s.jsx(YI,{description:m&&h(a)||a,side:Jd.Left})]})})},[Jh.Checkbox]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,optionType:l,readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,conversation:p}){const f=Fk(),{preset:h}=Pk(),[g,x,v]=oE({optionKey:t,initialValue:l!==tg.Custom?null==p?void 0:p[t]:a,setter:()=>({}),setOption:i}),b=n.useMemo((()=>(null==p?void 0:p[t])??a),[p,a,t]);return cE({preset:h,settingKey:t,defaultValue:a,conversation:p,inputValue:x,setInputValue:v}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsx(rl,{className:"grid w-full items-center",children:s.jsxs("div",{className:"flex justify-start gap-4",children:[s.jsxs(dl,{htmlFor:`${t}-dynamic-checkbox`,className:"text-left text-sm font-medium",children:[u?f(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",f("com_endpoint_default"),":"," ",f(null!=a?"com_ui_yes":"com_ui_no"),")"]})]}),s.jsx(Si,{id:`${t}-dynamic-checkbox`,disabled:c,checked:b,onCheckedChange:e=>{g(e),i(t)(e)},className:"mt-[2px] focus:ring-opacity-20 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:focus:ring-gray-600 dark:focus:ring-opacity-50 dark:focus:ring-offset-0"})]})}),r&&s.jsx(YI,{description:m?f(r)??r:r,side:Jd.Left})]})})},[Jh.Tags]:function({label:e="",settingKey:t,defaultValue:a=[],description:r="",columnSpan:o,setOption:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,descriptionSide:f=Jd.Left,conversation:h,minTags:g,maxTags:x}){const v=Fk(),{preset:b}=Pk(),{showToast:_}=Bd(),y=n.useRef(null),[j,w]=n.useState(""),[N,C]=n.useState(a??[]),k=n.useCallback((e=>{C(e),i(t)(e)}),[i,t]),S=n.useCallback((()=>{y.current&&y.current.focus()}),[y]),E=null==h?void 0:h[t],T=n.useMemo((()=>E??a??[]),[E,a]),I=n.useCallback((e=>{if(!T)return;if(null!=g&&T.length<=g)return void _({message:v("com_ui_min_tags",{0:g+""}),status:"warning"});const t=T.filter(((t,n)=>n!==e));k(t)}),[v,g,T,_,k]),R=n.useCallback((()=>{if(!j)return;let e=[...T??[],j];null!=x&&e.length>x&&(_({message:v("com_ui_max_tags",{0:x+""}),status:"warning"}),e=e.slice(-x)),k(e),w("")}),[j,T,k,x,_,v]);return cE({preset:b,settingKey:t,defaultValue:void 0===a?[]:a,inputValue:N,setInputValue:C,preventDelayedUpdate:!0,conversation:h}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?v(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==a&&a.length?`${v("com_endpoint_default")}: ${a}`:v("com_endpoint_default_blank"),")"]})]})}),s.jsx("div",{children:s.jsxs("div",{className:"mb-2 flex flex-wrap break-all rounded-lg bg-surface-secondary",children:[T&&T.length>0&&s.jsx("div",{className:"flex w-full gap-1 p-1",children:T.map(((e,t)=>s.jsx(Al,{label:e,onClick:S,onRemove:()=>{I(t),y.current&&y.current.focus()}},`${e}-${t}`)))}),s.jsx(ll,{ref:y,id:`${t}-dynamic-input`,disabled:c,value:j,onKeyDown:e=>{T&&("Backspace"!==e.key||j||I(T.length-1),"Enter"===e.key&&R())},onChange:e=>w(e.target.value),placeholder:p?v(l)??l:l,className:n_("flex h-10 max-h-10 border-none bg-surface-secondary px-3 py-2")})]})})]}),r&&s.jsx(YI,{description:m?v(r)??r:r,side:f})]})})},[Jh.Combobox]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,options:l,items:c,showLabel:d=!0,showDefault:u=!1,labelCode:m=!1,descriptionCode:p=!1,searchPlaceholderCode:f=!1,selectPlaceholderCode:h=!1,conversation:g,isCollapsed:x=!1,SelectIcon:v=null,selectPlaceholder:b="",searchPlaceholder:_=""}){const y=Fk(),{preset:j}=Pk(),[w,N]=n.useState(null),C=n.useMemo((()=>(null==g?void 0:g[t])??a),[g,a,t]),k=n.useMemo((()=>null!=c?c:(l??[]).map((e=>({label:e,value:e})))),[l,c]),S=n.useCallback((e=>{N(e),i(t)(e)}),[i,t]);return cE({preset:j,settingKey:t,defaultValue:a,conversation:g,inputValue:w,setInputValue:N,preventDelayedUpdate:!0}),0===(k??l??[]).length?null:s.jsx("div",{className:n_("flex flex-col items-center justify-start gap-6",null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[!0===d&&s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(dl,{htmlFor:`${t}-dynamic-combobox`,className:"text-left text-sm font-medium",children:[m?y(e)??e:e||t,u&&s.jsxs("small",{className:"opacity-40",children:["(",y("com_endpoint_default"),": ",a,")"]})]})}),s.jsx(Fd,{displayValue:C,selectPlaceholder:!0===h?y(b):b,searchPlaceholder:!0===f?y(_):_,isCollapsed:x,ariaLabel:t,selectedValue:C??"",setValue:S,items:k,SelectIcon:v})]}),r&&s.jsx(YI,{description:p?y(r)??r:r,side:Jd.Left})]})})}};function ZI({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Qu((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Ev[t]??Ev[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=XI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})}function JI({conversation:e,setOption:t,models:n,readonly:a}){const r=Fk(),o=mm[Uu.google],{model:i,modelLabel:l,promptPrefix:c,temperature:d,topP:u,topK:m,maxContextTokens:p,maxOutputTokens:f}=e??{},[h,g]=oE({setOption:t,optionKey:"maxContextTokens",initialValue:p});if(!e)return null;const v=t("model"),b=t("modelLabel"),_=t("promptPrefix"),y=t("temperature"),j=t("topP"),w=t("topK"),N=t("maxOutputTokens");return s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Dd,{title:r("com_ui_model"),value:i??"",setValue:v,availableValues:n,disabled:a,className:n_(f_,"flex w-full resize-none",m_),containerClassName:"flex w-full resize-none"})}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"modelLabel",className:"text-left text-sm font-medium",children:[r("com_endpoint_custom_name")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),s.jsx(ll,{id:"modelLabel",disabled:a,value:l||"",onChange:e=>b(e.target.value??null),placeholder:r("com_endpoint_google_custom_name_placeholder"),className:n_(f_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",u_)})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[r("com_endpoint_prompt_prefix")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"promptPrefix",disabled:a,value:c||"",onChange:e=>_(e.target.value??null),placeholder:r("com_endpoint_prompt_prefix_placeholder"),className:n_(f_,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2")})]})]}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsxs(al,{openDelay:300,children:[s.jsx(rl,{className:"grid w-full items-center gap-2",children:s.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[s.jsxs(dl,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[r("com_endpoint_context_tokens")," "]}),s.jsx(cl,{id:"max-context-tokens",stringMode:!1,disabled:a,value:g,onChange:h,placeholder:r("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),s.jsx(YI,{description:"com_endpoint_context_info",langCode:!0,side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default"),": ",o.temperature.default,")"]})]}),s.jsx(cl,{id:"temp-int",disabled:a,value:d,onChange:e=>y(e??o.temperature.default),max:o.temperature.max,min:o.temperature.min,step:o.temperature.step,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:a,value:[d??o.temperature.default],onValueChange:e=>y(e[0]),onDoubleClick:()=>y(o.temperature.default),max:o.temperature.max,min:o.temperature.min,step:o.temperature.step,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"temp",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_top_p")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.topP.default+""}),")"]})]}),s.jsx(cl,{id:"top-p-int",disabled:a,value:u,onChange:e=>j(e??o.topP.default),max:o.topP.max,min:o.topP.min,step:o.topP.step,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:a,value:[u??o.topP.default],onValueChange:e=>j(e[0]),onDoubleClick:()=>j(o.topP.default),max:o.topP.max,min:o.topP.min,step:o.topP.step,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"topp",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"top-k-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_top_k")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.topK.default+""}),")"]})]}),s.jsx(cl,{id:"top-k-int",disabled:a,value:m,onChange:e=>w(e??o.topK.default),max:o.topK.max,min:o.topK.min,step:o.topK.step,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:a,value:[m??o.topK.default],onValueChange:e=>w(e[0]),onDoubleClick:()=>w(o.topK.default),max:o.topK.max,min:o.topK.min,step:o.topK.step,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"topk",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"max-tokens-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_max_output_tokens")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.maxOutputTokens.default+""}),")"]})]}),s.jsx(cl,{id:"max-tokens-int",disabled:a,value:f,onChange:e=>N(Number(e)),max:o.maxOutputTokens.max,min:o.maxOutputTokens.min,step:o.maxOutputTokens.step,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:a,value:[f??o.maxOutputTokens.default],onValueChange:e=>N(e[0]),onDoubleClick:()=>N(o.maxOutputTokens.default),max:o.maxOutputTokens.max,min:o.maxOutputTokens.min,step:o.maxOutputTokens.step,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"maxoutputtokens",side:Jd.Left})]})]})]})}function eR({title:e="Plugins",value:t,disabled:a,setSelected:r,availableValues:o,showAbove:i=!1,showLabel:l=!0,containerClassName:c,optionsClassName:d="",labelClassName:u="",isSelected:m,className:p,searchPlaceholder:f,optionValueKey:h="value"}){const[g,x]=n.useState(!1),v=n.useRef(null),b=["select-plugin","plugins-label","selected-plugins"];Wi(v,(()=>x(!1)),b);const[_,y]=Hl({availableOptions:o,placeholder:f,getTextKeyOverride:e=>(e.name||"").toUpperCase()}),j=Boolean(y)?_:o,w={className:"top-full mt-3"};i&&(w.className="bottom-full mb-3");const N={open:g};return s.jsx("div",{className:n_("flex items-center justify-center gap-2",c??""),children:s.jsx("div",{className:"relative w-full",children:s.jsx(Gr,{value:t,onChange:e=>{r(e),x(!0)},disabled:a,children:()=>s.jsxs(s.Fragment,{children:[s.jsxs(Kr,{className:n_("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus:outline-none focus:ring-0 focus:ring-offset-0 dark:border-gray-600 dark:border-white/20 dark:bg-gray-800 sm:text-sm",p??""),id:b[0],onClick:()=>x((e=>!e)),...N,children:[" ",l&&s.jsx(Wr,{className:n_("block text-xs text-gray-700 dark:text-gray-500",u),id:b[1],"data-headlessui-state":"",children:e}),s.jsx("span",{className:"inline-flex w-full truncate",id:b[2],children:s.jsxs("span",{className:n_("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",l?"":"text-xs"),children:[!l&&e.length>0&&s.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[e,":"]}),s.jsx("span",{className:"flex h-6 items-center gap-1 truncate",children:s.jsx("div",{className:"flex gap-1",children:t.map(((e,t)=>s.jsxs("div",{className:"relative",style:{width:"16px",height:"16px"},children:[e.icon?s.jsx("img",{src:e.icon,alt:`${e} logo`,className:"h-full w-full rounded-sm bg-white"}):s.jsx(yt,{className:"h-full w-full rounded-sm bg-white"}),s.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]},t)))})})]})}),s.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:i?{transform:"scaleY(-1)"}:{},children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),s.jsx(qr,{show:g,as:S.Fragment,leave:"transition ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",...w,children:s.jsxs(Qr,{ref:v,className:n_("absolute z-50 mt-2 max-h-60 w-full overflow-auto rounded bg-white text-base text-xs ring-1 ring-black/10 focus:outline-none dark:bg-gray-800 dark:ring-white/20 dark:last:border-0 md:w-[100%]",d),children:[y,j.map(((e,t)=>{if(!e)return null;const n=m(e[h]);return s.jsx(Yr,{value:e[h],className:"group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden border-b border-black/10 pl-3 pr-9 text-gray-800 last:border-0 hover:bg-gray-20 dark:border-white/20 dark:text-white dark:hover:bg-gray-700",children:s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[!e.isButton&&s.jsx("span",{className:"h-6 w-6 shrink-0",children:s.jsxs("div",{className:"relative",style:{width:"100%",height:"100%"},children:[e.icon?s.jsx("img",{src:e.icon,alt:`${e.name} logo`,className:"h-full w-full rounded-sm bg-white"}):s.jsx(yt,{className:"h-full w-full rounded-sm bg-white"}),s.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]})}),s.jsx("span",{className:n_("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",n?"font-semibold":""),children:e.name}),e.isButton&&s.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:s.jsx(Nt,{})}),n&&!e.isButton&&s.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:s.jsx(oc,{})})]})},t)}))]})})]})})})})}function tR({conversation:e,setOption:t,setTools:a,checkPluginSelection:r,models:o,readonly:i}){const l=Fk(),c=Ae(Ny.availableTools),{data:d}=vk({select:ru}),u=n.useMemo((()=>(null==e?void 0:e.tools)?ou(e.tools,null==d?void 0:d.map):[]),[e,d]),m=n.useMemo((()=>c?Object.values(c):[]),[c]),{model:p,modelLabel:f,chatGptLabel:h,promptPrefix:g,temperature:v,top_p:b,frequency_penalty:_,presence_penalty:y,maxContextTokens:j}=e??{},[w,N]=oE({setOption:t,optionKey:"chatGptLabel",initialValue:f??h}),[C,k]=oE({setOption:t,optionKey:"promptPrefix",initialValue:g}),[S,E]=oE({setOption:t,optionKey:"temperature",initialValue:v}),[T,I]=oE({setOption:t,optionKey:"top_p",initialValue:b}),[R,P]=oE({setOption:t,optionKey:"frequency_penalty",initialValue:_}),[A,M]=oE({setOption:t,optionKey:"presence_penalty",initialValue:y}),[L,O]=oE({setOption:t,optionKey:"maxContextTokens",initialValue:j}),D=t("model");return e?s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Dd,{title:l("com_endpoint_completion_model"),value:p??"",setValue:D,availableValues:o,disabled:i,className:n_(f_,"flex w-full resize-none",m_),containerClassName:"flex w-full resize-none"})}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"chatGptLabel",className:"text-left text-sm font-medium",children:[l("com_endpoint_custom_name")," ",s.jsx("small",{className:"opacity-40",children:l("com_endpoint_default_empty")})]}),s.jsx(ll,{id:"chatGptLabel",disabled:i,value:N||"",onChange:e=>w(e.target.value??null),placeholder:l("com_endpoint_openai_custom_name_placeholder"),className:n_(f_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",u_)})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[l("com_endpoint_prompt_prefix")," ",s.jsx("small",{className:"opacity-40",children:l("com_endpoint_default_empty")})]}),s.jsx(x,{id:"promptPrefix",disabled:i,value:k||"",onChange:e=>C(e.target.value??null),placeholder:l("com_endpoint_plug_set_custom_instructions_for_gpt_placeholder"),className:n_(f_,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2")})]})]})]}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsx(eR,{showAbove:!1,showLabel:!1,setSelected:a,value:u,optionValueKey:"pluginKey",availableValues:m,isSelected:r,searchPlaceholder:l("com_ui_select_search_plugin"),className:n_(f_,"flex w-full resize-none",u_),optionsClassName:"w-full max-h-[275px] dark:bg-gray-700 z-10 border dark:border-gray-600",containerClassName:"flex w-full resize-none border border-transparent",labelClassName:"dark:text-white"}),s.jsxs(al,{openDelay:300,children:[s.jsx(rl,{className:"grid w-full items-center gap-2",children:s.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[s.jsxs(dl,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[l("com_endpoint_context_tokens")," "]}),s.jsx(cl,{id:"max-context-tokens",stringMode:!1,disabled:i,value:O,onChange:L,placeholder:l("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),s.jsx(YI,{description:"com_endpoint_context_info",langCode:!0,side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0.8"}),")"]})]}),s.jsx(cl,{id:"temp-int",disabled:i,value:E,onChange:e=>S(Number(e)),max:2,min:0,step:.01,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:i,value:[E??.8],onValueChange:e=>S(e[0]),onDoubleClick:()=>S(.8),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"temp",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_top_p")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"1"}),")"]})]}),s.jsx(cl,{id:"top-p-int",disabled:i,value:I,onChange:e=>T(Number(e)),max:1,min:0,step:.01,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:i,value:[I??1],onValueChange:e=>T(e[0]),onDoubleClick:()=>T(1),max:1,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"topp",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"freq-penalty-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_frequency_penalty")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0"}),")"]})]}),s.jsx(cl,{id:"freq-penalty-int",disabled:i,value:P,onChange:e=>R(Number(e)),max:2,min:-2,step:.01,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:i,value:[P??0],onValueChange:e=>R(e[0]),onDoubleClick:()=>R(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"freq",side:Jd.Left})]}),s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"pres-penalty-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_presence_penalty")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0"}),")"]})]}),s.jsx(cl,{id:"pres-penalty-int",disabled:i,value:M,onChange:e=>A(Number(e)),max:2,min:-2,step:.01,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:i,value:[M??0],onValueChange:e=>A(e[0]),onDoubleClick:()=>A(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"pres",side:Jd.Left})]})]})]}):null}function nR({readonly:e,examples:t,setExample:n,addExample:a,removeExample:r}){const o=Fk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"examples-grid",className:"grid gap-6 sm:grid-cols-2",children:t.map(((a,r)=>s.jsxs(S.Fragment,{children:[s.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:`input-${r}`,className:"text-left text-sm font-medium",children:[o("com_ui_input")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:`input-${r}`,disabled:e,value:a.input.content||"",onChange:e=>n(r,"input",e.target.value??null),placeholder:"Set example input. Example is ignored if empty.",className:n_(f_,"flex max-h-[138px] min-h-[75px] w-full resize-none px-3 py-2")})]})}),s.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(dl,{htmlFor:`output-${r}`,className:"text-left text-sm font-medium",children:[o("com_endpoint_output")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:`output-${r}`,disabled:e,value:a.output.content||"",onChange:e=>n(r,"output",e.target.value??null),placeholder:"Set example output. Example is ignored if empty.",className:n_(f_,"flex max-h-[300px] min-h-[75px] w-full resize-none px-3 py-2")})]})})]},r)))}),s.jsxs("div",{className:"flex justify-center",children:[s.jsx(ki,{type:"button",className:"mr-2 mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:r,children:s.jsx(Ct,{className:"w-[16px]"})}),s.jsx(ki,{type:"button",className:"mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:a,children:s.jsx(kt,{className:"w-[16px]"})})]})]})}function sR({conversation:e,setOption:t,models:n,readonly:a}){const r=Fk();if(!e)return null;const{agent:o,skipCompletion:i,model:l,temperature:c}=e.agentOptions??{},d=t("model"),u=t("temperature"),m=t("agent"),p=t("skipCompletion");return s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsx("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Dd,{title:r("com_endpoint_agent_model"),value:l??"",setValue:d,availableValues:n,disabled:a,className:n_(f_,"flex w-full resize-none",m_),containerClassName:"flex w-full resize-none"})})}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsxs(al,{openDelay:300,children:[s.jsxs(rl,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(dl,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default"),": 0)"]})]}),s.jsx(cl,{id:"temp-int",disabled:a,value:c,onChange:e=>u(Number(e)),max:2,min:0,step:.01,controls:!1,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(yl,{disabled:a,value:[c??0],onValueChange:e=>u(e[0]),onDoubleClick:()=>u(1),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"temp",side:Jd.Left})]}),s.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-10",children:[s.jsxs(al,{openDelay:500,children:[s.jsxs(rl,{className:"flex w-[100px] flex-col items-center space-y-4 text-center",children:[s.jsx("label",{htmlFor:"functions-agent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:s.jsx("small",{children:r("com_endpoint_plug_use_functions")})}),s.jsx(Cl,{id:"functions-agent",checked:"functions"===o,onCheckedChange:e=>{m(e?"functions":"classic")},disabled:a,className:"ml-4 mt-2"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"func",side:Jd.Bottom})]}),s.jsxs(al,{openDelay:500,children:[s.jsxs(rl,{className:"ml-[-60px] flex w-[100px] flex-col items-center space-y-4 text-center",children:[s.jsx("label",{htmlFor:"skip-completion",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:s.jsx("small",{children:r("com_endpoint_plug_skip_completion")})}),s.jsx(Cl,{id:"skip-completion",checked:!0===i,onCheckedChange:e=>{p(e)},disabled:a,className:"ml-4 mt-2"})]}),s.jsx(qI,{endpoint:e.endpoint??"",type:"skip",side:Jd.Bottom})]})]})]})]})}function aR({conversation:e,models:t,isPreset:n=!1}){var a,r;const{optionSettings:o}=Pk(),{setOption:i,setExample:l,addExample:c,removeExample:d}=lE(n?e:null);if(!e)return null;const{examples:u,model:m}=e,p=null==(a=null==m?void 0:m.toLowerCase())?void 0:a.includes("gemini"),f=!p&&(null==(r=null==m?void 0:m.toLowerCase())?void 0:r.includes("chat")),h=!p&&!f&&/code|text/.test(m??""),{showExamples:g}=o;return g&&f&&!h?s.jsx(nR,{examples:u??[{input:{content:""},output:{content:""}}],setExample:l,addExample:c,removeExample:d}):s.jsx(JI,{conversation:e,setOption:i,models:t})}function rR({conversation:e,models:t,isPreset:n=!1}){const{showAgentSettings:a}=Pk(),{setOption:r,setTools:o,setAgentOption:i,checkPluginSelection:l}=lE(n?e:null);return e?a?s.jsx(sR,{conversation:e,setOption:i,models:t}):s.jsx(tR,{conversation:e,setOption:r,setTools:o,checkPluginSelection:l,models:t}):null}const oR={[Uu.assistants]:QI,[Uu.azureAssistants]:QI,[Uu.agents]:ZI,[Uu.openAI]:ZI,[Uu.custom]:ZI,[Uu.azureOpenAI]:ZI,[Uu.anthropic]:function({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Qu((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Ev[t]??Ev[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=XI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})},[Uu.bedrock]:function({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Qu((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Ev[t]??Ev[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=XI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})}};function iR({conversation:e,setOption:t,isPreset:n=!1,className:a=""}){var r;const o=mk(),{data:i}=Gy(),l=Ae(Ny.currentSettingsView),c=kb(i,(null==e?void 0:e.endpoint)??"","type")??(null==e?void 0:e.endpoint)??"";if(!c||l!==Dp.default)return null;const{settings:d,multiViewSettings:u}={settings:oR,multiViewSettings:{[Uu.google]:aR,[Uu.gptPlugins]:rR}},{endpoint:m}=e,p=(null==(r=o.data)?void 0:r[m??""])??[],f=d[c];if(f)return s.jsx("div",{className:n_("h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:s.jsx(f,{conversation:e,setOption:t,models:p,isPreset:n})});const h=u[c];return null==h?null:s.jsx("div",{className:n_("hide-scrollbar h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:s.jsx(h,{conversation:e,models:p,isPreset:n})})}const lR=({open:e,onOpenChange:t,preset:a})=>{const[r,o]=n.useState(a.title??"My Preset"),i=pk(),{showToast:l}=Bd(),c=Fk(),d=()=>{const e=o_({preset:{...a,title:r}}),n=e.title?`\`${e.title}\``:c("com_endpoint_preset_title");i.mutate(e,{onSuccess:()=>{l({message:`${n} ${c("com_ui_saved")}`}),t(!1)},onError:()=>{l({message:c("com_endpoint_preset_save_error"),severity:eu.ERROR})}})};n.useEffect((()=>{o(a.title??c("com_endpoint_my_preset"))}),[e]);return s.jsx(ul,{open:e,onOpenChange:t,children:s.jsx(zd,{title:c("com_endpoint_save_as_preset"),className:"z-[90] w-11/12 sm:w-1/4",overlayClassName:"z-[80]",showCloseButton:!1,main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"preset-custom-name",className:"text-left text-sm font-medium",children:c("com_endpoint_preset_name")}),s.jsx(ll,{id:"preset-custom-name",value:r||"",onChange:e=>o(e.target.value||""),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d())},placeholder:c("com_endpoint_preset_custom_name_placeholder"),"aria-label":c("com_endpoint_preset_name"),className:n_(f_,"flex h-10 max-h-10 w-full resize-none border-border-medium px-3 py-2",u_)})]})}),selection:{selectHandler:d,selectClasses:"bg-green-500 hover:bg-green-600 dark:hover:bg-green-600 text-white",selectText:c("com_ui_save")}})})},cR={[Om.openai]:Uu.openAI,[Om.azure]:Uu.azureOpenAI},dR={[Om.openai]:"bg-white/75 dark:bg-black/65",[Om.azure]:"azure-bg-color",[Om.azure_blob]:"azure-bg-color",[Om.execute_code]:"bg-black text-white opacity-85",[Om.text]:"bg-blue-500 dark:bg-blue-900 opacity-85 text-white",[Om.vectordb]:"bg-yellow-700 dark:bg-yellow-900 opacity-85 text-white"};function uR({source:e,isCodeFile:t,className:n="absolute right-0 bottom-0 rounded-full p-[0.15rem] text-gray-600 transition-colors"}){if(!0===t)return s.jsx("div",{className:n_(n,dR[Om.execute_code]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(St,{className:"h-3 w-3"})})});if(e===Om.text)return s.jsx("div",{className:n_(n,dR[e]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(Et,{className:"h-3 w-3"})})});if(e===Om.vectordb)return s.jsx("div",{className:n_(n,dR[e]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(Tt,{className:"h-3 w-3"})})});const a=cR[e??""];return a?s.jsx("div",{className:n_(n,dR[e??""]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx($I,{endpoint:a,size:14,isCreatedByUser:!1,iconClassName:"h-3 w-3"})})}):null}const mR=({file:e,fileType:t,className:n=""})=>{var a;return s.jsxs("div",{className:n_("relative size-10 shrink-0 overflow-hidden rounded-xl",n),children:[s.jsx(ed,{file:e,fileType:t}),s.jsx(uR,{source:null==e?void 0:e.source,isCodeFile:!!(null==(a=null==e?void 0:e.metadata)?void 0:a.fileIdentifier)}),"number"==typeof(null==e?void 0:e.progress)&&(null==e?void 0:e.progress)<1&&s.jsx(ac,{bgOpacity:.2,color:"white",className:"absolute inset-0 m-2.5 flex items-center justify-center"})]})};function pR({onRemove:e}){const t=Fk();return s.jsx("button",{type:"button",className:"absolute right-1 top-1 -translate-y-1/2 translate-x-1/2 rounded-full bg-surface-secondary p-0.5 transition-colors duration-200 hover:bg-surface-primary",onClick:e,"aria-label":t("com_ui_attach_remove"),children:s.jsx("span",{"aria-hidden":"true",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})}const fR=({file:e,overrideType:t,buttonClassName:n,containerClassName:a,onDelete:r,onClick:o})=>{const i=Mv(t??e.type);return s.jsxs("div",{className:n_("group relative inline-block text-sm text-text-primary",a),children:[s.jsx("button",{type:"button",onClick:o,"aria-label":e.filename,className:n_("relative overflow-hidden rounded-2xl border border-border-light bg-surface-hover-alt",n),children:s.jsx("div",{className:"w-56 p-1.5",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.jsx(mR,{file:e,fileType:i,className:"relative"}),s.jsxs("div",{className:"overflow-hidden",children:[s.jsx("div",{className:"truncate font-medium",title:e.filename,children:e.filename}),s.jsx("div",{className:"truncate text-text-secondary",title:i.title,children:i.title})]})]})})}),r&&s.jsx(pR,{onRemove:r})]})};function hR({circumference:e,offset:t,circleCSSProperties:n}){return s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${e} ${e}`,strokeDashoffset:t,fill:"transparent",r:"55",cx:"60",cy:"60",style:n})]})})}const gR=({imageBase64:e,url:t,progress:a=1,className:r="",source:o,alt:i="Preview image"})=>{const[l,c]=n.useState(!1),[d,u]=n.useState(!1),[m,p]=n.useState(null),f=n.useCallback((()=>{p(document.activeElement),c(!0)}),[]),h=n.useCallback((e=>{c(!1),e.stopPropagation(),e.preventDefault(),m instanceof HTMLElement&&!m.closest('[data-skip-refocus="true"]')&&m.focus()}),[m]),g=n.useCallback((e=>{"Escape"===e.key&&h(e)}),[h]);n.useEffect((()=>{if(l){document.addEventListener("keydown",g),document.body.style.overflow="hidden";const e=document.querySelector('[aria-label="Close full view"]');e&&setTimeout((()=>e.focus()),0)}return()=>{document.removeEventListener("keydown",g),document.body.style.overflow="unset"}}),[l,g]);const x={backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},v=e??t??"",b=v?{...x,backgroundImage:`url(${v})`}:x;if("string"!=typeof b.backgroundImage||0===b.backgroundImage.length)return null;const _=2*Math.PI*55,y=_-a*_;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n_("relative size-14 rounded-xl",r),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[s.jsx("button",{type:"button",className:"size-full overflow-hidden rounded-xl",style:b,"aria-label":`View ${i} in full size`,"aria-haspopup":"dialog",onClick:e=>{e.preventDefault(),e.stopPropagation(),f()}}),a<1?s.jsx(hR,{circumference:_,offset:y,circleCSSProperties:{transition:"stroke-dashoffset 0.3s linear"},"aria-label":`Loading progress: ${Math.round(100*a)}%`}):s.jsx("div",{className:n_("absolute inset-0 flex transform-gpu cursor-pointer items-center justify-center rounded-xl transition-opacity duration-200 ease-in-out",d?"bg-black/20 opacity-100":"opacity-0"),onClick:e=>{e.stopPropagation(),f()},"aria-hidden":"true",children:s.jsx(It,{className:n_("size-5 transform-gpu text-white drop-shadow-lg transition-all duration-200",d?"scale-110":"")})}),s.jsx(uR,{source:o,"aria-label":o?`Source: ${o}`:void 0})]}),s.jsx(ul,{open:l,onOpenChange:c,children:s.jsx(gl,{showCloseButton:!1,className:"w-11/12 overflow-x-auto bg-transparent p-0 sm:w-auto",disableScroll:!1,children:s.jsx("img",{src:v,alt:i,className:"max-w-screen h-full max-h-screen w-full object-contain"})})})]})},xR=({imageBase64:e,url:t,onDelete:n,progress:a=1,source:r=Om.local})=>s.jsxs("div",{className:"group relative inline-block text-sm text-black/70 dark:text-white/90",children:[s.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-600",children:s.jsx(gR,{source:r,imageBase64:e,url:t,progress:a})}),s.jsx(pR,{onRemove:n})]});function vR({files:e,setFiles:t,abortUpload:a,setFilesLoading:r,assistant_id:o,agent_id:i,tool_resource:l,fileFilter:c,isRTL:d=!1,Wrapper:u}){const m=Fk(),{showToast:p}=Bd(),f=Array.from((null==e?void 0:e.values())??[]).filter((e=>!c||c(e))),{mutateAsync:h}=Wy({onMutate:async()=>s_.log("agents","Deleting files: agent_id, assistant_id, tool_resource",i,o,l),onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),{deleteFile:g}=gE({mutateAsync:h,agent_id:i,assistant_id:o,tool_resource:l});if(n.useEffect((()=>{0!==f.length?f.some((e=>e.progress<1))?r(!0):f.every((e=>1===e.progress))&&r(!1):r(!1)}),[f]),0===f.length)return null;const x=()=>{const e=d?{display:"flex",flexDirection:"row-reverse",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"}:{display:"flex",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"};return s.jsx("div",{style:e,children:f.reduce(((e,t)=>(e.map.has(t.file_id)||(e.map.set(t.file_id,!0),e.uniqueFiles.push(t)),e)),{map:new Map,uniqueFiles:[]}).uniqueFiles.map(((e,n)=>{var r;const o=()=>{p({message:m("com_ui_deleting_file"),status:"info"}),a&&e.progress<1&&a(),g({file:e,setFiles:t})},i=(null==(r=e.type)?void 0:r.startsWith("image"))??!1;return s.jsx("div",{style:{flexBasis:"70px",flexGrow:0,flexShrink:0},children:i?s.jsx(xR,{url:e.preview??e.filepath,onDelete:o,progress:e.progress,source:e.source}):s.jsx(fR,{file:e,onDelete:o})},n)}))})};return u?s.jsx(u,{children:x()}):x()}function bR({agent_id:e,files:t}){const a=Fk(),{setFilesLoading:r}=Pk(),o=n.useRef(null),[i,l]=n.useState(new Map),[c,d]=n.useState(!1),[u,m]=n.useState(!1),{data:p}=Ky(),f=null==p?void 0:p.sharePointFilePickerEnabled,{data:h=cp}=Yy({select:e=>fp(e)}),{handleFileChange:g}=wE({overrideEndpoint:Uu.agents,additionalMetadata:{agent_id:e,tool_resource:gu.ocr},fileSetter:l}),{handleSharePointFiles:x,isProcessing:v,downloadProgress:b}=CE({overrideEndpoint:Uu.agents,additionalMetadata:{agent_id:e,tool_resource:gu.file_search},fileSetter:l});kE((()=>{t&&l(new Map(t))}),[t],750);const _=h.endpoints[Uu.agents];if(_.disabled??!1)return null;const y=()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},j=[{label:a("com_files_upload_local_machine"),onClick:y,icon:s.jsx(Rt,{className:"icon-md"})},{label:a("com_files_upload_sharepoint"),onClick:()=>m(!0),icon:s.jsx(td,{className:"icon-md"})}],w=s.jsx(ie,{className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(dc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_context")]})});return s.jsxs("div",{className:"w-full",children:[s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[s.jsx(rl,{asChild:!0,children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-token-text-primary block font-medium",children:a("com_agents_file_context")}),s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})]})}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:a("com_agents_file_context_info")})})})})]})}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(vR,{files:i,setFiles:l,setFilesLoading:r,agent_id:e,tool_resource:gu.ocr,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsxs("div",{children:[f?s.jsx(s.Fragment,{children:s.jsx(wd,{gutter:2,menuId:"file-search-upload-menu",isOpen:c,setIsOpen:d,trigger:w,items:j,modal:!0,unmountOnHide:!0})}):s.jsx("button",{type:"button",disabled:!e,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:y,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(dc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_context")]})}),s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:!e,onChange:g})]}),e?null:s.jsx("div",{className:"text-xs text-text-secondary",children:a("com_agents_file_context_disabled")})]}),s.jsx(UI,{isOpen:u,onOpenChange:m,onFilesSelected:async e=>{try{await x(e),m(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:v,downloadProgress:b,maxSelectionCount:null==_?void 0:_.fileLimit})]})}function _R({title:e,selectedKey:t,onSelectionChange:a,dropdownOptions:r,showDropdown:o,register:i,dropdownOpen:l,setDropdownOpen:c,dropdownKey:d}){const u=Fk(),[m,p]=n.useState({}),f=r.find((e=>e.key===t)),h=r.map((e=>({label:e.label,onClick:()=>a(e.key)})));return s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsx(dl,{className:"text-md w-fit font-medium",children:e}),o?s.jsx(wd,{menuId:`${d}-dropdown`,items:h,isOpen:l,setIsOpen:c,trigger:s.jsxs(ie,{onClick:()=>c(!l),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[null==f?void 0:f.label,s.jsx(Pt,{className:"ml-1 h-4 w-4"})]})}):s.jsx("div",{className:"text-sm text-text-secondary",children:null==f?void 0:f.label})]}),(null==f?void 0:f.inputs)&&Object.entries(f.inputs).map((([e,t],n)=>s.jsxs("div",{children:[s.jsxs("div",{className:"relative",children:[s.jsx(ll,{type:"text",placeholder:t.placeholder,autoComplete:"password"===t.type?"one-time-code":"off",readOnly:"password"===t.type,onFocus:"password"===t.type?e=>e.target.readOnly=!1:void 0,className:"mb-2 "+("password"===t.type?"pr-10":""),...i(e)}),"password"===t.type&&s.jsx("button",{type:"button",onClick:()=>{return t=e,void p((e=>({...e,[t]:!e[t]})));var t},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary transition-colors hover:text-text-primary","aria-label":m[e]?u("com_ui_hide_password"):u("com_ui_show_password"),children:s.jsx("div",{className:"relative h-4 w-4",children:m[e]?s.jsx(At,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in"}):s.jsx(Mt,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in"})})})]}),t.link&&s.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:s.jsx("a",{href:t.link.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:t.link.text})})]},e)))]})}function yR({isOpen:e,onSubmit:t,onRevoke:a,onOpenChange:r,authTypes:o,isToolAuthenticated:i,register:l,handleSubmit:c,triggerRef:d,triggerRefs:u}){var m,p,f,h,g,x,v,b;const _=Fk(),{data:y}=Ky(),[j,w]=n.useState((null==(m=null==y?void 0:y.webSearch)?void 0:m.searchProvider)||Hf.SERPER),[N,C]=n.useState((null==(p=null==y?void 0:y.webSearch)?void 0:p.rerankerType)||Kf.JINA),[k,S]=n.useState(Gf.FIRECRAWL),E=[{key:Hf.SERPER,label:_("com_ui_web_search_provider_serper"),inputs:{serperApiKey:{placeholder:_("com_ui_enter_api_key"),type:"password",link:{url:"https://serper.dev/api-keys",text:_("com_ui_web_search_provider_serper_key")}}}},{key:Hf.SEARXNG,label:_("com_ui_web_search_provider_searxng"),inputs:{searxngInstanceUrl:{placeholder:_("com_ui_web_search_searxng_instance_url"),type:"text"},searxngApiKey:{placeholder:_("com_ui_web_search_searxng_api_key"),type:"password"}}}],T=[{key:Kf.JINA,label:_("com_ui_web_search_reranker_jina"),inputs:{jinaApiKey:{placeholder:_("com_ui_web_search_jina_key"),type:"password",link:{url:"https://jina.ai/api-dashboard/",text:_("com_ui_web_search_reranker_jina_key")}},jinaApiUrl:{placeholder:_("com_ui_web_search_jina_url"),type:"text",link:{url:"https://api.jina.ai/v1/rerank",text:_("com_ui_web_search_reranker_jina_url_help")}}}},{key:Kf.COHERE,label:_("com_ui_web_search_reranker_cohere"),inputs:{cohereApiKey:{placeholder:_("com_ui_web_search_cohere_key"),type:"password",link:{url:"https://dashboard.cohere.com/welcome/login",text:_("com_ui_web_search_reranker_cohere_key")}}}}],I=[{key:Gf.FIRECRAWL,label:_("com_ui_web_search_scraper_firecrawl"),inputs:{firecrawlApiUrl:{placeholder:_("com_ui_web_search_firecrawl_url"),type:"text"},firecrawlApiKey:{placeholder:_("com_ui_enter_api_key"),type:"password",link:{url:"https://docs.firecrawl.dev/introduction#api-key",text:_("com_ui_web_search_scraper_firecrawl_key")}}}}],[R,P]=n.useState({provider:!1,reranker:!1,scraper:!1}),A=null==(f=o.find((([e])=>e===$f.PROVIDERS)))?void 0:f[1],M=null==(h=o.find((([e])=>e===$f.SCRAPERS)))?void 0:h[1],L=null==(g=o.find((([e])=>e===$f.RERANKERS)))?void 0:g[1];return s.jsx(ul,{open:e,onOpenChange:r,triggerRef:d,triggerRefs:u,children:s.jsx(zd,{className:"w-11/12 sm:w-[500px]",title:"",main:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-4 text-center font-medium",children:_("com_ui_web_search")}),s.jsxs("form",{onSubmit:c(t),children:[A!==Mu.SYSTEM_DEFINED&&s.jsx(_R,{title:_("com_ui_web_search_provider"),selectedKey:j,onSelectionChange:e=>{w(e)},dropdownOptions:E,showDropdown:!(null==(x=null==y?void 0:y.webSearch)?void 0:x.searchProvider),register:l,dropdownOpen:R.provider,setDropdownOpen:e=>P((t=>({...t,provider:e}))),dropdownKey:"provider"}),M!==Mu.SYSTEM_DEFINED&&s.jsx(_R,{title:_("com_ui_web_search_scraper"),selectedKey:k,onSelectionChange:e=>{S(e)},dropdownOptions:I,showDropdown:!(null==(v=null==y?void 0:y.webSearch)?void 0:v.scraperType),register:l,dropdownOpen:R.scraper,setDropdownOpen:e=>P((t=>({...t,scraper:e}))),dropdownKey:"scraper"}),L!==Mu.SYSTEM_DEFINED&&s.jsx(_R,{title:_("com_ui_web_search_reranker"),selectedKey:N,onSelectionChange:e=>{C(e)},dropdownOptions:T,showDropdown:!(null==(b=null==y?void 0:y.webSearch)?void 0:b.rerankerType),register:l,dropdownOpen:R.reranker,setDropdownOpen:e=>P((t=>({...t,reranker:e}))),dropdownKey:"reranker"})]})]}),selection:{selectHandler:c(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:_("com_ui_save")},buttons:i&&s.jsx(ki,{onClick:a,className:"bg-red-500 text-white hover:bg-red-600",children:_("com_ui_revoke")}),showCancelButton:!0})})}function jR({authTypes:e=[],isToolAuthenticated:t=!1}){const n=Fk(),a=Vo(),{control:r,setValue:o,getValues:i}=a,{onSubmit:l,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=aT({onSubmit:()=>{o(vf.web_search,!0,{shouldDirty:!0})},onRevoke:()=>{o(vf.web_search,!1,{shouldDirty:!0})}}),p=$o({control:r,name:vf.web_search}),f=null==e?void 0:e.some((([,e])=>e===Mu.USER_PROVIDED)),h=e=>{t?o(vf.web_search,e,{shouldDirty:!0}):p?o(vf.web_search,!1,{shouldDirty:!0}):d(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:vf.web_search,control:r,render:({field:e})=>s.jsx(Si,{...e,checked:p||t&&e.value,onCheckedChange:h,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),s.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!i(vf.web_search);h(e)},children:s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:vf.web_search,children:n("com_ui_web_search")})}),s.jsxs("div",{className:"ml-2 flex gap-2",children:[f&&(t||p)&&s.jsx("button",{type:"button",onClick:()=>d(!0),children:s.jsx(Lt,{className:"h-5 w-5 text-text-primary"})}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_search_info")})})})})]})}),s.jsx(yR,{onSubmit:l,authTypes:e,isOpen:c,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit})]})}function wR(){const e=Fk(),{data:t}=oj({toolId:hu.web_search},{retry:1});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("div",{className:"flex flex-row items-center gap-1",children:s.jsx("div",{className:"flex items-center gap-1",children:s.jsx("span",{className:"text-token-text-primary block font-medium",children:e("com_ui_web_search")})})})}),s.jsx("div",{className:"flex flex-col items-start gap-2",children:s.jsx(jR,{authTypes:null==t?void 0:t.authTypes,isToolAuthenticated:null==t?void 0:t.authenticated})})]})}const NR=n.memo((function(){const e=Fk(),t=Vo(),{control:n,setValue:a,getValues:r}=t;return s.jsx(s.Fragment,{children:s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"my-2 flex items-center",children:[s.jsx(Uo,{name:vf.file_search,control:n,render:({field:e})=>s.jsx(Si,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>a(vf.file_search,!r(vf.file_search),{shouldDirty:!0}),children:[s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:vf.file_search,children:e("com_agents_enable_file_search")}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_agents_file_search_info")})})})})]})})})}));function CR({agent_id:e,files:t}){const a=Fk(),{setFilesLoading:r}=Pk(),{watch:o}=Vo(),i=n.useRef(null),[l,c]=n.useState(new Map),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{data:f}=Ky(),{data:h=cp}=Yy({select:e=>fp(e)}),{handleFileChange:g}=wE({overrideEndpoint:Uu.agents,additionalMetadata:{agent_id:e,tool_resource:gu.file_search},fileSetter:c}),{handleSharePointFiles:x,isProcessing:v,downloadProgress:b}=CE({overrideEndpoint:Uu.agents,additionalMetadata:{agent_id:e,tool_resource:gu.file_search},fileSetter:c});kE((()=>{t&&c(new Map(t))}),[t],750);const _=o(vf.file_search),y=h.endpoints[Uu.agents],j=y.disabled??!1,w=null==f?void 0:f.sharePointFilePickerEnabled,N=!e||!1===_;if(j)return null;const C=[{label:a("com_files_upload_local_machine"),onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},icon:s.jsx(Rt,{className:"icon-md"})},{label:a("com_files_upload_sharepoint"),onClick:()=>p(!0),icon:s.jsx(td,{className:"icon-md"})}],k=s.jsx(ie,{disabled:N,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(dc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_search")]})});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:a("com_assistants_file_search")})})}),s.jsx(NR,{}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(vR,{files:l,setFiles:c,setFilesLoading:r,agent_id:e,tool_resource:gu.file_search,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsxs("div",{children:[w?s.jsx(wd,{gutter:2,menuId:"file-search-upload-menu",isOpen:d,setIsOpen:u,trigger:k,items:C,modal:!0,unmountOnHide:!0}):s.jsx("button",{type:"button",disabled:N,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(dc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_search")]})}),s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:N,onChange:g})]}),e?null:s.jsx("div",{className:"text-xs text-text-secondary",children:a("com_agents_file_search_disabled")})]}),s.jsx(UI,{isOpen:m,onOpenChange:p,onFilesSelected:async e=>{try{await x(e),p(!1)}catch(t){console.error("SharePoint file processing error:",t)}},disabled:N,isDownloading:v,downloadProgress:b,maxSelectionCount:null==y?void 0:y.fileLimit})]})}function kR(){const e=Fk(),t=Vo(),{setValue:n,watch:a}=t,r=a(vf.artifacts),o=void 0!==r&&""!==r,i=r===$h.CUSTOM,l=r===$h.SHADCNUI;return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_ui_artifacts")})})}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(SR,{id:"artifacts",label:e("com_ui_artifacts_toggle_agent"),checked:o,onCheckedChange:e=>{n(vf.artifacts,e?$h.DEFAULT:"",{shouldDirty:!0})},hoverCardText:e("com_nav_info_code_artifacts_agent")}),s.jsx(SR,{id:"includeShadcnui",label:e("com_ui_include_shadcnui"),checked:l,onCheckedChange:e=>{n(vf.artifacts,e?$h.SHADCNUI:$h.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_include_shadcnui"),disabled:!o||i}),s.jsx(SR,{id:"customPromptMode",label:e("com_ui_custom_prompt_mode"),checked:i,onCheckedChange:e=>{n(vf.artifacts,e?$h.CUSTOM:$h.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_custom_prompt_mode"),disabled:!o})]})]})}function SR({id:e,label:t,checked:n,onCheckedChange:a,hoverCardText:r,disabled:o=!1}){return s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:o?"text-text-tertiary":"",children:t}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:r})})})}),s.jsx(Cl,{id:e,checked:n,onCheckedChange:a,className:"ml-4","data-testid":e,disabled:o})]})})}function ER({tool:e,allTools:t}){var a,r;const[o,i]=n.useState(!1),[l,c]=n.useState(!1),[d,u]=n.useState(null),[m,p]=n.useState(""),f=Fk(),{showToast:h}=Bd(),g=bk(),{getValues:x,setValue:v}=Vo();if(!t)return null;const b=t[e],_=e=>{const t=(x("tools")||[]).filter((e=>{var t;return!(null==(t=null==b?void 0:b.tools)?void 0:t.some((t=>t.tool_id===e)))}));v("tools",[...t,...e])},y=e=>{if(e){const t=j&&b.tools?[e,...b.tools.map((e=>e.tool_id))]:[e];g.mutate({pluginKey:e,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{h({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{var e;const n=null==(e=x("tools"))?void 0:e.filter((e=>!t.includes(e)));v("tools",n),h({message:"Tool deleted successfully",status:"success"})}})}};if(!b)return null;const j=b.tools&&b.tools.length>0,w=(()=>{if(!(null==b?void 0:b.tools))return[];const e=x("tools")||[];return b.tools.filter((t=>e.includes(t.tool_id))).map((e=>e.tool_id))})(),N=m===b.tool_id;return j?s.jsxs(ul,{children:[s.jsx(ui,{type:"single",value:m,onValueChange:p,collapsible:!0,children:s.jsxs(mi,{value:b.tool_id,className:"group relative w-full border-none",children:[s.jsx("div",{className:"relative flex w-full items-center gap-1 rounded-lg p-1 hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:s.jsx(Ds,{asChild:!0,children:s.jsx(Fs,{asChild:!0,children:s.jsxs("button",{type:"button",className:n_("flex grow items-center gap-1 rounded bg-transparent p-0 text-left transition-colors","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),children:[b.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${b.metadata.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:b.metadata.name}),s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"relative flex items-center",children:[s.jsxs("div",{className:n_("flex items-center gap-2 transition-all duration-300",o||l?"-translate-x-8":"translate-x-0"),children:[s.jsx("div",{"data-checkbox-container":!0,onClick:e=>e.stopPropagation(),className:"mt-1",children:s.jsx(Si,{id:`select-all-${b.tool_id}`,checked:w.length===(null==(a=b.tools)?void 0:a.length),onCheckedChange:e=>{if(b.tools){const t=e?b.tools.map((e=>e.tool_id)):[];_(t)}},className:n_("h-4 w-4 rounded border border-gray-300 transition-all duration-200 hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500",N?"visible":"pointer-events-none invisible"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();e.currentTarget.click()}},tabIndex:N?0:-1})}),s.jsx("div",{className:n_("pointer-events-none flex h-4 w-4 items-center justify-center transition-transform duration-300",N?"rotate-180":""),"aria-hidden":"true",children:s.jsx(Pt,{className:"h-4 w-4"})})]}),s.jsx("div",{className:n_("absolute right-0 transition-all duration-300",o||l?"translate-x-0 opacity-100":"translate-x-8 opacity-0"),children:s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:n_("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:translate-x-0 focus:opacity-100"),onClick:e=>e.stopPropagation(),"aria-label":`Delete ${b.metadata.name}`,tabIndex:0,onFocus:()=>c(!0),children:s.jsx(kc,{className:"h-4 w-4"})})})})]})})]})})})}),s.jsx(pi,{className:"relative ml-1 pt-1 before:absolute before:bottom-2 before:left-0 before:top-0 before:w-0.5 before:bg-border-medium",children:s.jsx("div",{className:"space-y-1",children:null==(r=b.tools)?void 0:r.map((e=>s.jsxs("label",{htmlFor:e.tool_id,className:n_("border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2","ml-2 mr-1 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.stopPropagation()},onMouseEnter:()=>u(e.tool_id),onMouseLeave:()=>u(null),children:[s.jsx(Si,{id:e.tool_id,checked:w.includes(e.tool_id),onCheckedChange:t=>{const n=w.includes(e.tool_id)?w.filter((t=>t!==e.tool_id)):[...w,e.tool_id];_(n)},onKeyDown:e=>{if(e.stopPropagation(),"Enter"===e.key||" "===e.key){e.preventDefault();e.currentTarget.click()}},onClick:e=>e.stopPropagation(),className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer rounded border border-gray-300 transition-[border-color] duration-200 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background dark:border-gray-600 dark:hover:border-gray-500"}),s.jsx("span",{className:"text-token-text-primary",children:e.metadata.name}),e.metadata.description&&s.jsxs(Ot,{placement:"left-start",children:[s.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center",children:[s.jsx(Dt,{render:s.jsxs(Ft,{className:n_("flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary transition-opacity duration-200",d===e.tool_id?"opacity-100":"opacity-0"),"aria-label":f("com_ui_tool_info"),children:[s.jsx(Hc,{className:"h-4 w-4"}),s.jsx(zt,{children:f("com_ui_tool_info")})]})}),s.jsxs(Ut,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":f("com_ui_tool_more_info"),"aria-expanded":d===e.tool_id,"aria-controls":`tool-description-${e.tool_id}`,children:[s.jsx(zt,{children:f("com_ui_tool_more_info")}),s.jsx(Pt,{className:"h-4 w-4"})]})]}),s.jsx(Vt,{id:`tool-description-${e.tool_id}`,gutter:14,shift:40,flip:!1,className:"z-[999] w-80 scale-95 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary opacity-0 shadow-md transition-all duration-200 data-[enter]:scale-100 data-[leave]:scale-95 data-[enter]:opacity-100 data-[leave]:opacity-0",portal:!0,unmountOnHide:!0,role:"tooltip","aria-label":e.metadata.description,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e.metadata.description})})})]})]},e.tool_id)))})})]})}),s.jsx(zd,{showCloseButton:!1,title:f("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:f("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>y(b.tool_id),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:f("com_ui_delete")}})]}):s.jsxs(ul,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:[s.jsxs("div",{className:"flex grow items-center",children:[b.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${b.metadata.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:b.metadata.name})]}),s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:n_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:opacity-100",o||l?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${b.metadata.name}`,tabIndex:0,onFocus:()=>c(!0),children:s.jsx(kc,{className:"h-4 w-4"})})})]}),s.jsx(zd,{showCloseButton:!1,title:f("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:f("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>y(b.tool_id),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:f("com_ui_delete")}})]})}function TR({isOpen:e,onSubmit:t,onRevoke:n,onOpenChange:a,isUserProvided:r,isToolAuthenticated:o,register:i,handleSubmit:l,triggerRef:c,triggerRefs:d}){const u=Fk();return s.jsx(ul,{open:e,onOpenChange:a,triggerRef:c,triggerRefs:d,children:s.jsx(zd,{className:"w-11/12 sm:w-[450px]",title:"",main:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-4 text-center font-medium",children:u("com_ui_librechat_code_api_title")}),s.jsx("div",{className:"mb-4 text-center text-sm",children:u("com_ui_librechat_code_api_subtitle")}),s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"mx-auto mb-4 flex max-w-[400px] flex-wrap justify-center gap-3",children:["python.svg","nodedotjs.svg","tsnode.svg","rust.svg","go.svg","c.svg","cplusplus.svg","php.svg","fortran.svg","r.svg"].map((e=>s.jsx("div",{className:"h-6 w-6",children:s.jsx("img",{src:`assets/${e}`,alt:"",className:"h-full w-full object-contain opacity-[0.85] dark:invert"})},e)))}),s.jsx("a",{href:"https://code.librechat.ai/pricing",target:"_blank",rel:"noopener noreferrer",className:"block text-center text-[15px] font-medium text-blue-500 underline decoration-1 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:u("com_ui_librechat_code_api_key")})]}),s.jsx("form",{onSubmit:l(t),children:s.jsx(ll,{type:"password",placeholder:u("com_ui_enter_api_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("apiKey",{required:!0})})})]}),selection:{selectHandler:l(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:u("com_ui_save")},buttons:r&&o&&s.jsx(ki,{onClick:n,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",children:u("com_ui_revoke")}),showCancelButton:!0})})}function IR({authType:e="",isToolAuthenticated:t=!1}){const n=Fk(),a=Vo(),{control:r,setValue:o,getValues:i}=a,{onSubmit:l,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=nT({onSubmit:()=>{o(vf.execute_code,!0,{shouldDirty:!0})},onRevoke:()=>{o(vf.execute_code,!1,{shouldDirty:!0})}}),p=$o({control:r,name:vf.execute_code}),f=e===Mu.USER_PROVIDED,h=e=>{t?o(vf.execute_code,e,{shouldDirty:!0}):p?o(vf.execute_code,!1,{shouldDirty:!0}):d(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:vf.execute_code,control:r,render:({field:e})=>s.jsx(Si,{...e,checked:p||t&&e.value,onCheckedChange:h,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),s.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!i(vf.execute_code);h(e)},children:s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:vf.execute_code,children:n("com_ui_run_code")})}),s.jsxs("div",{className:"ml-2 flex gap-2",children:[f&&(t||p)&&s.jsx("button",{type:"button",onClick:()=>d(!0),children:s.jsx(Lt,{className:"h-5 w-5 text-text-primary"})}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_code_interpreter")})})})})]})}),s.jsx(TR,{isOpen:c,onSubmit:l,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit,isUserProvided:e===Mu.USER_PROVIDED})]})}const RR=gu.execute_code;function PR({agent_id:e,files:t}){const a=Fk(),{setFilesLoading:r}=Pk(),{watch:o}=Vo(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=cp}=Yy({select:e=>fp(e)}),{abortUpload:u,handleFileChange:m}=wE({fileSetter:c,overrideEndpoint:Uu.agents,additionalMetadata:{agent_id:e,tool_resource:RR}});kE((()=>{t&&c(new Map(t))}),[t],750);const p=o(vf.execute_code),f=d.endpoints[Uu.agents];if((null==f?void 0:f.disabled)??!1)return null;return s.jsx("div",{className:"mb-2 w-full",children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:a("com_assistants_code_interpreter_files")}),s.jsx(vR,{files:l,setFiles:c,agent_id:e,abortUpload:u,tool_resource:RR,setFilesLoading:r,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:!e||!1===p,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:!e||!1===p,onChange:m}),s.jsx(dc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_code_files")]})})})]})})}function AR({agent_id:e,files:t}){const n=Fk(),{data:a}=oj({toolId:hu.execute_code});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("div",{className:"flex flex-row items-center gap-1",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-token-text-primary block font-medium",children:n("com_agents_code_interpreter_title")}),s.jsx("span",{className:"text-xs text-text-secondary",children:n("com_agents_by_librechat")})]})})}),s.jsxs("div",{className:"flex flex-col items-start gap-2",children:[s.jsx(IR,{authType:null==a?void 0:a.message,isToolAuthenticated:null==a?void 0:a.authenticated}),s.jsx(PR,{agent_id:e,files:t})]})]})}let MR;function LR({serverName:e,serverStatus:t,tool:n,onConfigClick:a,isInitializing:r,canCancel:o,onCancel:i,hasCustomUserVars:l=!1}){if(MR=Fk(),r)return s.jsx(OR,{serverName:e,onConfigClick:a,onCancel:i,canCancel:o});if(!t)return null;const{connectionState:c,requiresOAuth:d}=t;if("connecting"===c)return s.jsx(DR,{serverName:e,onConfigClick:a});if("disconnected"===c)return d?s.jsx(FR,{serverName:e,onConfigClick:a}):s.jsx(zR,{serverName:e,onConfigClick:a});if("error"===c)return s.jsx(UR,{serverName:e,onConfigClick:a});if("connected"===c){if(l){const t=(null==n?void 0:n.authenticated)||d;return s.jsx(VR,{serverName:e,onConfigClick:a,isAuthenticated:t})}return null}return null}function OR({serverName:e,onCancel:t,canCancel:n}){return n?s.jsx("button",{type:"button",onClick:t,className:"group flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-red-100 dark:hover:bg-red-900/20","aria-label":MR("com_ui_cancel"),title:MR("com_ui_cancel"),children:s.jsxs("div",{className:"relative h-4 w-4",children:[s.jsx(ac,{className:"h-4 w-4 group-hover:opacity-0"}),s.jsx(vt,{className:"absolute inset-0 h-4 w-4 text-red-500 opacity-0 group-hover:opacity-100"})]})}):s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(ac,{className:"h-4 w-4","aria-label":MR("com_nav_mcp_status_connecting",{0:e})})})}function DR({serverName:e}){return s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(ac,{className:"h-4 w-4","aria-label":MR("com_nav_mcp_status_connecting",{0:e})})})}function FR({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":MR("com_nav_mcp_configure_server",{0:e}),children:s.jsx(Lt,{className:"h-4 w-4 text-amber-500"})})}function zR({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":MR("com_nav_mcp_configure_server",{0:e}),children:s.jsx(Bt,{className:"h-4 w-4 text-orange-500"})})}function UR({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":MR("com_nav_mcp_configure_server",{0:e}),children:s.jsx($t,{className:"h-4 w-4 text-red-500"})})}function VR({serverName:e,onConfigClick:t,isAuthenticated:n}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":MR("com_nav_mcp_configure_server",{0:e}),children:s.jsx(ze,{className:"h-4 w-4 "+(n?"text-green-500":"text-gray-400")})})}function BR({serverName:e,requiresOAuth:t,conversationId:n,sidePanel:a=!1,hasCustomUserVars:r=!1}){const o=Fk(),{initializeServer:i,cancelOAuthFlow:l,isInitializing:c,isCancellable:d,getOAuthUrl:u}=DE({conversationId:n}),{data:m}=Ky(),{connectionStatus:p}=OE({enabled:!!(null==m?void 0:m.mcpServers)&&Object.keys(m.mcpServers).length>0}),f=null==p?void 0:p[e],h="connected"===(null==f?void 0:f.connectionState),g=d(e),x=c(e),v=u(e),b=h&&(t||r);if(!b&&!(!h&&!v)&&!v)return null;if(v)return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ki,{onClick:()=>l(e),disabled:!g,variant:"outline",title:g?void 0:"disabled",children:o("com_ui_cancel")}),s.jsx(ki,{variant:"submit",onClick:()=>window.open(v,"_blank","noopener,noreferrer"),className:"flex-1",children:o("com_ui_continue_oauth")})]})});const _=b?"flex justify-start":"flex justify-end",y=b?void 0:"default";let j="";j=o(x?"com_ui_loading":b?"com_ui_reinitialize":t?"com_ui_authenticate":"com_ui_mcp_initialize");const w=x?s.jsx(ac,{className:"h-4 w-4"}):s.jsx(Ht,{className:"h-4 w-4"});return s.jsx("div",{className:_,children:s.jsxs(ki,{variant:y,onClick:()=>i(e,!1),disabled:x,size:a?"sm":"default",className:"w-full",children:[w,j]})})}function $R({isOpen:e,onOpenChange:t,fieldsSchema:n,onSave:a,isSubmitting:r=!1,onRevoke:o,serverName:i,serverStatus:l,conversationId:c}){const d=Fk(),u=Object.keys(n).length>0?d("com_ui_configure_mcp_variables_for",{0:i}):`${i} MCP Server`;return s.jsx(ul,{open:e,onOpenChange:t,children:s.jsxs(gl,{className:"flex max-h-screen w-11/12 max-w-lg flex-col space-y-2",children:[s.jsx(xl,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(bl,{className:"text-xl",children:u.charAt(0).toUpperCase()+u.slice(1)}),(()=>{if(!l)return null;const{connectionState:e,requiresOAuth:t}=l;return"connecting"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-blue-50 px-2 py-0.5 text-xs font-medium text-blue-600 dark:bg-blue-950 dark:text-blue-400",children:[s.jsx(ac,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_connecting")})]}):"disconnected"===e?t?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-600 dark:bg-amber-950 dark:text-amber-400",children:[s.jsx(Lt,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_oauth")})]}):s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-orange-50 px-2 py-0.5 text-xs font-medium text-orange-600 dark:bg-orange-950 dark:text-orange-400",children:[s.jsx(Bt,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_offline")})]}):"error"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-600 dark:bg-red-950 dark:text-red-400",children:[s.jsx($t,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_error")})]}):"connected"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700 dark:bg-green-900 dark:text-green-300",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),s.jsx("span",{children:d("com_ui_active")})]}):null})()]})}),s.jsx(wI,{serverName:i,fields:n,onSave:a,onRevoke:o||(()=>{}),isSubmitting:r}),s.jsx(BR,{serverName:i,conversationId:c,requiresOAuth:(null==l?void 0:l.requiresOAuth)||!1,hasCustomUserVars:n&&Object.keys(n).length>0})]})})}function HR({serverInfo:e}){const[t,a]=n.useState(!1),[r,o]=n.useState(!1),i=Fk(),{showToast:l}=Bd(),c=bk(),{getValues:d,setValue:u}=Vo(),{initializeServer:m,isInitializing:p,getServerStatusIconProps:f,getConfigDialogProps:h}=DE();if(!e)return null;const g=e.serverName,x=p(g),v=f(g),b=h(),_=v&&s.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:s.jsx(LR,{...v})});return s.jsxs(ul,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>a(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||a(!1)},children:[s.jsxs("div",{className:"flex grow cursor-pointer items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",onClick:e=>{e.target.closest("[data-status-icon]")||x||m(g)},role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),x||m(g))},"aria-disabled":x,children:[_&&s.jsx("div",{className:"flex items-center","data-status-icon":!0,children:_}),e.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),s.jsxs("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[g,x&&s.jsx("span",{className:"ml-2 text-xs text-text-secondary",children:i("com_ui_initializing")})]})]}),s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:n_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",r||t?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${g}`,tabIndex:0,onFocus:()=>a(!0),children:s.jsx(kc,{className:"h-4 w-4"})})})]}),s.jsx(zd,{showCloseButton:!1,title:i("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:i("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=g)&&c.mutate({pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{l({message:i("com_ui_delete_tool_error",{error:String(e)}),status:"error"})},onSuccess:()=>{const t=d("tools"),n=(null==t?void 0:t.filter((t=>t!==e&&!t.endsWith(`${Sh.mcp_delimiter}${e}`))))||[];u("tools",n),l({message:i("com_ui_delete_tool_success"),status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:i("com_ui_delete")}}),b&&s.jsx($R,{...b})]})}function GR({serverName:e}){const t=Fk(),{showToast:a}=Bd(),r=bk(),{getValues:o,setValue:i}=Vo(),[l,c]=n.useState(!1),[d,u]=n.useState(!1);if(!e)return null;return s.jsxs(ul,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:[s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(jt,{className:"h-4 w-4 text-red-500"})})}),s.jsx("div",{className:"flex grow cursor-not-allowed items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",children:s.jsxs("div",{className:"grow select-none px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[e,s.jsxs("span",{className:"ml-2 text-xs text-text-secondary",children:[" - ",t("com_ui_unavailable")]})]})}),s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:n_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",d||l?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${e}`,tabIndex:0,onFocus:()=>c(!0),children:s.jsx(kc,{className:"h-4 w-4"})})})]}),s.jsx(zd,{showCloseButton:!1,title:t("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:t("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{r.mutate({pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{a({message:t("com_ui_delete_tool_error",{error:String(e)}),status:"error"})},onSuccess:()=>{const n=o("tools"),s=(null==n?void 0:n.filter((t=>t!==e&&!t.endsWith(`${Sh.mcp_delimiter}${e}`))))||[];i("tools",s),a({message:t("com_ui_delete_tool_success"),status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:t("com_ui_delete")}})]})}function KR({serverInfo:e}){var t,a;const r=Fk(),{showToast:o}=Bd(),i=bk(),{getValues:l,setValue:c}=Vo(),{getServerStatusIconProps:d,getConfigDialogProps:u}=DE(),[m,p]=n.useState(!1),[f,h]=n.useState(!1),[g,x]=n.useState(""),[v,b]=n.useState(null);if(!e)return null;const _=e.serverName,y=t=>{const n=(l("tools")||[]).filter((t=>{var n;return!(null==(n=null==e?void 0:e.tools)?void 0:n.some((e=>e.tool_id===t)))}));c("tools",[...n,...t])},j=(()=>{if(!(null==e?void 0:e.tools))return[];const t=l("tools")||[];return e.tools.filter((e=>t.includes(e.tool_id))).map((e=>e.tool_id))})(),w=g===_,N=d(_),C=u(),k=N&&s.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:s.jsx(LR,{...N})});return s.jsxs(ul,{children:[s.jsx(ui,{type:"single",value:g,onValueChange:x,collapsible:!0,children:s.jsxs(mi,{value:_,className:"group relative w-full border-none",children:[s.jsx("div",{className:"relative flex w-full items-center gap-1 rounded-lg p-1 hover:bg-surface-primary-alt",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onFocus:()=>p(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||p(!1)},children:s.jsx(Ds,{asChild:!0,children:s.jsxs("div",{className:"flex grow cursor-pointer select-none items-center gap-1 rounded bg-transparent p-0 text-left transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",onClick:()=>x((e=>e?"":_)),children:[k&&s.jsx("div",{className:"flex items-center",children:k}),e.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:_}),s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"relative flex items-center",children:s.jsx("div",{className:n_("absolute right-0 transition-all duration-300",f||m?"translate-x-0 opacity-100":"translate-x-8 opacity-0"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{"data-checkbox-container":!0,onClick:e=>e.stopPropagation(),className:"mt-1",children:s.jsx(Si,{id:`select-all-${_}`,checked:j.length===(null==(t=e.tools)?void 0:t.length)&&j.length>0,onCheckedChange:t=>{if(e.tools){const n=t?e.tools.map((e=>e.tool_id)):[`${Sh.mcp_server}${Sh.mcp_delimiter}${_}`];y(n)}},className:n_("h-4 w-4 rounded border border-border-medium transition-all duration-200 hover:border-border-heavy",w?"visible":"pointer-events-none invisible"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();e.currentTarget.click()}},tabIndex:w?0:-1})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Fs,{asChild:!0,children:s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation()},className:n_("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200 hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",w&&"bg-surface-active-alt"),"aria-hidden":"true",tabIndex:0,onFocus:()=>p(!0),children:s.jsx(Pt,{className:n_("h-4 w-4 transition-transform duration-200",w&&"rotate-180")})})}),s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:n_("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200","hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),onClick:e=>e.stopPropagation(),"aria-label":`Delete ${_}`,tabIndex:0,onFocus:()=>p(!0),children:s.jsx(kc,{className:"h-4 w-4"})})})]})]})})})})]})})}),s.jsx(pi,{className:"relative ml-1 pt-1 before:absolute before:bottom-2 before:left-0 before:top-0 before:w-0.5 before:bg-border-medium",children:s.jsx("div",{className:"space-y-1",children:null==(a=e.tools)?void 0:a.map((e=>s.jsxs("label",{htmlFor:e.tool_id,className:n_("border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2","ml-2 mr-1 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.stopPropagation()},onMouseEnter:()=>b(e.tool_id),onMouseLeave:()=>b(null),children:[s.jsx(Si,{id:e.tool_id,checked:j.includes(e.tool_id),onCheckedChange:t=>{const n=j.includes(e.tool_id)?j.filter((t=>t!==e.tool_id)):[...j,e.tool_id];y(n)},onKeyDown:e=>{if(e.stopPropagation(),"Enter"===e.key||" "===e.key){e.preventDefault();e.currentTarget.click()}},onClick:e=>e.stopPropagation(),className:n_("relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer rounded border border-border-medium transition-[border-color] duration-200 hover:border-border-heavy focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background")}),s.jsx("span",{className:"text-token-text-primary select-none",children:e.metadata.name}),e.metadata.description&&s.jsxs(Ot,{placement:"left-start",children:[s.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center",children:[s.jsx(Dt,{render:s.jsxs(Ft,{className:n_("flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary transition-opacity duration-200",v===e.tool_id?"opacity-100":"opacity-0"),"aria-label":r("com_ui_tool_info"),children:[s.jsx(Hc,{className:"h-4 w-4"}),s.jsx(zt,{children:r("com_ui_tool_info")})]})}),s.jsxs(Ut,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":r("com_ui_tool_more_info"),"aria-expanded":v===e.tool_id,"aria-controls":`tool-description-${e.tool_id}`,children:[s.jsx(zt,{children:r("com_ui_tool_more_info")}),s.jsx(Pt,{className:"h-4 w-4"})]})]}),s.jsx(Vt,{id:`tool-description-${e.tool_id}`,gutter:14,shift:40,flip:!1,className:"z-[999] w-80 scale-95 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary opacity-0 shadow-md transition-all duration-200 data-[enter]:scale-100 data-[leave]:scale-95 data-[enter]:opacity-100 data-[leave]:opacity-0",portal:!0,unmountOnHide:!0,role:"tooltip","aria-label":e.metadata.description,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e.metadata.description})})})]})]},e.tool_id)))})})]})}),s.jsx(zd,{showCloseButton:!1,title:r("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:r("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=_)&&i.mutate({pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{o({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{const t=l("tools"),n=(null==t?void 0:t.filter((t=>t!==e&&!t.endsWith(`${Sh.mcp_delimiter}${e}`))))||[];c("tools",n),o({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:r("com_ui_delete")}}),C&&s.jsx($R,{...C})]})}function WR({agentId:e,mcpServerNames:t,setShowMCPToolDialog:n}){const a=Fk(),{mcpServersMap:r}=Zk();return s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"text-token-text-primary mb-2 block font-medium",children:a("com_ui_mcp_servers")}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-1",children:null==t?void 0:t.map((t=>{const n=r.get(t);return(null==n?void 0:n.isConfigured)?n?n.isConnected?s.jsx(KR,{serverInfo:n},`${n.serverName}-${e}`):s.jsx(HR,{serverInfo:n},`${n.serverName}-${e}`):null:s.jsx(GR,{serverName:t},`${t}-${e}`)}))}),s.jsx("div",{className:"mt-2",children:s.jsx("button",{type:"button",onClick:()=>n(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:a("com_assistants_add_mcp_server_tools")})})})]})]})}const qR="mb-2 text-token-text-primary block font-medium",QR=n_(f_,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",u_);function YR({createMutation:e}){const t=Fk(),a=nS(),{showToast:r}=Bd(),o=Vo(),[i,l]=n.useState(!1),[c,d]=n.useState(!1),{actions:u,setAction:m,agentsConfig:p,startupConfig:f,mcpServersMap:h,setActivePanel:g,endpointsConfig:x,groupedTools:v}=Zk(),{control:b,formState:{errors:_}}=o,y=$o({control:b,name:"provider"}),j=$o({control:b,name:"model"}),w=$o({control:b,name:"agent"}),N=$o({control:b,name:"tools"}),C=$o({control:b,name:"id"}),{data:k=[]}=Qy(C),S=n.useMemo((()=>{const e={...a};return k.forEach((t=>{t.file_id&&(e[t.file_id]=t)})),e}),[a,k]),{ocrEnabled:E,codeEnabled:T,toolsEnabled:I,actionsEnabled:R,artifactsEnabled:P,webSearchEnabled:A,fileSearchEnabled:M}=Bk(null==p?void 0:p.capabilities),L=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.context_files)return w.context_files;return Yv({agent:w,fileMap:S}).context_files??[]}),[w,C,S]),O=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.knowledge_files)return w.knowledge_files;return Yv({agent:w,fileMap:S}).knowledge_files??[]}),[w,C,S]),D=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.code_files)return w.code_files;return Yv({agent:w,fileMap:S}).code_files??[]}),[w,C,S]),F=n.useCallback((()=>{C?g(Xd.actions):r({message:t("com_assistants_actions_disabled"),status:"warning"})}),[C,g,r,t]),z="string"==typeof y?y:null==y?void 0:y.value;let U,V,B,$;void 0!==z&&(V=kb(x,z,"type"),B=kb(x,z,"iconURL"),$=Mb({endpoint:z,endpointsConfig:x,endpointType:V,endpointIconURL:B}),U=kT[$]);const{toolIds:H,mcpServerNames:G}=function(e,t,s){return n.useMemo((()=>{var n;const a=new Set,r=new Set,o=new Set;for(const t of e??[]){if(!t.includes(Sh.mcp_delimiter)){r.add(t);continue}const e=t.split(Sh.mcp_delimiter)[1];e&&a.add(e)}if(t)for(const[e,s]of Object.entries(t))if(r.has(e)&&o.add(e),null==(n=s.tools)?void 0:n.length)for(const t of s.tools)if(r.has(t.tool_id)){o.add(e);break}if(s)for(const[e]of s)a.has(e)||r.has(e)&&a.add(e);return{toolIds:Array.from(o).sort(((e,t)=>e.localeCompare(t))),mcpServerNames:Array.from(a).sort(((e,t)=>e.localeCompare(t)))}}),[t,s,e])}(N,v,h);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"h-auto bg-white px-4 pt-3 dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(zI,{agent_id:C,createMutation:e,avatar:(null==w?void 0:w.avatar)??null}),s.jsxs("label",{className:qR,htmlFor:"name",children:[t("com_ui_name"),s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Uo,{name:"name",rules:{required:t("com_ui_agent_name_is_required")},control:b,render:({field:e})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",maxLength:256,className:QR,id:"name",type:"text",placeholder:t("com_agents_name_placeholder"),"aria-label":"Agent name"}),s.jsx("div",{className:n_("mt-1 w-56 text-sm text-red-500",_.name?"visible h-auto":"invisible h-0"),children:_.name?_.name.message:" "})]})}),s.jsx(Uo,{name:"id",control:b,render:({field:e})=>s.jsx("p",{className:"h-3 text-xs italic text-text-secondary","aria-live":"polite",children:e.value})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:qR,htmlFor:"description",children:t("com_ui_description")}),s.jsx(Uo,{name:"description",control:b,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",maxLength:512,className:QR,id:"description",type:"text",placeholder:t("com_agents_description_placeholder"),"aria-label":"Agent description"})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:qR,htmlFor:"category-selector",children:[t("com_ui_category")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(RI,{className:"w-full"})]}),s.jsx(LI,{}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:qR,htmlFor:"provider",children:[t("com_ui_model")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("button",{type:"button",onClick:()=>g(Xd.model),className:"btn btn-neutral border-token-border-light relative h-10 w-full rounded-lg font-medium","aria-haspopup":"true","aria-expanded":"false",children:s.jsxs("div",{className:"flex w-full items-center gap-2",children:[U&&s.jsx("div",{className:"shadow-stroke relative flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-white text-black dark:bg-white",children:s.jsx(U,{className:"h-2/3 w-2/3",endpoint:z,endpointType:V,iconURL:B})}),s.jsx("span",{children:null!=j&&j?j:t("com_ui_select_model")})]})})]}),(T||M||P||E||A)&&s.jsxs("div",{className:"mb-4 flex w-full flex-col items-start gap-3",children:[s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_assistants_capabilities")}),T&&s.jsx(AR,{agent_id:C,files:D}),A&&s.jsx(wR,{}),E&&s.jsx(bR,{agent_id:C,files:L}),P&&s.jsx(kR,{}),M&&s.jsx(CR,{agent_id:C,files:O})]}),null!=(null==f?void 0:f.mcpServers)&&s.jsx(WR,{agentId:C,mcpServerNames:G,setShowMCPToolDialog:d}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:qR,children:`${!0===I?t("com_ui_tools"):""}\n              ${!0===I&&!0===R?" + ":""}\n              ${!0===R?t("com_assistants_actions"):""}`}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-1",children:H.map(((e,t)=>{if(!v)return null;return v[e]?s.jsx(ER,{tool:e,allTools:v,agent_id:C},`${e}-${t}-${C}`):null}))}),s.jsx("div",{className:"flex flex-col gap-1",children:(u??[]).filter((e=>e.agent_id===C)).map(((e,t)=>s.jsx(PI,{action:e,onClick:()=>{m(e),g(Xd.actions)}},t)))}),s.jsxs("div",{className:"mt-2 flex space-x-2",children:[(I??!1)&&s.jsx("button",{type:"button",onClick:()=>l(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_assistants_add_tools")})}),(R??!1)&&s.jsx("button",{type:"button",disabled:!C,onClick:F,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_assistants_add_actions")})})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_support_contact")})})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-name",children:s.jsx("span",{className:"text-sm",children:t("com_ui_support_contact_name")})}),s.jsx(Uo,{name:"support_contact.name",control:b,rules:{minLength:{value:3,message:t("com_ui_support_contact_name_min_length",{minLength:3})}},render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",className:n_(QR,n?"border-2 border-red-500":""),id:"support-contact-name",type:"text",placeholder:t("com_ui_support_contact_name_placeholder"),"aria-label":"Support contact name"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:n.message})]})})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-email",children:s.jsx("span",{className:"text-sm",children:t("com_ui_support_contact_email")})}),s.jsx(Uo,{name:"support_contact.email",control:b,rules:{validate:e=>Yb(e??"",t("com_ui_support_contact_email_invalid"))},render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",className:n_(QR,n?"border-2 border-red-500":""),id:"support-contact-email",type:"email",placeholder:t("com_ui_support_contact_email_placeholder"),"aria-label":"Support contact email"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:n.message})]})})]})]})]})]}),s.jsx(II,{isOpen:i,setIsOpen:l,endpoint:Uu.agents}),s.jsx(EI,{agentId:C,isOpen:c,mcpServerNames:G,setIsOpen:d,endpoint:Uu.agents})]})}const XR=new Set(Object.keys(am));function ZR({agentQuery:e,selectedAgentId:t=null,setCurrentAgentId:a,createMutation:r}){const o=Fk(),i=n.useRef(null),{control:l,reset:c}=Vo(),d=qk(),{data:u=null}=Ry({requiredPermission:d},{select:e=>e.data.map((e=>Yv({agent:{...e,name:e.name||e.id}})))}),m=n.useCallback((e=>{const t=e.isPublic??!1,n={...e,provider:qv(e.provider),label:e.name??"",value:e.id||"",icon:t?s.jsx(we,{className:"icon-lg text-green-400"}):null},a={[vf.web_search]:!1,[vf.file_search]:!1,[vf.execute_code]:!1,[vf.end_after_tools]:!1,[vf.hide_sequential_outputs]:!1},r=[];(e.tools??[]).forEach((e=>{void 0===a[e]?r.push(e):a[e]=!0}));const o={...a,agent:n,model:n.model,tools:r,category:e.category||"general",support_contact:e.support_contact};Object.entries(e).forEach((([e,t])=>{"model_parameters"!==e&&void 0===a[e]?"agent_ids"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))?o[e]=t:XR.has(e)&&("recursion_limit"!==e||"number"!=typeof t?"number"!=typeof t&&"object"!=typeof t&&(o[e]=t):o[e]=t):o[e]=t})),c(o)}),[c]),p=n.useCallback((t=>{const n=!!(t?(u??[]).find((e=>e.id===t)):void 0);if(r.reset(),!n)return a(void 0),c(Qv());a(t);const s=e.data;s?m(s):console.warn("Agent not found")}),[u,r,a,e.data,m,c]);n.useEffect((()=>{e.data&&e.isSuccess&&m(e.data)}),[e.data,e.isSuccess,m]),n.useEffect((()=>{let e=null;if(t!==i.current)return null!=t&&""!==t&&u&&(e=setTimeout((()=>{i.current=t,p(t)}),5)),()=>{e&&clearTimeout(e)}}),[t,u,p]);const f=o("com_ui_create")+" "+o("com_ui_agent");return s.jsx(Uo,{name:"agent",control:l,render:({field:e})=>{var t,n,a,r;return s.jsx(Fd,{containerClassName:"px-0",selectedValue:((null==(t=null==e?void 0:e.value)?void 0:t.value)??"")+"",displayValue:(null==(n=null==e?void 0:e.value)?void 0:n.label)??"",selectPlaceholder:(null==(a=null==e?void 0:e.value)?void 0:a.value)??f,iconSide:"right",searchPlaceholder:o("com_agents_search_name"),SelectIcon:null==(r=null==e?void 0:e.value)?void 0:r.icon,setValue:p,items:(null==u?void 0:u.map((e=>({label:e.name??"",value:e.id??"",icon:e.icon}))))??[{label:"Loading...",value:""}],className:n_("z-50 flex h-[40px] w-full flex-none items-center justify-center truncate rounded-md bg-transparent font-bold"),ariaLabel:o("com_ui_agent"),isCollapsed:!1,showCarat:!0})}})}function JR({principal:e,size:t="md",className:n}){const{avatar:a,type:r,name:o}=e,i=o||"Unknown",l={sm:"h-6 w-6",md:"h-8 w-8",lg:"h-10 w-10"}[t],c={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[t],{Icon:d,containerClass:u,iconClass:m}=(()=>{switch(r){case dx.USER:return{Icon:Gt,containerClass:"bg-blue-100 dark:bg-blue-900",iconClass:"text-blue-600 dark:text-blue-400"};case dx.GROUP:return{Icon:$e,containerClass:"bg-green-100 dark:bg-green-900",iconClass:"text-green-600 dark:text-green-400"};case dx.ROLE:return{Icon:Kt,containerClass:"bg-purple-100 dark:bg-purple-900",iconClass:"text-purple-600 dark:text-purple-400"};default:return{Icon:Gt,containerClass:"bg-surface-tertiary",iconClass:"text-text-secondary"}}})();return a?s.jsxs("div",{className:n_("flex-shrink-0",n),children:[s.jsx("img",{src:a,alt:`${i} avatar`,className:n_(l,"rounded-full object-cover"),onError:e=>{var t;const n=e.target;n.style.display="none",null==(t=n.nextElementSibling)||t.classList.remove("hidden")}}),s.jsx("div",{className:n_("hidden",l),children:s.jsx("div",{className:n_(l,"flex items-center justify-center rounded-full",u),children:s.jsx(d,{className:n_(c,m)})})})]}):s.jsx("div",{className:n_("flex-shrink-0",n),children:s.jsx("div",{className:n_(l,"flex items-center justify-center rounded-full",u),children:s.jsx(d,{className:n_(c,m)})})})}function eP({id:e,resourceType:t=mx.AGENT,selectedRoleId:n=fx.AGENT_VIEWER,onRoleChange:a,className:r=""}){const o=Fk(),[i,l]=S.useState(!1),{data:c,isLoading:d}=Ck(t),u=e=>{const t=Fb(e);return{name:o(t.name),description:o(t.description)}},m=null==c?void 0:c.find((e=>e.accessRoleId===n)),p=m?u(m.accessRoleId):null;if(d||!c)return s.jsx(Nl,{className:"h-10 w-24 rounded-lg"});const f=c.map((e=>{const t=u(e.accessRoleId);return{id:e.accessRoleId,label:t.name,onClick:()=>{a(e.accessRoleId),l(!1)},render:e=>s.jsx("button",{...e,children:s.jsxs("div",{className:"flex flex-col items-start gap-0.5 text-left",children:[s.jsx("span",{className:"font-medium text-text-primary",children:t.name}),s.jsx("span",{className:"text-xs text-text-secondary",children:t.description})]})})}}));return s.jsx("div",{className:r,id:e,children:s.jsx(wd,{menuId:"access-roles-menu",isOpen:i,setIsOpen:l,trigger:s.jsxs(ie,{"aria-label":(null==p?void 0:p.description)||"Select role",className:n_("flex items-center justify-between gap-2 rounded-xl border border-border-light bg-transparent px-3 py-2 text-sm transition-colors hover:bg-surface-tertiary"),children:[s.jsx("span",{className:"font-medium",children:(null==p?void 0:p.name)||o("com_ui_select")}),s.jsx(Pt,{className:"h-4 w-4 text-text-secondary"})]}),items:f,className:"w-[280px]"})})}const tP={[mx.AGENT]:"com_ui_agent",[mx.PROMPTGROUP]:"com_ui_prompt"};function nP({isPublic:e,publicRole:t,onPublicToggle:n,onPublicRoleChange:a,resourceType:r=mx.AGENT,className:o}){const i=Fk(),l=S.useCallback((e=>{n(e)}),[n]);return s.jsxs("div",{className:n_("space-y-4",o),children:[s.jsx("div",{className:"group relative rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:n_("transition-colors duration-200",e?"text-blue-600 dark:text-blue-500":"text-text-secondary"),children:s.jsx(Wt,{className:"size-5"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(dl,{htmlFor:"share-everyone-toggle",className:"cursor-pointer text-sm font-medium text-text-primary",children:i("com_ui_share_everyone")}),s.jsx(Md,{side:Li.Top,text:i("com_ui_share_everyone_description_var",{resource:i(tP[r])||i("com_ui_resource")})})]})]}),s.jsx(Cl,{id:"share-everyone-toggle",checked:e,onCheckedChange:l,"aria-label":i("com_ui_share_everyone")})]})}),s.jsx("div",{className:n_("transition-all duration-300 ease-in-out",e?"max-h-32 opacity-100":"max-h-0 opacity-0"),style:{overflow:e?"visible":"hidden"},children:s.jsx("div",{className:n_("rounded-lg transition-all duration-300",e?"bg-surface-secondary/50 translate-y-0":"-translate-y-2"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:n_("transition-all duration-300",e?"scale-100 text-blue-600 dark:text-blue-500":"scale-95 text-text-secondary"),children:s.jsx(Kt,{className:"size-5"})}),s.jsx("div",{className:"flex flex-col gap-0.5",children:s.jsx(dl,{htmlFor:"permission-level",className:"text-sm font-medium text-text-primary",children:i("com_ui_everyone_permission_level")})})]}),s.jsx("div",{className:n_("relative z-50 transition-all duration-300",e?"scale-100 opacity-100":"scale-95 opacity-0"),children:s.jsx(eP,{id:"permission-level",resourceType:r,selectedRoleId:t,onRoleChange:a})})]})})})]})}const sP=n.forwardRef((function({principal:e,className:t,style:n,onClick:a,...r},o){const i=Fk(),{name:l,email:c,type:d}=e,u=l||i("com_ui_unknown"),m=c||`${d} (${e.source||"local"})`,p=(()=>{switch(d){case dx.USER:return{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",label:i("com_ui_user")};case dx.GROUP:return{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",label:i("com_ui_group")};case dx.ROLE:return{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",label:i("com_ui_role")};default:return{className:"bg-surface-tertiary text-text-secondary",label:d}}})();return s.jsxs("div",{...r,ref:o,className:n_("flex items-center gap-3 p-2",t),style:n,onClick:e=>{null==a||a(e)},children:[s.jsx(JR,{principal:e,size:"md"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"truncate text-sm font-medium text-text-primary",children:u}),s.jsx("div",{className:"truncate text-xs text-text-secondary",children:m})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:n_("inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",p.className),children:p.label})})]})}));function aP({options:e,renderOptions:t,onPick:a,onQueryChange:r,query:o,label:i,isSmallScreen:l=!1,placeholder:c,resetValueOnHide:d=!1,isLoading:u=!1,minQueryLengthForNoResults:m=2}){const p=Fk(),[f,h]=n.useState(!1),g=n.useRef(null),[x,v]=n.useState(o),b=R({resetValueOnHide:d});n.useEffect((()=>{v(o)}),[o]);const _=n.useMemo((()=>ko((e=>{r(e)}),500)),[r]);n.useEffect((()=>()=>{_.cancel()}),[_]);return s.jsxs(G,{store:b,children:[s.jsx(K,{className:"mb-2 block font-medium text-text-primary",children:i}),s.jsx(s.Fragment,{children:s.jsxs("div",{className:n_("group relative flex h-10 cursor-pointer items-center gap-2 rounded-lg border-border-medium text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===l?"mb-2 h-14 rounded-2xl":""),children:[u?s.jsx(ac,{className:"absolute left-3 h-4 w-4"}):s.jsx(wt,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),s.jsx(z,{ref:g,onKeyDown:e=>{"Escape"===e.key&&b.getState().open&&(e.preventDefault(),e.stopPropagation(),v(""),r(""),_.cancel(),h(!1))},store:b,setValueOnClick:!1,setValueOnChange:!1,onChange:e=>{const t=e.target.value;v(t),_(t)},value:x,placeholder:c||p("com_ui_select_options"),className:"h-10 w-full rounded-lg bg-transparent pl-10 text-sm leading-tight text-text-primary placeholder-text-secondary placeholder-opacity-100 focus:outline-none focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary"})]})}),s.jsx(W,{portal:!1,gutter:8,sameWidth:!0,open:u||e.length>0||x.trim().length>=m&&!u,store:b,unmountOnHide:!0,autoFocusOnShow:!1,modal:!1,className:n_("animate-popover z-[9999] min-w-64 overflow-hidden rounded-2xl border border-border-light bg-surface-secondary shadow-lg","[pointer-events:auto]"),children:u?s.jsx("div",{className:"space-y-2 p-2",children:Array.from({length:3}).map(((e,t)=>s.jsxs("div",{className:"flex items-center gap-3 px-3 py-2",children:[s.jsx(Nl,{className:"h-8 w-8 rounded-full"}),s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsx(Nl,{className:"h-4 w-3/4"}),s.jsx(Nl,{className:"h-3 w-1/2"})]})]},t)))}):e.length>0?e.map((e=>s.jsx(B,{focusOnHover:!0,value:e.value,selectValueOnClick:!1,onClick:()=>{return t=e,v(""),r(""),a(t),h(!1),void(g.current&&g.current.focus());var t},className:n_("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:t(e)},e.key))):x.trim().length>=m?s.jsx("div",{className:n_("flex items-center justify-center px-4 py-8 text-center","text-sm text-text-secondary"),children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(wt,{className:"h-8 w-8 text-text-tertiary opacity-50"}),s.jsx("div",{className:"font-medium",children:p("com_ui_no_results_found")}),s.jsx("div",{className:"text-xs text-text-tertiary",children:p("com_ui_try_adjusting_search")})]})}):null})]})}function rP({onAddPeople:e,placeholder:t,className:a="",typeFilter:r=null,excludeIds:o=[]}){const i=Fk(),[l,c]=n.useState(""),d=n.useMemo((()=>({q:l,limit:30,...r&&r.length>0&&{types:r}})),[l,r]),{data:u,isLoading:m,error:p}=Nk(d,{enabled:l.length>=2}),f=l.length>=2&&m,h=n.useMemo((()=>((null==u?void 0:u.results)||[]).filter((e=>e.idOnTheSource&&!o.includes(e.idOnTheSource)))),[null==u?void 0:u.results,o]);p&&console.error("Principal search error:",p);return s.jsx("div",{className:`${a}`,children:s.jsx(aP,{options:h.map((e=>({...e,id:e.id??void 0,key:e.idOnTheSource||"unknownpicker_key",value:e.idOnTheSource||"Unknown"}))),renderOptions:e=>s.jsx(sP,{principal:e}),placeholder:t||i("com_ui_search_default_placeholder"),query:l,onQueryChange:e=>{c(e)},onPick:t=>{e([t])},isLoading:f,label:""})})}const oP=({control:e,peoplePickerPerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Uo,{name:t,control:e,render:({field:e})=>s.jsx(Cl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),iP=()=>{const e=Fk(),{showToast:t}=Bd(),{user:a,roles:r}=Kk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(ax.partial().parse(e.updates),Rx.updatePeoplePickerPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([xx.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update people picker permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Qg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[hg.PEOPLE_PICKER]:gx[d].permissions[hg.PEOPLE_PICKER]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=zo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[hg.PEOPLE_PICKER];p(n||gx[d].permissions[hg.PEOPLE_PICKER])}),[r,d,p]),(null==a?void 0:a.role)!==Qg.ADMIN)return null;const b=[{peoplePickerPerm:gg.VIEW_USERS,label:e("com_ui_people_picker_allow_view_users")},{peoplePickerPerm:gg.VIEW_GROUPS,label:e("com_ui_people_picker_allow_view_groups")},{peoplePickerPerm:gg.VIEW_ROLES,label:e("com_ui_people_picker_allow_view_roles")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Qg.USER,onClick:()=>{u(Qg.USER)}},{label:Qg.ADMIN,onClick:()=>{u(Qg.ADMIN)}}];return s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{variant:"outline",className:"btn btn-neutral border-token-border-light relative gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(gl,{className:"w-full border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(bl,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_people_picker")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(wd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({peoplePickerPerm:e,label:t})=>s.jsx("div",{children:s.jsx(oP,{control:f,peoplePickerPerm:e,label:t,getValues:g,setValue:h})},e)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})};function lP({principles:e,onRemoveHandler:t,className:n="",onRoleChange:a,resourceType:r=mx.AGENT}){const o=Fk(),i=Ki("(max-width: 768px)");return 0===e.length?s.jsx("div",{className:`space-y-3 ${n}`,children:s.jsxs("div",{className:"rounded-lg border border-dashed border-border-medium py-8 text-center text-muted-foreground",children:[s.jsx($e,{className:"mx-auto mb-2 h-8 w-8 opacity-50"}),s.jsx("p",{className:"mt-1 text-xs",children:o("com_ui_search_above_to_add_all")})]})}):s.jsx("div",{className:`space-y-3 ${n}`,children:s.jsx("div",{className:"space-y-2",children:e.map((e=>{const{displayName:n,subtitle:l}={displayName:(c=e).name||o("com_ui_unknown"),subtitle:i?`${c.type} (${c.source||"local"})`:c.email||`${c.type} (${c.source||"local"})`};var c;return s.jsxs("div",{className:"bg-surface flex items-center justify-between rounded-2xl border border-border p-3",children:[s.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[s.jsx(JR,{principal:e,size:"md"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"truncate text-sm font-medium",children:n}),s.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[s.jsx("span",{children:l}),"entra"===e.source&&s.jsxs(s.Fragment,{children:[s.jsx(qt,{className:"h-3 w-3"}),s.jsx("span",{children:o("com_ui_azure_ad")})]})]})]})]}),s.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[!!e.accessRoleId&&!!a&&s.jsx(eP,{resourceType:r,selectedRoleId:e.accessRoleId,onRoleChange:t=>{null==a||a(e.idOnTheSource,t)},className:"min-w-0"}),s.jsx(ki,{variant:"outline",onClick:()=>t(e.idOnTheSource),className:"h-9 w-9 p-0 hover:border-destructive/10 hover:bg-destructive/10 hover:text-destructive","aria-label":o("com_ui_remove_user",{0:n}),children:s.jsx(vt,{className:"h-4 w-4"})})]})]},e.idOnTheSource+"-principalList")}))})})}function cP({resourceName:e,resourceDbId:t,resourceId:a,resourceType:r,onGrantAccess:o,disabled:i=!1,children:l}){const c=Fk(),{showToast:d}=Bd(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),{hasPeoplePickerAccess:h,peoplePickerTypeFilter:g}=cT(),{config:x,permissionsData:v,isLoadingPermissions:b,permissionsError:_,updatePermissionsMutation:y,currentShares:j,currentIsPublic:w,currentPublicRole:N,isPublic:C,setIsPublic:k,publicRole:S,setPublicRole:E}=dT(r,t,u),[T,I]=n.useState([]),[R,P]=n.useState(!1),[A,M]=n.useState(null==x?void 0:x.defaultViewerRoleId);n.useEffect((()=>{if(v&&u){const e=v.principals||[];I(e.map((e=>({...e,isExisting:!0})))),P(!1)}}),[v,u]);const L=(null==x?void 0:x.getResourceUrl)?null==x?void 0:x.getResourceUrl(a||""):"",O=qE({text:L});if(!t)return null;if(!x)return console.error(`Unsupported resource type: ${r}`),null;const D=e=>{I(T.filter((t=>t.idOnTheSource!==e))),P(!0)},F=j.length+(w?1:0),z=T.some((e=>e.accessRoleId===(null==x?void 0:x.defaultOwnerRoleId)))||C&&S===(null==x?void 0:x.defaultOwnerRoleId),U=R||(C!==w||S!==N);if(_)return s.jsx("div",{className:"text-sm text-red-600",children:c("com_ui_permissions_failed_load")});const V=l||s.jsx(ki,{size:"sm",variant:"outline","aria-label":c("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)}),type:"button",disabled:i,children:s.jsxs("div",{className:"flex min-w-[32px] items-center justify-center gap-2 text-blue-500",children:[s.jsx("span",{className:"flex h-6 w-6 items-center justify-center",children:s.jsx(Qt,{className:"icon-md h-4 w-4"})}),F>0&&s.jsx(dl,{className:"text-sm font-medium text-text-secondary",children:F})]})});return s.jsxs(ul,{open:u,onOpenChange:m,modal:!0,children:[s.jsx(ml,{asChild:!0,children:V}),s.jsxs(gl,{className:"max-h-[90vh] w-11/12 overflow-y-auto md:max-w-3xl",children:[s.jsx(bl,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($e,{className:"h-5 w-5"}),c("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)})]})}),s.jsxs("div",{className:"space-y-6 p-2",children:[s.jsx("div",{className:"space-y-4",children:h&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-text-primary",children:[s.jsx(Yt,{className:"h-4 w-4"}),c("com_ui_user_group_permissions")," ( ",T.length," )"]}),s.jsx(rP,{onAddPeople:e=>{const t=e.filter((e=>!T.some((t=>t.idOnTheSource===e.idOnTheSource)))).map((e=>({...e,accessRoleId:A||(null==x?void 0:x.defaultViewerRoleId),isExisting:!1})));I((e=>[...e,...t])),P(!0)},placeholder:c("com_ui_search_people_placeholder"),typeFilter:g,excludeIds:T.map((e=>e.idOnTheSource))}),b?s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(Nl,{className:"h-[62px] w-full rounded-lg"}),s.jsx(Nl,{className:"h-[62px] w-full rounded-lg"})]}):0!==T.length||R?s.jsxs("div",{className:"space-y-2",children:[!z&&R&&s.jsx("div",{className:"rounded-lg border border-destructive/30 bg-destructive/10 p-3 text-center",children:s.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-red-600 dark:text-red-400",children:[s.jsx(Xt,{className:"h-4 w-4"}),c("com_ui_at_least_one_owner_required")]})}),s.jsx(lP,{principles:T,onRemoveHandler:D,resourceType:r,onRoleChange:(e,t)=>((e,t)=>{I(T.map((n=>n.idOnTheSource===e?{...n,accessRoleId:t}:n))),P(!0)})(e,t)})]}):s.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border-light p-8 text-center",children:[s.jsx($e,{className:"mx-auto h-8 w-8 text-text-primary"}),s.jsx("p",{className:"mt-2 text-sm text-text-primary",children:c("com_ui_no_individual_access")}),s.jsx("p",{className:"mt-1 text-xs text-text-primary",children:c("com_ui_search_above_to_add_people")})]})]})}),s.jsx("div",{className:"flex border-t border-border-light"}),s.jsx(nP,{isPublic:C,publicRole:S,onPublicToggle:e=>{k(e),P(!0),e||E(null==x?void 0:x.defaultViewerRoleId)},onPublicRoleChange:e=>{E(e),P(!0)},resourceType:r}),s.jsxs("div",{className:"flex justify-between pt-4",children:[s.jsx("div",{className:"flex gap-2",children:a&&L&&s.jsx(ki,{variant:"outline",onClick:()=>{p||(O(f),d({message:c("com_ui_agent_url_copied"),status:"success"}))},disabled:p,className:n_("shrink-0",p?"cursor-default":""),"aria-label":c("com_ui_copy_url_to_clipboard"),title:p?null==x?void 0:x.getCopyUrlMessage():c("com_ui_copy_url_to_clipboard"),children:p?s.jsx(ft,{className:"h-4 w-4"}):s.jsx(Zt,{className:"h-4 w-4"})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(iP,{}),s.jsx(fl,{asChild:!0,children:s.jsx(ki,{variant:"outline",onClick:()=>{const e=(null==v?void 0:v.principals)||[];I(e.map((e=>({...e,isExisting:!0})))),M(null==x?void 0:x.defaultViewerRoleId),k(w),E(N||(null==x?void 0:x.defaultViewerRoleId)||""),P(!1),m(!1)},children:c("com_ui_cancel")})}),s.jsx(ki,{onClick:async()=>{if(T.length||C||R)try{const e=new Map(j.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),n=new Map(T.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),s=T.filter((t=>{const n=`${t.type}-${t.idOnTheSource}`,s=e.get(n);return!s||s.accessRoleId!==t.accessRoleId})),a=j.filter((e=>{const t=`${e.type}-${e.idOnTheSource}`;return!n.has(t)}));await y.mutateAsync({resourceType:r,resourceId:t,data:{updated:s,removed:a,public:C,publicAccessRoleId:C?S:void 0}}),o&&o(T,C,S),d({message:c("com_ui_permissions_updated_success"),status:"success"}),P(!1)}catch(e){console.error("Error updating permissions:",e),d({message:c("com_ui_permissions_failed_update"),status:"error"})}},disabled:y.isLoading||!U||R&&!z,className:"min-w-[120px]",children:y.isLoading?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ac,{className:"h-4 w-4"}),c("com_ui_saving")]}):c("com_ui_save_changes")})]})]})]})]})]})}const dP=({setActivePanel:e})=>{const t=Fk();return s.jsxs(ki,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(Xd.advanced),children:[s.jsx(Jt,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_advanced")]})},uP=({setActivePanel:e})=>{const t=Fk();return s.jsxs(ki,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(Xd.version),children:[s.jsx(en,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_agent_version")]})};function mP({agent_id:e}){const t=Fk(),{showToast:n}=Bd(),a=zy({onSuccess:()=>{n({message:t("com_ui_agent_duplicated"),status:"success"})},onError:e=>{console.error(e),n({message:t("com_ui_agent_duplicate_error"),status:"error"})}});if(!e)return null;return s.jsx(ki,{size:"sm",variant:"outline","aria-label":t("com_ui_duplicate")+" "+t("com_ui_agent"),type:"button",onClick:()=>{a.mutate({agent_id:e})},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-primary",children:s.jsx(ht,{className:"size-4"})})})}const pP=({control:e,agentPerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Uo,{name:t,control:e,render:({field:e})=>s.jsx(Cl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),fP=()=>{const e=Fk(),{showToast:t}=Bd(),{user:a,roles:r}=Kk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Yg.partial().parse(e.updates),Rx.updateAgentPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([xx.roles,n.roleName]),null!=s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),null!=a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Qg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[hg.AGENTS]:gx[d].permissions[hg.AGENTS]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=zo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[hg.AGENTS];p(n||gx[d].permissions[hg.AGENTS])}),[r,d,p]),(null==a?void 0:a.role)!==Qg.ADMIN)return null;const b=[{agentPerm:gg.SHARED_GLOBAL,label:e("com_ui_agents_allow_share")},{agentPerm:gg.CREATE,label:e("com_ui_agents_allow_create")},{agentPerm:gg.USE,label:e("com_ui_agents_allow_use")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Qg.USER,onClick:()=>{u(Qg.USER)}},{label:Qg.ADMIN,onClick:()=>{u(Qg.ADMIN)}}];return s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(gl,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(bl,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_agents")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(wd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({agentPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(pP,{control:f,agentPerm:t,label:n,getValues:g,setValue:h}),d===Qg.ADMIN&&t===gg.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})};function hP({agent_id:e,setCurrentAgentId:t,createMutation:n}){const a=Fk(),{reset:r}=Vo(),{showToast:o}=Bd(),{conversation:i}=Pk(),{setOption:l}=lE(),c=Fy({onSuccess:(e,s,c)=>{var d;const u=c;if(!u)return;o({message:a("com_ui_agent_deleted"),status:"success"}),(null==(d=n.data)?void 0:d.id)&&(s_.log("agents","resetting createMutation"),n.reset());const m=u[0];if(!m)return t(void 0),r(Qv()),l("agent_id")("");if(s.agent_id===(null==i?void 0:i.agent_id))return l("model")(""),l("agent_id")(m.id);const p=u.find((e=>e.id===(null==i?void 0:i.agent_id)));p&&t(p.id),t(m.id)},onError:e=>{console.error(e),o({message:a("com_ui_agent_delete_error"),status:"error"})}});return e?s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{size:"sm",variant:"outline","aria-label":a("com_ui_delete")+" "+a("com_ui_agent"),type:"button",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:s.jsx(kc,{})})})}),s.jsx(zd,{title:a("com_ui_delete")+" "+a("com_ui_agent"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(dl,{htmlFor:"delete-agent",className:"text-left text-sm font-medium",children:a("com_ui_delete_agent_confirm")})})})}),selection:{selectHandler:()=>c.mutate({agent_id:e}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:a("com_ui_delete")}})]}):null}function gP({activePanel:e,createMutation:t,updateMutation:n,setActivePanel:a,setCurrentAgentId:r}){const o=Fk(),{user:i}=Kk(),l=Vo(),{control:c}=l,d=$o({control:c,name:"agent"}),u=$o({control:c,name:"id"}),m=Wk({permissionType:hg.AGENTS,permission:gg.SHARED_GLOBAL}),{hasPermission:p,isLoading:f}=IT(mx.AGENT,(null==d?void 0:d._id)||""),h=p(px.SHARE),g=p(px.DELETE),x=e===Xd.builder;return s.jsxs("div",{className:"mb-1 flex w-full flex-col gap-2",children:[x&&s.jsx(dP,{setActivePanel:a}),x&&u&&s.jsx(uP,{setActivePanel:a}),(null==i?void 0:i.role)===Qg.ADMIN&&x&&s.jsx(fP,{}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[((null==d?void 0:d.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===Qg.ADMIN||g)&&!f&&s.jsx(hP,{agent_id:u,setCurrentAgentId:r,createMutation:t}),((null==d?void 0:d.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===Qg.ADMIN||h)&&m&&!f&&s.jsx(cP,{resourceDbId:null==d?void 0:d._id,resourceId:u,resourceName:(null==d?void 0:d.name)??"",resourceType:mx.AGENT}),d&&d.author===(null==i?void 0:i.id)&&s.jsx(mP,{agent_id:u}),s.jsx("button",{className:"btn btn-primary focus:shadow-outline flex h-9 w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",disabled:t.isLoading||n.isLoading,"aria-busy":t.isLoading||n.isLoading,children:t.isLoading||n.isLoading?s.jsx(ac,{className:"icon-md","aria-hidden":"true"}):o(u?"com_ui_save":"com_ui_create")})]})]})}function xP({providers:e,setActivePanel:t,models:a}){const r=Fk(),{control:o,setValue:i}=Vo(),l=$o({control:o,name:"model"}),c=$o({control:o,name:"provider"}),d=$o({control:o,name:"model_parameters"}),u=n.useMemo((()=>("string"==typeof c?c:null==c?void 0:c.value)??""),[c]),m=n.useMemo((()=>u?a[u]??[]:[]),[a,u]);n.useEffect((()=>{const e=l??"";if(u&&e){if(!m.includes(e)){const e=a[u]??[];i("model",e[0]??"")}localStorage.setItem(Eh.LAST_AGENT_MODEL,e),localStorage.setItem(Eh.LAST_AGENT_PROVIDER,u)}u&&!e&&i("model",m[0]??"")}),[u,m,a,i,l]);const{data:p={}}=Gy(),f=n.useMemo((()=>{var e;return(null==(e=null==p?void 0:p[u])?void 0:e.availableRegions)??[]}),[p,u]),h=n.useMemo((()=>kb(p,u,"type")),[u,p]),g=n.useMemo((()=>{var e,t,n;const s=(null==(e=p[u])?void 0:e.customParams)??{},[a,r]=Qu(h??u,l??""),o=s.defaultParamsEndpoint??r,i=Tv[a]??Tv[o]??[],c=(null==(n=null==(t=p[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],d=To(c,"key");return i.filter((e=>null!=e)).map((e=>d[e.key]??e))}),[h,p,l,u]),x=e=>t=>{i(`model_parameters.${e}`,t)};return s.jsxs("div",{className:"mx-1 mb-1 flex h-full min-h-[50vh] w-full flex-col gap-2 text-sm",children:[s.jsxs("div",{className:"model-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{t(Xd.builder)},children:s.jsx("div",{className:"model-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:r("com_ui_model_parameters")})]}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{id:"provider-label",className:"text-token-text-primary model-panel-label mb-2 block font-medium",htmlFor:"provider",children:[r("com_ui_provider")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Uo,{name:"provider",control:o,rules:{required:!0,minLength:1},render:({field:t,fieldState:{error:n}})=>{var a,o;const i="string"==typeof t.value?t.value:(null==(a=t.value)?void 0:a.value)??"",l="string"==typeof t.value?t.value:(null==(o=t.value)?void 0:o.label)??"";return s.jsxs(s.Fragment,{children:[s.jsx(Fd,{selectedValue:i,displayValue:uh[l]??l,selectPlaceholder:r("com_ui_select_provider"),searchPlaceholder:r("com_ui_select_search_provider"),setValue:t.onChange,items:e.map((e=>({label:"string"==typeof e?e:e.label,value:"string"==typeof e?e:e.value}))),className:n_(n?"border-2 border-red-500":""),ariaLabel:r("com_ui_provider"),isCollapsed:!1,showCarat:!0}),n&&s.jsx("span",{className:"model-panel-error text-sm text-red-500 transition duration-300 ease-in-out",children:r("com_ui_field_required")})]})}})]}),s.jsxs("div",{className:"model-panel-section mb-4",children:[s.jsxs("label",{id:"model-label",className:n_("text-token-text-primary model-panel-label mb-2 block font-medium",!u&&"text-gray-500 dark:text-gray-400"),htmlFor:"model",children:[r("com_ui_model")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Uo,{name:"model",control:o,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:t}})=>s.jsxs(s.Fragment,{children:[s.jsx(Fd,{selectedValue:e.value||"",selectPlaceholder:r(u?"com_ui_select_model":"com_ui_select_provider_first"),searchPlaceholder:r("com_ui_select_model"),setValue:e.onChange,items:m.map((e=>({label:e,value:e}))),disabled:!u,className:n_("disabled:opacity-50",t?"border-2 border-red-500":""),ariaLabel:r("com_ui_model"),isCollapsed:!1,showCarat:!0}),u&&t&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:r("com_ui_field_required")})]})})]})]}),g&&s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-2",children:s.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.map((e=>{const t=XI[e.component];if(!t)return null;const{key:n,default:a,...r}=e;return"region"===n&&f.length&&(r.options=f),s.jsx(t,{settingKey:n,defaultValue:a,...r,setOption:x,conversation:d},n)}))})}),s.jsxs("button",{type:"button",onClick:()=>{i("model_parameters",{})},className:"btn btn-neutral my-1 flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[s.jsx(tn,{className:"h-4 w-4","aria-hidden":"true"}),r("com_ui_reset_var",{0:r("com_ui_model_parameters")})]})]})}function vP(){var e,t;const a=Fk(),{user:r}=Kk(),{showToast:o}=Bd(),{activePanel:i,agentsConfig:l,setActivePanel:c,endpointsConfig:d,setCurrentAgentId:u,agent_id:m}=Zk(),{onSelect:p}=function(){const e=pr(),t=Ik(),{conversation:s,newConversation:a}=Pk(),r=Dk(),[o,i]=n.useState((null==s?void 0:s.agent_id)??null),l=Py(o??"",{enabled:!!o&&o!==Sh.EPHEMERAL_AGENT_ID}),c=n.useCallback(((e,n)=>{if(s_.log("conversation","Updating conversation with agent",e),Yu(null==s?void 0:s.endpoint))return void a({template:{...n},preset:n});const r=t({conversation:{...s??{},agent_id:e.id},preset:n});a({template:r,preset:n,keepLatestMessage:!0})}),[s,t,a]);return{onSelect:n.useCallback((async t=>{const n=null==r?void 0:r[t];if(!n)return;i(n.id);const s={endpoint:Uu.agents,agent_id:n.id,conversationId:Sh.NEW_CONVO};c({id:n.id},s);try{await e.invalidateQueries({queryKey:[xx.agent,n.id],exact:!0,refetchType:"active"},{throwOnError:!0});const{data:t}=await l.refetch();t&&c(t,{...s,agent_id:t.id})}catch(a){if(null==a?void 0:a.silent)return void console.warn("Current fetch was cancelled");console.error("Error fetching full agent data:",a),c({},{...s,agent_id:void 0})}}),[r,c,e,l])}}(),f=mk(),h=Py(m??"",{enabled:!!m&&m!==Sh.EPHEMERAL_AGENT_ID}),{hasPermission:g,isLoading:x}=IT(mx.AGENT,(null==(e=h.data)?void 0:e._id)||""),v=g(px.EDIT),b=Ay(m??"",{enabled:!!m&&m!==Sh.EPHEMERAL_AGENT_ID&&v&&!x}),_=v&&b.data?b:h,y=n.useMemo((()=>f.data??{}),[f.data]),j=zo({defaultValues:Qv(),mode:"onChange"}),{control:w,handleSubmit:N,reset:C}=j,k=$o({control:w,name:"id"}),S=n.useRef(),E=n.useMemo((()=>new Set(null==l?void 0:l.allowedProviders)),[null==l?void 0:l.allowedProviders]),T=n.useMemo((()=>Object.keys(d??{}).filter((e=>!Yu(e)&&(!(E.size>0)||E.has(e))&&e!==Uu.agents&&e!==Uu.chatGPTBrowser&&e!==Uu.gptPlugins)).map((e=>qv(e)))),[d,E]),I=Dy({onMutate:()=>{var e;S.current=null==(e=_.data)?void 0:e.version},onSuccess:e=>{void 0!==S.current&&e.version===S.current?o({message:a("com_ui_no_changes"),status:"info"}):o({message:`${a("com_assistants_update_success")} ${e.name??a("com_ui_agent")}`}),S.current=void 0},onError:e=>{const t=e;o({message:`${a("com_agents_update_error")}${t.message?` ${a("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),R=Oy({onSuccess:e=>{u(e.id),o({message:`${a("com_assistants_create_success")} ${e.name??a("com_ui_agent")}`})},onError:e=>{const t=e;o({message:`${a("com_agents_create_error")}${t.message?` ${a("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),P=n.useCallback((e=>{const t=e.tools??[];!0===e.execute_code&&t.push(hu.execute_code),!0===e.file_search&&t.push(hu.file_search),!0===e.web_search&&t.push(hu.web_search);const{name:n,artifacts:s,description:r,instructions:i,model:l,model_parameters:c,provider:d,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}=e,x=l??"",v=("string"==typeof d?d:d.value)??"";if(!k)return v&&x?n?void R.mutate({name:n,artifacts:s,description:r,instructions:i,model:x,tools:t,provider:v,model_parameters:c,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}):o({message:a("com_agents_missing_name"),status:"error"}):o({message:a("com_agents_missing_provider_model"),status:"error"});I.mutate({agent_id:k,data:{name:n,artifacts:s,description:r,instructions:i,model:x,tools:t,provider:v,model_parameters:c,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}})}),[k,R,I,o,a]),A=n.useCallback((()=>{k&&p(k)}),[k,p]),M=n.useMemo((()=>{var e;return!(null==(e=_.data)?void 0:e.id)||((null==r?void 0:r.role)===Qg.ADMIN||v)}),[null==(t=_.data)?void 0:t.id,null==r?void 0:r.role,v]);return s.jsx(Bo,{...j,children:s.jsxs("form",{onSubmit:N(P),className:"scrollbar-gutter-stable h-auto w-full flex-shrink-0 overflow-x-hidden","aria-label":"Agent configuration form",children:[s.jsxs("div",{className:"mx-1 mt-2 flex w-full flex-wrap gap-2",children:[s.jsx("div",{className:"w-full",children:s.jsx(ZR,{createMutation:R,agentQuery:_,setCurrentAgentId:u,selectedAgentId:_.isInitialLoading?null:m??null})}),k&&s.jsxs("div",{className:"flex w-full gap-2",children:[s.jsxs(ki,{type:"button",variant:"outline",className:"w-full justify-center",onClick:()=>{C(Qv()),u(void 0)},disabled:_.isInitialLoading,children:[s.jsx(kt,{className:"mr-1 h-4 w-4"}),a("com_ui_create")+" "+a("com_ui_new")+" "+a("com_ui_agent")]}),s.jsx(ki,{variant:"submit",disabled:!k||_.isInitialLoading,onClick:e=>{e.preventDefault(),A()},"aria-label":a("com_ui_select")+" "+a("com_ui_agent"),children:a("com_ui_select")})]})]}),_.isInitialLoading&&s.jsx(lI,{}),!M&&!_.isInitialLoading&&s.jsx("div",{className:"flex h-[30vh] w-full items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-token-text-primary m-2 text-xl font-semibold",children:a("com_agents_not_available")}),s.jsx("p",{className:"text-token-text-secondary",children:a("com_agents_no_access")})]})}),M&&!_.isInitialLoading&&i===Xd.model&&s.jsx(xP,{models:y,providers:T,setActivePanel:c}),M&&!_.isInitialLoading&&i===Xd.builder&&s.jsx(YR,{createMutation:R}),M&&!_.isInitialLoading&&i===Xd.advanced&&s.jsx(yI,{}),M&&!_.isInitialLoading&&s.jsx(gP,{createMutation:R,updateMutation:I,activePanel:i,setActivePanel:c,setCurrentAgentId:u})]})})}const bP={type:gp.None,saved_auth_fields:!1,api_key:"",authorization_type:xp.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:vp.DefaultPost,name:"",description:"",url:"",tools:[],icon:"",trust:!1};function _P(){const e=zo({defaultValues:{type:gp.None,saved_auth_fields:!1,api_key:"",authorization_type:xp.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:vp.DefaultPost}}),{watch:t,setValue:a}=e,r=t("type");return n.useEffect((()=>{"none"===r&&(a("api_key",""),a("authorization_type",xp.Basic),a("custom_auth_header",""),a("oauth_client_id",""),a("oauth_client_secret",""),a("authorization_url",""),a("client_url",""),a("scope",""),a("token_exchange_method",vp.DefaultPost))}),[r,a]),s.jsx(Bo,{...e,children:s.jsx(ZT,{})})}function yP({icon:e,onIconChange:t}){const[a,r]=n.useState(""),o=n.useRef(null),i=Fk();n.useEffect((()=>{r(e||"")}),[e]);return s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{onClick:()=>{o.current&&(o.current.value="",o.current.click())},className:"bg-token-surface-secondary dark:bg-token-surface-tertiary border-token-border-medium flex h-16 w-16 shrink-0 cursor-pointer items-center justify-center rounded-[1.5rem] border-2 border-dashed",children:a?s.jsx("img",{src:a,className:"h-full w-full rounded-[1.5rem] object-cover",alt:"MCP Icon",width:"64",height:"64"}):s.jsx(Zc,{})}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"token-text-secondary text-sm",children:[i("com_ui_icon")," ",i("com_ui_optional")]}),s.jsx("span",{className:"token-text-tertiary text-xs",children:i("com_agents_mcp_icon_size")})]}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:t,ref:o})]})}function jP({mcp:e,agent_id:t,setMCP:a}){const r=Fk(),{showToast:o}=Bd(),{handleSubmit:i,register:l,formState:{errors:c},control:d}=Vo(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),[h,g]=n.useState([]);n.useEffect((()=>{(null==e?void 0:e.mcp_id)&&e.metadata.tools&&(f(!0),g(e.metadata.tools))}),[e]);const x=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,metadata:s,agent_id:a})=>{try{e(["success",{mcp_id:n,metadata:s,agent_id:a}])}catch(r){t(r)}},isLoading:!1}}({onSuccess(e){o({message:r("com_ui_update_mcp_success"),status:"success"}),a(e[1]),f(!0),g(e[1].metadata.tools??[]),m(!1)},onError(e){o({message:e.message||r("com_ui_update_mcp_error"),status:"error"}),m(!1)}}),v=i((async n=>{m(!0);try{const s=await x.mutate({agent_id:t??"",mcp_id:null==e?void 0:e.mcp_id,metadata:{...n,tools:h}});a(s[1]),o({message:r("com_ui_update_mcp_success"),status:"success"})}catch{o({message:r("com_ui_update_mcp_error"),status:"error"})}finally{m(!1)}}));return s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"mb-4",children:s.jsx(yP,{icon:null==e?void 0:e.metadata.icon,onIconChange:n=>{var s;const r=null==(s=n.target.files)?void 0:s[0];if(r){const n=new FileReader;n.onloadend=()=>{const s=n.result;a({mcp_id:(null==e?void 0:e.mcp_id)??"",agent_id:t??"",metadata:{...null==e?void 0:e.metadata,icon:s}})},n.readAsDataURL(r)}}})}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(dl,{htmlFor:"name",children:r("com_ui_name")}),s.jsx("input",{id:"name",...l("name",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:r("com_agents_mcp_name_placeholder")}),c.name&&s.jsx("span",{className:"text-xs text-red-500",children:r("com_ui_field_required")})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs(dl,{htmlFor:"description",children:[r("com_ui_description"),s.jsx("span",{className:"ml-1 text-xs text-text-secondary-alt",children:r("com_ui_optional")})]}),s.jsx("input",{id:"description",...l("description"),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:r("com_agents_mcp_description_placeholder")})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(dl,{htmlFor:"url",children:r("com_ui_mcp_url")}),s.jsx("input",{id:"url",...l("url",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:"https://mcp.example.com"}),c.url&&s.jsx("span",{className:"text-xs text-red-500",children:"required"===c.url.type?r("com_ui_field_required"):c.url.message})]}),s.jsx(_P,{}),s.jsxs("div",{className:"my-2 flex items-center gap-2",children:[s.jsx(Uo,{name:"trust",control:d,rules:{required:!0},render:({field:e})=>s.jsx(Si,{id:"trust",checked:e.value,onCheckedChange:e.onChange})}),s.jsxs(dl,{htmlFor:"trust",className:"flex flex-col",children:[r("com_ui_trust_app"),s.jsx("span",{className:"text-xs text-text-secondary",children:r("com_agents_mcp_trust_subtext")})]})]}),c.trust&&s.jsx("span",{className:"text-xs text-red-500",children:r("com_ui_field_required")})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{onClick:v,disabled:u,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:u?s.jsx(ac,{className:"icon-md"}):(null==e?void 0:e.mcp_id)?r("com_ui_update"):r("com_ui_create")})}),p&&(null==e?void 0:e.metadata.tools)&&s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-token-text-primary block font-medium",children:r("com_ui_available_tools")}),s.jsx("button",{onClick:()=>{var t;h.length===(null==(t=null==e?void 0:e.metadata.tools)?void 0:t.length)?g([]):(null==e?void 0:e.metadata.tools)&&g(e.metadata.tools)},type:"button",className:"btn btn-neutral border-token-border-light relative h-8 rounded-full px-4 font-medium",children:h.length===e.metadata.tools.length?r("com_ui_deselect_all"):r("com_ui_select_all")})]}),s.jsx("div",{className:"flex flex-col gap-2",children:e.metadata.tools.map((e=>s.jsxs("label",{htmlFor:e,className:"border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2",children:[s.jsx(Si,{id:e,checked:h.includes(e),onCheckedChange:()=>(e=>{g((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))})(e),className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer"}),s.jsx("span",{className:"text-token-text-primary",children:e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")})]},e)))})]})]})}function wP(){const e=Fk(),{showToast:t}=Bd(),{mcp:a,setMcp:r,agent_id:o,setActivePanel:i}=Zk(),l=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,agent_id:s})=>{try{console.log("Mock delete MCP:",{mcp_id:n,agent_id:s}),e()}catch(a){t(a)}}}}({onSuccess:()=>{t({message:e("com_ui_delete_mcp_success"),status:"success"}),i(Xd.builder),r(void 0)},onError(n){t({message:n.message??e("com_ui_delete_mcp_error"),status:"error"})}}),c=zo({defaultValues:bP,mode:"onChange"}),{reset:d}=c;return n.useEffect((()=>{if(a){const e={icon:a.metadata.icon??"",name:a.metadata.name??"",description:a.metadata.description??"",url:a.metadata.url??"",tools:a.metadata.tools??[],trust:a.metadata.trust??!1};a.metadata.auth&&Object.assign(e,{type:a.metadata.auth.type||gp.None,saved_auth_fields:!1,api_key:a.metadata.api_key??"",authorization_type:a.metadata.auth.authorization_type||xp.Basic,oauth_client_id:a.metadata.oauth_client_id??"",oauth_client_secret:a.metadata.oauth_client_secret??"",authorization_url:a.metadata.auth.authorization_url??"",client_url:a.metadata.auth.client_url??"",scope:a.metadata.auth.scope??"",token_exchange_method:a.metadata.auth.token_exchange_method??vp.DefaultPost}),d(e)}}),[a,d]),s.jsx(Bo,{...c,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{i(Xd.builder),r(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!a&&s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:!o||!a.mcp_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(kc,{className:"text-red-500"})})})}),s.jsx(zd,{showCloseButton:!1,title:e("com_ui_delete_mcp"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:e("com_ui_delete_mcp_confirm")}),selection:{selectHandler:()=>{if(!o)return t({message:e("com_agents_no_agent_id_error"),status:"error"});l.mutate({mcp_id:a.mcp_id,agent_id:o})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:e(a?"com_ui_edit_mcp_server":"com_ui_add_mcp_server")}),s.jsx("div",{className:"text-xs text-text-secondary",children:e("com_agents_mcp_info")})]}),s.jsx(jP,{mcp:a,agent_id:o,setMCP:r})]})})})}function NP(){return s.jsx(Jk,{children:s.jsx(CP,{})})}function CP(){const{conversation:e}=Pk(),{activePanel:t,setCurrentAgentId:a}=Zk();return n.useEffect((()=>{const t=(null==e?void 0:e.agent_id)??"";t&&a(t)}),[a,null==e?void 0:e.agent_id]),(null==e?void 0:e.endpoint)?t===Xd.actions?s.jsx(iI,{}):t===Xd.version?s.jsx(XT,{}):t===Xd.mcp?s.jsx(wP,{}):s.jsx(vP,{}):null}const kP=({bookmark:e,tabIndex:t=0,onFocus:a,onBlur:r})=>{const o=Fk(),{showToast:i}=Bd(),[l,c]=n.useState(!1),d=Cj({onSuccess:()=>{i({message:o("com_ui_bookmarks_delete_success")})},onError:()=>{i({message:o("com_ui_bookmarks_delete_error"),severity:eu.ERROR})}}),u=n.useCallback((async()=>{await d.mutateAsync(e)}),[e,d]);return s.jsx(s.Fragment,{children:s.jsxs(ul,{open:l,onOpenChange:c,children:[s.jsx(ml,{asChild:!0,children:s.jsx(Ol,{description:o("com_ui_delete"),render:s.jsx(ki,{variant:"ghost","aria-label":o("com_ui_bookmarks_delete"),tabIndex:t,onFocus:a,onBlur:r,onClick:()=>c(!l),className:"h-8 w-8 p-0",children:s.jsx(kc,{})})})}),s.jsx(zd,{showCloseButton:!1,title:o("com_ui_bookmarks_delete"),className:"w-11/12 max-w-lg",main:s.jsxs(dl,{className:"text-left text-sm font-medium",children:[o("com_ui_bookmark_delete_confirm")," ",e]}),selection:{selectHandler:u,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]})})},SP=({tags:e,bookmark:t,mutation:a,conversationId:r,setOpen:o,formRef:i})=>{const l=Fk(),c=pr(),{showToast:d}=Bd(),{bookmarks:u}=uS(),{register:m,handleSubmit:p,setValue:f,getValues:h,control:g,formState:{errors:x}}=zo({mode:"onBlur",reValidateMode:"onChange",defaultValues:{tag:(null==t?void 0:t.tag)??"",description:(null==t?void 0:t.description)??"",conversationId:r??"",addToConversation:!(null==r||!r)}});n.useEffect((()=>{t&&t.tag&&(f("tag",t.tag),f("description",t.description??""))}),[t,f]);return s.jsx("form",{ref:i,className:"mt-6","aria-label":"Bookmark form",method:"POST",onSubmit:p((n=>{if(s_.log("tag_mutation","BookmarkForm - onSubmit: data",n),a.isLoading)return;if(n.tag===(null==t?void 0:t.tag)&&n.description===(null==t?void 0:t.description))return;if(null!=n.tag&&(e??[]).includes(n.tag))return void d({message:l("com_ui_bookmarks_create_exists"),status:"warning"});(c.getQueryData([xx.conversationTags])??[]).some((e=>e.tag===n.tag))?d({message:l("com_ui_bookmarks_create_exists"),status:"warning"}):(a.mutate(n),o(!1))})),children:s.jsxs("div",{className:"flex w-full flex-col items-center gap-2",children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"bookmark-tag",className:"text-left text-sm font-medium",children:l("com_ui_bookmarks_title")}),s.jsx(ll,{type:"text",id:"bookmark-tag","aria-label":l(t?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),...m("tag",{required:l("com_ui_field_required"),maxLength:{value:128,message:l("com_ui_field_max_length",{field:l("com_ui_bookmarks_title"),length:128})},validate:e=>e===(null==t?void 0:t.tag)||u.every((t=>t.tag!==e))||l("com_ui_bookmarks_tag_exists")}),"aria-invalid":!!x.tag,placeholder:l(t?"com_ui_bookmarks_edit":"com_ui_bookmarks_new")}),x.tag&&s.jsx("span",{className:"text-sm text-red-500",children:x.tag.message})]}),s.jsxs("div",{className:"mt-4 grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"bookmark-description",className:"text-left text-sm font-medium",children:l("com_ui_bookmarks_description")}),s.jsx(Ml,{...m("description",{maxLength:{value:1048,message:l("com_ui_field_max_length",{field:l("com_ui_bookmarks_description"),length:1048})}}),id:"bookmark-description",disabled:!1,className:n_("flex h-10 max-h-[250px] min-h-[100px] w-full resize-none rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background focus-visible:outline-none")})]}),null!=r&&r&&s.jsxs("div",{className:"mt-2 flex w-full items-center",children:[s.jsx(Uo,{name:"addToConversation",control:g,render:({field:e})=>{var t;return s.jsx(Si,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:null==(t=e.value)?void 0:t.toString()})}}),s.jsx("button",{type:"button","aria-label":l("com_ui_bookmarks_add_to_conversation"),className:"form-check-label w-full cursor-pointer text-text-primary",onClick:()=>f("addToConversation",!h("addToConversation"),{shouldDirty:!0}),children:s.jsx("div",{className:"flex select-none items-center",children:l("com_ui_bookmarks_add_to_conversation")})})]})]})})},EP=({open:e,setOpen:t,tags:a,setTags:r,context:o,bookmark:i,children:l,triggerRef:c,conversationId:d})=>{const u=Fk(),m=n.useRef(null),{showToast:p}=Bd(),f=Nj({context:o,tag:null==i?void 0:i.tag,options:{onSuccess:(e,n)=>{if(p({message:u(i?"com_ui_bookmarks_update_success":"com_ui_bookmarks_create_success")}),t(!1),s_.log("tag_mutation","tags before setting",a),r&&!0===n.addToConversation){const e=[...a||[],n.tag].filter((e=>void 0!==e));if(r(e),s_.log("tag_mutation","tags after",e),null==n.tag||""===n.tag)return;setTimeout((()=>{const e=document.getElementById(n.tag??"");console.log("tagElement",e),e&&e.focus()}),5)}},onError:()=>{p({message:u(i?"com_ui_bookmarks_update_error":"com_ui_bookmarks_create_error"),severity:eu.ERROR})}}});return s.jsxs(ul,{open:e,onOpenChange:t,triggerRef:c,children:[l,s.jsx(zd,{title:u(i?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),showCloseButton:!1,className:"w-11/12 md:max-w-2xl",main:s.jsx(SP,{tags:a,setOpen:t,mutation:f,conversationId:d,bookmark:i,formRef:m}),buttons:s.jsx(ki,{variant:"submit",type:"submit",disabled:f.isLoading,onClick:()=>{m.current&&m.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},className:"text-white",children:f.isLoading?s.jsx(ac,{}):u("com_ui_save")})})]})},TP=({bookmark:e,tabIndex:t=0,onFocus:a,onBlur:r})=>{const o=Fk(),[i,l]=n.useState(!1);return s.jsx(EP,{context:"EditBookmarkButton",bookmark:e,open:i,setOpen:l,children:s.jsx(ml,{asChild:!0,children:s.jsx(Ol,{description:o("com_ui_edit"),render:s.jsx(ki,{variant:"ghost","aria-label":o("com_ui_bookmarks_edit"),tabIndex:t,onFocus:a,onBlur:r,onClick:()=>l(!i),className:"h-8 w-8 p-0",children:s.jsx(ec,{})})})})})},IP=({row:e,moveRow:t,position:a})=>{const r=n.useRef(null),o=Nj({context:"BookmarkTableRow",tag:e.tag}),i=Fk(),{showToast:l}=Bd(),[,c]=er({accept:"bookmark",drop:t=>{o.mutate({...e,position:t.index},{onSuccess:()=>{l({message:i("com_ui_bookmarks_update_success"),severity:eu.SUCCESS})},onError:()=>{l({message:i("com_ui_bookmarks_update_error"),severity:eu.ERROR})}})},hover(e){r.current&&e.index!==a&&(t(e.index,a),e.index=a)}}),[{isDragging:d},u]=nr({type:"bookmark",item:{index:a},collect:e=>({isDragging:e.isDragging()})});return u(c(r)),s.jsxs(Tl,{ref:r,className:"cursor-move hover:bg-surface-secondary",style:{opacity:d?.5:1},children:[s.jsx(Rl,{className:"w-[70%] px-4 py-4",children:s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.tag})}),s.jsx(Rl,{className:"w-[10%] px-12 py-4",children:e.count}),s.jsx(Rl,{className:"w-[20%] px-4 py-4",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(TP,{bookmark:e,tabIndex:0}),s.jsx(kP,{bookmark:e.tag,tabIndex:0})]})})]})},RP=()=>{const e=Fk(),[t,a]=n.useState([]),[r,o]=n.useState(0),[i,l]=n.useState(""),[c,d]=n.useState(!1),{bookmarks:u=[]}=uS();n.useEffect((()=>{const e=(e=>{const t=new Set;return e.filter((e=>{const n=t.has(e._id);return t.add(e._id),!n}))})(u).sort(((e,t)=>e.position-t.position));a(e)}),[u]);const m=n.useCallback(((e,t)=>{a((n=>{const s=[...n],[a]=s.splice(e,1);return s.splice(t,0,a),s.map(((e,t)=>({...e,position:t})))}))}),[]),p=n.useCallback((e=>s.jsx(IP,{moveRow:m,row:e,position:e.position},e._id)),[m]),f=t.filter((e=>e.tag&&e.tag.toLowerCase().includes(i.toLowerCase()))),h=f.slice(10*r,10*(r+1));return s.jsx(dS.Provider,{value:{bookmarks:u},children:s.jsxs("div",{role:"region","aria-label":e("com_ui_bookmarks"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(ll,{placeholder:e("com_ui_bookmarks_filter"),value:i,onChange:e=>l(e.target.value),"aria-label":e("com_ui_bookmarks_filter")})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsxs(kl,{className:"w-full table-fixed",children:[s.jsx(Sl,{children:s.jsxs(Tl,{className:"border-b border-border-light",children:[s.jsx(Il,{className:"w-[70%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_ui_bookmarks_title")})}),s.jsx(Il,{className:"w-[30%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_ui_bookmarks_count")})}),s.jsx(Il,{className:"w-[40%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_assistants_actions")})})]})}),s.jsx(El,{children:h.length?h.map(p):s.jsx(Tl,{children:s.jsx(Rl,{colSpan:3,className:"h-24 text-center text-sm text-text-secondary",children:e("com_ui_no_bookmarks")})})})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex justify-between gap-2",children:s.jsx(EP,{context:"BookmarkPanel",open:c,setOpen:d,children:s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{variant:"outline",size:"sm",className:"w-full gap-2 text-sm",onClick:()=>d(!c),children:[s.jsx(nn,{className:"size-4"}),s.jsx("div",{className:"break-all",children:e("com_ui_bookmarks_new")})]})})})}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>o((e=>Math.max(e-1,0))),disabled:0===r,"aria-label":e("com_ui_prev"),children:e("com_ui_prev")}),s.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${r+1} / ${Math.ceil(f.length/10)}`}),s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>o((e=>10*(e+1)<f.length?e+1:e)),disabled:10*(r+1)>=f.length,"aria-label":e("com_ui_next"),children:e("com_ui_next")})]})]})]})})},PP=()=>{const{data:e}=fj();return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:s.jsx(dS.Provider,{value:{bookmarks:e||[]},children:s.jsx(RP,{})})})};function AP({open:e,onOpenChange:t,children:a,triggerRef:r}){const o=Fk(),{showToast:i}=Bd(),l=Wk({permissionType:hg.MEMORIES,permission:gg.CREATE}),{mutate:c,isLoading:d}=nj({onSuccess:()=>{i({message:o("com_ui_memory_created"),status:"success"}),t(!1),m(""),f(""),setTimeout((()=>{var e;null==(e=null==r?void 0:r.current)||e.focus()}),0)},onError:e=>{var t,n,s;let a=o("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const r=e;(null==(n=null==(t=r.response)?void 0:t.data)?void 0:n.error)&&(a=r.response.data.error,409===(null==(s=r.response)?void 0:s.status)||a.includes("already exists")?a=o("com_ui_memory_key_exists"):a.includes("lowercase letters and underscores")&&(a=o("com_ui_memory_key_validation")))}else e.message&&(a=e.message);i({message:a,status:"error"})}}),[u,m]=n.useState(""),[p,f]=n.useState(""),h=()=>{l&&(u.trim()&&p.trim()?c({key:u.trim(),value:p.trim()}):i({message:o("com_ui_field_required"),status:"error"}))},g=e=>{"Enter"===e.key&&e.ctrlKey&&l&&h()};return s.jsxs(ul,{open:e,onOpenChange:t,triggerRef:r,children:[a,s.jsx(zd,{title:o("com_ui_create_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(dl,{htmlFor:"memory-key",className:"text-sm font-medium",children:o("com_ui_key")}),s.jsx(ll,{id:"memory-key",value:u,onChange:e=>m(e.target.value),onKeyDown:g,placeholder:o("com_ui_enter_key"),className:"w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(dl,{htmlFor:"memory-value",className:"text-sm font-medium",children:o("com_ui_value")}),s.jsx("textarea",{id:"memory-value",value:p,onChange:e=>f(e.target.value),onKeyDown:g,placeholder:o("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]})]}),buttons:s.jsx(ki,{type:"button",variant:"submit",onClick:h,disabled:d||!u.trim()||!p.trim(),className:"text-white",children:d?s.jsx(ac,{className:"size-4"}):o("com_ui_create")})})]})}function MP({memory:e,open:t,onOpenChange:a,children:r,triggerRef:o}){const i=Fk(),{showToast:l}=Bd(),{data:c}=ej(),d=Wk({permissionType:hg.MEMORIES,permission:gg.UPDATE}),{mutate:u,isLoading:m}=(e=>{const t=pr();return fr((({key:e,value:t,originalKey:n})=>Rx.updateMemory(e,t,n)),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([xx.memories]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})})({onMutate:()=>{a(!1),setTimeout((()=>{var e;null==(e=null==o?void 0:o.current)||e.focus()}),0)},onSuccess:()=>{l({message:i("com_ui_saved"),status:"success"})},onError:e=>{var t,n,s;let a=i("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const r=e;(null==(n=null==(t=r.response)?void 0:t.data)?void 0:n.error)&&(a=r.response.data.error,409===(null==(s=r.response)?void 0:s.status)||a.includes("already exists")?a=i("com_ui_memory_key_exists"):a.includes("lowercase letters and underscores")&&(a=i("com_ui_memory_key_validation")))}else e.message&&(a=e.message);l({message:a,status:"error"})}}),[p,f]=n.useState(""),[h,g]=n.useState(""),[x,v]=n.useState("");n.useEffect((()=>{e&&(f(e.key),g(e.value),v(e.key))}),[e]);const b=()=>{d&&e&&(p.trim()&&h.trim()?u({key:p.trim(),value:h.trim(),...x!==p.trim()&&{originalKey:x}}):l({message:i("com_ui_field_required"),status:"error"}))},_=e=>{"Enter"===e.key&&e.ctrlKey&&d&&b()};return s.jsxs(ul,{open:t,onOpenChange:a,triggerRef:o,children:[r,s.jsx(zd,{title:i(d?"com_ui_edit_memory":"com_ui_view_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:s.jsxs("div",{className:"space-y-4",children:[e&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[s.jsxs("div",{children:[i("com_ui_date"),":"," ",new Date(e.updated_at).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),void 0!==e.tokenCount&&s.jsxs("div",{children:[e.tokenCount.toLocaleString(),(null==c?void 0:c.tokenLimit)&&` / ${c.tokenLimit.toLocaleString()}`," ",i(1===e.tokenCount?"com_ui_token":"com_ui_tokens")]})]}),(null==c?void 0:c.tokenLimit)&&null!==(null==c?void 0:c.usagePercentage)&&s.jsxs("div",{className:"text-xs text-text-secondary",children:[i("com_ui_usage"),": ",c.usagePercentage,"%"," "]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(dl,{htmlFor:"memory-key",className:"text-sm font-medium",children:i("com_ui_key")}),s.jsx(ll,{id:"memory-key",value:p,onChange:e=>d&&f(e.target.value),onKeyDown:_,placeholder:i("com_ui_enter_key"),className:"w-full",disabled:!d})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(dl,{htmlFor:"memory-value",className:"text-sm font-medium",children:i("com_ui_value")}),s.jsx("textarea",{id:"memory-value",value:h,onChange:e=>d&&g(e.target.value),onKeyDown:_,placeholder:i("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3,disabled:!d})]})]}),buttons:d?s.jsx(ki,{type:"button",variant:"submit",onClick:b,disabled:m||!p.trim()||!h.trim(),className:"text-white",children:m?s.jsx(ac,{className:"size-4"}):i("com_ui_save")}):null})]})}const LP=({control:e,memoryPerm:t,label:n})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,s.jsx(Uo,{name:t,control:e,render:({field:e})=>s.jsx(Cl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),OP=()=>{const e=Fk(),{user:t,roles:a}=Kk(),{showToast:r}=Bd(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Zg.partial().parse(e.updates),Rx.updateMemoryPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([xx.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update memory permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{r({status:"success",message:e("com_ui_saved")})},onError:()=>{r({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Qg.USER),m=n.useMemo((()=>{var e,t,n;return(null==(e=null==a?void 0:a[d])?void 0:e.permissions)?null==(n=null==(t=null==a?void 0:a[d])?void 0:t.permissions)?void 0:n[hg.MEMORIES]:gx[d].permissions[hg.MEMORIES]}),[a,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=zo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t,n,s;(null==(t=null==(e=null==a?void 0:a[d])?void 0:e.permissions)?void 0:t[hg.MEMORIES])?p(null==(s=null==(n=null==a?void 0:a[d])?void 0:n.permissions)?void 0:s[hg.MEMORIES]):p(gx[d].permissions[hg.MEMORIES])}),[a,d,p]),(null==t?void 0:t.role)!==Qg.ADMIN)return null;const b=[{memoryPerm:gg.USE,label:e("com_ui_memories_allow_use")},{memoryPerm:gg.CREATE,label:e("com_ui_memories_allow_create")},{memoryPerm:gg.UPDATE,label:e("com_ui_memories_allow_update")},{memoryPerm:gg.READ,label:e("com_ui_memories_allow_read")},{memoryPerm:gg.OPT_OUT,label:e("com_ui_memories_allow_opt_out")}],_=[{label:Qg.USER,onClick:()=>{u(Qg.USER)}},{label:Qg.ADMIN,onClick:()=>{u(Qg.ADMIN)}}];return s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(gl,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(bl,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_memories")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(wd,{unmountOnHide:!0,menuId:"memory-role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:_,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x((e=>{o({roleName:d,updates:e})})),children:[s.jsx("div",{className:"py-5",children:b.map((({memoryPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(LP,{control:f,memoryPerm:t,label:n,getValues:g,setValue:h}),d===Qg.ADMIN&&t===gg.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"submit",disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})},DP=({memory:e})=>{const t=Fk(),[a,r]=n.useState(!1),o=n.useRef(null);return s.jsx(MP,{open:a,memory:e,onOpenChange:r,triggerRef:o,children:s.jsx(ml,{asChild:!0,children:s.jsx(Ol,{description:t("com_ui_edit_memory"),render:s.jsx(ki,{variant:"ghost","aria-label":t("com_ui_bookmarks_edit"),onClick:()=>r(!a),className:"h-8 w-8 p-0",children:s.jsx(ec,{})})})})})},FP=({memory:e})=>{const t=Fk(),{showToast:a}=Bd(),[r,o]=n.useState(!1),{mutate:i}=(()=>{const e=pr();return fr((e=>Rx.deleteMemory(e)),{onSuccess:()=>{e.invalidateQueries([xx.memories])}})})(),[l,c]=n.useState(null);return s.jsxs(ul,{open:r,onOpenChange:o,children:[s.jsx(ml,{asChild:!0,children:s.jsx(Ol,{description:t("com_ui_delete_memory"),render:s.jsx(ki,{variant:"ghost","aria-label":t("com_ui_delete"),onClick:()=>o(!r),className:"h-8 w-8 p-0",children:l===e.key?s.jsx(ac,{className:"size-4 animate-spin"}):s.jsx(kc,{className:"size-4"})})})}),s.jsx(zd,{showCloseButton:!1,title:t("com_ui_delete_memory"),className:"w-11/12 max-w-lg",main:s.jsxs(dl,{className:"text-left text-sm font-medium",children:[t("com_ui_delete_confirm"),' "',e.key,'"?']}),selection:{selectHandler:async()=>{c(e.key),i(e.key,{onSuccess:()=>{a({message:t("com_ui_deleted"),status:"success"}),o(!1)},onError:()=>a({message:t("com_ui_error"),status:"error"}),onSettled:()=>c(null)})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:t("com_ui_delete")}})]})},zP=10;function UP(){var e;const t=Fk(),{user:a}=Kk(),{data:r}=ky(),{data:o,isLoading:i}=ej(),{showToast:l}=Bd(),[c,d]=n.useState(0),[u,m]=n.useState(""),[p,f]=n.useState(!1),[h,g]=n.useState(!0),x=tj({onSuccess:()=>{l({message:t("com_ui_preferences_updated"),status:"success"})},onError:()=>{l({message:t("com_ui_error_updating_preferences"),status:"error"}),g((e=>!e))}});n.useEffect((()=>{var e;void 0!==(null==(e=null==r?void 0:r.personalization)?void 0:e.memories)&&g(r.personalization.memories)}),[null==(e=null==r?void 0:r.personalization)?void 0:e.memories]);const v=Wk({permissionType:hg.MEMORIES,permission:gg.READ}),b=Wk({permissionType:hg.MEMORIES,permission:gg.UPDATE}),_=Wk({permissionType:hg.MEMORIES,permission:gg.CREATE}),y=Wk({permissionType:hg.MEMORIES,permission:gg.OPT_OUT}),j=n.useMemo((()=>(null==o?void 0:o.memories)??[]),[o]),w=n.useMemo((()=>A(j,u,{keys:["key","value"]})),[j,u]),N=n.useMemo((()=>w.slice(c*zP,(c+1)*zP)),[w,c]);return i?s.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:s.jsx(ac,{})}):v?s.jsx("div",{className:"flex h-full w-full flex-col overflow-hidden",children:s.jsxs("div",{role:"region","aria-label":t("com_ui_memories"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(ll,{placeholder:t("com_ui_memories_filter"),value:u,onChange:e=>m(e.target.value),"aria-label":t("com_ui_memories_filter")})}),((null==o?void 0:o.tokenLimit)||y)&&s.jsxs("div",{className:n_("flex items-center rounded-lg",null!=(null==o?void 0:o.tokenLimit)&&y?"justify-between":"justify-end"),children:[(null==o?void 0:o.tokenLimit)&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative size-10",children:[s.jsxs("svg",{className:"size-10 -rotate-90 transform",children:[s.jsx("circle",{cx:"20",cy:"20",r:"16",stroke:"currentColor",strokeWidth:"3",fill:"none",className:"text-gray-200 dark:text-gray-700"}),s.jsx("circle",{cx:"20",cy:"20",r:"16",strokeWidth:"3",fill:"none",strokeDasharray:""+2*Math.PI*16,strokeDashoffset:""+2*Math.PI*16*(1-(o.usagePercentage??0)/100),className:"transition-all "+(C=o.usagePercentage??0,C>90?"stroke-red-500":C>75?"stroke-yellow-500":"stroke-green-500"),strokeLinecap:"round"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-xs font-medium",children:[o.usagePercentage,"%"]})})]}),s.jsx("div",{className:"text-sm text-text-secondary",children:t("com_ui_usage")})]}),y&&s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsx("span",{children:t("com_ui_use_memory")}),s.jsx(Cl,{checked:h,onCheckedChange:e=>{g(e),x.mutate({memories:e})},"aria-label":t("com_ui_reference_saved_memories"),disabled:x.isLoading})]})]}),_&&s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(AP,{open:p,onOpenChange:f,children:s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{variant:"outline",className:"w-full bg-transparent",children:[s.jsx(kt,{className:"size-4","aria-hidden":!0}),t("com_ui_create_memory")]})})})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsxs(kl,{className:"w-full table-fixed",children:[s.jsx(Sl,{children:s.jsxs(Tl,{className:"border-b border-border-light hover:bg-surface-secondary",children:[s.jsx(Il,{className:(b?"w-[75%]":"w-[100%]")+" bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:t("com_ui_memory")})}),b&&s.jsx(Il,{className:"w-[25%] bg-surface-secondary py-3 text-center text-sm font-medium text-text-secondary",children:s.jsx("div",{children:t("com_assistants_actions")})})]})}),s.jsx(El,{children:N.length?N.map(((e,t)=>s.jsxs(Tl,{className:"border-b border-border-light hover:bg-surface-secondary",children:[s.jsx(Rl,{className:(b?"w-[75%]":"w-[100%]")+" px-4 py-4",children:s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm text-text-primary",title:e.value,children:e.value})}),b&&s.jsx(Rl,{className:"w-[25%] px-4 py-4",children:s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx(DP,{memory:e}),s.jsx(FP,{memory:e})]})})]},t))):s.jsx(Tl,{children:s.jsx(Rl,{colSpan:b?2:1,className:"h-24 text-center text-sm text-text-secondary",children:t("com_ui_no_data")})})})]})}),w.length>zP&&s.jsxs("div",{className:"flex items-center justify-end gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>d((e=>Math.max(e-1,0))),disabled:0===c,"aria-label":t("com_ui_prev"),children:t("com_ui_prev")}),s.jsx("div",{className:"text-sm","aria-live":"polite",children:`${c+1} / ${Math.ceil(w.length/zP)}`}),s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>d((e=>(e+1)*zP<w.length?e+1:e)),disabled:(c+1)*zP>=w.length,"aria-label":t("com_ui_next"),children:t("com_ui_next")})]}),(null==a?void 0:a.role)===Qg.ADMIN&&s.jsx("div",{className:"mt-4",children:s.jsx(OP,{})})]})}):s.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-sm text-text-secondary",children:t("com_ui_no_read_access")})})});var C}const VP=({field:e,inputClass:t,labelClass:a})=>{const r=Fk(),o=n.useRef([]),i=n.useRef(null),[l,c]=n.useState(""),d=()=>{if(l.trim()&&e.value.length<Sh.MAX_CONVO_STARTERS){const t=[l,...e.value];e.onChange(t),c("")}},u={transition:"opacity 200ms ease-in-out",opacity:0},m={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}},p=e.value.length>=Sh.MAX_CONVO_STARTERS;return s.jsxs("div",{className:"relative",children:[s.jsx("label",{className:a,htmlFor:"conversation_starters",children:r("com_assistants_conversation_starters")}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:e=>o.current[0]=e,value:l,maxLength:64,className:`${t} pr-10`,type:"text",placeholder:r(p?"com_assistants_max_starters_reached":"com_assistants_conversation_starters_placeholder"),onChange:e=>c(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(e.preventDefault(),p?((t=e.currentTarget).classList.remove("shake"),t.offsetWidth,t.classList.add("shake"),setTimeout((()=>{t.classList.remove("shake")}),200)):d())}}),s.jsx(Dr,{nodeRef:i,in:e.value.length<Sh.MAX_CONVO_STARTERS,timeout:200,unmountOnExit:!0,children:e=>s.jsx("div",{ref:i,style:{...u,...m[e],transition:"entering"===e?"none":u.transition},className:"absolute right-1 top-1",children:s.jsx(Ol,{side:"top",description:r(p?"com_assistants_max_starters_reached":"com_ui_add"),className:"flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:d,disabled:p,children:s.jsx(kt,{className:"size-4"})})})})]}),e.value.map(((n,a)=>s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:e=>o.current[a+1]=e,value:n,onChange:t=>{const n=[...e.value];n[a]=t.target.value,e.onChange(n)},className:`${t} pr-10`,type:"text",maxLength:64}),s.jsx(Ol,{side:"top",description:r("com_ui_delete"),className:"absolute right-1 top-1 flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:()=>(t=>{const n=e.value.filter(((e,n)=>n!==t));e.onChange(n)})(a),children:s.jsx(vt,{className:"size-4"})})]},a)))]})]})};function BP({isOpen:e,endpoint:t,setIsOpen:a}){const r=Fk(),{getValues:o,setValue:i}=Vo(),{data:l}=hj(t),c=Xu(t),{maxPage:d,setMaxPage:u,currentPage:m,setCurrentPage:p,itemsPerPage:f,searchChanged:h,setSearchChanged:g,searchValue:x,setSearchValue:v,gridRef:b,handleSearch:_,handleChangePage:y,error:j,setError:w,errorMessage:N,setErrorMessage:C,showPluginAuthForm:k,setShowPluginAuthForm:S,selectedPlugin:E,setSelectedPlugin:T}=rT(),I=bk(),R=e=>{var t,n;w(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&C(s),setTimeout((()=>{w(!1),C("")}),5e3)},P=e=>{const t=()=>{const t=o("functions").slice();t.push(e.pluginKey),i("functions",t)};if(!e.auth)return t();I.mutate(e,{onError:e=>{R(e)},onSuccess:t}),S(!1)},A=null==l?void 0:l.filter((e=>e.name.toLowerCase().includes(x.toLowerCase())));return n.useEffect((()=>{A&&(u(Math.ceil(A.length/f)),h&&(p(1),g(!1)))}),[l,f,x,A,h,u,p,g]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),p(1),v("")},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:r(c?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:r("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("div",{className:"sm:mt-0",children:s.jsx("button",{onClick:()=>{a(!1),p(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})})]}),j&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[r("com_nav_plugin_auth_error")," ",N]}),k&&s.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:s.jsx(kI,{plugin:E,onSubmit:e=>P(e),isEntityTool:!0})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:x,onChange:_,placeholder:r("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:b,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((m-1)*f,m*f).map(((e,t)=>s.jsx(TI,{tool:e,isInstalled:o("functions").includes(e.pluginKey),onAddTool:()=>(e=>{S(!1);const t=null==l?void 0:l.find((t=>t.pluginKey===e));T(t);const{authConfig:n,authenticated:s=!1}=t??{};n&&n.length>0&&!s?S(!0):P({pluginKey:e,action:"install",auth:null})})(e.pluginKey),onRemoveTool:()=>(e=>{S(!1),I.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{R(e)},onSuccess:()=>{const t=o("functions").filter((t=>t!==e));i("functions",t)}})})(e.pluginKey)},t)))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:d>0?s.jsx(NI,{currentPage:m,maxPage:d,onChangePage:y}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}function $P({control:e,setValue:t}){const n=Fk(),a=e=>{t("append_current_datetime",e,{shouldDirty:!0})};return s.jsx("div",{className:"mb-6",children:s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:"append_current_datetime",control:e,render:({field:e})=>s.jsx(Si,{...e,id:"append_current_datetime",checked:e.value,onCheckedChange:a,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":"append-date-label"})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("label",{id:"append-date-label",htmlFor:"append_current_datetime",className:"form-check-label text-token-text-primary w-full cursor-pointer",children:n("com_assistants_append_date")}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-5 w-5 text-gray-500","aria-label":n("com_assistants_append_date_tooltip")})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("com_assistants_append_date_tooltip")})})})})]})})})}function HP(){const e=Fk(),t=Vo(),{control:n,setValue:a,getValues:r}=t;return s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:xf.image_vision,control:n,render:({field:e})=>s.jsx(Si,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:xf.image_vision,onClick:()=>a(xf.image_vision,!r(xf.image_vision),{shouldDirty:!0}),children:s.jsx("div",{className:"flex items-center",children:e("com_assistants_image_vision")})})]})}function GP({version:e,retrievalModels:t}){const a=Fk(),r=Vo(),{control:o,setValue:i,getValues:l}=r,c=$o({control:o,name:"model"}),d=$o({control:o,name:"assistant"});n.useMemo((()=>{var e;return"string"==typeof d?[]:null==(e=d.tool_resources)?void 0:e.file_search}),[d]);const u=n.useMemo((()=>!t.has(c)),[c,t]);return n.useEffect((()=>{c&&u&&i(xf.retrieval,!1)}),[c,i,u]),s.jsx(s.Fragment,{children:s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:xf.retrieval,control:o,render:({field:e})=>s.jsx(Si,{...e,checked:e.value,disabled:u,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("label",{className:n_("form-check-label text-token-text-primary w-full select-none",u?"cursor-no-drop opacity-50":"cursor-pointer"),htmlFor:xf.retrieval,onClick:()=>t.has(c)&&i(xf.retrieval,!l(xf.retrieval),{shouldDirty:!0}),children:a(1==e?"com_assistants_retrieval":"com_assistants_file_search")}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,disabled:u,className:"ml-16 w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&a("com_assistants_file_search_info")})})})}),s.jsx(YI,{side:Jd.Top,disabled:!u,description:"com_assistants_non_retrieval_model",langCode:!0,sideOffset:20,className:"ml-16"})]})})})}const KP=gu.code_interpreter;function WP({endpoint:e,assistant_id:t,files:a}){const r=Fk(),{setFilesLoading:o}=Pk(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=cp}=Yy({select:e=>fp(e)}),{handleFileChange:u}=wE({overrideEndpoint:e,additionalMetadata:{assistant_id:t,tool_resource:KP},fileSetter:c});n.useEffect((()=>{a&&c(new Map(a))}),[a]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return s.jsx("div",{className:"mb-2 w-full",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:r("com_assistants_code_interpreter_files")}),s.jsx(vR,{files:l,setFiles:c,assistant_id:t,tool_resource:KP,setFilesLoading:o,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:!t,onChange:u}),r("com_ui_upload_files")]})})})]})})}function qP({version:e}){const t=Fk(),n=Vo(),{control:a,setValue:r,getValues:o}=n;return s.jsx(s.Fragment,{children:s.jsx(al,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Uo,{name:xf.code_interpreter,control:a,render:({field:e})=>s.jsx(Si,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>r(xf.code_interpreter,!o(xf.code_interpreter),{shouldDirty:!0}),children:[s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:xf.code_interpreter,children:t("com_assistants_code_interpreter")}),s.jsx(rl,{children:s.jsx(Hc,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx(ol,{children:s.jsx(il,{side:Jd.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&t("com_assistants_code_interpreter_info")})})})})]})})})}function QP({version:e,endpoint:t,codeEnabled:a,retrievalEnabled:r,assistantsConfig:o}){const i=Fk(),l=Vo(),{control:c}=l,d=$o({control:c,name:"assistant"}),u=$o({control:c,name:"id"}),m=n.useMemo((()=>"string"==typeof d?[]:d.code_files),[d]),p=n.useMemo((()=>new Set((null==o?void 0:o.retrievalModels)??[])),[o]),f=n.useMemo((()=>{var e;return null==(e=null==o?void 0:o.capabilities)?void 0:e.includes(xf.image_vision)}),[o]);return s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:i("com_assistants_capabilities")})})}),s.jsxs("div",{className:"flex flex-col items-start gap-2",children:[a&&s.jsx(qP,{version:e}),r&&s.jsx(GP,{endpoint:t,version:e,retrievalModels:p}),f&&1==e&&s.jsx(HP,{}),a&&e&&s.jsx(WP,{assistant_id:u,version:e,endpoint:t,files:m})]})]})}function YP(){return s.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const XP=({url:e,progress:t=1})=>{const n=2*Math.PI*55,a=n-t*n;return s.jsx("div",{children:s.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[s.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}}),t<1&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:a,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function ZP({handleFileChange:e}){const t=n.useRef(null);return s.jsx(Ha,{children:s.jsxs(Ga,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[s.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;t.current&&(t.current.value=""),null==(e=t.current)||e.click()},children:"Upload Photo"}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:t,tabIndex:-1})]})})}function JP({endpoint:e,version:t,assistant_id:a,metadata:r,createMutation:o}){const i=pr(),l=xS(),[c,d]=n.useState(!1),[u,m]=n.useState(1),[p,f]=n.useState(null),[h,g]=n.useState(null),x=n.useRef(null),{data:v=cp}=Yy({select:e=>fp(e)}),b=Fk(),{showToast:_}=Bd(),y=n.useMemo((()=>{var t;return(null==(t=null==l?void 0:l[e][a??""])?void 0:t.model)??""}),[l,e,a]),{mutate:j}=Pj({onMutate:()=>{m(.4)},onSuccess:(t,n)=>{var s,r,l;!0!==n.postCreation?_({message:b("com_ui_upload_success")}):x.current!==(null==(s=o.data)?void 0:s.id)&&(x.current=(null==(r=o.data)?void 0:r.id)??""),f(null),g(null==(l=t.metadata)?void 0:l.avatar);const c=i.getQueryData([xx.assistants,e,Su]);if(!(null==c?void 0:c.data)||!c)return;const d=c.data.map((e=>e.id===a?{...e,...t}:e));i.setQueryData([xx.assistants,e,Su],{...c,data:d}),m(1)},onError:e=>{console.error("Error:",e),f(null),g(null),_({message:b("com_ui_upload_error"),status:"error"}),m(1)}});n.useEffect((()=>{if(p){const e=new FileReader;e.onloadend=()=>{g(e.result)},e.readAsDataURL(p)}}),[p]),n.useEffect((()=>{g((null==r?void 0:r.avatar)??null)}),[r]),n.useEffect((()=>{const n=!!(o.isSuccess&&p&&h&&h.includes("base64"));if((!n||x.current!==o.data.id)&&n&&o.data.id){console.log("[AssistantAvatar] Uploading Avatar after Assistant Creation");const n=new FormData;n.append("file",p,p.name),n.append("assistant_id",o.data.id),j({assistant_id:o.data.id,model:y,postCreation:!0,formData:n,endpoint:e,version:t})}}),[o.data,o.isSuccess,p,h,j,y,e,t]);return s.jsxs(Ka,{open:c,onOpenChange:d,children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Wa,{asChild:!0,children:s.jsx("button",{type:"button",className:"h-20 w-20",children:h?s.jsx(XP,{url:h,progress:u}):s.jsx(YP,{})})})}),s.jsx(ZP,{handleFileChange:n=>{var s;const r=null==(s=n.target.files)?void 0:s[0];if(v.avatarSizeLimit&&r&&r.size<=v.avatarSizeLimit){if(!r)return void console.error("No file selected");if(f(r),d(!1),!a)return void console.log("[AssistantAvatar] No assistant_id, will wait until form submission + upload");const n=new FormData;n.append("file",r,r.name),n.append("assistant_id",a),j({assistant_id:a,model:y,formData:n,endpoint:e,version:t})}else{const e=v.avatarSizeLimit?Dv(v.avatarSizeLimit):2;_({message:b("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}d(!1)}})]})}const eA=new Set(["name","id","description","instructions","conversation_starters","model","append_current_datetime"]);function tA({reset:e,value:t,endpoint:a,documentsMap:r,selectedAssistant:o,setCurrentAssistantId:i,createMutation:l,allTools:c}){const d=Fk(),u=nS(),m=n.useRef(null),[p]=ET(Eh.LAST_MODEL,{}),f=n.useMemo((()=>new Set(null==c?void 0:c.filter((e=>!0===e.toolkit)).map((e=>e.pluginKey)))),[c]),h=gj(a,void 0,{select:e=>e.data.map((e=>{var t,n,s,o;const i=a===Uu.assistants?Om.openai:Om.azure,l={...e,label:e.name??"",value:e.id,files:e.file_ids?[]:void 0,code_files:(null==(n=null==(t=e.tool_resources)?void 0:t.code_interpreter)?void 0:n.file_ids)?[]:void 0},c=(e,t)=>{const n=null==u?void 0:u[e];n?null==t||t.push([e,{file_id:n.file_id,type:n.type,filepath:n.filepath,filename:n.filename,width:n.width,height:n.height,size:n.bytes,preview:n.filepath,progress:1,source:i}]):null==t||t.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:a,source:i}])};l.files&&e.file_ids&&e.file_ids.forEach((e=>c(e,l.files))),l.code_files&&(null==(o=null==(s=e.tool_resources)?void 0:s.code_interpreter)?void 0:o.file_ids)&&e.tool_resources.code_interpreter.file_ids.forEach((e=>c(e,l.code_files)));const d=null==r?void 0:r.get(e.id);return d&&(l.conversation_starters||(l.conversation_starters=d.conversation_starters),l.append_current_datetime=d.append_current_datetime??!1),l}))}),g=n.useCallback((t=>{var n;const s=null==(n=h.data)?void 0:n.find((e=>e.id===t));if(l.reset(),!s)return i(void 0),e({...sm,model:(null==p?void 0:p[a])??""});const r={...s,label:s.name??"",value:s.id||""},o={[xf.code_interpreter]:!1,[xf.image_vision]:!1,[xf.retrieval]:!1};(s.tools??[]).filter((e=>"function"!==e.type||om(e))).map((e=>{var t;return((null==(t=e.function)?void 0:t.name)??"")||e.type})).forEach((e=>{e===hu.file_search&&(o[xf.retrieval]=!0),o[e]=!0}));const c=new Set,d=(s.tools??[]).filter((e=>"function"===e.type&&!om(e))).map((e=>{var t;return(null==(t=e.function)?void 0:t.name)??""})).filter((e=>{const t=e.split("_")[0],n=f.has(t);return n&&c.add(t),!n}));c.size>0&&d.push(...Array.from(c));const u={functions:d,...o,assistant:r,model:r.model};Object.entries(s).forEach((([e,t])=>{eA.has(e)&&("append_current_datetime"!==e?("conversation_starters"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))||"number"!=typeof t&&"object"!=typeof t)&&(u[e]=t):u[e]=!!t)})),e(u),i(s.id)}),[h.data,e,i,l,a,p,f]);n.useEffect((()=>{let e=null;if(o!==m.current)return""!==o&&null!=o&&h.data&&(e=setTimeout((()=>{m.current=o,g(o)}),5)),()=>{e&&clearTimeout(e)}}),[o,h.data,g]);const x=d("com_ui_create")+" "+d("com_ui_assistant");return s.jsx(Dd,{value:t||x,setValue:Wv(g),availableValues:h.data??[{label:"Loading...",value:""}],iconSide:"left",showAbove:!1,showLabel:!1,emptyTitle:!0,containerClassName:"flex-grow",searchClassName:"dark:from-gray-850",searchPlaceholder:d("com_assistants_search_name"),optionsClass:"hover:bg-gray-20/50 dark:border-gray-700",optionsListClass:"rounded-lg shadow-lg dark:bg-gray-850 dark:border-gray-700 dark:last:border",currentValueClass:n_("text-md font-semibold text-gray-900 dark:text-white",""===t?"text-gray-500":""),className:n_("mt-1 rounded-md dark:border-gray-700 dark:bg-gray-850","z-50 flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer hover:border-green-500 focus:border-gray-400"),renderOption:()=>s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[s.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-2 text-gray-800 dark:text-gray-100",children:s.jsx(kt,{className:"w-[16px]"})}),s.jsx("span",{className:n_("ml-4 flex h-6 items-center gap-1 text-gray-800 dark:text-gray-100"),children:x})]})})}function nA({activeModel:e,assistant_id:t,setCurrentAssistantId:n,createMutation:a,endpoint:r}){const o=Fk(),{showToast:i}=Bd(),{conversation:l}=Pk(),{setOption:c}=lE(),d=Rj({onSuccess:(e,t,s)=>{var r;const d=s;if(!d)return;i({message:o("com_ui_assistant_deleted"),status:"success"}),void 0!==(null==(r=a.data)?void 0:r.id)&&(console.log("[deleteAssistant] resetting createMutation"),a.reset());const u=d[0];if(!u)return c("assistant_id")("");if(t.assistant_id===(null==l?void 0:l.assistant_id))return c("assistant_id")(u.id);const m=d.find((e=>e.id===(null==l?void 0:l.assistant_id)));m&&n(m.id),n(u.id)},onError:e=>{console.error(e),i({message:o("com_ui_assistant_delete_error"),status:"error"})}});return t?0===(null==e?void 0:e.length)||void 0===e?null:s.jsxs(qi,{children:[s.jsx(Qi,{asChild:!0,children:s.jsx("button",{className:n_("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",u_),type:"button",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:s.jsx(kc,{})})})}),s.jsx(Od,{title:o("com_ui_delete")+" "+o("com_ui_assistant"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(dl,{htmlFor:"delete-assistant",className:"text-left text-sm font-medium",children:o("com_ui_delete_assistant_confirm")})})})}),selection:{selectHandler:()=>d.mutate({assistant_id:t,model:e,endpoint:r}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]}):null}function sA({tool:e,allTools:t,assistant_id:a=""}){const[r,o]=n.useState(!1),i=Fk(),{showToast:l}=Bd(),c=bk(),{getValues:d,setValue:u}=Vo(),m=t.find((t=>t.pluginKey===e));return m?s.jsxs(ul,{children:[s.jsxs("div",{className:n_("flex w-full items-center rounded-lg text-sm",a?"":"opacity-40"),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[s.jsxs("div",{className:"flex grow items-center",children:[m.icon&&s.jsx("div",{className:"flex h-9 w-9 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${m.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"h-9 grow px-3 py-2",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:m.name})]}),r&&s.jsx(ml,{asChild:!0,children:s.jsx("button",{type:"button",className:"flex h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-gray-200 dark:hover:bg-gray-700",children:s.jsx(kc,{})})})]}),s.jsx(zd,{showCloseButton:!1,title:i("com_ui_delete_tool"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:i("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=m.pluginKey)&&c.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{l({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{const t=d("functions").filter((t=>t!==e));u("functions",t),l({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-colors duration-200 text-white",selectText:i("com_ui_delete")}})]}):null}const aA=({children:e})=>{const t=Fk();return s.jsxs("div",{children:[s.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:t("com_assistants_code_interpreter_files")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e})]})};function rA({endpoint:e,assistant_id:t,files:a}){const r=Fk(),{setFilesLoading:o}=Pk(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=cp}=Yy({select:e=>fp(e)}),{handleFileChange:u}=wE({overrideEndpoint:e,additionalMetadata:{assistant_id:t},fileSetter:c});n.useEffect((()=>{a&&c(new Map(a))}),[a]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:r(t?"com_assistants_knowledge":"com_assistants_knowledge_disabled")})})}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"text-token-text-tertiary rounded-lg",children:t?r("com_assistants_knowledge_info"):""}),s.jsx(vR,{files:l,setFiles:c,setFilesLoading:o,assistant_id:t,fileFilter:e=>ap.some((t=>t.test(e.type??""))),Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx(vR,{files:l,setFiles:c,setFilesLoading:o,assistant_id:t,fileFilter:e=>!ap.some((t=>t.test(e.type??""))),Wrapper:aA}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-8 rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:!t,onChange:u}),r("com_ui_upload_files")]})})})]})]})}const oA="mb-2 text-token-text-primary block font-medium",iA=n_(f_,"flex w-full px-3 py-2 dark:border-gray-800 dark:bg-gray-800 rounded-xl mb-2",u_);function lA({setAction:e,endpoint:t,actions:a=[],setActivePanel:r,documentsMap:o,assistant_id:i,setCurrentAssistantId:l,assistantsConfig:c,version:d}){const u=mk(),m=xS(),{data:p=[]}=Iy(),{onSelect:f}=function(e){const t=Ik(),{conversation:s,newConversation:a}=Pk(),r=Mk((e=>su(e.data)));return{onSelect:n.useCallback((n=>{var o;const i=null==(o=r[e])?void 0:o[n];if(!i)return;const l={endpoint:e,assistant_id:i.id,model:i.model,conversationId:"new"};if(s_.log("conversation","Updating conversation with assistant",i),Yu(null==s?void 0:s.endpoint)){const e=t({conversation:{...s??{}},preset:l});a({template:e,preset:l,keepLatestMessage:!0})}else a({template:{...l},preset:l})}),[e,r,s,t,a])}}(t),{showToast:h}=Bd(),g=Fk(),x=zo({defaultValues:sm}),[v,b]=n.useState(!1),{control:_,handleSubmit:y,reset:j,setValue:w,getValues:N}=x,C=$o({control:_,name:"assistant"}),k=$o({control:_,name:"functions"}),S=$o({control:_,name:"id"}),E=n.useMemo((()=>{var e,n;return null==(n=null==(e=null==m?void 0:m[t])?void 0:e[S])?void 0:n.model}),[m,t,S]),T=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(xf.tools)}),[c]),I=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(xf.actions)}),[c]),R=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(xf.retrieval)}),[c]),P=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(xf.code_interpreter)}),[c]),A=Ij({onSuccess:e=>{h({message:`${g("com_assistants_update_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_update_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),M=Tj({onSuccess:e=>{l(e.id),h({message:`${g("com_assistants_create_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_create_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),L=n.useMemo((()=>"string"==typeof C?[]:C.files),[C]);let O;return O=M.isLoading||A.isLoading?s.jsx(ac,{className:"icon-md"}):g(S?"com_ui_save":"com_ui_create"),s.jsx(Bo,{...x,children:s.jsxs("form",{onSubmit:y((e=>{const n=[...k].map((e=>{var n,s;if(!e.includes(Cu))return e;{const a=null==(n=null==m?void 0:m[t])?void 0:n[S],r=null==(s=null==a?void 0:a.tools)?void 0:s.find((t=>{var n;return(null==(n=t.function)?void 0:n.name)===e}));if(a&&r)return r}return e}));e.code_interpreter&&n.push({type:hu.code_interpreter}),e.retrieval&&n.push({type:2==d?hu.file_search:hu.retrieval}),e.image_vision&&n.push(rm);const{name:s,description:a,instructions:r,conversation_starters:o,model:i,append_current_datetime:l}=e;S?A.mutate({assistant_id:S,data:{name:s,description:a,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,append_current_datetime:l}}):M.mutate({name:s,description:a,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,version:d,append_current_datetime:l})})),className:"h-auto w-full flex-shrink-0 overflow-x-hidden",children:[s.jsxs("div",{className:"flex w-full flex-wrap",children:[s.jsx(Uo,{name:"assistant",control:_,render:({field:e})=>s.jsx(tA,{reset:j,value:e.value,endpoint:t,documentsMap:o,allTools:p,setCurrentAssistantId:l,selectedAssistant:i??null,createMutation:M})}),S&&s.jsx("button",{className:"btn btn-primary focus:shadow-outline mx-2 mt-1 h-[40px] rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0",type:"button",disabled:!S,onClick:e=>{e.preventDefault(),f(S)},children:g("com_ui_select")})]}),s.jsxs("div",{className:"bg-surface-50 h-auto px-4 pb-8 pt-3 dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(JP,{createMutation:M,assistant_id:S,metadata:C.metadata??null,endpoint:t,version:d}),s.jsx("label",{className:oA,htmlFor:"name",children:g("com_ui_name")}),s.jsx(Uo,{name:"name",control:_,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",max:256,className:iA,id:"name",type:"text",placeholder:g("com_assistants_name_placeholder")})}),s.jsx(Uo,{name:"id",control:_,render:({field:e})=>s.jsx("p",{className:"h-3 text-xs italic text-text-secondary",children:e.value})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:oA,htmlFor:"description",children:g("com_ui_description")}),s.jsx(Uo,{name:"description",control:_,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",max:512,className:iA,id:"description",type:"text",placeholder:g("com_assistants_description_placeholder")})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:oA,htmlFor:"instructions",children:g("com_ui_instructions")}),s.jsx(Uo,{name:"instructions",control:_,render:({field:e})=>s.jsx("textarea",{...e,value:e.value??"",max:32768,className:n_(iA,"min-h-[100px] resize-y"),id:"instructions",placeholder:g("com_assistants_instructions_placeholder"),rows:3})})]}),s.jsx($P,{control:_,setValue:w,getValues:N}),s.jsx("div",{className:"relative mb-6",children:s.jsx(Uo,{name:"conversation_starters",control:_,defaultValue:[],render:({field:e})=>s.jsx(VP,{field:e,inputClass:iA,labelClass:oA})})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:oA,htmlFor:"model",children:g("com_ui_model")}),s.jsx(Uo,{name:"model",control:_,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:n}})=>{var a;return s.jsxs(s.Fragment,{children:[s.jsx(Dd,{emptyTitle:!0,value:e.value,setValue:e.onChange,availableValues:(null==(a=u.data)?void 0:a[t])??[],showAbove:!1,showLabel:!1,className:n_(p_,"flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer"),containerClassName:n_("rounded-md",n?"border-red-500 border-2":"")}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:g("com_ui_field_required")})]})}})]}),(!0===P||!0===R)&&1==d&&s.jsx(rA,{assistant_id:S,files:L,endpoint:t}),s.jsx(QP,{version:d,endpoint:t,codeEnabled:P,assistantsConfig:c,retrievalEnabled:R}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:oA,children:`${!0===T?g("com_ui_tools"):""}\n              ${!0===T&&!0===I?" + ":""}\n              ${!0===I?g("com_assistants_actions"):""}`}),s.jsxs("div",{className:"space-y-2",children:[k.map(((e,t)=>s.jsx(sA,{tool:e,allTools:p,assistant_id:S},`${e}-${t}-${S}`))),a.filter((e=>e.assistant_id===S)).map(((t,n)=>s.jsx(PI,{action:t,onClick:()=>e(t)},n))),s.jsxs("div",{className:"flex space-x-2",children:[!0===T&&s.jsx("button",{type:"button",onClick:()=>b(!0),className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_tools")})}),!0===I&&s.jsx("button",{type:"button",disabled:!S,onClick:()=>{if(!S)return h({message:g("com_assistants_actions_disabled"),status:"warning"});r(Xd.actions)},className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_actions")})})]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(nA,{assistant_id:S,activeModel:E,setCurrentAssistantId:l,createMutation:M,endpoint:t}),s.jsx("button",{className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",children:O})]})]}),s.jsx(BP,{endpoint:t,isOpen:v,setIsOpen:b})]})})}function cA({columns:e,data:t}){const n=lr({columns:e,data:t,getCoreRowModel:ur()});return s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>s.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>s.jsx("th",{className:"py-1 font-normal",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},t)))},t)))}),s.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>s.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>s.jsx("td",{className:"py-2",children:ir(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const dA=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],uA=ko(((e,t)=>{t(Wx(e))}),800);function mA({action:e,assistant_id:t,endpoint:a,version:r,setAction:o}){var i;const l=e=>{e.status||(b(null),y(null)),h(e)},c=Fk(),{showToast:d}=Bd(),u=xS(),{handleSubmit:m,reset:p}=Vo(),[f,h]=n.useState(null),[g,x]=n.useState(""),[v,b]=n.useState(null),[_,y]=n.useState(null);n.useEffect((()=>{var t;const n=(null==(t=null==e?void 0:e.metadata)?void 0:t.raw_spec)??"";n&&(x(n),uA(n,l))}),[null==(i=null==e?void 0:e.metadata)?void 0:i.raw_spec]),n.useEffect((()=>{if(!f||!f.status||!f.spec)return;const{functionSignatures:e,requestBuilders:t}=Kx(f.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));b(n),h(null),y(e.map((e=>e.toObjectTool())))}),[f]);const j=Aj({onSuccess(e){d({message:c("com_assistants_update_actions_success"),status:"success"}),p(),o(e[2])},onError(e){d({message:(null==e?void 0:e.message)??c("com_assistants_update_actions_error"),status:"error"})}}),w=m((n=>{console.log("authFormData",n);const s=t??"";if(!s)return;if(!_)return;if(!v)return;let{metadata:o}=e??{};o||(o={});const i=null==e?void 0:e.action_id;o.raw_spec=g;const l=new URL(v[0].domain).hostname;if(!l)return;o.domain=l;const{type:c,saved_auth_fields:d}=n,m=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};d&&c===gp.ServiceHttp?o={...o,api_key:n.api_key,auth:{type:c,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:d&&c===gp.OAuth?o={...o,auth:{type:c,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:d?(m(o),o.auth={type:c}):m(o),j.mutate({action_id:i,metadata:o,functions:_,assistant_id:s,endpoint:a,version:r,model:(null==u?void 0:u[a][s].model)??""})}));return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"",children:[s.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[s.jsx("label",{htmlFor:"example-schema",className:"text-token-text-primary whitespace-nowrap font-medium",children:c("com_ui_schema")}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{id:"example-schema",onChange:e=>console.log(e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[s.jsx("option",{value:"label",children:c("com_ui_examples")}),s.jsx("option",{value:"0",children:"Weather (JSON)"}),s.jsx("option",{value:"1",children:"Pet Store (YAML)"}),s.jsx("option",{value:"2",children:"Blank Template"})]})})]}),s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[s.jsx("div",{className:"relative",children:s.jsx("textarea",{id:"schemaInput",value:g,onChange:e=>{const t=e.target.value;if(x(t),!t)return b(null),y(null),h(null);uA(t,l)},spellCheck:"false",placeholder:c("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),f&&"OpenAPI spec is valid."!==f.message&&s.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:f.message.split("\n").map(((e,t)=>s.jsx("div",{children:e},t)))})]})]}),!!v&&s.jsxs("div",{className:"my-2",children:[s.jsx("div",{className:"flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_assistants_available_actions")})}),s.jsx(cA,{columns:dA,data:v})]}),s.jsxs("div",{className:"relative my-1",children:[s.jsx(nI,{action_id:null==e?void 0:e.action_id}),s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_ui_privacy_policy_url")})}),s.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:s.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{disabled:!_||!_.length,onClick:w,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:j.isLoading?s.jsx(ac,{className:"icon-md"}):(null==e?void 0:e.action_id.length)?c("com_ui_update"):c("com_ui_create")})})]})}function pA({action:e,endpoint:t,version:a,setAction:r,assistant_id:o,setActivePanel:i}){const l=Fk(),{showToast:c}=Bd(),d=xS(),u=Mj({onSuccess:()=>{c({message:l("com_assistants_delete_actions_success"),status:"success"}),i(Xd.builder),r(void 0)},onError(e){c({message:(null==e?void 0:e.message)??l("com_assistants_delete_actions_error"),status:"error"})}}),m=zo({defaultValues:{type:gp.None,saved_auth_fields:!1,api_key:"",authorization_type:xp.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:vp.DefaultPost}}),{reset:p,watch:f}=m;return n.useEffect((()=>{var t;(null==(t=null==e?void 0:e.metadata)?void 0:t.auth)&&p({type:e.metadata.auth.type||gp.None,saved_auth_fields:!1,api_key:e.metadata.api_key??"",authorization_type:e.metadata.auth.authorization_type||xp.Basic,oauth_client_id:e.metadata.oauth_client_id??"",oauth_client_secret:e.metadata.oauth_client_secret??"",authorization_url:e.metadata.auth.authorization_url??"",client_url:e.metadata.auth.client_url??"",scope:e.metadata.auth.scope??"",token_exchange_method:e.metadata.auth.token_exchange_method??vp.DefaultPost})}),[e,p]),s.jsx(Bo,{...m,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{i(Xd.builder),r(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!e&&s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:!o||!e.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(kc,{className:"text-red-500"})})})}),s.jsx(zd,{showCloseButton:!1,title:l("com_ui_delete_action"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:l("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{const n=o??"";if(!n)return c({message:"No assistant_id found, is the assistant created?",status:"error"});u.mutate({model:(null==d?void 0:d[t][n].model)??"",action_id:e.action_id,assistant_id:n,endpoint:t})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:l("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:(e?"Edit":"Add")+" actions"}),s.jsx("div",{className:"text-xs text-text-secondary",children:l("com_assistants_actions_info")})]}),s.jsx(ZT,{disableOAuth:!0}),s.jsx(mA,{action:e,assistant_id:o,setAction:r,endpoint:t,version:a})]})})})}function fA(){const{conversation:e,index:t}=Pk(),[a,r]=n.useState(Xd.builder),[o,i]=n.useState(void 0),[l,c]=n.useState(null==e?void 0:e.assistant_id),{data:d={}}=Gy(),{data:u=[]}=xj(null==e?void 0:e.endpoint),{data:m=null}=vj((null==e?void 0:e.endpoint)??"",{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),p=n.useMemo((()=>null==d?void 0:d[(null==e?void 0:e.endpoint)??""]),[null==e?void 0:e.endpoint,d]);if(n.useEffect((()=>{const t=(null==e?void 0:e.assistant_id)??"";t&&c(t)}),[null==e?void 0:e.assistant_id]),!(null==e?void 0:e.endpoint))return null;const f=(null==p?void 0:p.version)??Nf[e.endpoint];return a===Xd.actions||o?s.jsx(pA,{index:t,action:o,actions:u,setAction:i,activePanel:a,documentsMap:m,setActivePanel:r,assistant_id:l,setCurrentAssistantId:c,endpoint:e.endpoint,version:f}):a===Xd.builder?s.jsx(lA,{index:t,activePanel:a,action:o,actions:u,setAction:i,documentsMap:m,setActivePanel:r,assistant_id:l,setCurrentAssistantId:c,endpoint:e.endpoint,assistantsConfig:p,version:f}):void 0}function hA({className:e}){const t=Fk(),a=Pe(Ny.promptsName),r=Pe(Ny.promptsCategory),o=hE("/d/prompts",n.useCallback((()=>{a(""),r("")}),[a,r]));return s.jsx(ki,{variant:"outline",className:n_(e,"bg-transparent"),onClick:e=>{o(e)},"aria-label":"Manage Prompts",role:"button",children:t("com_ui_manage")})}const gA=n.memo((function({group:e,instanceProjectId:t}){const a=nt(),r=Fe(),o=Fk(),i=n.useRef(null),[l,c]=n.useState(e.name),{hasPermission:d}=IT("promptGroup",e._id||""),u=d(px.EDIT),m=d(px.DELETE),p=n.useMemo((()=>{var n;return t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e.projectIds,t]),f=Oj({onMutate:()=>{i.current&&clearTimeout(i.current)}}),h=(e=>{const t=pr(),{onSuccess:n,...s}=e||{},a=Ae(Ny.promptsName),r=Ae(Ny.promptsPageSize),o=Ae(Ny.promptsCategory);return fr({mutationFn:e=>Rx.deletePromptGroup(e.id),...s,onSuccess:(e,s,i)=>{t.setQueryData([xx.promptGroups,a,o,r],(e=>e?Hb(e,s.id):e)),qb(t,s.id),n&&n(e,s,i)}})})({onSuccess:(t,n)=>{n.id===e._id&&r("/d/prompts")}}),{isLoading:g}=f,x=n.useCallback((()=>{console.log(e._id??"",{name:l}),f.mutate({id:e._id??"",payload:{name:l}})}),[e._id,l,f]),v=n.useCallback((t=>{"Enter"===t.key&&(t.preventDefault(),r(`/d/prompts/${e._id}`,{replace:!0}))}),[e._id,r]),b=n.useCallback((()=>{h.mutate({id:e._id??""})}),[e._id,h]),_=n.useCallback((()=>{r(`/d/prompts/${e._id}`,{replace:!0})}),[e._id,r]);return s.jsx("div",{className:n_("mx-2 my-2 flex cursor-pointer rounded-lg border border-border-light bg-surface-primary p-3 shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-secondary",a.promptId===e._id&&"bg-surface-hover"),onClick:_,onKeyDown:v,role:"button",tabIndex:0,"aria-label":`${e.name} prompt group`,children:s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 truncate pr-2",children:[s.jsx(VS,{category:e.category??"",className:"icon-lg","aria-hidden":"true"}),s.jsx(dl,{className:"text-md cursor-pointer truncate font-semibold text-text-primary",children:e.name})]}),s.jsxs("div",{className:"flex h-full items-center gap-2",children:[p&&s.jsx(we,{className:"icon-md text-green-500","aria-label":o("com_ui_global_group")}),u&&s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"ghost",onClick:e=>e.stopPropagation(),className:"h-8 w-8 p-0 hover:bg-surface-hover","aria-label":o("com_ui_rename_prompt")+" "+e.name,children:s.jsx(sn,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),s.jsx(zd,{showCloseButton:!1,title:o("com_ui_rename_prompt"),className:"w-11/12 max-w-lg",main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(ll,{value:l,onChange:e=>c(e.target.value),className:"w-full","aria-label":o("com_ui_rename_prompt")+" "+e.name})})}),selection:{selectHandler:x,selectClasses:"bg-surface-submit hover:bg-surface-submit-hover text-white disabled:hover:bg-surface-submit",selectText:o("com_ui_save"),isLoading:g}})]}),m&&s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:e=>e.stopPropagation(),"aria-label":o("com_ui_delete_prompt")+" "+e.name,children:s.jsx(kc,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),s.jsx(zd,{showCloseButton:!1,title:o("com_ui_delete_prompt"),className:"w-11/12 max-w-lg",main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(dl,{htmlFor:"confirm-delete",className:"text-left text-sm font-medium",children:[o("com_ui_delete_confirm")," ",s.jsx("strong",{children:e.name})]})})}),selection:{selectHandler:b,selectClasses:"bg-red-600 dark:bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]})]})]})})})),xA=({currentIndex:e,totalCount:t,onPrevious:n,onNext:a})=>t<=1?null:s.jsxs("div",{className:"flex items-center justify-start gap-1 self-center bg-gray-700 pb-2 text-xs",children:[s.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:n,disabled:0===e,children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})})}),s.jsxs("span",{className:"flex-shrink-0 tabular-nums",children:[e+1," / ",t]}),s.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:a,disabled:e===t-1,children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})})]});function vA({isOpen:e,onOpenChange:t,src:a="",downloadImage:r,args:o}){const i=Fk(),[l,c]=n.useState(!1),[d,u]=n.useState(null),[m,p]=n.useState(1),[f,h]=n.useState(0),[g,x]=n.useState(0),[v,b]=n.useState(!1),[_,y]=n.useState({x:0,y:0}),j=n.useRef(null),w=n.useCallback((async e=>{try{const t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(t){const e=parseInt(t,10);return N(e)}const n=await fetch(e),s=await n.blob();return N(s.size)}catch(t){return console.error("Error getting image size:",t),null}}),[]),N=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},C=n.useCallback((()=>{p(1),h(0),x(0)}),[]),k=n.useCallback((()=>{m>1?C():p(2)}),[m,C]),S=n.useCallback((e=>{if(e.preventDefault(),!j.current)return;const t=j.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,a=e.deltaY>0?.9:1.1,r=Math.min(Math.max(m*a,1),5);if(r===m)return;if(1===r)return p(1),h(0),void x(0);const o=t.width/2,i=t.height/2,l=r/m,c=(n-o-f)*(l-1),d=(s-i-g)*(l-1);p(r),h(f-c),x(g-d)}),[m,f,g]),E=n.useCallback((e=>{e.preventDefault(),m<=1||(b(!0),y({x:e.clientX-f,y:e.clientY-g}))}),[m,f,g]),T=n.useCallback((e=>{if(!v||m<=1)return;const t=e.clientX-_.x,n=e.clientY-_.y;h(t),x(n)}),[v,_,m]),I=n.useCallback((()=>{b(!1)}),[]);return n.useEffect((()=>{const e=e=>"Escape"===e.key&&C();return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[C]),n.useEffect((()=>{e&&a&&(w(a).then(u),C())}),[e,a,w,C]),n.useEffect((()=>{1===m&&(h(0),x(0))}),[m]),n.useEffect((()=>{1===m&&(h(0),x(0))}),[l,m]),s.jsx(ul,{open:e,onOpenChange:t,children:s.jsxs(gl,{showCloseButton:!1,className:"h-full w-full rounded-none bg-transparent",disableScroll:!1,overlayClassName:"bg-surface-primary opacity-95 z-50",children:[s.jsxs("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] absolute left-0 top-0 z-10 flex items-center justify-between p-3 transition-all duration-500 sm:p-4 "+(l?"right-0 sm:right-80":"right-0"),children:[s.jsx(Ol,{description:i("com_ui_close"),render:s.jsx(ki,{onClick:()=>t(!1),variant:"ghost",className:"h-10 w-10 p-0 hover:bg-surface-hover",children:s.jsx(vt,{className:"size-7 sm:size-6"})})}),s.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[m>1&&s.jsx(Ol,{description:i("com_ui_reset_zoom"),render:s.jsx(ki,{onClick:C,variant:"ghost",className:"h-10 w-10 p-0",children:s.jsx(tn,{className:"size-6"})})}),s.jsx(Ol,{description:i("com_ui_download"),render:s.jsx(ki,{onClick:()=>r(),variant:"ghost",className:"h-10 w-10 p-0",children:s.jsx(an,{className:"size-6"})})}),s.jsx(Ol,{description:i(l?"com_ui_hide_image_details":"com_ui_show_image_details"),render:s.jsx(ki,{onClick:()=>c(!l),variant:"ghost",className:"h-10 w-10 p-0",children:l?s.jsx(rn,{className:"size-7 sm:size-6"}):s.jsx(on,{className:"size-7 sm:size-6"})})})]})]}),s.jsx("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] flex h-full transition-all duration-500 "+(l?"mr-0 sm:mr-80":"mr-0"),children:s.jsx("div",{ref:j,className:"flex flex-1 items-center justify-center px-2 pb-4 pt-16 sm:px-4 sm:pt-20",onWheel:S,onMouseDown:E,onMouseMove:T,onMouseUp:I,onMouseLeave:I,onDoubleClick:k,style:{cursor:m<=1?"default":v?"grabbing":"grab",overflow:m>1?"hidden":"visible",minHeight:0},children:s.jsx("div",{className:"flex items-center justify-center transition-transform duration-100 ease-out",style:{transform:`translate(${f}px, ${g}px) scale(${m})`,transformOrigin:"center center",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("img",{src:a,alt:"Image",className:"block object-contain",style:{maxHeight:"calc(100vh - 8rem)",maxWidth:l&&window.innerWidth>=640?"calc(100vw - 22rem)":"calc(100vw - 2rem)",width:"auto",height:"auto"}})})})}),s.jsx("div",{className:"sm:shadow-l-lg ease-[cubic-bezier(0.175,0.885,0.32,1.275)] fixed right-0 top-0 z-20 h-full w-full transform border-l border-border-light bg-surface-primary shadow-2xl backdrop-blur-sm transition-transform duration-500 sm:w-80 sm:rounded-l-2xl "+(l?"translate-x-0":"translate-x-full"),children:s.jsxs("div",{className:"h-full overflow-y-auto p-4 sm:p-6",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between sm:hidden",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:i("com_ui_image_details")}),s.jsx(ki,{onClick:()=>c(!1),variant:"ghost",className:"h-12 w-12 p-0",children:s.jsx(vt,{className:"size-6"})})]}),s.jsxs("div",{className:"mb-4 hidden sm:block",children:[s.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:i("com_ui_image_details")}),s.jsx("div",{className:"mb-4 h-px bg-border-medium"})]}),s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-medium text-text-primary",children:i("com_ui_prompt")}),s.jsx("div",{className:"rounded-md bg-surface-tertiary p-3",children:s.jsx("p",{className:"text-sm leading-relaxed text-text-primary",children:(null==o?void 0:o.prompt)||"No prompt available"})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"mb-3 text-sm font-medium text-text-primary",children:i("com_ui_generation_settings")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_size"),":"]}),s.jsx("span",{className:"text-sm font-medium text-text-primary",children:(null==o?void 0:o.size)||"Unknown"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_quality"),":"]}),s.jsx("span",{className:"rounded px-2 py-1 text-xs font-medium capitalize "+(R=(null==o?void 0:o.quality)||"","high"===R?"bg-green-100 text-green-800":"low"===R?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:(null==o?void 0:o.quality)||"Standard"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_file_size"),":"]}),s.jsx("span",{className:"text-sm font-medium text-text-primary",children:d||"Loading..."})]})]})]})]})]})})]})});var R}const bA=({imagePath:e,altText:t,height:a,width:r,placeholderDimensions:o,className:i,args:l})=>{const[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useRef(null),{width:f,height:h}=n.useMemo((()=>{var e,t;return a_({originalWidth:Number((null==(e=null==o?void 0:o.width)?void 0:e.split("px")[0])??r),originalHeight:Number((null==(t=null==o?void 0:o.height)?void 0:t.split("px")[0])??a),containerRef:p})}),[o,a,r]);return s.jsx("div",{ref:p,children:s.jsxs("div",{className:n_("relative mt-1 flex h-auto w-full max-w-lg items-center justify-center overflow-hidden rounded-lg border border-border-light text-text-secondary-alt shadow-md",i),children:[s.jsx("button",{type:"button","aria-label":`View ${t} in dialog`,onClick:()=>d(!0),className:"cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:s.jsx(ln.LazyLoadImage,{alt:t,onLoad:()=>m(!0),visibleByDefault:!0,className:n_("opacity-100 transition-opacity duration-100",u?"opacity-100":"opacity-0"),src:e,style:{width:`${f}`,height:"auto",color:"transparent",display:"block"},placeholder:s.jsx(Nl,{className:n_("h-auto w-full",`h-[${h}] w-[${f}]`),"aria-label":"Loading image","aria-busy":"true"})})}),u&&s.jsx(vA,{isOpen:c,onOpenChange:d,src:e,downloadImage:async()=>{try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch image: ${n.status}`);const s=await n.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=t||"image.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}catch(n){console.error("Download failed:",n);const s=document.createElement("a");s.href=e,s.download=t||"image.png",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},args:l})]})})},_A=({href:e,filename:t})=>{const{showToast:n}=Bd(),{refetch:s}=((e="")=>mr([xx.fileDownload,e],(async()=>{if(!e)return void console.warn("No user ID provided for file download");const t=(await Rx.getCodeOutputDownload(e)).data;return window.URL.createObjectURL(t)}),{enabled:!1,retry:!1}))(e);return{handleDownload:async e=>{e.preventDefault();try{const e=await s();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void n({status:"error",message:"Error downloading file"});const a=document.createElement("a");a.href=e.data,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e.data)}catch(a){console.error("Error downloading file:",a)}}}},yA=({href:e,filename:t,children:n})=>{const{handleDownload:a}=_A({href:e,filename:t});return s.jsx("a",{href:e,onClick:a,target:"_blank",rel:"noopener noreferrer",className:"!text-blue-400 visited:!text-purple-400 hover:underline",children:n})},jA=n.memo((({attachment:e})=>{var t;const[a,r]=n.useState(!1),{handleDownload:o}=_A({href:e.filepath??"",filename:e.filename??""}),i=null==(t=e.filename)?void 0:t.split(".").pop();return n.useEffect((()=>{const e=setTimeout((()=>r(!0)),50);return()=>clearTimeout(e)}),[]),e.filepath?s.jsx("div",{className:n_("file-attachment-container","transition-all duration-300 ease-out",a?"translate-y-0 opacity-100":"translate-y-2 opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx(fR,{file:e,onClick:o,overrideType:i,containerClassName:"max-w-fit",buttonClassName:"bg-surface-secondary hover:cursor-pointer hover:bg-surface-hover active:bg-surface-secondary focus:bg-surface-hover hover:border-border-heavy active:border-border-heavy"})}):null})),wA=n.memo((({attachment:e})=>{const[t,a]=n.useState(!1),{width:r,height:o,filepath:i=null}=e;return n.useEffect((()=>{a(!1);const e=setTimeout((()=>a(!0)),100);return()=>clearTimeout(e)}),[e]),s.jsx("div",{className:n_("image-attachment-container","transition-all duration-500 ease-out",t?"scale-100 opacity-100":"scale-[0.98] opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx(bA,{altText:e.filename,imagePath:i??"",height:o??0,width:r??0,className:"mb-4"})})}));function NA({attachments:e}){if(!e||0===e.length)return null;const t=[],n=[];return e.forEach((e=>{const{width:s,height:a,filepath:r=null}=e;qm.test(e.filename)&&null!=s&&null!=a&&null!=r?n.push(e):e.type!==hu.web_search&&t.push(e)})),s.jsxs(s.Fragment,{children:[t.length>0&&s.jsx("div",{className:"my-2 flex flex-wrap items-center gap-2.5",children:t.map(((e,t)=>e.filepath?s.jsx(jA,{attachment:e},`file-${t}`):null))}),n.length>0&&s.jsx("div",{className:"mb-2 flex flex-wrap items-center",children:n.map(((e,t)=>s.jsx(wA,{attachment:e},`image-${t}`)))})]})}function CA({progress:e,error:t,toolName:n="image_gen_oai"}){const a=Fk(),r=a(t?"com_ui_error":"image_edit_oai"===n?e>=1?"com_ui_image_edited":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_edit_editing_image":"com_ui_getting_started":e>=1?"com_ui_image_created":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_creating_image":"com_ui_getting_started");return s.jsx("div",{className:n_("progress-text-content pointer-events-none absolute left-0 top-0 inline-flex w-full items-center gap-2 overflow-visible whitespace-nowrap"),children:s.jsx("span",{className:"font-medium "+(e<1?"shimmer":""),children:r})})}function kA({initialProgress:e=.1,isSubmitting:t,toolName:a,args:r="",output:o,attachments:i}){var l,c;const[d,u]=n.useState(e),m=n.useRef(null),p="string"==typeof o&&o.toLowerCase().includes("error processing tool"),f=!t&&e<1||!0===p;let h,g,x,v="high";try{x="string"==typeof r?JSON.parse(r):r}catch(I){console.error("Error parsing args:",I),x={}}try{const e=x;if(e&&"string"==typeof e.size){const[t,n]=e.size.split("x").map((e=>parseInt(e,10)));isNaN(t)||isNaN(n)||(h=t,g=n)}else!e||"string"==typeof e.size&&e.size||(h=void 0,g=void 0);if(e&&"string"==typeof e.quality){const t=e.quality.toLowerCase();"low"!==t&&"medium"!==t&&"high"!==t||(v=t)}}catch(Di){h=void 0,g=void 0}const b=null==i?void 0:i[0],{width:_,height:y,filepath:j=null,filename:w=""}=b||{};let N=h??_,C=g??y;void 0!==N&&void 0!==C||(N=1024,C=1024);const[k,S]=n.useState({width:"auto",height:"auto"}),E=n.useRef(null),T=n.useCallback((()=>{if(N&&C&&E.current){const e=a_({originalWidth:N,originalHeight:C,containerRef:E});S(e)}}),[N,C]);return n.useEffect((()=>{if(t){u(e),m.current&&clearInterval(m.current);let t=2e4;"low"===v?t=1e4:"high"===v&&(t=5e4);const n=Math.floor(.3*t),s=200,a=(Math.floor(Math.random()*n)+t)/s;let r=0;m.current=setInterval((()=>{if(r++,r>=a)clearInterval(m.current),u(.9);else{const e=r/a;let t;if(e<.8)t=Math.pow(e,1.1);else{const n=(e-.8)/.2;t=.8+.2*(1-Math.pow(1-n,2))}u(.1+.8*t)}}),s)}return()=>{m.current&&clearInterval(m.current)}}),[e,v]),n.useEffect((()=>{(e>=1||f)&&(u(e),m.current&&clearInterval(m.current))}),[e,f]),n.useEffect((()=>{T();const e=new ResizeObserver((()=>{T()}));return E.current&&e.observe(E.current),()=>{e.disconnect()}}),[T]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:s.jsx(CA,{progress:d,error:f,toolName:a})}),s.jsx("div",{className:"relative mb-2 flex w-full justify-start",children:s.jsxs("div",{ref:E,className:"w-full max-w-lg",children:["auto"!==k.width&&d<1&&s.jsx(bd,{variant:"default",progress:d,randomness:.6,width:k.width,height:k.height}),s.jsx(bA,{altText:w,imagePath:j??"",width:Number(null==(l=k.width)?void 0:l.split("px")[0]),height:Number(null==(c=k.height)?void 0:c.split("px")[0]),placeholderDimensions:{width:k.width,height:k.height},args:x})]})})]})}class SA extends S.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Markdown rendering error:",e,t)}componentDidUpdate(e){e.content!==this.props.content&&this.state.hasError&&this.setState({hasError:!1,error:void 0})}render(){if(this.state.hasError){const{content:e,codeExecution:t=!0}=this.props,n=[[Xo,{detect:!0,ignoreMissing:!0,subset:jb}]];return s.jsx(NS,{children:s.jsx(Yo,{remarkPlugins:[Zo,Jo],rehypePlugins:n,components:{code:t?jM:wM,a:NM,p:CM},children:e})})}return this.props.children}}const EA=n.memo((({content:e="",codeExecution:t=!0})=>{const n=[[ei],[Xo,{detect:!0,ignoreMissing:!0,subset:jb}]];return s.jsx(SA,{content:e,codeExecution:t,children:s.jsx(jS,{children:s.jsx(NS,{children:s.jsx(Yo,{remarkPlugins:[Zo,Jo,[ti,{singleDollarTextMath:!1}]],rehypePlugins:n,components:{code:t?jM:wM,a:NM,p:CM},children:e})})})})}));function TA(e){return`https://www.google.com/s2/favicons?domain=${e}&sz=32`}function IA(e){const t=e.replace(/(^\w+:|^)\/\//,"").split("/")[0];return t.startsWith("www.")?t.substring(4):t}function RA({domain:e,className:t=""}){return s.jsxs("div",{className:n_("relative size-4 flex-shrink-0 overflow-hidden rounded-full",t),children:[s.jsx("div",{className:"absolute inset-0 rounded-full bg-white"}),s.jsx("img",{src:TA(e),alt:e,className:"relative size-full"}),s.jsx("div",{className:"border-border-light/10 absolute inset-0 rounded-full border dark:border-transparent"})]})}function PA({source:e,label:t,onMouseEnter:n,onMouseLeave:a,onClick:r,isFile:o=!1,isLocalFile:i=!1,children:l}){const c=Fk(),d=IA(e.link||"");return s.jsx("span",{className:"relative ml-0.5 inline-block",children:s.jsx(Ot,{showTimeout:150,hideTimeout:150,children:s.jsxs("span",{className:"flex items-center",children:[s.jsx(Dt,{render:o?s.jsx("button",{onClick:r,className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium text-blue-600 no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:text-blue-400 dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,title:i?c("com_sources_download_local_unavailable"):void 0,children:t}):s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,children:t})}),s.jsxs(Ut,{className:"ml-0.5 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(zt,{children:c("com_citation_more_details",{label:t})}),s.jsx(Pt,{className:"icon-sm"})]}),s.jsxs(Vt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:[l,!l&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"mb-2 flex items-center",children:[o?s.jsx("div",{className:"mr-2 flex h-4 w-4 items-center justify-center",children:s.jsx(cn,{className:"h-3 w-3 text-text-secondary"})}):s.jsx(RA,{domain:d,className:"mr-2"}),o?s.jsx("button",{onClick:r,className:"line-clamp-2 cursor-pointer overflow-hidden text-left text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||e.title||c("com_file_source")}):s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||d})]}),o?s.jsx(s.Fragment,{children:e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})}):s.jsxs(s.Fragment,{children:[s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]})]})]})]})})})}const AA=n.createContext({hoveredCitationId:null,setHoveredCitationId:()=>{}}),MA={search:"organic",ref:"references",news:"topStories",file:"references"};function LA(e){var t;const a=Fk(),{citations:r,citationId:o}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:i}=n.useContext(AA),[l,c]=n.useState(0),d=function(e){const{searchResults:t}=ES(),n=[];for(const{turn:s,refType:a,index:r}of e){const e=MA[a.toLowerCase()]?MA[a.toLowerCase()]:a;if(!t||!t[s]||!t[s][e])continue;const o=t[s][e][r];o&&n.push({...o,turn:s,refType:a.toLowerCase(),index:r,link:o.link??"",title:o.title??"",snippet:o.snippet??"",attribution:o.attribution??""})}return n}(r||[]);if(!d||0===d.length)return null;const u=d.length,m=null==d?void 0:d[l];return s.jsxs(PA,{source:m,label:(()=>{if(!d||0===d.length)return a("com_citation_source");const e=d[0],t=d.length-1,n=e.attribution||e.title||IA(e.link||"")||a("com_citation_source");return t>0?`${n} +${t}`:n})(),onMouseEnter:()=>i(o||null),onMouseLeave:()=>i(null),children:[u>1&&s.jsxs("span",{className:"mb-2 flex items-center justify-between border-b border-border-heavy pb-2",children:[s.jsxs("span",{className:"flex gap-2",children:[s.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),l>0&&c(l-1)},disabled:0===l,style:{opacity:0===l?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:"←"}),s.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),l<u-1&&c(l+1)},disabled:l===u-1,style:{opacity:l===u-1?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:"→"})]}),s.jsxs("span",{className:"text-xs text-text-tertiary",children:[l+1,"/",u]})]}),s.jsxs("span",{className:"mb-2 flex items-center",children:[s.jsx(RA,{domain:IA(m.link||""),className:"mr-2"}),s.jsx("a",{href:m.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:m.attribution})]}),s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:m.title}),s.jsx("p",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:m.snippet})]})}function OA(e){var t,a;const r=Fk(),o=Ae(Ny.user),{showToast:i}=Bd(),{citation:l,citationId:c}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:d}=n.useContext(AA),u=function({turn:e,index:t,refType:n}){const{searchResults:s}=ES();if(!n)return;const a=MA[n.toLowerCase()]?MA[n.toLowerCase()]:n;if(!s||!s[e]||!s[e][a])return;const r=s[e][a][t];return r?{...r,turn:e,refType:n.toLowerCase(),index:t,link:r.link??"",title:r.title??"",snippet:r.snippet??"",attribution:r.attribution??""}:void 0}({turn:(null==l?void 0:l.turn)||0,refType:null==l?void 0:l.refType,index:(null==l?void 0:l.index)||0}),m="file"===(null==u?void 0:u.refType)&&(null==u?void 0:u.fileId),p=m&&"local"===(null==(a=null==u?void 0:u.metadata)?void 0:a.storageType),{refetch:f}=Xy((null==o?void 0:o.id)??"",m&&!p?u.fileId:""),h=n.useCallback((async e=>{if(e.preventDefault(),e.stopPropagation(),m&&(null==u?void 0:u.fileId))if(p)i({status:"error",message:r("com_sources_download_local_unavailable")});else try{const e=await f();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void i({status:"error",message:r("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",u.fileName||"file"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t),i({status:"error",message:r("com_ui_download_error")})}}),[f,m,p,u,r,i]);if(!u)return null;return s.jsx(PA,{source:u,label:u.attribution||u.title||IA(u.link||"")||r("com_citation_source"),onMouseEnter:()=>d(c||null),onMouseLeave:()=>d(null),onClick:m&&!p?h:void 0,isFile:m,isLocalFile:p})}const DA=n.memo((function({children:e,citationId:t}){const a=function(e){const{hoveredCitationId:t}=n.useContext(AA);return e&&t===e}(t);return s.jsx("span",{className:"rounded px-0 py-0.5 transition-colors "+(a?"bg-amber-300/20":""),children:e})})),FA=({artifact:e})=>{const t=Fk(),a=De(),r=Pe(Ny.artifactsVisibility),[o,i]=Re(Ny.artifactsState),l=Pe(Ny.currentArtifactId),c=Oe(Ny.currentArtifactId),[d,u]=Re(Ny.visibleArtifacts),m=n.useRef(ko((e=>{s_.log("artifacts_visibility","Setting artifact to visible state from Artifact button",e),u((t=>({...t,[e.id]:e})))}),750));if(n.useEffect((()=>{if(null==e||null==(null==e?void 0:e.id)||""===e.id)return;if(!a.pathname.includes("/c/"))return;const t=m.current;return t(e),()=>{t.cancel()}}),[e,a.pathname]),null==e)return null;const p=Mv("artifact");return s.jsxs("div",{className:"group relative my-4 rounded-xl text-sm text-text-primary",children:[s.jsx("button",{type:"button",onClick:()=>{a.pathname.includes("/c/")&&(c(),r(!0),null==(null==o?void 0:o[e.id])&&i(d),setTimeout((()=>{l(e.id)}),15))},className:"relative overflow-hidden rounded-xl border border-border-medium transition-all duration-300 hover:border-border-xheavy hover:shadow-lg",children:s.jsx("div",{className:"w-fit bg-surface-tertiary p-2",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.jsx(mR,{fileType:p,className:"relative"}),s.jsxs("div",{className:"overflow-hidden text-left",children:[s.jsx("div",{className:"truncate font-medium",children:e.title}),s.jsx("div",{className:"truncate text-text-secondary",children:t("com_ui_artifact_click")})]})]})})}),s.jsx("br",{})]})},zA=()=>e=>{dn(e,["textDirective","leafDirective","containerDirective"],((e,t,n)=>{if("textDirective"===e.type){const s=`:${e.name}`;n&&Array.isArray(n.children)&&"number"==typeof t&&(n.children[t]={type:"text",value:s})}if("artifact"===e.name)return e.data={hName:e.name,hProperties:e.attributes,...e.data},e}))},UA="untitled",VA="unknown",BA="lc-no-identifier";function $A({node:e,...t}){const a=De(),{messageId:r}=pS(),{getNextIndex:o,resetCounter:i}=n.useContext(yS),l=n.useRef(o(!1)).current,c=Pe(b_),[d,u]=n.useState(null),m=n.useRef(Eo((e=>{e()}),25)),p=n.useCallback((()=>{const e=x_(t.children);s_.log("artifacts","updateArtifact: content.length",e.length);const n=t.title??UA,s=t.type??VA,o=t.identifier??BA,i=`${o}_${s}_${n}_${r}`.replace(/\s+/g,"_").toLowerCase();m.current((()=>{const t=Date.now();if(i===`${BA}_${VA}_${UA}_${r}`)return;const d={id:i,identifier:o,title:n,type:s,content:e,messageId:r,index:l,lastUpdateTime:t};if(!a.pathname.includes("/c/"))return u(d);c((t=>{var n;return null!=(null==t?void 0:t[i])&&(null==(n=t[i])?void 0:n.content)===e?t:{...t,[i]:d}})),u(d)}))}),[t.type,t.title,c,t.children,t.identifier,r,l,a.pathname]);return n.useEffect((()=>{i(),p()}),[p,i]),s.jsx(FA,{artifact:d})}function HA(e,t){const n=e.substring(0,t),s=n.lastIndexOf("\\ue200"),a=n.lastIndexOf("\\ue201");return-1===s||-1!==a&&a>s}function GA(e,t){BE.lastIndex=t,$E.lastIndex=t,HE.lastIndex=t;const n=BE.exec(e),s=$E.exec(e);let a,r=null;for(HE.lastIndex=t;!r&&null!==(a=HE.exec(e));)HA(e,a.index)&&(r=a);let o=null,i="",l=-1,c=-1;return n&&(!o||n.index<l||-1===l)&&(o=n,i="span",l=n.index,c=0),s&&(!o||s.index<l||-1===l)&&(o=s,i="composite",l=s.index,c=0),r&&(!o||r.index<l||-1===l)&&(o=r,i="standalone",l=r.index,c=0),o?{type:i,match:o,index:c}:null}function KA(){return e=>{!function(e){dn(e,"text",((e,t,n)=>{var s;const a=e,r=n;if("string"!=typeof a.value)return;const o=a.value,i=[];let l=0;const c=new Map,d={span:0,composite:0,standalone:0};for(;l<o.length;){const e=GA(o,l);if(!e){const e=o.substring(l).replace(GE,"");e&&i.push({type:"text",value:e});break}const{type:t,match:n}=e,s=n.index,a=n[0];if(s>l){const e=o.substring(l,s).replace(GE,"");e&&i.push({type:"text",value:e})}const r=`${t}-${d[t]}-${s}`;switch(c.set(s,r),t){case"span":{const e=a.replace(/\\ue203|\\ue204/g,"");let t=null;const n=s+a.length,r=GA(o,n);if(r&&("standalone"===r.type||"composite"===r.type)&&r.match.index-n<5){const e=r.match.index,n=r.type;t=`${n}-${d[n]}-${e}`}i.push({type:"highlighted-text",data:{hName:"highlighted-text",hProperties:{citationId:t}},children:[{type:"text",value:e}]}),d.span++;break}case"composite":{const e=a,t=new RegExp(HE.source,"g");let n;const s=[];for(;null!==(n=t.exec(e));){const e=Number(n[1]),t=n[2],a=Number(n[3]);s.push({turn:e,refType:t,index:a})}s.length>0&&i.push({type:"composite-citation",data:{hName:"composite-citation",hProperties:{citations:s,citationId:r}}}),d.composite++;break}case"standalone":{const e=Number(n[1]),t=n[2],s=Number(n[3]);i.push({type:"citation",data:{hName:"citation",hProperties:{citation:{turn:e,refType:t,index:s},citationType:"standalone",citationId:r}}}),d.standalone++;break}}l=s+a.length}if(i.length>0&&void 0!==t)return null==(s=r.children)||s.splice(t,1,...i),t+i.length;a.value!==a.value.replace(GE,"")&&(a.value=a.value.replace(GE,""))}))}(e)}}const WA=n.memo((({content:e="",isLatestMessage:t})=>{const a=Ae(Ny.LaTeXParsing),r=""===e,o=n.useMemo((()=>r?"":a?Kv(e):e),[e,a,r]),i=n.useMemo((()=>[[ei],[Xo,{detect:!0,ignoreMissing:!0,subset:jb}]]),[]),l=[Zo,Jo,ni,zA,[ti,{singleDollarTextMath:!1}],KA];return r?s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"relative",children:s.jsx("span",{className:t?"result-thinking":""})})}):s.jsx(SA,{content:e,codeExecution:!0,children:s.jsx(jS,{children:s.jsx(NS,{children:s.jsx(Yo,{remarkPlugins:l,rehypePlugins:i,components:{code:jM,a:NM,p:CM,artifact:$A,citation:OA,"highlighted-text":DA,"composite-citation":LA},children:o})})})})})),qA=n.memo((({text:e,isCreatedByUser:t,showCursor:a})=>{const{messageId:r}=pS(),{isSubmitting:o,latestMessage:i}=Pk(),l=Ae(Ny.enableUserMsgMarkdown),c=n.useMemo((()=>a&&o),[a,o]),d=n.useMemo((()=>r===(null==i?void 0:i.messageId)),[r,null==i?void 0:i.messageId]),u=n.useMemo((()=>t?l?s.jsx(EA,{content:e}):s.jsx(s.Fragment,{children:e}):s.jsx(WA,{content:e,isLatestMessage:d})),[t,l,e,d]);return s.jsx("div",{className:n_(o?"submitting":"",c&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!l&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:u})})),QA="group mt-3 flex w-fit items-center justify-center rounded-xl bg-surface-tertiary px-3 py-2 text-xs leading-[18px] animate-thinking-appear",YA="icon-sm ml-1.5 transform-gpu text-text-primary transition-transform duration-200",XA="relative pl-3 text-text-secondary",ZA="absolute left-0 h-[calc(100%-10px)] border-l-2 border-border-medium dark:border-border-heavy",JA="absolute left-0 h-[calc(100%)] border-l-2 border-border-medium dark:border-border-heavy",eM="whitespace-pre-wrap leading-[26px]",tM=n.memo((({isPart:e,children:t})=>s.jsxs("div",{className:XA,children:[s.jsx("div",{className:!0===e?JA:ZA}),s.jsx("p",{className:eM,children:t})]}))),nM=n.memo((({isExpanded:e,onClick:t,label:n})=>s.jsxs("button",{type:"button",onClick:t,className:QA,children:[s.jsx(un,{size:14,className:"mr-1.5 text-text-secondary"}),n,s.jsx(Pt,{className:`${YA} ${e?"rotate-180":""}`})]}))),sM=n.memo((({children:e})=>{const t=Fk(),a=Ae(Ny.showThinking),[r,o]=n.useState(a),i=n.useCallback((e=>{e.preventDefault(),o((e=>!e))}),[]),l=n.useMemo((()=>t("com_ui_thoughts")),[t]);return null==e?null:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-5",children:s.jsx(nM,{isExpanded:r,onClick:i,label:l})}),s.jsx("div",{className:n_("grid transition-all duration-300 ease-out",r&&"mb-8"),style:{gridTemplateRows:r?"1fr":"0fr"},children:s.jsx("div",{className:"overflow-hidden",children:s.jsx(tM,{isPart:!0,children:e})})})]})}));nM.displayName="ThinkingButton",tM.displayName="ThinkingContent",sM.displayName="Thinking";const aM=n.memo(sM),rM=n.memo((({reasoning:e})=>{const{isExpanded:t,nextType:a}=pS(),r=n.useMemo((()=>e.replace(/^<think>\s*/,"").replace(/\s*<\/think>$/,"").trim()),[e]);return r?s.jsx("div",{className:n_("grid transition-all duration-300 ease-out",a!==Ph.THINK&&t&&"mb-8"),style:{gridTemplateRows:t?"1fr":"0fr"},children:s.jsx("div",{className:"overflow-hidden",children:s.jsx(tM,{isPart:!0,children:r})})}):null})),oM=n.memo((()=>s.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:s.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"submitting relative",children:s.jsx("span",{className:"result-thinking"})})})})}))),iM=({output:e="",renderImages:t,attachments:a})=>{const r=Fk(),o=n.useMemo((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]),{imageAttachments:i,nonImageAttachments:l}=n.useMemo((()=>{const e=[],n=[];return null==a||a.forEach((t=>{const{width:s,height:a,filepath:r=null}=t;qm.test(t.filename)&&null!=s&&null!=a&&null!=r?e.push(t):n.push(t)})),{imageAttachments:!0===t?e:null,nonImageAttachments:n}}),[a,t]),c=e=>{const t=new Date,n="number"==typeof e.expiresAt?new Date(e.expiresAt):null;return!!n&&Fo(t,n)?`${e.filename} ${r("com_download_expired")}`:s.jsxs(yA,{href:e.filepath,filename:e.filename,children:["- ",e.filename," ",r("com_click_to_download")]})};return s.jsxs(s.Fragment,{children:[o&&s.jsx("div",{children:o}),l.length>0&&s.jsxs("div",{children:[s.jsx("p",{children:r("com_generated_files")}),l.map(((e,t)=>s.jsxs(S.Fragment,{children:[c(e),t<l.length-1&&", "]},e.filepath)))]}),null==i?void 0:i.map(((e,t)=>{const{width:n,height:a,filepath:r}=e;return s.jsx(bA,{altText:e.filename,imagePath:r,height:a,width:n},t)}))]})};function lM(){return s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full bg-transparent text-text-secondary",children:s.jsx(vt,{className:"size-4"})})}function cM(){return s.jsx("div",{className:"flex size-4 items-center justify-center rounded-full bg-brand-purple text-white","data-projection-id":"162",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 8",fill:"none",width:"8",height:"8",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.66607 0.376042C8.01072 0.605806 8.10385 1.07146 7.87408 1.4161L3.54075 7.9161C3.40573 8.11863 3.18083 8.24304 2.93752 8.24979C2.69421 8.25654 2.46275 8.1448 2.31671 7.95008L0.150044 5.06119C-0.098484 4.72982 -0.0313267 4.25972 0.300044 4.01119C0.631415 3.76266 1.10152 3.82982 1.35004 4.16119L2.88068 6.20204L6.62601 0.584055C6.85577 0.239408 7.32142 0.146278 7.66607 0.376042Z",fill:"currentColor"})})})}const dM="progress-text-wrapper text-token-text-secondary relative -mt-[0.75px] h-5 w-full leading-5",uM=({popover:e,children:t})=>e?s.jsx("div",{className:dM,children:s.jsx(Wa,{asChild:!0,children:s.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})})}):s.jsx("div",{className:dM,children:s.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})});function mM({progress:e,onClick:t,inProgressText:n,finishedText:a,authText:r,hasInput:o=!0,popover:i=!1,isExpanded:l=!1,error:c=!1}){const d=c?a:e<1?r??n:a,u=c?s.jsx(lM,{}):e<1?s.jsx(ac,{}):s.jsx(cM,{}),m=e<1&&!c;return s.jsx(uM,{popover:i,children:s.jsxs("button",{type:"button",className:n_("inline-flex w-full items-center gap-2",o?"":"pointer-events-none"),disabled:!o,onClick:o?t:void 0,children:[u,s.jsx("span",{className:m?"shimmer":"",children:d}),o&&(l?s.jsx(mn,{className:"size-4 shrink-0 translate-y-[1px]"}):s.jsx(Pt,{className:"size-4 shrink-0 translate-y-[1px]"}))]})})}const pM=({output:e=""})=>{const t=n.useMemo((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]);return t&&s.jsx("pre",{className:"shrink-0",children:s.jsx("div",{className:"text-text-primary",children:t})})};function fM({initialProgress:e=.1,args:t,output:a="",attachments:r}){const o=Fk(),i=Ae(Ny.showCode),[l,c]=n.useState(i),d=n.useRef(null),[u,m]=n.useState(0),[p,f]=n.useState(!1),h=a.length>0,g=n.useRef(a),x=n.useRef(l),{lang:v,code:b}=function(e){return n.useMemo((()=>{let t=e;try{t=JSON.parse(e||"")}catch{}if("object"==typeof t)return t;const n=null==e?void 0:e.match(/"lang"\s*:\s*"(\w+)"/),s=null==e?void 0:e.match(/"code"\s*:\s*"(.+?)(?="\s*,\s*"(session_id|args)"|"\s*})/s);let a="";return s&&(a=s[1],a.endsWith('"}')&&(a=a.slice(0,-2)),a=a.replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\\\/g,"\\")),{lang:n?n[1]:"",code:a}}),[e])}(t)??{},_=FE(e);return n.useEffect((()=>{a!==g.current&&(g.current=a,l&&d.current&&setTimeout((()=>{if(d.current){const e=d.current.scrollHeight;m(e)}}),10))}),[a,l]),n.useEffect((()=>{if(l!==x.current)if(x.current=l,l&&d.current)f(!0),requestAnimationFrame((()=>{if(d.current){const e=d.current.scrollHeight;m(e)}const e=setTimeout((()=>{f(!1)}),500);return()=>clearTimeout(e)}));else if(!l){f(!0),m(0);const e=setTimeout((()=>{f(!1)}),500);return()=>clearTimeout(e)}}),[l]),n.useEffect((()=>{if(!d.current)return;const e=new ResizeObserver((e=>{if(l&&!p)for(const t of e)t.target===d.current&&m(t.contentRect.height)}));return e.observe(d.current),()=>{e.disconnect()}}),[l,p]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:s.jsx(mM,{progress:_,onClick:()=>c((e=>!e)),inProgressText:o("com_ui_analyzing"),finishedText:o("com_ui_analyzing_finished"),hasInput:!!(null==b?void 0:b.length),isExpanded:l})}),s.jsx("div",{className:"relative mb-2",style:{height:l?u:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:l?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsxs("div",{className:n_("code-analyze-block mt-0.5 overflow-hidden rounded-xl bg-surface-primary",l&&"shadow-lg"),ref:d,style:{transform:l?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:l?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:[l&&s.jsx("div",{style:{transform:l?"translateY(0)":"translateY(-4px)",opacity:l?1:0,transition:"transform 0.35s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.35s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx(EA,{content:b?`\`\`\`${v}\n${b}\n\`\`\``:"",codeExecution:!1})}),h&&s.jsx("div",{className:n_("bg-surface-tertiary p-4 text-xs",l?"border-t border-surface-primary-contrast":""),style:{transform:l?"translateY(0)":"translateY(-6px)",opacity:l?1:0,transition:"transform 0.45s cubic-bezier(0.16, 1, 0.3, 1) 0.05s, opacity 0.45s cubic-bezier(0.19, 1, 0.22, 1) 0.05s",boxShadow:l?"0 -1px 0 rgba(0,0,0,0.05)":"none"},children:s.jsx("div",{className:"prose flex flex-col-reverse",children:s.jsx(pM,{output:a})})})]})}),r&&r.length>0&&s.jsx(NA,{attachments:r})]})}const hM=({currentAgentId:e})=>{const t=Fk(),a=Dk()||{},r=n.useMemo((()=>a[e]),[a,e]);return e?s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-6 flex h-full w-4 items-center justify-center",children:s.jsxs("div",{className:"relative h-full w-4",children:[s.jsx("div",{className:"absolute left-0 top-0 h-1/2 w-px border border-border-medium"}),s.jsx("div",{className:"absolute left-0 top-1/2 h-px w-3 border border-border-medium"})]})}),s.jsxs("div",{className:"my-4 flex items-center gap-2",children:[s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(bI,{message:{endpoint:Uu.agents,isCreatedByUser:!1},agent:r})}),s.jsx("div",{className:"text-base font-medium text-text-primary",children:(null==r?void 0:r.name)||t("com_ui_agent")})]})]}):null},gM=n.memo((({message:e})=>{const t=n.useMemo((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")})))||[]}),[null==e?void 0:e.files]),a=n.useMemo((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return!(!0===(null==(t=e.type)?void 0:t.startsWith("image/")))})))||[]}),[null==e?void 0:e.files]);return s.jsxs(s.Fragment,{children:[a.length>0&&a.map((e=>s.jsx(fR,{file:e},e.file_id))),t.length>0&&t.map((e=>s.jsx(bA,{imagePath:e.preview??e.filepath??"",height:e.height??1920,width:e.width??1080,altText:e.filename??"Uploaded Image",placeholderDimensions:{height:`${e.height??1920}px`,width:`${e.height??1080}px`}},e.file_id)))]})})),xM=({children:e,message:t})=>s.jsxs("div",{className:"text-message flex min-h-[20px] flex-col items-start gap-3 overflow-visible [.text-message+&]:mt-5",dir:"auto",children:[!0===(null==t?void 0:t.isCreatedByUser)&&s.jsx(gM,{message:t}),e]}),vM=({part:e,index:t,messageId:a,isSubmitting:r,enterEdit:o})=>{const i=Fk(),{addedIndex:l}=aS(),{ask:c,getMessages:d,setMessages:u,conversation:m}=Pk(),[p,f]=Re(Ny.latestMessageFamily(l)),{conversationId:h=""}=m??{},g=n.useMemo((()=>{var e;return null==(e=d())?void 0:e.find((e=>e.messageId===a))}),[d,a]),x=Ae(Ny.chatDirection),v=n.useRef(null),b=function(e){var t=pr();return fr((function(e){return function(e){var t=e.conversationId,n=e.messageId,s=e.index,a=e.text;if(!t)throw new Error("conversationId is required");return qC.put(SN({conversationId:t,messageId:n}),{text:a,index:s})}(e)}),{onSuccess:function(){t.invalidateQueries([QC.messages,e])}})}(h??""),_="rtl"===(null==x?void 0:x.toLowerCase()),{register:y,handleSubmit:j,setValue:w}=zo({defaultValues:{text:(Ph.THINK in e?e.think:e.text)||""}});n.useEffect((()=>{const e=v.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const N=n.useCallback((e=>{"Escape"===e.key&&(e.preventDefault(),o(!0))}),[o]),{ref:C,...k}=y("text",{required:!0,onChange:e=>{w("text",e.target.value,{shouldValidate:!0})}});return s.jsxs(xM,{message:g,children:[s.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:s.jsx(Ml,{...k,ref:e=>{C(e),v.current=e},onKeyDown:N,"data-testid":"message-text-editor",className:n_("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",_?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",m_),dir:_?"rtl":"ltr"})}),s.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[s.jsx("button",{className:"btn btn-primary relative mr-2",disabled:r,onClick:j((n=>{const s=d(),r=null==s?void 0:s.find((e=>e.messageId===(null==g?void 0:g.parentMessageId))),i=e.type===Ph.THINK?{index:t,type:Ph.THINK,[Ph.THINK]:n.text}:{index:t,type:Ph.TEXT,[Ph.TEXT]:n.text};r&&(c({...r},{editedContent:i,editedMessageId:a,isRegenerate:!0,isEdited:!0}),o(!0))})),children:i("com_ui_save_submit")}),s.jsx("button",{className:"btn btn-secondary relative mr-2",disabled:r,onClick:j((e=>{var n;const s=d();if(!s)return;b.mutate({index:t,conversationId:h??"",text:e.text,messageId:a}),a===(null==p?void 0:p.messageId)&&f({...p,text:e.text});if(!s.some((e=>e.messageId===a)))return o(!0);const r=null==(n=null==g?void 0:g.content)?void 0:n.map(((n,s)=>n.type===Ph.TEXT&&s===t?{...n,text:e.text}:n));u(s.map((e=>e.messageId===a?{...e,content:r}:e))),o(!0)})),children:i("com_ui_save")}),s.jsx("button",{className:"btn btn-neutral relative",onClick:()=>o(!0),children:i("com_ui_cancel")})]})]})},bM=S.memo((({lang:e,codeRef:t,blockIndex:a})=>{const r=Fk(),{showToast:o}=Bd(),i=((e,t)=>{const n=pr();return fr((t=>Rx.callTool({toolId:e,toolParams:t})),{onMutate:e=>{var n;return null==(n=null==t?void 0:t.onMutate)?void 0:n.call(t,e)},onError:(e,n,s)=>{var a;return null==(a=null==t?void 0:t.onError)?void 0:a.call(t,e,n,s)},onSuccess:(e,s,a)=>{var r;return n.setQueryData([xx.toolCalls,s.conversationId],(t=>[...t??[],{user:"",toolId:hu.execute_code,partIndex:s.partIndex,messageId:s.messageId,blockIndex:s.blockIndex,conversationId:s.conversationId,result:e.result,attachments:e.attachments}])),null==(r=null==t?void 0:t.onSuccess)?void 0:r.call(t,e,s,a)}})})(hu.execute_code,{onError:()=>{o({message:r("com_ui_run_code_error"),status:"error"})}}),{messageId:l,conversationId:c,partIndex:d}=pS(),u=n.useMemo((()=>function(e){const t=e.toLowerCase().trim(),n=wb[t];return n||""}(e)),[e]),{data:m}=oj({toolId:hu.execute_code},{retry:1}),p=n.useMemo((()=>(null==m?void 0:m.message)??!1),[null==m?void 0:m.message]),f=n.useMemo((()=>(null==m?void 0:m.authenticated)??!1),[null==m?void 0:m.authenticated]),{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:v,handleRevokeApiKey:b}=nT({}),_=n.useCallback((async()=>{var e;if(!f)return void v(!0);const n=(null==(e=t.current)?void 0:e.textContent)??"";"string"==typeof n&&0!==n.length&&"string"==typeof u&&0!==u.length&&i.mutate({partIndex:d,messageId:l,blockIndex:a,conversationId:c??"",lang:u,code:n})}),[t,i,d,l,a,c,u,v,f]),y=n.useMemo((()=>ko(_,1e3,{leading:!0})),[_]);return n.useEffect((()=>()=>{y.cancel()}),[y]),"string"!=typeof u||0===u.length?null:s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:n_("ml-auto flex gap-2"),onClick:y,disabled:i.isLoading,children:[i.isLoading?s.jsx(ac,{className:"animate-spin",size:18}):s.jsx(Ve,{size:18}),r("com_ui_run_code")]}),s.jsx(TR,{onSubmit:g,isOpen:x,register:h.register,onRevoke:b,onOpenChange:v,handleSubmit:h.handleSubmit,isToolAuthenticated:f,isUserProvided:p===Mu.USER_PROVIDED})]})})),_M=S.memo((({lang:e,error:t,codeRef:a,blockIndex:r,plugin:o=null,allowExecution:i=!0})=>{const l=Fk(),[c,d]=n.useState(!1);return s.jsxs("div",{className:"relative flex items-center justify-between rounded-tl-md rounded-tr-md bg-gray-700 px-4 py-2 font-sans text-xs text-gray-200 dark:bg-gray-700",children:[s.jsx("span",{className:"",children:e}),!0===o?s.jsx(pn,{className:"ml-auto flex h-4 w-4 gap-2 text-white/50"}):s.jsxs("div",{className:"flex items-center justify-center gap-4",children:[!0===i&&s.jsx(bM,{lang:e,codeRef:a,blockIndex:r}),s.jsx("button",{type:"button",className:n_("ml-auto flex gap-2",!0===t?"h-4 w-4 items-start text-white/50":""),onClick:async()=>{var e;const t=null==(e=a.current)?void 0:e.textContent;null!=t&&(d(!0),ot(t.trim(),{format:"text/plain"}),setTimeout((()=>{d(!1)}),3e3))},children:c?s.jsxs(s.Fragment,{children:[s.jsx(oc,{className:"h-[18px] w-[18px]"}),!0===t?"":l("com_ui_copied")]}):s.jsxs(s.Fragment,{children:[s.jsx(rc,{}),!0===t?"":l("com_ui_copy_code")]})})]})]})})),yM=({lang:e,blockIndex:t,codeChildren:a,classProp:r="",allowExecution:o=!0,plugin:i=null,error:l})=>{const c=n.useRef(null),d=n.useContext(CS),{messageId:u,partIndex:m}=pS(),p=o?`${u}_${m??0}_${t??0}_${hu.execute_code}`:"",[f,h]=n.useState(0),g=null==d?void 0:d[p],[x,v]=n.useState((null==d?void 0:d[p])??null);n.useEffect((()=>{g&&(v(g),h(g.length-1))}),[g]);const b=n.useMemo((()=>null==x?void 0:x[f]),[x,f]),_=!(!0!==i&&!0!==l),y=_?"json":e;return s.jsxs("div",{className:"w-full rounded-md bg-gray-900 text-xs text-white/80",children:[s.jsx(_M,{lang:e,error:l,codeRef:c,blockIndex:t,plugin:!0===i,allowExecution:o}),s.jsx("div",{className:n_(r,"overflow-y-auto p-4"),children:s.jsx("code",{ref:c,className:n_(_?"!whitespace-pre-wrap":`hljs language-${y} !whitespace-pre`),children:a})}),!0===o&&x&&x.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-gray-700 p-4 text-xs",children:s.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:s.jsx("pre",{className:"shrink-0",children:s.jsx(iM,{output:(null==b?void 0:b.result)??"",attachments:(null==b?void 0:b.attachments)??[],renderImages:!0})})})}),x.length>1&&s.jsx(xA,{currentIndex:f,totalCount:x.length,onPrevious:()=>{f>0&&h(f-1)},onNext:()=>{x&&f<x.length-1&&h(f+1)}})]})]})},jM=n.memo((({className:e,children:t})=>{const a=Wk({permissionType:hg.RUN_CODE,permission:gg.USE}),r=/language-(\w+)/.exec(e??""),o=r&&r[1],i="math"===o,l="string"==typeof t&&1===t.split("\n").length,{getNextIndex:c,resetCounter:d}=n.useContext(wS),u=n.useRef(c(i||l)).current;return n.useEffect((()=>{d()}),[t,d]),i?s.jsx(s.Fragment,{children:t}):l?s.jsx("code",{onDoubleClick:g_,className:e,children:t}):s.jsx(yM,{lang:o??"text",codeChildren:t,blockIndex:u,allowExecution:a})})),wM=n.memo((({className:e,children:t})=>{const n=/language-(\w+)/.exec(e??""),a=n&&n[1];return"math"===a?t:"string"==typeof t&&1===t.split("\n").length?s.jsx("code",{onDoubleClick:g_,className:e,children:t}):s.jsx(yM,{lang:a??"text",codeChildren:t,allowExecution:!1})})),NM=n.memo((({href:e,children:t})=>{const a=Ae(Ny.user),{showToast:r}=Bd(),o=Fk(),{file_id:i="",filename:l="",filepath:c}=n.useMemo((()=>{const t=new RegExp(`(?:files|outputs)/${null==a?void 0:a.id}/([^\\s]+)`),n=e.match(t);if(n&&n[0]){const e=n[0],t=e.split("/"),s=t.pop();return{file_id:t.pop(),filename:s,filepath:e}}return{file_id:"",filename:"",filepath:""}}),[null==a?void 0:a.id,e]),{refetch:d}=Xy((null==a?void 0:a.id)??"",i),u={target:"_new"};if(!i||!l)return s.jsx("a",{href:e,...u,children:t});u.onClick=async e=>{e.preventDefault();try{const e=await d();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void r({status:"error",message:o("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",l),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t)}},u.target="_blank";const m=Rx.getDomainServerBaseUrl();return s.jsx("a",{href:(null==c?void 0:c.startsWith("files/"))?`${m}/${c}`:`${m}/files/${c}`,...u,children:t})})),CM=n.memo((({children:e})=>s.jsx("p",{className:"mb-2 whitespace-pre-wrap",children:e}))),kM=/{{(.*?)}}/g,SM=({children:e})=>s.jsx("p",{children:S.Children.map(e,(e=>(e=>"object"==typeof e&&null!==e||"string"!=typeof e?e:e.split(kM).map(((e,t)=>t%2==1?s.jsx("b",{className:"ml-[0.5] rounded-lg bg-amber-100 p-[1px] font-medium text-yellow-800 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90",children:`{{${e}}}`},t):e)))(e)))}),EM=e=>{const t=e.trim();if(t.includes(":")){const[e,n]=t.split(":");if(n&&n.includes("|"))return{variable:e.trim(),type:"select",options:n.split("|").map((e=>e.trim()))}}return{variable:t,type:"text"}};function TM({group:e,onClose:t}){var a;const r=Fk(),{user:o}=Kk(),i=n.useMemo((()=>{var t;return Xh({text:(null==(t=e.productionPrompt)?void 0:t.prompt)??"",user:o})}),[null==(a=e.productionPrompt)?void 0:a.prompt,o]),{allVariables:l,uniqueVariables:c,variableIndexMap:d}=n.useMemo((()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=[],a=[],r=new Set,o=new Map,i=new Map;for(;null!==(n=t.exec(e));){const e=n[1];s.push(e);const t=o.get(e)??0;o.set(e,t+1),t>0?r.add(e):(a.push(e),i.set(e,a.length-1))}return{allVariables:s,uniqueVariables:a,repeatedVariables:r,variableIndexMap:i}})(i)),[i]),{submitPrompt:u}=VE(),{control:m,handleSubmit:p}=zo({defaultValues:{fields:c.map((e=>({variable:pb(e),value:"",config:EM(e)})))}}),{fields:f}=Ho({control:m,name:"fields"}),h=$o({control:m,name:"fields"});if(!c.length)return null;return s.jsx("div",{className:"mx-auto p-1 md:container",children:s.jsxs("form",{onSubmit:p((e=>{let n=i;e.fields.forEach((({variable:e,value:t})=>{if(!t)return;const s=e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),a=new RegExp(s,"g");n=n.replace(a,t)})),u(n),t()})),className:"space-y-4",children:[s.jsx("div",{className:"mb-6 max-h-screen max-w-[90vw] overflow-auto rounded-md bg-surface-tertiary p-4 text-text-secondary dark:bg-surface-primary sm:max-w-full md:max-h-96",children:s.jsx(Yo,{remarkPlugins:[Zo,Jo,[ti,{singleDollarTextMath:!1}]],rehypePlugins:[[ei],[Xo,{ignoreMissing:!0}]],components:{code:wM,p:SM},className:"markdown prose dark:prose-invert light my-1 max-h-[50vh] max-w-full break-words dark:text-text-secondary",children:(()=>{let e=i;return l.forEach((t=>{const n=`{{${t}}}`,s=d.get(t),a=h[s].value;if(a===n||""===a||!a)return;const r=""!==a?`**${a}**`:n;e=e.replaceAll(n,r)})),e})()})}),s.jsx("div",{className:"space-y-4",children:f.map(((e,t)=>s.jsx("div",{className:"flex flex-col space-y-2",children:s.jsx(Uo,{name:`fields.${t}.value`,control:m,render:({field:{onChange:n,onBlur:a,value:r,ref:o}})=>"select"===e.config.type?s.jsx(wl,{options:e.config.options||[],placeholder:e.config.variable,className:n_(f_,"rounded px-3 py-2 focus:bg-surface-tertiary"),value:r,onChange:n,onBlur:a}):s.jsx(Ml,{ref:o,value:r,onChange:n,onBlur:a,id:`fields.${t}.value`,className:n_(f_,"rounded px-3 py-2 focus:bg-surface-tertiary"),placeholder:e.config.variable,maxRows:8})})},e.id)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx(ki,{type:"submit",variant:"submit",children:r("com_ui_submit")})})]})})}const IM=({open:e,onClose:t,group:a})=>{var r;const o=n.useMemo((()=>{var e;return mb((null==(e=null==a?void 0:a.productionPrompt)?void 0:e.prompt)??"")}),[null==(r=null==a?void 0:a.productionPrompt)?void 0:r.prompt]);return a&&o?s.jsx(ul,{open:e,onOpenChange:e=>{e||t()},children:s.jsxs(gl,{className:"max-h-[90vh] max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:max-w-[60vw]",children:[s.jsx(bl,{children:a.name}),s.jsx(TM,{group:a,onClose:t})]})}):null},RM={code:({children:e})=>s.jsx("code",{onDoubleClick:g_,className:"rounded-md bg-surface-primary-alt p-1 text-xs text-text-secondary md:text-sm",children:e})},PM=({promptText:e,showInfo:t=!0})=>{const a=Fk(),r=n.useMemo((()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=new Set;for(;null!==(n=t.exec(e));)s.add(n[1]);return Array.from(s)})(e||"")),[e]);return s.jsxs("div",{className:"rounded-xl border border-border-light bg-transparent p-4 shadow-md",children:[s.jsxs("h3",{className:"flex items-center gap-2 py-2 text-lg font-semibold text-text-primary",children:[s.jsx(fn,{className:"icon-sm","aria-hidden":"true"}),a("com_ui_variables")]}),s.jsxs("div",{className:"flex flex-col space-y-4",children:[r.length?s.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(((e,t)=>s.jsx("span",{className:n_("rounded-full border border-border-light px-3 py-1 text-text-primary",null!=Oh[e.toLowerCase()]?"bg-amber-100 text-yellow-800 border-yellow-600 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90":""),children:null!=Oh[e.toLowerCase()]?e.toLowerCase():e},t)))}):s.jsx("div",{className:"text-sm text-text-secondary",children:s.jsx(Yo,{components:RM,className:"markdown prose dark:prose-invert",children:a("com_ui_variables_info")})}),s.jsx(jl,{className:"my-3 text-text-primary"}),t&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-text-primary",children:a("com_ui_special_variables")}),s.jsx("span",{className:"text-sm text-text-secondary",children:s.jsx(Yo,{components:RM,className:"markdown prose dark:prose-invert",children:a("com_ui_special_variables_more_info")})})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-text-primary",children:a("com_ui_dropdown_variables")}),s.jsx("span",{className:"text-sm text-text-secondary",children:s.jsx(Yo,{components:RM,className:"markdown prose dark:prose-invert",children:a("com_ui_dropdown_variables_info")})})]})]})]})]})},AM=({initialValue:e,onValueChange:t,disabled:a,tabIndex:r})=>{const o=Fk(),[i,l]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect((()=>{l(e||""),d((null==e?void 0:e.length)||0)}),[e]),n.useEffect((()=>{d(i.length)}),[i]);return a&&!i?null:s.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:s.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[s.jsx(pn,{className:"icon-sm","aria-hidden":"true"}),s.jsx(ll,{type:"text",tabIndex:r,disabled:a,placeholder:o("com_ui_description_placeholder"),value:i,onChange:e=>{e.target.value.length<=120&&(l(e.target.value),null==t||t(e.target.value))},className:"border-none"}),!a&&s.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/120`})]})})},MM=({initialValue:e,onValueChange:t,disabled:a,tabIndex:r})=>{const o=Fk(),[i,l]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect((()=>{l(e||""),d((null==e?void 0:e.length)||0)}),[e]),n.useEffect((()=>{d(i.length)}),[i]);return!0!==a||i?s.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:s.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[s.jsx(hn,{className:"icon-sm","aria-hidden":"true"}),s.jsx(ll,{type:"text",tabIndex:r,disabled:a,placeholder:o("com_ui_command_placeholder"),value:i,onChange:e=>{let n=e.target.value.toLowerCase();n=n.replace(/\s/g,"-").replace(/[^a-z0-9-]/g,""),n.length<=Sh.COMMANDS_MAX_LENGTH&&(l(n),null==t||t(n))},className:"border-none"}),!0!==a&&s.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/${Sh.COMMANDS_MAX_LENGTH}`})]})}):null},LM=({group:e})=>{var t,a;const r=Fk(),{user:o}=Kk(),i=n.useMemo((()=>{var t;return Xh({text:(null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt)??"",user:o})}),[null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt,o]);return e?s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col items-center justify-between p-4 text-text-primary sm:flex-row",children:s.jsx("div",{className:"mb-1 flex flex-row items-center font-bold sm:text-xl md:mb-0 md:text-2xl",children:s.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[s.jsx("div",{className:"rounded pr-2",children:((null==(a=e.category)?void 0:a.length)??0)>0?s.jsx(VS,{category:e.category??""}):null}),s.jsx(dl,{className:"text-2xl font-bold",children:e.name})]})})}),s.jsx("div",{className:"flex h-full max-h-screen flex-col overflow-y-auto md:flex-row",children:s.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-0 md:max-h-[calc(100vh-150px)] md:p-2",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-light py-2 pl-4 text-base font-semibold text-text-primary",children:r("com_ui_prompt_text")}),s.jsx("div",{className:"group relative min-h-32 rounded-b-lg border border-border-light p-4 transition-all duration-150",children:s.jsx(Yo,{remarkPlugins:[Zo,Jo,[ti,{singleDollarTextMath:!1}]],rehypePlugins:[[ei],[Xo,{ignoreMissing:!0}]],components:{p:SM,code:wM},className:"markdown prose dark:prose-invert light dark:text-gray-70 my-1 break-words",children:i})})]}),s.jsx(PM,{promptText:i,showInfo:!1}),s.jsx(AM,{initialValue:e.oneliner,disabled:!0}),s.jsx(MM,{initialValue:e.command,disabled:!0})]})})]}):null},OM=({group:e,open:t,onOpenChange:n})=>s.jsx(ul,{open:t,onOpenChange:n,children:s.jsx(gl,{className:"max-h-[90vh] w-11/12 max-w-full overflow-y-auto md:max-w-[60vw]",children:s.jsx("div",{className:"p-2",children:s.jsx(LM,{group:e})})})});function DM({category:e,name:t,snippet:n,onClick:a,children:r}){return s.jsxs("div",{onClick:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null==a||a(e))},className:"relative my-2 flex w-full cursor-pointer flex-col gap-2 rounded-xl border border-border-light px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-tertiary hover:shadow-lg",role:"button",tabIndex:0,"aria-labelledby":`card-title-${t}`,"aria-describedby":`card-snippet-${t}`,"aria-label":`Card for ${t}`,children:[s.jsxs("div",{className:"flex w-full justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-row gap-2",children:[s.jsx(VS,{category:e,className:"icon-md","aria-hidden":"true"}),s.jsx(dl,{id:`card-title-${t}`,className:"break-word select-none text-balance text-sm font-semibold text-text-primary",title:t,children:t})]}),s.jsx("div",{children:r})]}),s.jsx("div",{id:`card-snippet-${t}`,className:"ellipsis max-w-full select-none text-balance text-sm text-text-secondary",children:n})]})}const FM=n.memo((function({group:e,instanceProjectId:t}){var a;const r=Fk(),{submitPrompt:o}=VE(),[i,l]=n.useState(!1),[c,d]=n.useState(!1),u=hE(`/d/prompts/${e._id}`),m=n.useMemo((()=>{var n;return null!=t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e,t]),{hasPermission:p}=IT("promptGroup",e._id||""),f=p(px.EDIT);return s.jsxs(s.Fragment,{children:[s.jsx(DM,{name:e.name,category:e.category??"",onClick:()=>{var t;const n=null==(t=e.productionPrompt)?void 0:t.prompt;(null==n?void 0:n.trim())&&(mb(n)?d(!0):o(n))},snippet:"string"==typeof e.oneliner&&e.oneliner.length>0?e.oneliner:(null==(a=e.productionPrompt)?void 0:a.prompt)??"",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[!0===m&&s.jsx(we,{className:"icon-md text-green-400","aria-label":"Global prompt group"}),s.jsxs(Ei,{modal:!1,children:[s.jsx(Ti,{asChild:!0,children:s.jsxs("button",{id:`prompt-actions-${e._id}`,"aria-label":`${e.name} - Actions Menu`,"aria-expanded":"false","aria-controls":`prompt-menu-${e._id}`,"aria-haspopup":"menu",onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"z-50 inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:[s.jsx(gn,{className:"icon-md text-text-secondary","aria-hidden":"true"}),s.jsx("span",{className:"sr-only",children:r("com_ui_sr_actions_menu",{0:e.name})+" "+r("com_ui_prompt")})]})}),s.jsxs(Ri,{id:`prompt-menu-${e._id}`,"aria-label":`Available actions for ${e.name}`,className:"z-50 w-fit rounded-xl",collisionPadding:2,align:"end",children:[s.jsxs(Pi,{role:"menuitem",onClick:e=>{e.stopPropagation(),l(!0)},className:"w-full cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",children:[s.jsx(xn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),s.jsx("span",{children:r("com_ui_preview")})]}),f&&s.jsx(Ii,{children:s.jsxs(Pi,{disabled:!f,className:"cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",onClick:e=>{e.stopPropagation(),u(e)},children:[s.jsx(vn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),s.jsx("span",{children:r("com_ui_edit")})]})})]})]})]})}),s.jsx(OM,{group:e,open:i,onOpenChange:l}),s.jsx(IM,{open:c,onClose:()=>d(!1),group:e})]})}));function zM({groups:e=[],isChatRoute:t,isLoading:n}){const a=Fe(),r=Fk(),{data:o={}}=Ky(),{instanceProjectId:i}=o,l=Wk({permissionType:hg.PROMPTS,permission:gg.CREATE});return s.jsxs("div",{className:"flex h-full flex-col",children:[l&&s.jsx("div",{className:"flex w-full justify-end",children:s.jsxs(ki,{variant:"outline",className:"w-full bg-transparent "+(t?"":"mx-2"),onClick:()=>a("/d/prompts/new"),children:[s.jsx(kt,{className:"size-4","aria-hidden":!0}),r("com_ui_create_prompt")]})}),s.jsx("div",{className:"flex-grow overflow-y-auto",children:s.jsxs("div",{className:"overflow-y-auto overflow-x-hidden",children:[n&&t&&s.jsx(Nl,{className:"my-2 flex h-[84px] w-full rounded-2xl border-0 px-3 pb-4 pt-3"}),n&&!t&&Array.from({length:10}).map(((e,t)=>s.jsx(Nl,{className:"w-100 mx-2 my-2 flex h-14 rounded-lg border-0 p-4"},t))),!n&&0===e.length&&t&&s.jsx("div",{className:"my-2 flex h-[84px] w-full items-center justify-center rounded-2xl border border-border-light bg-transparent px-3 pb-4 pt-3 text-text-primary",children:r("com_ui_nothing_found")}),!n&&0===e.length&&!t&&s.jsx("div",{className:"my-12 flex w-full items-center justify-center text-lg font-semibold text-text-primary",children:r("com_ui_nothing_found")}),e.map((e=>t?s.jsx(FM,{group:e,instanceProjectId:i},e._id):s.jsx(gA,{group:e,instanceProjectId:i},e._id)))]})})]})}const UM=n.memo((function({onPrevious:e,onNext:t,hasNextPage:n,hasPreviousPage:a,isLoading:r,isChatRoute:o,children:i}){const l=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex gap-2",children:[!o&&s.jsx(Ad,{returnThemeOnly:!0}),i]}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(ki,{variant:"outline",size:"sm",onClick:e,disabled:!a||r,"aria-label":l("com_ui_prev"),children:l("com_ui_prev")}),s.jsx(ki,{variant:"outline",size:"sm",onClick:t,disabled:!n||r,"aria-label":l("com_ui_next"),children:l("com_ui_next")})]})]})}));function VM({children:e,isDetailView:t,className:a=""}){const r=De(),o=Ki("(max-width: 1024px)"),i=n.useMemo((()=>{var e;return null==(e=r.pathname)?void 0:e.startsWith("/c/")}),[r.pathname]),{promptGroups:l,groupsQuery:c,nextPage:d,prevPage:u,hasNextPage:m,hasPreviousPage:p}=HS();return s.jsxs("div",{className:n_("flex h-full w-full flex-col gap-2 md:mr-2 md:w-auto md:min-w-72 lg:w-1/4 xl:w-1/4",!0===t&&o?"hidden":"",a),children:[e,s.jsx("div",{className:n_("flex-grow overflow-y-auto",i?"":"px-2 md:px-0"),children:s.jsx(zM,{groups:l,isChatRoute:i,isLoading:!!c.isLoading})}),s.jsx("div",{className:n_(i?"":"px-2 pb-3 pt-2 md:px-0"),children:s.jsx(UM,{onPrevious:u,onNext:d,hasNextPage:m,hasPreviousPage:p,isLoading:c.isFetching,isChatRoute:i,children:i&&s.jsx(hA,{className:"select-none"})})})]})}function BM({onCheckedChange:e,className:t=""}){const[n,a]=Re(Ny.autoSendPrompts),r=Fk();return s.jsxs("div",{className:n_("flex select-none items-center justify-end gap-2 text-right text-sm",t),children:[s.jsxs("div",{children:[" ",r("com_nav_auto_send_prompts")," "]}),s.jsx(Cl,{"aria-label":"toggle-auto-send-prompts",id:"autoSendPrompts",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"autoSendPrompts"})]})}function $M({className:e=""}){const t=Fk(),{name:a,setName:r}=HS(),{categories:o}=lT("h-4 w-4"),[i,l]=n.useState(a||""),[c,d]=n.useState(!1),[u,m]=Re(Ny.promptsCategory),p=n.useMemo((()=>[...[{value:Rh.ALL,label:t("com_ui_all_proper"),icon:s.jsx(bn,{className:"h-4 w-4 text-text-primary"})},{value:Rh.MY_PROMPTS,label:t("com_ui_my_prompts"),icon:s.jsx(Gt,{className:"h-4 w-4 text-text-primary"})},{value:Rh.SHARED_PROMPTS,label:t("com_ui_shared_prompts"),icon:s.jsx(Qt,{className:"h-4 w-4 text-text-primary"})},{divider:!0,value:null}],...o?[...o]:[{value:Rh.NO_CATEGORY,label:t("com_ui_no_category")}]]),[o,t]),f=n.useCallback((e=>{e===Rh.ALL?m(""):m(e)}),[m]);return n.useEffect((()=>{l(a||"")}),[a]),n.useEffect((()=>{if(""===i)return r(""),void d(!1);d(!0);const e=setTimeout((()=>{d(!1),r(i)}),500);return()=>clearTimeout(e)}),[i,r]),s.jsxs("div",{className:n_("flex w-full gap-2 text-text-primary",e),children:[s.jsx(rd,{value:u||Rh.ALL,onChange:f,options:p,className:"bg-transparent",icon:s.jsx(bn,{className:"h-4 w-4"}),label:"Filter: ",ariaLabel:t("com_ui_filter_prompts"),iconOnly:!0}),s.jsx(ld,{value:i,onChange:e=>{l(e.target.value)},isSearching:c,placeholder:t("com_ui_filter_prompts_name")})]})}function HM(){const e=HS();return s.jsx("div",{className:"flex h-full w-full flex-col",children:s.jsxs(VM,{className:"mt-2 space-y-2 lg:w-full xl:w-full",...e,children:[s.jsx($M,{className:"items-center justify-center"}),s.jsx("div",{className:"flex w-full flex-row items-center justify-end",children:s.jsx(BM,{className:"text-xs dark:text-white"})})]})})}function GM(){const e=Fk(),{conversation:t,setConversation:a}=Pk(),{setOption:r}=lE(),[o,i]=n.useState(!1),[l,c]=n.useState(null),{data:d={}}=Gy(),u=(null==t?void 0:t.endpoint)??"",m=(null==t?void 0:t.model)??"",p=n.useMemo((()=>{var e;return(null==(e=null==d?void 0:d[(null==t?void 0:t.endpoint)??""])?void 0:e.availableRegions)??[]}),[d,null==t?void 0:t.endpoint]),f=n.useMemo((()=>kb(d,null==t?void 0:t.endpoint,"type")),[null==t?void 0:t.endpoint,d]),h=n.useMemo((()=>{var e,t,n;const s=(null==(e=d[u])?void 0:e.customParams)??{},[a,r]=Qu(f??u,m),o=s.defaultParamsEndpoint??r,i=Cv[a]??Cv[o]??[],l=(null==(n=null==(t=d[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],c=To(l,"key");return i.filter((e=>null!=e)).map((e=>c[e.key]??e))}),[f,d,m,u]);n.useEffect((()=>{if(!h)return;const e=new Set(h.filter((e=>null!=e)).map((e=>e.key)));a((t=>{if(!t)return t;const n={...t},s=Object.keys(n),a=[];return s.forEach((s=>{e.has(s)||ff.has(s)||null!=t[s]&&(a.push(s),delete n[s])})),s_.log("parameters","parameters effect, updated keys:",a),n}))}),[h,a]);const g=n.useCallback((()=>{a((e=>{if(!e)return e;const t={...e},n=[];return Object.keys(t).forEach((e=>{ff.has(e)||void 0!==t[e]&&(n.push(e),delete t[e])})),s_.log("parameters","parameters reset, affected keys:",n),t}))}),[a]),x=n.useCallback((()=>{const e=Sm.parse({...t});c(e),i(!0)}),[t]);return h?s.jsxs("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",h.map((e=>{const n=XI[e.component];if(!n)return null;const{key:a,default:o,...i}=e;return"region"===a&&p.length&&(i.options=p),s.jsx(n,{settingKey:a,defaultValue:o,...i,setOption:r,conversation:t},a)}))]}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsxs("button",{type:"button",onClick:g,className:"btn btn-neutral flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[s.jsx(tn,{className:"h-4 w-4","aria-hidden":"true"}),e("com_ui_reset_var",{0:e("com_ui_model_parameters")})]})}),s.jsx("div",{className:"mt-2 flex justify-center",children:s.jsx("button",{onClick:x,className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"button",children:e("com_endpoint_save_as_preset")})}),l&&s.jsx(lR,{open:o,onOpenChange:i,preset:l})]}):null}function KM({row:e}){var t;const n=e.original;return s.jsxs("div",{className:"flex w-full items-center gap-2",children:[!0===(null==(t=null==n?void 0:n.type)?void 0:t.startsWith("image"))?s.jsx(gR,{url:n.filepath,className:"h-10 w-10 flex-shrink-0",source:n.source,alt:n.filename}):s.jsx(mR,{fileType:Mv(null==n?void 0:n.type),file:n}),s.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:s.jsx("span",{className:"block w-full overflow-hidden truncate text-ellipsis whitespace-nowrap text-xs",children:null==n?void 0:n.filename})})]})}const WM=[{accessorKey:"filename",header:({column:e})=>{const t=Fk();return s.jsxs(ki,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_name"),s.jsx(_n,{className:"ml-2 h-4 w-4"})]})},meta:{size:"150px"},cell:({row:e})=>s.jsx(KM,{row:e})},{accessorKey:"updatedAt",meta:{size:"10%"},header:({column:e})=>{const t=Fk();return s.jsxs(ki,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_date"),s.jsx(_n,{className:"ml-2 h-4 w-4"})]})},cell:({row:e})=>{var t,n;return s.jsx("span",{className:"flex justify-end text-xs",children:Lv((null==(n=null==(t=e.original)?void 0:t.updatedAt)?void 0:n.toString())??"")})}}];function qM({columns:e,data:t}){var a;const r=Fk(),[o,i]=n.useState([]),[l,c]=n.useState([]),[d,u]=n.useState({}),[{pageIndex:m,pageSize:p},f]=n.useState({pageIndex:0,pageSize:10}),h=Pe(Ny.showFiles),g=n.useMemo((()=>({pageIndex:m,pageSize:p})),[m,p]),x=lr({data:t,columns:e,state:{sorting:o,columnFilters:l,columnVisibility:d,pagination:g},onSortingChange:i,onPaginationChange:f,getCoreRowModel:ur(),getSortedRowModel:dr(),onColumnFiltersChange:c,getFilteredRowModel:cr(),onColumnVisibilityChange:u,getPaginationRowModel:gr(),defaultColumn:{minSize:0,size:10,maxSize:10,enableResizing:!0}}),v=nS(),{showToast:b}=Bd(),{setFiles:_,conversation:y}=Pk(),{data:j=cp}=Yy({select:e=>fp(e)}),{addFile:w}=jE(_),N=n.useCallback((e=>{if(!(null==v?void 0:v[e.file_id])||!(null==y?void 0:y.endpoint))return void b({message:r("com_ui_attach_error"),status:"error"});const t=v[e.file_id],n=y.endpoint;if(!t.source)return;const s=bp(t.source),a=Yu(n);if(s&&!a)return void b({message:r("com_ui_attach_error_openai"),status:"error"});!s&&a&&b({message:r("com_ui_attach_warn_endpoint"),status:"warning"});const{fileSizeLimit:o,supportedMimeTypes:i}=j.endpoints[n]??j.endpoints.default;t.bytes>o?b({message:`${r("com_ui_attach_error_size")} ${o/rp} MB (${n})`,status:"error"}):cp.checkType(e.type,i)?w({progress:1,attached:!0,file_id:t.file_id,filepath:t.filepath,preview:t.filepath,type:t.type,height:t.height,width:t.width,filename:t.filename,source:t.source,size:t.bytes,metadata:t.metadata}):b({message:`${r("com_ui_attach_error_type")} ${e.type} (${n})`,status:"error"})}),[w,v,y,r,b,j.endpoints]),C=null==(a=x.getColumn("filename"))?void 0:a.getFilterValue();return s.jsxs("div",{role:"region","aria-label":r("com_files_table"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(ll,{placeholder:r("com_files_filter"),value:C??"",onChange:e=>{var t;return null==(t=x.getColumn("filename"))?void 0:t.setFilterValue(e.target.value)},"aria-label":r("com_files_filter")})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(kl,{children:[s.jsx(Sl,{children:x.getHeaderGroups().map((e=>s.jsx(Tl,{className:"border-b border-border-light",children:e.headers.map(((e,t)=>s.jsx(Il,{style:{width:0===t?"75%":"25%"},className:"bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{className:"px-4",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())})},e.id)))},e.id)))}),s.jsx(El,{children:x.getRowModel().rows.length?x.getRowModel().rows.map((e=>s.jsx(Tl,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border-light transition-colors hover:bg-surface-secondary [&:last-child]:border-0",children:e.getVisibleCells().map((t=>{const n="filename"===t.column.id;return s.jsx(Rl,{style:{width:"150px",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"data-skip-refocus":"true",role:n?"button":void 0,tabIndex:n?0:void 0,onClick:t=>{if(n){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),N(e.original))}},onKeyDown:t=>{if(n&&("Enter"===t.key||" "===t.key)){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),N(e.original))}},children:ir(t.column.columnDef.cell,t.getContext())},t.id)}))},e.id))):s.jsx(Tl,{children:s.jsx(Rl,{colSpan:e.length,className:"h-24 text-center text-sm text-text-secondary",children:r("com_files_no_results")})})})]})})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(ki,{variant:"outline",size:"sm",onClick:()=>h(!0),"aria-label":r("com_sidepanel_manage_files"),children:[s.jsx(yn,{className:"h-4 w-4","aria-hidden":"true"}),s.jsx("span",{className:"ml-2",children:r("com_sidepanel_manage_files")})]}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>x.previousPage(),disabled:!x.getCanPreviousPage(),"aria-label":r("com_ui_prev"),children:r("com_ui_prev")}),s.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${m+1} / ${x.getPageCount()}`}),s.jsx(ki,{variant:"outline",size:"sm",onClick:()=>x.nextPage(),disabled:!x.getCanNextPage(),"aria-label":r("com_ui_next"),children:r("com_ui_next")})]})]})]})}function QM(){const{data:e=[]}=qy();return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:s.jsx(qM,{columns:WM,data:e})})}function YM(){return s.jsx("div",{className:"space-y-6 p-2",children:[1,2].map((e=>s.jsxs("div",{className:"space-y-4",children:[s.jsx(Nl,{className:"h-6 w-1/3 rounded-lg"})," ",[1,2].map((e=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(Nl,{className:"h-5 w-1/4 rounded-lg"})," ",s.jsx(Nl,{className:"h-8 w-full rounded-lg"})," ",s.jsx(Nl,{className:"h-4 w-2/3 rounded-lg"})," "]},e)))]},e)))})}function XM(){const e=Fk(),t=pr(),{showToast:a}=Bd(),{conversationId:r}=function(){const e=n.useContext(MS);if(!e)throw new Error("useMCPPanelContext must be used within MCPPanelProvider");return e}(),{data:o,isLoading:i}=Ky(),{connectionStatus:l}=OE({enabled:!!(null==o?void 0:o.mcpServers)&&Object.keys(o.mcpServers).length>0}),[c,d]=n.useState(null),u=bk({onSuccess:async()=>{a({message:e("com_nav_mcp_vars_updated"),status:"success"}),await Promise.all([t.refetchQueries([xx.tools]),t.refetchQueries([xx.mcpAuthValues]),t.refetchQueries([xx.mcpConnectionStatus])])},onError:t=>{console.error("Error updating MCP auth:",t),a({message:e("com_nav_mcp_vars_update_error"),status:"error"})}}),m=n.useMemo((()=>(null==o?void 0:o.mcpServers)?Object.entries(o.mcpServers).map((([e,t])=>({serverName:e,iconPath:null,config:{...t,customUserVars:t.customUserVars??{}}}))):[]),[null==o?void 0:o.mcpServers]),p=()=>{d(null)},f=n.useCallback(((e,t)=>{console.log(`[MCP Panel] Saving config for ${e}, pluginKey: ${Sh.mcp_prefix}${e}`);const n={pluginKey:`${Sh.mcp_prefix}${e}`,action:"install",auth:t};u.mutate(n)}),[u]),h=n.useCallback((e=>{const t={pluginKey:`${Sh.mcp_prefix}${e}`,action:"uninstall",auth:{}};u.mutate(t)}),[u]);if(i)return s.jsx(YM,{});if(0===m.length)return s.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:e("com_sidepanel_mcp_no_servers_with_vars")});if(c){const t=m.find((e=>e.serverName===c));if(!t)return d(null),s.jsxs("div",{className:"p-4 text-center text-sm text-gray-500",children:[e("com_ui_error"),": ",e("com_ui_mcp_server_not_found")]});const n=null==l?void 0:l[c];return s.jsxs("div",{className:"h-auto max-w-full space-y-4 overflow-x-hidden py-2",children:[s.jsxs(ki,{variant:"outline",onClick:p,size:"sm",children:[s.jsx(pt,{className:"mr-1 h-4 w-4"}),e("com_ui_back")]}),s.jsx("div",{className:"mb-4",children:s.jsx(wI,{serverName:c,fields:t.config.customUserVars,onSave:e=>{c&&f(c,e)},onRevoke:()=>{c&&h(c)},isSubmitting:u.isLoading})}),s.jsx(BR,{sidePanel:!0,conversationId:r,serverName:c,requiresOAuth:(null==n?void 0:n.requiresOAuth)||!1,hasCustomUserVars:t.config.customUserVars&&Object.keys(t.config.customUserVars).length>0})]})}return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden py-2",children:s.jsx("div",{className:"space-y-2",children:m.map((e=>{const t=null==l?void 0:l[e.serverName],n="connected"===(null==t?void 0:t.connectionState);return s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(ki,{variant:"outline",className:"flex-1 justify-start dark:hover:bg-gray-700",onClick:()=>{return t=e.serverName,void d(t);var t},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:e.serverName}),t&&s.jsx("span",{className:"rounded-xl px-2 py-0.5 text-xs "+(n?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"),children:t.connectionState})]})})},e.serverName)}))})})}function ZM(){return s.jsx(LS,{children:s.jsx(XM,{})})}function JM({onToggle:e,navVisible:t,isHovering:n,setIsHovering:a,side:r="left",className:o="",translateX:i=!0}){const l=Fk(),c={transition:"transform 0.3s ease, opacity 0.2s ease"},d=n||!t?"15deg":"0deg",u="right"===r?`-${d}`:d,m="right"===r?d:`-${d}`;return s.jsx("div",{className:n_(o,"-translate-y-1/2 transition-transform",t?"rotate-0":"rotate-180",t&&i?"translate-x-[260px]":"translate-x-0"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:s.jsx(Ol,{side:"right"===r?"left":"right","aria-label":l("left"===r?"com_ui_chat_history":"com_ui_controls"),"aria-expanded":t,"aria-controls":"left"===r?"chat-history-nav":"controls-nav",id:`toggle-${r}-nav`,onClick:e,role:"button",description:l(t?"com_nav_close_sidebar":"com_nav_open_sidebar"),className:"flex items-center justify-center",tabIndex:0,children:s.jsx("span",{className:"","data-state":"closed",children:s.jsx("div",{className:"flex h-[72px] w-8 items-center justify-center",style:{...c,opacity:n?1:.25},children:s.jsxs("div",{className:"flex h-6 w-6 flex-col items-center",children:[s.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(0.15rem) rotate(${u}) translateZ(0px)`}}),s.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(-0.15rem) rotate(${m}) translateZ(0px)`}})]})})})})})}function eL({links:e,isCollapsed:t,resize:a}){const r=Fk(),{active:o,setActive:i}=function(){const e=n.useContext(Qk);if(void 0===e)throw new Error("useActivePanel must be used within an ActivePanelProvider");return e}();return s.jsx("div",{"data-collapsed":t,className:"bg-token-sidebar-surface-primary hide-scrollbar group flex-shrink-0 overflow-x-hidden",children:s.jsx("div",{className:"h-full",children:s.jsx("div",{className:"flex h-full min-h-0 flex-col",children:s.jsx("div",{className:"flex h-full min-h-0 flex-col opacity-100 transition-opacity",children:s.jsx("div",{className:"scrollbar-trigger relative h-full w-full flex-1 items-start border-white/20",children:s.jsx("div",{className:"flex h-full w-full flex-col gap-1 px-3 py-2.5 group-[[data-collapsed=true]]:items-center group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:e.map(((e,n)=>{const l=(e=>e.id===o?"default":"ghost")(e);return t?s.jsx(Ol,{description:r(e.title),side:"left",render:s.jsxs(ki,{variant:"ghost",size:"icon",onClick:t=>{if(e.onClick)return e.onClick(t),void i("");i(e.id),a&&a(25)},children:[s.jsx(e.icon,{className:"h-4 w-4 text-text-secondary"}),s.jsx("span",{className:"sr-only",children:r(e.title)})]})},`nav-link-${n}`):s.jsx(ui,{type:"single",value:o,onValueChange:i,collapsible:!0,children:s.jsxs(mi,{value:e.id,className:"w-full border-none",children:[s.jsx(Ds,{asChild:!0,children:s.jsx(Fs,{asChild:!0,children:s.jsxs(ki,{variant:"outline",size:"sm",className:"w-full justify-start bg-transparent text-text-secondary data-[state=open]:bg-surface-secondary data-[state=open]:text-text-primary",onClick:t=>{e.onClick&&(e.onClick(t),i(""))},children:[s.jsx(e.icon,{className:"mr-2 h-4 w-4"}),r(e.title),null!=e.label&&e.label&&s.jsx("span",{className:n_("ml-auto opacity-100 transition-all duration-300 ease-in-out","default"===l?"text-text-primary":""),children:e.label})]})})}),s.jsx(pi,{className:"w-full text-text-primary",children:e.Component&&s.jsx(e.Component,{})})]})},n)}))})})})})})})}function tL({links:e,isCollapsed:t,resize:n,defaultActive:a}){return s.jsx(Yk,{defaultActive:a,children:s.jsx(eL,{links:e,isCollapsed:t,resize:n})})}const nL=n.memo((({defaultSize:e,panelRef:t,navCollapsedSize:a=3,hasArtifacts:r,minSize:o,setMinSize:i,collapsedSize:l,setCollapsedSize:c,isCollapsed:d,setIsCollapsed:u,fullCollapse:m,setFullCollapse:p,interfaceConfig:f})=>{var h;const g=Fk(),{endpoint:x}=function(){const e=n.useContext(PS);if(!e)throw new Error("useSidePanelContext must be used within SidePanelProvider");return e}(),[v,b]=n.useState(!1),[_,y]=ET("newUser",!0),{data:j={}}=Gy(),w=Ki("(max-width: 767px)"),{data:N={expiresAt:void 0}}=hk(x??""),C=n.useMemo((()=>{const e=localStorage.getItem("side:active-panel");return"string"==typeof e?e:void 0}),[]),k=n.useMemo((()=>kb(j,x,"type")),[x,j]),S=n.useMemo((()=>{var e;return!!(null==(e=null==j?void 0:j[x??""])?void 0:e.userProvide)}),[j,x]),E=n.useMemo((()=>!S||!!N.expiresAt),[N.expiresAt,S]),T=n.useCallback((()=>{var e;u(!0),c(0),i(20),p(!0),localStorage.setItem("fullPanelCollapse","true"),null==(e=t.current)||e.collapse()}),[t,i,u,p,c]),I=function({hidePanel:e,keyProvided:t,endpoint:s,endpointType:a,interfaceConfig:r,endpointsConfig:o}){const i=Wk({permissionType:hg.PROMPTS,permission:gg.USE}),l=Wk({permissionType:hg.BOOKMARKS,permission:gg.USE}),c=Wk({permissionType:hg.MEMORIES,permission:gg.USE}),d=Wk({permissionType:hg.MEMORIES,permission:gg.READ}),u=Wk({permissionType:hg.AGENTS,permission:gg.USE}),m=Wk({permissionType:hg.AGENTS,permission:gg.CREATE}),{data:p}=Ky();return n.useMemo((()=>{const n=[];return Yu(s)&&(s===Uu.assistants&&(null==o?void 0:o[Uu.assistants])&&!0!==o[Uu.assistants].disableBuilder||s===Uu.azureAssistants&&(null==o?void 0:o[Uu.azureAssistants])&&!0!==o[Uu.azureAssistants].disableBuilder)&&t&&n.push({title:"com_sidepanel_assistant_builder",label:"",icon:Xl,id:Uu.assistants,Component:fA}),(null==o?void 0:o[Uu.agents])&&u&&m&&!0!==o[Uu.agents].disableBuilder&&n.push({title:"com_sidepanel_agent_builder",label:"",icon:Xl,id:Uu.agents,Component:NP}),i&&n.push({title:"com_ui_prompts",label:"",icon:jn,id:"prompts",Component:HM}),c&&d&&n.push({title:"com_ui_memories",label:"",icon:Tt,id:"memories",Component:UP}),!0===r.parameters&&!0===Zu(s??"",a??"")&&!Xu(s)&&t&&n.push({title:"com_sidepanel_parameters",label:"",icon:Jt,id:"parameters",Component:GM}),n.push({title:"com_sidepanel_attach_files",label:"",icon:dc,id:"files",Component:QM}),l&&n.push({title:"com_sidepanel_conversation_tags",label:"",icon:wn,id:"bookmarks",Component:PP}),(null==p?void 0:p.mcpServers)&&Object.values(p.mcpServers).some((e=>e.customUserVars&&Object.keys(e.customUserVars).length>0||e.isOAuth||!1===e.startup))&&n.push({title:"com_nav_setting_mcp",label:"",icon:Yc,id:"mcp-settings",Component:ZM}),n.push({title:"com_sidepanel_hide_panel",label:"",icon:Nn,onClick:e,id:"hide-panel"}),n}),[o,r.parameters,t,a,s,u,i,c,d,l,m,e,p])}({endpoint:x,hidePanel:T,keyProvided:E,endpointType:k,interfaceConfig:f,endpointsConfig:j}),R=n.useCallback((()=>{var e,n;_&&y(!1),u((e=>(e&&(i(20),c(a),p(!1),localStorage.setItem("fullPanelCollapse","false")),!e))),d?null==(n=t.current)||n.expand():null==(e=t.current)||e.collapse()}),[_,t,y,i,d,u,p,c,a]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),className:"relative flex w-px items-center justify-center",children:s.jsx(JM,{navVisible:!d,isHovering:v,onToggle:R,setIsHovering:b,className:n_("fixed top-1/2",d&&(0===o||0===l)||m?"mr-9":"mr-16"),translateX:!1,side:"right"})}),(!d||o>0)&&!w&&!m&&s.jsx(Wl,{withHandle:!0,className:"bg-transparent text-text-primary"}),s.jsx(Kl,{tagName:"nav",id:"controls-nav",order:r?3:2,"aria-label":g("com_ui_controls"),role:"navigation",collapsedSize:l,defaultSize:e,collapsible:!0,minSize:o,maxSize:40,ref:t,style:{overflowY:"auto",transition:"width 0.2s ease, visibility 0s linear 0.2s"},onExpand:()=>{u(!1),localStorage.setItem("react-resizable-panels:collapsed","false")},onCollapse:()=>{u(!0),localStorage.setItem("react-resizable-panels:collapsed","true")},className:n_("sidenav hide-scrollbar border-l border-border-light bg-background py-1 transition-opacity",d?"min-w-[50px]":"min-w-[340px] sm:min-w-[352px]",w&&d&&(0===o||0===l)||m?"hidden min-w-0":"opacity-100"),children:s.jsx(tL,{resize:null==(h=t.current)?void 0:h.resize,isCollapsed:d,defaultActive:C,links:I})})]})})),sL=lh().interface,aL=n.memo((({defaultLayout:e=[97,3],defaultCollapsed:t=!1,fullPanelCollapse:a=!1,navCollapsedSize:r=3,artifacts:o,children:i})=>{const{data:l}=Ky(),c=n.useMemo((()=>(null==l?void 0:l.interface)??sL),[l]),d=n.useRef(null),[u,m]=n.useState(20),[p,f]=n.useState(t),[h,g]=n.useState(a),[x,v]=n.useState(r),b=Ki("(max-width: 767px)"),_=Ae(Ny.hideSidePanel),y=n.useCallback((()=>{if(null==o){const t=2===e.length?e[1]:e[2];return[100-t,t]}{const e=0,t=100-e,n=Math.floor(t/2);return[n,t-n,e]}}),[o,e]),j=n.useMemo((()=>v_(y())),[y]),w=n.useMemo((()=>Eo((e=>{const t=v_(e);localStorage.setItem("react-resizable-panels:layout",JSON.stringify(t))}),350)),[]);n.useEffect((()=>{var e;if(b)return f(!0),v(0),m(20),g(!0),localStorage.setItem("fullPanelCollapse","true"),void(null==(e=d.current)||e.collapse());f(t),v(r),m(20)}),[b,t,r,a]);const N=n.useMemo((()=>null!=o?15:30),[o]),C=n.useCallback((()=>{var e;f((()=>(localStorage.setItem("fullPanelCollapse","true"),g(!0),v(0),m(0),!1))),null==(e=d.current)||e.collapse()}),[]);return s.jsxs(s.Fragment,{children:[s.jsxs(Gl,{direction:"horizontal",onLayout:e=>w(e),className:"transition-width relative h-full w-full flex-1 overflow-auto bg-presentation",children:[s.jsx(Kl,{defaultSize:j[0],minSize:N,order:1,id:"messages-view",children:i}),null!=o&&s.jsxs(s.Fragment,{children:[s.jsx(Wl,{withHandle:!0,className:"ml-3 bg-border-medium text-text-primary"}),s.jsx(Kl,{defaultSize:j[1],minSize:N,order:2,id:"artifacts-panel",children:o})]}),!_&&!0===c.sidePanel&&s.jsx(nL,{panelRef:d,minSize:u,setMinSize:m,isCollapsed:p,setIsCollapsed:f,collapsedSize:x,setCollapsedSize:v,fullCollapse:h,setFullCollapse:g,defaultSize:j[j.length-1],hasArtifacts:null!=o,interfaceConfig:c})]}),s.jsx("button",{"aria-label":"Close right side panel",className:"nav-mask "+(p?"":"active"),onClick:C})]})}));function rL({buttonClass:e,iconClass:t="",endpoint:n,endpointType:a,model:r}){const{conversation:o,optionSettings:i,setOptionSettings:l,showAgentSettings:c,setShowAgentSettings:d}=Pk(),u=Fk(),[m,p]=Re(Ny.currentSettingsView),{model:f,endpoint:h,endpointType:g}=o??{},x=a??n??g??h??"",v=r??f,b=/gemini|learnlm|gemma/.test(v??"")??!1,_=(!b&&(null==v?void 0:v.toLowerCase().includes("chat")))??!1,y=!b&&!_&&/code|text/.test(v??""),{showExamples:j}=i,w=!b&&!y&&_,N={[Uu.google]:[{label:u(!0===j?"com_hide_examples":"com_show_examples"),buttonClass:!0===b||y?"disabled":"",handler:()=>{p(Dp.default),l((e=>({...e,showExamples:!e.showExamples})))},icon:s.jsx(uc,{className:n_("mr-1 w-[14px]",t)})}],[Uu.gptPlugins]:[{label:u(c?"com_show_completion_settings":"com_show_agent_settings"),buttonClass:"",handler:()=>{p(Dp.default),d((e=>!e))},icon:s.jsx(Jl,{className:n_("mr-1 w-[14px]",t),size:24})}]};if(!x)return null;if(x===Uu.google&&!w)return null;Dp.default,n_("mr-1 h-6 w-[14px]",t),Dp.advanced,n_("mr-1 h-6 w-[14px]",t);const C=N[x]??[];return s.jsxs("div",{className:"flex w-full justify-between",children:[s.jsx("div",{className:"flex items-center justify-start",children:C.map(((t,n)=>s.jsxs(ki,{type:"button",className:n_(t.buttonClass,"border border-gray-300/50 focus:ring-1 focus:ring-green-500/90 dark:border-gray-500/50 dark:focus:ring-green-500","ml-1 h-full bg-transparent px-2 py-1 text-xs font-normal text-black hover:bg-gray-100 hover:text-black dark:bg-transparent dark:text-white dark:hover:bg-gray-600 dark:hover:text-white",e??""),onClick:t.handler,children:[t.icon,t.label]},`button-${n}`)))}),null]})}aL.displayName="SidePanelGroup";const oL=({exportPreset:e,submitPreset:t})=>{const a=Fk(),r=pr(),{preset:o,setPreset:i}=Pk(),{setOption:l,setOptions:c,setAgentOption:d}=lE(o),[u,m]=oE({setOption:l,optionKey:"title",initialValue:null==o?void 0:o.title}),[p,f]=Re(Ny.presetModalVisible),{data:h=[]}=Gy({select:Sb}),g=n.useMemo((()=>h.filter((e=>!Xu(e)))),[h]);n.useEffect((()=>{var e,t;if(!o)return;if(Xu(o.endpoint))return;const n=o.endpoint??"";if(!n)return;const s=r.getQueryData([xx.models]);if(!s)return;const a=s[n];a&&a.length&&o.model!==a[0]&&(a.includes(o.model??"")||(console.log("setting model",a[0]),l("model")(a[0])),(null==(e=o.agentOptions)?void 0:e.model)!==a[0]&&null!=(null==(t=o.agentOptions)?void 0:t.model)&&o.agentOptions.model&&!a.includes(o.agentOptions.model)&&(console.log("setting agent model",a[0]),d("model")(a[0])))}),[o,r,l,d]);const x=n.useCallback((e=>{if(!c)return console.warn("setOptions is not defined");const{newEndpointType:t}=Tb({newEndpoint:e,modularChat:!0,conversation:null,endpointsConfig:r.getQueryData([xx.endpoints])??{}});c({endpoint:e,endpointType:t})}),[r,c]),{endpoint:v,endpointType:b,model:_}=o||{},y=v??"";return y?Xu(y)?null:s.jsx(ul,{open:p,onOpenChange:e=>{f(e),e||i(null)},children:s.jsxs(gl,{className:"h-[100dvh] max-h-[100dvh] w-full max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:h-auto md:max-h-[90vh] md:max-w-[75vw] md:rounded-lg lg:max-w-[950px]",children:[s.jsx(bl,{children:`${a("com_ui_edit")} ${a("com_endpoint_preset")} - ${null==o?void 0:o.title}`}),s.jsxs("div",{className:"flex w-full flex-col gap-2 px-1 pb-4 md:gap-4",children:[s.jsxs("div",{className:"grid w-full gap-2 md:grid-cols-2 md:gap-4",children:[s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx(dl,{htmlFor:"preset-name",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint_preset_name")}),s.jsx(ll,{id:"preset-name",value:m??"",onChange:u,placeholder:a("com_endpoint_set_custom_name"),className:n_(f_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",u_)})]}),s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx(dl,{htmlFor:"endpoint",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint")}),s.jsx(Dd,{value:y||"",setValue:x,showLabel:!1,emptyTitle:!0,searchPlaceholder:a("com_endpoint_search"),availableValues:g})]})]}),s.jsx("div",{className:"flex w-full",children:s.jsx(rL,{buttonClass:"ml-0 w-full border border-border-medium p-2 h-[40px] justify-center mt-0",iconClass:"hidden lg:block w-4",endpoint:y,endpointType:b,model:_})}),s.jsx("div",{className:"w-full border-t border-border-medium"}),s.jsx("div",{className:"w-full flex-1",children:s.jsx(iR,{conversation:o,setOption:l,isPreset:!0,className:"text-text-primary"})}),s.jsxs("div",{className:"flex justify-end gap-2 border-t border-border-medium pt-2 md:pt-4",children:[s.jsx("button",{onClick:e,className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 md:px-4",children:a("com_endpoint_export")}),s.jsx("button",{onClick:t,className:"rounded-md bg-green-500 px-3 py-2 text-sm font-medium text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 md:px-4",children:a("com_ui_save")})]})]})]})}):null},iL=({onFileSelected:e,className:t="",containerClassName:a="",successText:r=null,invalidText:o=null,validator:i=null,text:l=null,id:c="1"})=>{const[d,u]=n.useState("text-gray-600"),[m,p]=n.useState(null),f=Fk();let h;return h=m?"success"===m?r??f("com_ui_upload_success"):o??f("com_ui_upload_invalid"):l??f("com_ui_import"),s.jsxs("label",{htmlFor:`file-upload-${c}`,className:n_("mr-1 flex h-auto cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-normal transition-colors hover:bg-gray-100 hover:text-green-600 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-green-500",d,a),children:[s.jsx(Cn,{className:"mr-1 flex w-[22px] items-center stroke-1"}),s.jsx("span",{className:"flex text-xs",children:h}),s.jsx("input",{id:`file-upload-${c}`,value:"",type:"file",className:n_("hidden",t),accept:".json",onChange:t=>{var n;const s=null==(n=t.target.files)?void 0:n[0];if(!s)return;const a=new FileReader;a.onload=t=>{var n;const s=JSON.parse(null==(n=t.target)?void 0:n.result);if(i&&!i(s))return p("invalid"),void u("text-red-600");i&&(p("success"),u("text-green-500 dark:text-green-500")),e(s)},a.readAsText(s)}})]})},lL=({title:e,description:t,selected:n,icon:a,className:r="",textClassName:o="",children:i,onClick:l,...c})=>s.jsx("div",{id:n?"selected-endpoint":void 0,role:"option","aria-selected":n,"aria-label":e,"data-testid":"chat-menu-item",className:n_("group m-1.5 flex cursor-pointer gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 hover:bg-black/5 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-600 md:min-w-[240px]",r||""),tabIndex:0,onClick:l,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l&&l())},...c,children:s.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[s.jsx("div",{children:s.jsxs("div",{className:n_("flex items-center gap-1 "),children:[null!=a?a:null,s.jsxs("div",{className:n_("truncate",o),children:[e,s.jsx("div",{className:"text-token-text-tertiary",children:t})]})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[i,n&&s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block ",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})}),cL=()=>s.jsx("div",{role:"separator","aria-orientation":"horizontal",className:"my-1.5 border-b bg-gray-200 dark:border-gray-700"}),dL=({presets:e,onSetDefaultPreset:t,onSelectPreset:n,onChangePreset:a,onDeletePreset:r,clearAllPresets:o,onFileSelected:i})=>{const{data:l}=Gy(),c=Ae(Ny.defaultPreset),d=Fk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:s.jsxs("div",{className:"flex h-full grow items-center justify-end gap-2",children:[s.jsx("label",{htmlFor:"default-preset",className:"w-40 truncate rounded bg-transparent py-1 text-xs font-medium text-gray-600 transition-colors dark:bg-transparent dark:text-gray-300 sm:w-72",children:c?`${d("com_endpoint_preset_default_item")} ${c.title}`:d("com_endpoint_preset_default_none")}),s.jsxs(qi,{children:[s.jsx(Qi,{asChild:!0,children:s.jsxs("label",{htmlFor:"file-upload",className:"mr-1 flex h-[32px] cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100 hover:text-red-700 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-red-700",children:[s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"mr-1 flex w-[22px] items-center",children:s.jsx("path",{d:"M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"})}),d("com_ui_clear")," ",d("com_ui_all")]})}),s.jsx(Od,{showCloseButton:!1,title:`${d("com_ui_clear")} ${d("com_endpoint_presets")}`,className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(dl,{htmlFor:"preset-item-clear-all",className:"text-left text-sm font-medium",children:d("com_endpoint_presets_clear_warning")})})})}),selection:{selectHandler:o,selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-600 text-white",selectText:d("com_ui_clear")}}),s.jsx(iL,{onFileSelected:i})]})]})}),e&&0===e.length&&s.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:s.jsx("div",{className:"flex h-full grow items-center justify-end gap-2 text-gray-600 dark:text-gray-300",children:d("com_endpoint_no_presets")})}),s.jsx(sr,{flipKey:null==e?void 0:e.map((e=>null==e?void 0:e.presetId)).filter((e=>e)).join("."),children:e&&e.length>0&&e.map(((o,i)=>{const d=(null==o?void 0:o.presetId)??"";if(!o||!d)return null;const u=Mb({endpoint:o.endpoint,endpointsConfig:l}),m=kT[u];return s.jsx(qa,{asChild:!0,children:s.jsxs("div",{children:[s.jsx(ar,{flipId:d,children:s.jsx(lL,{textClassName:"text-xs max-w-[150px] sm:max-w-[200px] truncate md:max-w-full ",title:db(o),onClick:()=>n(o),icon:null!=m&&s.jsx(m,{context:"menu-item",iconURL:kb(l,o.endpoint,"iconURL"),className:"icon-md mr-1 dark:text-white",endpoint:o.endpoint}),selected:!1,"data-testid":`preset-item-${o}`,children:s.jsxs("div",{className:"flex h-full items-center justify-end gap-1",children:[s.jsx("button",{className:n_("m-0 h-full rounded-md bg-transparent p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",(null==c?void 0:c.presetId)===d?"":"sm:invisible sm:group-hover:visible"),onClick:e=>{e.preventDefault(),e.stopPropagation(),t(o,(null==c?void 0:c.presetId)===d)},children:s.jsx(Cc,{unpin:(null==c?void 0:c.presetId)===d})}),s.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(o)},children:s.jsx(ec,{})}),s.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(o)},children:s.jsx(kc,{})})]})},`preset-item-${d}`)}),i!==e.length-1&&s.jsx(cL,{})]},`preset-${d}`)},`preset-${d}`)}))})]})},uL=()=>{const e=Fk(),{presetsQuery:t,onSetDefaultPreset:n,onFileSelected:a,onSelectPreset:r,onChangePreset:o,clearAllPresets:i,onDeletePreset:l,submitPreset:c,exportPreset:d}=rE(),{preset:u}=Pk();return s.jsxs(Ka,{children:[s.jsx(Wa,{asChild:!0,children:s.jsx(Ol,{id:"presets-button","aria-label":e("com_endpoint_examples"),description:e("com_endpoint_examples"),tabIndex:0,role:"button","data-testid":"presets-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(kn,{size:16,"aria-label":"Preset Icon"})})}),s.jsx(Ha,{children:s.jsx("div",{style:{position:"fixed",left:"0px",top:"0px",transform:"translate3d(268px, 50px, 0px)",minWidth:"max-content",zIndex:"auto"},children:s.jsx(Ga,{side:"bottom",align:"center",className:"mt-2 max-h-[495px] overflow-x-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-700 dark:text-white md:min-w-[400px]",children:s.jsx(dL,{presets:t.data,onSetDefaultPreset:n,onSelectPreset:r,onChangePreset:o,onDeletePreset:l,clearAllPresets:i,onFileSelected:a})})})}),u&&s.jsx(oL,{submitPreset:c,exportPreset:d})]})};function mL({setNavVisible:e,className:t}){const n=Fk();return s.jsx(Ol,{description:n("com_nav_open_sidebar"),render:s.jsx(ki,{size:"icon",variant:"outline","data-testid":"open-sidebar-button","aria-label":n("com_nav_open_sidebar"),className:n_("rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover",t),onClick:()=>e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),children:s.jsx(nc,{})})})}function pL(){const e=Fk(),t=pr(),{conversation:n,newConversation:a}=Pk();return s.jsx(Ol,{description:e("com_ui_new_chat"),render:s.jsx(ki,{size:"icon",variant:"outline","data-testid":"wide-header-new-chat-button","aria-label":e("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(t.setQueryData([xx.messages,(null==n?void 0:n.conversationId)??Sh.NEW_CONVO],[]),t.invalidateQueries([xx.messages]),a()):window.open("/c/new","_blank")},children:s.jsx(Fc,{})})})}const fL=({isLoading:e,hasData:t,delay:a=150,loadingComponent:r,children:o,className:i=""})=>{const[l,c]=n.useState(!1);return n.useEffect((()=>{let n;return e&&!t?n=setTimeout((()=>{c(!0)}),a):c(!1),()=>{n&&clearTimeout(n)}}),[e,t,a]),l?s.jsx("div",{className:i,children:r}):s.jsx("div",{className:i,children:o})},hL=({categories:e,activeTab:t,isLoading:n,onChange:a})=>{const r=Fk(),o=Ki("(max-width: 768px)"),i=e=>"promoted"===e.value?r("com_agents_top_picks"):"all"===e.value?r("com_agents_all_category"):e.label&&e.label.startsWith("com_")?r(e.label):e.label||e.value.charAt(0).toUpperCase()+e.value.slice(1),l=s.jsx("div",{className:"w-full pb-2",children:s.jsx("div",{className:"flex flex-wrap justify-center gap-1.5 px-4",children:[...Array(6)].map(((e,t)=>s.jsx("div",{className:"h-[36px] min-w-[80px] animate-pulse rounded-lg bg-surface-tertiary"},t)))})});if(!(n||e&&0!==e.length))return s.jsx("div",{className:"text-center text-text-secondary",children:r("com_ui_no_categories")});const c=s.jsx("div",{className:"w-full pb-2",children:s.jsx("div",{className:n_("px-4",o?"scrollbar-hide flex gap-2 overflow-x-auto scroll-smooth":"flex flex-wrap justify-center gap-1.5"),role:"tablist","aria-label":r("com_agents_category_tabs_label"),"aria-orientation":"horizontal",style:o?{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"}:void 0,children:e.map(((n,l)=>s.jsxs("button",{id:`category-tab-${n.value}`,onClick:()=>a(n.value),onKeyDown:t=>((t,n)=>{const s=e.findIndex((e=>e.value===n));let r=s;switch(t.key){case"ArrowLeft":t.preventDefault(),r=s>0?s-1:e.length-1;break;case"ArrowRight":t.preventDefault(),r=s<e.length-1?s+1:0;break;case"ArrowUp":t.preventDefault(),r=Math.max(0,s-5);break;case"ArrowDown":t.preventDefault(),r=Math.min(e.length-1,s+5);break;case"Home":t.preventDefault(),r=0;break;case"End":t.preventDefault(),r=e.length-1;break;default:return}const o=e[r];o&&(a(o.value),setTimeout((()=>{const e=document.getElementById(`category-tab-${o.value}`);e&&e.focus()}),0))})(t,n.value),className:n_("relative cursor-pointer select-none whitespace-nowrap px-3 py-2 transition-all duration-200",o?"min-w-fit flex-shrink-0":"",t===n.value?"rounded-t-lg bg-surface-hover text-text-primary":"rounded-lg bg-surface-secondary text-text-secondary hover:bg-surface-hover hover:text-text-primary active:scale-95"),role:"tab","aria-selected":t===n.value,"aria-controls":`tabpanel-${n.value}`,tabIndex:t===n.value?0:-1,"aria-label":r("com_agents_category_tab_label",{category:i(n),position:l+1,total:e.length}),children:[i(n),t===n.value&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-text-primary","aria-hidden":"true"})]},n.value)))})});return s.jsx(fL,{isLoading:n,hasData:(null==e?void 0:e.length)>0,delay:100,loadingComponent:l,children:c})},gL=({agent:e,isOpen:t,onClose:a})=>{const r=Fk(),{conversation:o,newConversation:i}=Pk(),{showToast:l}=Bd(),c=n.useRef(null),d=pr(),u=()=>{if(!(null==e?void 0:e.support_contact))return null;const{name:t,email:n}=e.support_contact;return t&&n?s.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:t}):n?s.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:n}):t?s.jsx("span",{children:t}):null};return s.jsx(ul,{open:t,onOpenChange:e=>!e&&a(),children:s.jsxs(gl,{ref:c,className:"max-h-[90vh] w-11/12 max-w-lg overflow-y-auto",children:[s.jsx(ki,{variant:"ghost",size:"icon",className:"absolute right-11 top-4 h-4 w-4 rounded-sm p-0 opacity-70 ring-ring-primary ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":r("com_agents_copy_link"),onClick:()=>{const t=`${new URL(window.location.origin).origin}/c/new?agent_id=${e.id}`;navigator.clipboard.writeText(t).then((()=>{l({message:r("com_agents_link_copied")})})).catch((()=>{l({message:r("com_agents_link_copy_failed")})}))},title:r("com_agents_copy_link"),children:s.jsx(Zt,{})}),s.jsx("div",{className:"mt-6 flex justify-center",children:Xv(e,{size:"xl"})}),s.jsx("div",{className:"mt-3 text-center",children:s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:(null==e?void 0:e.name)||r("com_agents_loading")})}),(null==e?void 0:e.support_contact)&&u()&&s.jsxs("div",{className:"mt-1 text-center text-sm text-text-secondary",children:[r("com_agents_contact"),": ",u()]}),s.jsx("div",{className:"mt-4 whitespace-pre-wrap px-6 text-center text-base text-text-primary",children:null==e?void 0:e.description}),s.jsx("div",{className:"mb-4 mt-6 flex justify-center",children:s.jsx(ki,{className:"w-full max-w-xs",onClick:()=>{if(e){const t=[xx.agents,{requiredPermission:px.EDIT}],n=d.getQueryData(t);if(null!=n&&!n.data.some((t=>t.id===e.id))){const s=[e,...JSON.parse(JSON.stringify(n.data))];d.setQueryData(t,{...n,data:s})}localStorage.setItem(`${Eh.AGENT_ID_PREFIX}0`,e.id),d.setQueryData([xx.messages,(null==o?void 0:o.conversationId)??Sh.NEW_CONVO],[]),d.invalidateQueries([xx.messages]),i({template:{conversationId:Sh.NEW_CONVO,endpoint:Uu.agents,agent_id:e.id,title:`Chat with ${e.name||"Agent"}`}})}},disabled:!e,children:r("com_agents_start_chat")})})]})})},xL=({value:e,onSearch:t,className:a=""})=>{const r=Fk(),[o,i]=n.useState(e),l=function(e,t){const[s,a]=n.useState(e);return n.useEffect((()=>{const n=setTimeout((()=>{a(e)}),t);return()=>{clearTimeout(n)}}),[e,t]),s}(o,300);n.useEffect((()=>{i(e)}),[e]),n.useEffect((()=>{l!==e&&l===o&&t(l)}),[l,t,e,o]);const c=n.useCallback((()=>{t(""),i("")}),[t]);return s.jsxs("div",{className:`relative w-full max-w-4xl ${a}`,role:"search",children:[s.jsx("label",{htmlFor:"agent-search",className:"sr-only",children:r("com_agents_search_instructions")}),s.jsx(ll,{id:"agent-search",type:"text",value:o,onChange:e=>{i(e.target.value)},placeholder:r("com_agents_search_placeholder"),className:"h-12 rounded-xl border-border-medium bg-transparent pl-12 pr-12 text-lg text-text-primary shadow-md transition-[border-color,box-shadow] duration-200 placeholder:text-text-secondary focus:border-border-heavy focus:shadow-lg focus:ring-0","aria-label":r("com_agents_search_aria"),"aria-describedby":"search-instructions search-results-count",autoComplete:"off",spellCheck:"false"}),s.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-4","aria-hidden":"true",children:s.jsx(wt,{className:"size-5 text-text-secondary"})}),s.jsx("div",{id:"search-instructions",className:"sr-only",children:r("com_agents_search_instructions")}),o&&s.jsx("button",{type:"button",onClick:c,className:"group absolute right-4 top-1/2 flex size-5 -translate-y-1/2 items-center justify-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":r("com_agents_clear_search"),title:r("com_agents_clear_search"),children:s.jsx(vt,{className:"size-5 text-text-secondary transition-colors duration-200 group-hover:text-text-primary",strokeWidth:2.5})})]})},vL=({error:e,onRetry:t,context:n})=>{const a=Fk(),r=e=>"object"==typeof e&&null!==e&&!(e instanceof Error),o=e=>e instanceof Error,i=()=>(null==n?void 0:n.searchQuery)?a("com_agents_error_search_title"):(null==n?void 0:n.category)?a("com_agents_error_category_title"):a("com_agents_error_title"),l=()=>(null==n?void 0:n.searchQuery)?a("com_agents_search_no_results",{query:n.searchQuery}):(null==n?void 0:n.category)&&"all"!==n.category?a("com_agents_category_empty",{category:n.category}):a("com_agents_error_not_found_message"),{title:c,message:d,suggestion:u}=(()=>{var t,n;let s;s="string"==typeof e?{message:e}:o(e)?{message:e.message}:r(e)&&((null==(t=null==e?void 0:e.response)?void 0:t.data)||(null==e?void 0:e.data))||e;let c="";(o(e)||r(e)&&(null==e?void 0:e.message))&&(c=e.message);const d=r(e)?null==e?void 0:e.code:"";if("ECONNABORTED"===d||(null==c?void 0:c.includes("timeout")))return{title:a("com_agents_error_timeout_title"),message:a("com_agents_error_timeout_message"),suggestion:a("com_agents_error_timeout_suggestion")};if("NETWORK_ERROR"===d||(null==c?void 0:c.includes("Network Error")))return{title:a("com_agents_error_network_title"),message:a("com_agents_error_network_message"),suggestion:a("com_agents_error_network_suggestion")};const u=r(e)?null==(n=null==e?void 0:e.response)?void 0:n.status:null;if(u){if(404===u)return{title:a("com_agents_error_not_found_title"),message:l(),suggestion:a("com_agents_error_not_found_suggestion")};if(400===u)return{title:a("com_agents_error_invalid_request"),message:(null==s?void 0:s.userMessage)||a("com_agents_error_bad_request_message"),suggestion:(null==s?void 0:s.suggestion)||a("com_agents_error_bad_request_suggestion")};if(u>=500)return{title:a("com_agents_error_server_title"),message:a("com_agents_error_server_message"),suggestion:a("com_agents_error_server_suggestion")}}return s&&"object"==typeof s&&(null==s?void 0:s.userMessage)?{title:i(),message:s.userMessage,suggestion:s.suggestion||a("com_agents_error_suggestion_generic")}:{title:i(),message:a("com_agents_error_generic"),suggestion:a("com_agents_error_suggestion_generic")}})();return s.jsx("div",{className:"py-12 text-center",role:"alert","aria-live":"assertive","aria-atomic":"true",children:s.jsxs("div",{className:"mx-auto max-w-md space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:n_("flex h-12 w-12 items-center justify-center rounded-full","bg-red-100 dark:bg-red-900/20"),children:s.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",role:"img","aria-label":"Error icon",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})})}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",id:"error-title",children:c}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",id:"error-message","aria-describedby":"error-title",children:d}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500",id:"error-suggestion",role:"note","aria-label":`Suggestion: ${u}`,children:["💡 ",u]})]}),t&&s.jsx("div",{className:"pt-2",children:s.jsx(ki,{onClick:t,variant:"outline",size:"sm",className:n_("border-red-300 text-red-700 hover:bg-red-50 focus:ring-2 focus:ring-red-500","dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 dark:focus:ring-red-400"),"aria-describedby":"error-message error-suggestion","aria-label":`Retry action. ${d}`,children:a("com_agents_error_retry")})})]})})},bL=({agent:e,onClick:t,className:a=""})=>{const r=Fk(),{categories:o}=Vk(),i=n.useMemo((()=>{if(!e.category)return"";const t=o.find((t=>t.value===e.category));return t?t.label&&t.label.startsWith("com_")?r(t.label):t.label:e.category.charAt(0).toUpperCase()+e.category.slice(1)}),[e.category,o,r]);return s.jsx("div",{className:n_("group relative h-40 overflow-hidden rounded-xl border border-border-light","cursor-pointer shadow-sm transition-all duration-200 hover:border-border-medium hover:shadow-lg","bg-surface-tertiary hover:bg-surface-hover","space-y-3 p-4",a),onClick:t,"aria-label":r("com_agents_agent_card_label",{name:e.name,description:e.description??""}),"aria-describedby":`agent-${e.id}-description`,tabIndex:0,role:"button",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())},children:s.jsxs("div",{className:"flex h-full items-start gap-3",children:[s.jsxs("div",{className:"flex h-full flex-shrink-0 flex-col justify-between space-y-4",children:[s.jsx("div",{className:"flex-shrink-0",children:Xv(e,{size:"sm"})}),e.category&&s.jsx("div",{className:"inline-flex items-center rounded-md border-border-xheavy bg-surface-active-alt px-2 py-1 text-xs font-medium",children:s.jsx(dl,{className:"line-clamp-1 font-normal",children:i})})]}),s.jsxs("div",{className:"flex h-full min-w-0 flex-1 flex-col justify-between space-y-1",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx(dl,{className:"mb-1 line-clamp-1 text-xl font-semibold text-text-primary",children:e.name}),s.jsx("p",{id:`agent-${e.id}-description`,className:"line-clamp-3 text-sm leading-relaxed text-text-primary",...e.description?{"aria-label":`Description: ${e.description}`}:{},children:e.description??""})]}),(()=>{const t=(e=>{var t,n;if(!e)return null;const s=null==(t=e.support_contact)?void 0:t.name,a=null==(n=e.support_contact)?void 0:n.email,r=e.authorName;return s||r||a||null})(e);return t?s.jsx("div",{className:"flex justify-end",children:s.jsx("div",{className:"flex items-center text-sm text-text-secondary",children:s.jsx(dl,{children:t})})}):null})()]})]})})},_L=({category:e,searchQuery:t,onSelectAgent:a,scrollElement:r})=>{var o;const i=Fk(),{categories:l}=Vk(),c=n.useMemo((()=>{const n={requiredPermission:px.VIEW,limit:6};return t?(n.search=t,"all"!==e&&"promoted"!==e&&(n.category=e)):"promoted"===e?n.promoted=1:"all"!==e&&(n.category=e),n}),[e,t]),{data:d,isLoading:u,error:m,isFetching:p,fetchNextPage:f,hasNextPage:h,refetch:g,isFetchingNextPage:x}=(v=c,hr({queryKey:[xx.marketplaceAgents,v],queryFn:({pageParam:e})=>{const t={...v};return e&&(t.cursor=e.toString()),Rx.getMarketplaceAgents(t)},getNextPageParam:e=>(null==e?void 0:e.after)??void 0,enabled:!!v.requiredPermission,keepPreviousData:!0,staleTime:12e4,cacheTime:6e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...b}));var v,b;const _=n.useMemo((()=>(null==d?void 0:d.pages)?d.pages.flatMap((e=>e.data||[])):[]),[null==d?void 0:d.pages]),y=(e=>{if(!e)return!1;if("object"==typeof e&&null!==e){if("agents"in e){const t=e.agents;return Array.isArray(t)&&t.length>0}if("id"in e||"name"in e)return!0}return!!Array.isArray(e)&&e.length>0})(null==(o=null==d?void 0:d.pages)?void 0:o[0]),{setScrollElement:j}=(({hasNextPage:e=!1,isFetchingNextPage:t=!1,fetchNextPage:s,threshold:a=.8,throttleMs:r=200})=>{const o=n.useRef(null),i=n.useCallback(So.throttle((()=>{const n=o.current;if(!n)return;const{scrollTop:r,scrollHeight:i,clientHeight:l}=n;(r+l)/i>=a&&e&&!t&&s()}),r),[e,t,s,a,r]);return n.useEffect((()=>{const e=o.current;if(e)return e.removeEventListener("scroll",i),e.addEventListener("scroll",i,{passive:!0}),()=>{var t;e.removeEventListener("scroll",i),null==(t=i.cancel)||t.call(i)}}),[i]),n.useEffect((()=>{const e=o.current;if(e)return e.removeEventListener("scroll",i),e.addEventListener("scroll",i,{passive:!0}),()=>{var t;e.removeEventListener("scroll",i),null==(t=i.cancel)||t.call(i)}}),[o.current,i]),{setScrollElement:n.useCallback((e=>{o.current=e}),[]),scrollElementRef:o}})({hasNextPage:h,isFetchingNextPage:x,fetchNextPage:()=>{h&&!p&&f()},threshold:.8,throttleMs:200});n.useEffect((()=>{r&&j(r)}),[r,j]);const w=e=>{const t=l.find((t=>t.value===e));return t?t.label:"promoted"===e?i("com_agents_top_picks"):"all"===e?"All":e.charAt(0).toUpperCase()+e.slice(1)},N=s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(ac,{className:"h-8 w-8 text-primary"})});if(m)return s.jsx(vL,{error:m||"Unknown error occurred",onRetry:()=>g(),context:{searchQuery:t,category:e}});const C=s.jsx("div",{className:"space-y-6",role:"tabpanel",id:`category-panel-${e}`,"aria-labelledby":`category-tab-${e}`,"aria-live":"polite","aria-busy":u&&!y,children:_&&0!==_.length||u||p?s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"search-results-count",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:i("com_agents_grid_announcement",{count:(null==_?void 0:_.length)||0,category:w(e)})}),_&&_.length>0&&s.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",role:"grid","aria-label":i("com_agents_grid_announcement",{count:_.length,category:w(e)}),children:_.map(((e,t)=>s.jsx("div",{role:"gridcell",children:s.jsx(bL,{agent:e,onClick:()=>a(e)})},`${e.id}-${t}`)))}),x&&s.jsxs("div",{className:"flex justify-center py-8",role:"status","aria-live":"polite","aria-label":i("com_agents_loading"),children:[s.jsx(ac,{className:"h-6 w-6 text-primary"}),s.jsx("span",{className:"sr-only",children:i("com_agents_loading")})]}),!h&&_&&_.length>0&&s.jsx("div",{className:"mt-8 text-center",children:s.jsx("p",{className:"text-sm text-text-secondary",children:i("com_agents_no_more_results")})})]}):s.jsx("div",{className:"py-12 text-center text-text-secondary",role:"status","aria-live":"polite","aria-label":i(t?"com_agents_search_empty_heading":"com_agents_empty_state_heading"),children:s.jsx("h3",{className:"mb-2 text-lg font-medium",children:i("com_agents_empty_state_heading")})})});return u||p&&!x?N:C},yL=({className:e=""})=>{const t=Fk(),a=Fe(),{category:r}=nt(),o=pr(),[i,l]=Ps(),{conversation:c,newConversation:d}=Pk(),u=Ki("(max-width: 768px)"),{navVisible:m,setNavVisible:p}=ct(),[f,h]=Re(Ny.hideSidePanel),g=i.get("q")||"",x=i.get("agent_id")||"",[v,b]=n.useState(r||"all"),[_,y]=n.useState(null),[j,w]=n.useState(!1),[N,C]=n.useState("right"),k=n.useRef(null),[S,E]=n.useState(!1),[T,I]=n.useState(null);TT(`${t("com_agents_marketplace")} | LibreChat`),n.useEffect((()=>{h(!1),localStorage.setItem("hideSidePanel","false"),localStorage.setItem("fullPanelCollapse","false")}),[h,f]),Gy();const R=My({staleTime:9e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1});n.useEffect((()=>{if(!r&&"/agents"===window.location.pathname&&R.data&&"all"===v){R.data.some((e=>"promoted"===e.value))&&b("promoted")}}),[r,R.data,v]);const P=e=>{const t=new URLSearchParams(i);t.set("agent_id",e.id),l(t),I(e),E(!0)},A=n.useMemo((()=>{const e=(R.data||[]).map((e=>e.value)),t=new Set(e);return Array.from(t)}),[R.data]),M=n.useCallback((e=>{const t=A.indexOf(e);return t>=0?t:0}),[A]);n.useEffect((()=>{r&&r!==v&&!j&&b(r)}),[r,v,j]);n.useEffect((()=>{E(!!x)}),[x]);const L=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),O=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),D=n.useMemo((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]),F=Wk({permissionType:hg.MARKETPLACE,permission:gg.USE});return n.useEffect((()=>{let e;return F||(e=setTimeout((()=>{a("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[F,a]),F?s.jsx("div",{className:`relative flex w-full grow overflow-hidden bg-presentation ${e}`,children:s.jsx(WT,{children:s.jsx(AS,{children:s.jsx(aL,{defaultLayout:L,fullPanelCollapse:D,defaultCollapsed:O,children:s.jsx("main",{className:"flex h-full flex-col overflow-hidden",role:"main",children:s.jsxs("div",{ref:k,className:"scrollbar-gutter-stable relative flex h-full flex-col overflow-y-auto overflow-x-hidden",children:[!u&&s.jsx("div",{className:"sticky top-0 z-20 flex items-center justify-between bg-surface-secondary p-2 font-semibold text-text-primary md:h-14",children:s.jsx("div",{className:"mx-1 flex items-center gap-2",children:m?s.jsx("div",{className:"h-10 w-10"}):s.jsxs(s.Fragment,{children:[s.jsx(mL,{setNavVisible:p}),s.jsx(Ol,{description:t("com_ui_new_chat"),render:s.jsx(ki,{size:"icon",variant:"outline","data-testid":"agents-new-chat-button","aria-label":t("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(o.setQueryData([xx.messages,(null==c?void 0:c.conversationId)??Sh.NEW_CONVO],[]),o.invalidateQueries([xx.messages]),d()):window.open("/c/new","_blank")},children:s.jsx(Fc,{})})})]})})}),!u&&s.jsx("div",{className:"container mx-auto max-w-4xl",children:s.jsxs("div",{className:n_("mb-8 text-center","mt-12"),children:[s.jsx("h1",{className:"mb-3 text-3xl font-bold tracking-tight text-text-primary md:text-5xl",children:t("com_agents_marketplace")}),s.jsx("p",{className:"mx-auto mb-6 max-w-2xl text-lg text-text-secondary",children:t("com_agents_marketplace_subtitle")})]})}),s.jsx("div",{className:n_("sticky z-10 bg-presentation pb-4",u?"top-0":"top-14"),children:s.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[s.jsxs("div",{className:"mx-auto flex max-w-2xl gap-2 pb-6",children:[s.jsx(xL,{value:g,onSearch:e=>{const t=new URLSearchParams(i);if(e.trim())t.set("q",e.trim()),a(`/agents/all?${t.toString()}`);else{t.delete("q");const e=v;a("promoted"===e?"/agents"+(t.toString()?`?${t.toString()}`:""):`/agents/${e}${t.toString()?`?${t.toString()}`:""}`)}}}),s.jsx(KT,{})]}),s.jsx(hL,{categories:R.data||[],activeTab:v,isLoading:R.isLoading,onChange:e=>{if(e===v||j)return;const t=M(v),n=M(e);C(n>t?"right":"left"),y(e),w(!0);const s=i.toString(),r=s?`?${s}`:"";a("promoted"===e?`/agents${r}`:`/agents/${e}${r}`),window.setTimeout((()=>{b(e),y(null),w(!1)}),300)}})]})}),s.jsx("div",{className:"container mx-auto max-w-4xl px-4 pb-8",children:s.jsxs("div",{className:"relative overflow-hidden",children:[s.jsxs("div",{className:n_(j&&("right"===N?"motion-safe:animate-slide-out-left":"motion-safe:animate-slide-out-right")),children:[!g&&s.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,s;if("promoted"===v)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===v)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const a=null==(e=R.data)?void 0:e.find((e=>e.value===v));return a?{name:(null==(n=a.label)?void 0:n.startsWith("com_"))?t(a.label):a.label,description:(null==(s=a.description)?void 0:s.startsWith("com_"))?t(a.description):a.description||""}:{name:v.charAt(0).toUpperCase()+v.slice(1),description:""}})();return s.jsxs("div",{className:"text-left",children:[s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&s.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),s.jsx(_L,{category:v,searchQuery:g,onSelectAgent:P,scrollElement:k.current},`grid-${v}`)]},`pane-current-${v}`),j&&_&&s.jsxs("div",{className:n_("absolute inset-0","right"===N?"motion-safe:animate-slide-in-right":"motion-safe:animate-slide-in-left"),children:[!g&&s.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,s;if("promoted"===_)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===_)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const a=null==(e=R.data)?void 0:e.find((e=>e.value===_));return a?{name:(null==(n=a.label)?void 0:n.startsWith("com_"))?t(a.label):a.label,description:(null==(s=a.description)?void 0:s.startsWith("com_"))?t(a.description):a.description||""}:{name:(_||"").charAt(0).toUpperCase()+(_||"").slice(1),description:""}})();return s.jsxs("div",{className:"text-left",children:[s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&s.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),s.jsx(_L,{category:_,searchQuery:g,onSelectAgent:P,scrollElement:k.current},`grid-${_}`)]},`pane-next-${_}-${N}`)]})}),S&&T&&s.jsx(gL,{agent:T,isOpen:S,onClose:()=>{const e=new URLSearchParams(i);e.delete("agent_id"),l(e),I(null),E(!1)}})]})})})})})}):null};function jL(){const e=Fk(),[t]=Ps(),[a,r]=n.useState(3),o=t.get("serverName");return n.useEffect((()=>{const e=setInterval((()=>{r((t=>t<=1?(clearInterval(e),window.close(),0):t-1))}),1e3);return()=>clearInterval(e)}),[]),s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:s.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[s.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_success_title")||"Authentication Successful"}),s.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:[e("com_ui_oauth_success_description")||"Your authentication was successful. This window will close in"," ",s.jsx("span",{className:"font-medium text-indigo-500",children:a})," ",e("com_ui_seconds")||"seconds","."]}),o&&s.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:[e("com_ui_oauth_connected_to")||"Connected to",":"," ",s.jsx("span",{className:"font-medium",children:o})]})]})})}function wL(){const e=Fk(),[t]=Ps(),n=t.get("error")||"unknown_error";return s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:s.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[s.jsx("div",{className:"mb-4 flex justify-center",children:s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:s.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),s.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_error_title")||"Authentication Failed"}),s.jsx("p",{className:"mb-6 text-sm text-gray-600",children:(t=>{switch(t){case"missing_code":return e("com_ui_oauth_error_missing_code")||"Authorization code is missing. Please try again.";case"missing_state":return e("com_ui_oauth_error_missing_state")||"State parameter is missing. Please try again.";case"invalid_state":return e("com_ui_oauth_error_invalid_state")||"Invalid state parameter. Please try again.";case"callback_failed":return e("com_ui_oauth_error_callback_failed")||"Authentication callback failed. Please try again.";default:return e("com_ui_oauth_error_generic")||t.replace(/_/g," ")}})(n)}),s.jsx("button",{onClick:()=>window.close(),className:"rounded-md bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2","aria-label":e("com_ui_close_window")||"Close Window",children:e("com_ui_close_window")||"Close Window"})]})})}const NL=e=>e.split("\n").map((e=>e.trim())).filter(Boolean).map(((e,t)=>({number:t+1,content:e}))),CL=async()=>{const e=await(async()=>{if("userAgentData"in navigator)try{const e=navigator.userAgentData,t=await e.getHighEntropyValues(["platform","platformVersion"]);return{os:t.platform,version:t.platformVersion}}catch(Di){s_.warn("Failed to get high entropy values"),s_.error(Di)}const e=navigator.userAgent.toLowerCase();return e.includes("mac")?{os:"macOS"}:e.includes("win")?{os:"Windows"}:e.includes("linux")?{os:"Linux"}:e.includes("android")?{os:"Android"}:e.includes("ios")||e.includes("iphone")||e.includes("ipad")?{os:"iOS"}:{os:"Unknown"}})();return{userAgent:navigator.userAgent,platform:e.os,platformVersion:e.version,language:navigator.language,windowSize:`${window.innerWidth}x${window.innerHeight}`}};function kL(){const e=Sn(),t={message:e.message??"An unexpected error occurred",stack:e.stack,status:e.status,statusText:e.statusText,data:e.data};return s.jsx("div",{role:"alert",className:"flex min-h-screen flex-col items-center justify-center bg-surface-primary bg-gradient-to-br",children:s.jsxs("div",{className:"bg-surface-primary/60 mx-4 w-11/12 max-w-4xl rounded-2xl border border-border-light p-8 shadow-2xl backdrop-blur-xl",children:[s.jsx("h2",{className:"mb-6 text-center text-3xl font-medium tracking-tight text-text-primary",children:"Oops! Something Unexpected Occurred"}),s.jsxs("div",{className:"mb-4 rounded-xl border border-red-500/20 bg-red-500/5 p-4 text-sm text-gray-600 dark:text-gray-200",children:[s.jsx("h3",{className:"mb-2 font-medium",children:"Error Message:"}),s.jsx("pre",{className:"whitespace-pre-wrap text-sm font-light leading-relaxed text-text-primary",children:t.message})]}),("number"==typeof t.status||"string"==typeof t.statusText)&&s.jsxs("div",{className:"mb-4 rounded-xl border border-yellow-500/20 bg-yellow-500/5 p-4 text-sm text-text-primary",children:[s.jsx("h3",{className:"mb-2 font-medium",children:"Status:"}),s.jsxs("p",{className:"text-text-primary",children:["number"==typeof t.status&&`${t.status} `,"string"==typeof t.statusText&&t.statusText]})]}),null!=t.stack&&""!==t.stack.trim()&&s.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[s.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[s.jsx("span",{children:"Stack Trace"}),s.jsx("div",{className:"flex items-center",children:s.jsx(ki,{variant:"outline",size:"sm",onClick:async()=>{null!=t.stack&&""!==t.stack&&await navigator.clipboard.writeText(t.stack)},className:"ml-2 px-2 py-1 text-xs",children:"Copy"})})]}),s.jsx("div",{className:"overflow-x-auto rounded-lg bg-black/5 p-4 dark:bg-white/5",children:NL(t.stack).map((({number:e,content:t})=>s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"select-none pr-4 font-mono text-xs text-text-secondary",children:String(e).padStart(3,"0")}),s.jsx("pre",{className:"flex-1 font-mono text-xs leading-relaxed text-text-primary",children:t})]},e)))})]}),null!=t.data&&s.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[s.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[s.jsx("span",{children:"Additional Details"}),s.jsx("span",{className:"transition-transform group-open:rotate-90",children:">"})]}),s.jsx("pre",{className:"whitespace-pre-wrap text-xs font-light leading-relaxed text-text-primary",children:JSON.stringify(t.data,null,2)})]}),s.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[s.jsx("p",{className:"text-sm font-light text-text-secondary",children:"Please try one of the following:"}),s.jsxs("ul",{className:"list-inside list-disc text-sm text-text-secondary",children:[s.jsx("li",{children:"Refresh the page"}),s.jsx("li",{children:"Clear your browser cache"}),s.jsx("li",{children:"Check your internet connection"}),s.jsx("li",{children:"Contact the Admin if the issue persists"})]}),s.jsxs("div",{className:"mt-4 flex flex-col items-center gap-4 sm:flex-row sm:justify-center",children:[s.jsx(ki,{variant:"submit",onClick:()=>window.location.reload(),className:"w-full sm:w-auto",children:"Refresh Page"}),s.jsx(ki,{variant:"outline",onClick:async()=>{try{const e=await CL(),n={timestamp:(new Date).toISOString(),browser:e,error:{...t,stack:null!=t.stack&&""!==t.stack.trim()?NL(t.stack):void 0}},s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`error-log-${(new Date).toISOString()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}catch(Di){s_.warn("Failed to download error logs:"),s_.error(Di)}},className:"w-full sm:w-auto",children:"Download Error Logs"})]})]})]})})}function SL({startupConfig:e}){var t;const n=Fk();if(!e)return null;const a={discord:e.discordLoginEnabled&&s.jsx(MT,{enabled:e.discordLoginEnabled,serverDomain:e.serverDomain,oauthPath:"discord",Icon:vc,label:n("com_auth_discord_login"),id:"discord"},"discord"),facebook:e.facebookLoginEnabled&&s.jsx(MT,{enabled:e.facebookLoginEnabled,serverDomain:e.serverDomain,oauthPath:"facebook",Icon:hc,label:n("com_auth_facebook_login"),id:"facebook"},"facebook"),github:e.githubLoginEnabled&&s.jsx(MT,{enabled:e.githubLoginEnabled,serverDomain:e.serverDomain,oauthPath:"github",Icon:xc,label:n("com_auth_github_login"),id:"github"},"github"),google:e.googleLoginEnabled&&s.jsx(MT,{enabled:e.googleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"google",Icon:fc,label:n("com_auth_google_login"),id:"google"},"google"),apple:e.appleLoginEnabled&&s.jsx(MT,{enabled:e.appleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"apple",Icon:bc,label:n("com_auth_apple_login"),id:"apple"},"apple"),openid:e.openidLoginEnabled&&s.jsx(MT,{enabled:e.openidLoginEnabled,serverDomain:e.serverDomain,oauthPath:"openid",Icon:()=>e.openidImageUrl?s.jsx("img",{src:e.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):s.jsx(gc,{}),label:e.openidLabel,id:"openid"},"openid"),saml:e.samlLoginEnabled&&s.jsx(MT,{enabled:e.samlLoginEnabled,serverDomain:e.serverDomain,oauthPath:"saml",Icon:()=>e.samlImageUrl?s.jsx("img",{src:e.samlImageUrl,alt:"SAML Logo",className:"h-5 w-5"}):s.jsx(_c,{}),label:e.samlLabel?e.samlLabel:n("com_auth_saml_login"),id:"saml"},"saml")};return e.socialLoginEnabled&&s.jsxs(s.Fragment,{children:[e.emailLoginEnabled&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative mt-6 flex w-full items-center justify-center border border-t border-gray-300 uppercase dark:border-gray-600",children:s.jsx("div",{className:"absolute bg-white px-3 text-xs text-black dark:bg-gray-900 dark:text-white",children:"Or"})}),s.jsx("div",{className:"mt-8"})]}),s.jsx("div",{className:"mt-2",children:null==(t=e.socialLogins)?void 0:t.map((e=>a[e]||null))})]})}const EL=({active:e,children:t})=>e?s.jsxs(s.Fragment,{children:[s.jsx("style",{children:"\n  @keyframes blink-animation {\n    0%,\n    100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }"}),s.jsx("div",{style:{animation:"blink-animation 3s infinite"},children:t})]}):s.jsx(s.Fragment,{children:t}),TL=({onHeightChange:e})=>{const{data:t}=(e=>{const t=Ae(Ny.queriesEnabled);return mr([xx.banner],(()=>Rx.getBanner()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:t})})(),[a,r]=Re(Ny.hideBannerHint),o=n.useRef(null);if(n.useEffect((()=>{e&&o.current&&e(o.current.offsetHeight)}),[t,a,e]),!t||t.bannerId&&a.includes(t.bannerId))return null;return s.jsxs("div",{ref:o,className:"sticky top-0 z-20 flex items-center bg-neutral-900 from-gray-700 to-gray-900 px-2 py-1 text-slate-50 dark:bg-gradient-to-r dark:text-white md:relative",children:[s.jsx("div",{className:"w-full truncate px-4 text-center text-sm",dangerouslySetInnerHTML:{__html:t.message}}),s.jsx("button",{type:"button","aria-label":"Dismiss banner",className:"h-8 w-8 opacity-80 hover:opacity-100",onClick:()=>{r([...a,t.bannerId]),e&&e(0)},children:s.jsx(vt,{className:"mx-auto h-4 w-4"})})]})};function IL({startupConfig:e}){var t,n;const a=Fk();if(!e)return null;const r=null==(t=e.interface)?void 0:t.privacyPolicy,o=null==(n=e.interface)?void 0:n.termsOfService,i=(null==r?void 0:r.externalUrl)&&s.jsx("a",{className:"text-sm text-green-500",href:r.externalUrl,target:r.openNewTab?"_blank":void 0,rel:"noreferrer",children:a("com_ui_privacy_policy")}),l=(null==o?void 0:o.externalUrl)&&s.jsx("a",{className:"text-sm text-green-500",href:o.externalUrl,target:o.openNewTab?"_blank":void 0,rel:"noreferrer",children:a("com_ui_terms_of_service")});return s.jsxs("div",{className:"align-end m-4 flex justify-center gap-2",role:"contentinfo",children:[i,i&&l&&s.jsx("div",{className:"border-r-[1px] border-gray-300 dark:border-gray-600"}),l]})}function RL({children:e,header:t,isFetching:n,startupConfig:a,startupConfigError:r,pathname:o,error:i}){const l=Fk(),c=null!=r,d=()=>c?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsx(AT,{children:l("com_auth_error_login_server")})}):"com_auth_error_invalid_reset_token"===i?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsxs(AT,{children:[l("com_auth_error_invalid_reset_token")," ",s.jsx("a",{className:"font-semibold text-green-600 hover:underline",href:"/forgot-password",children:l("com_auth_click_here")})," ",l("com_auth_to_try_again")]})}):null!=i&&i?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsx(AT,{children:l(i)})}):null;return s.jsxs("div",{className:"relative flex min-h-screen flex-col bg-white dark:bg-gray-900",children:[s.jsx(TL,{}),s.jsx(EL,{active:n,children:s.jsx("div",{className:"mt-6 h-10 w-full bg-cover",children:s.jsx("img",{src:"assets/logo.svg",className:"h-full w-full object-contain",alt:l("com_ui_logo",{0:(null==a?void 0:a.appTitle)??"LibreChat"})})})}),s.jsx(d,{}),s.jsx("div",{className:"absolute bottom-0 left-0 md:m-4",children:s.jsx(Ad,{})}),s.jsx("div",{className:"flex flex-grow items-center justify-center",children:s.jsxs("div",{className:"w-authPageWidth overflow-hidden bg-white px-6 py-4 dark:bg-gray-900 sm:max-w-md sm:rounded-lg",children:[!c&&!n&&s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",style:{userSelect:"none"},children:t}),e,!o.includes("2fa")&&(o.includes("login")||o.includes("register"))&&s.jsx(SL,{startupConfig:a})]})}),s.jsx(IL,{startupConfig:a})]})}const PL={"/login":"com_auth_welcome_back","/register":"com_auth_create_account","/forgot-password":"com_auth_reset_password","/reset-password":"com_auth_reset_password","/login/2fa":"com_auth_verify_your_identity"};function AL({isAuthenticated:e}){const[t,a]=n.useState(null),[r,o]=n.useState(null),[i,l]=n.useState(null),{data:c,isFetching:d,error:u}=Ky({enabled:!e||null===i}),m=Fk(),p=Fe(),f=De();n.useEffect((()=>{e&&p("/c/new",{replace:!0}),c&&l(c)}),[e,p,c]),n.useEffect((()=>{document.title=(null==i?void 0:i.appTitle)||"LibreChat"}),[null==i?void 0:i.appTitle]),n.useEffect((()=>{a(null),o(null)}),[f.pathname]);const h={error:t,setError:a,headerText:r,setHeaderText:o,startupConfigError:u,startupConfig:i,isFetching:d};return s.jsx(RL,{header:m(r||PL[f.pathname]),isFetching:d,startupConfig:i,startupConfigError:u,pathname:f.pathname,error:t,children:s.jsx(En,{context:h})})}function ML(){const{isAuthenticated:e}=Kk(),[t,a]=Re(Ny.queriesEnabled);return n.useEffect((()=>{if(t)return;const e=setTimeout((()=>{a(!0)}),500);return()=>{clearTimeout(e)}}),[t,a]),s.jsx(AL,{isAuthenticated:e})}const LL=({name:e,onSave:t})=>{const a=n.useRef(null),r=n.useRef(),[o,i]=n.useState(!1),[l,c]=n.useState(e),d=()=>{const e=null==l?void 0:l.trim();t(e||""),i(!1)};return n.useEffect((()=>{var e;o&&(null==(e=a.current)||e.focus())}),[o]),n.useEffect((()=>{c(e)}),[e]),s.jsx("div",{className:"flex items-center",children:s.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center"},className:"gap-2",children:o?s.jsxs(s.Fragment,{children:[s.jsx(ll,{type:"text",value:l??"",onChange:e=>{c(e.target.value)},onKeyDown:t=>{"Escape"===t.key&&(i(!1),c(e)),"Enter"===t.key&&d()},ref:a,className:"flex w-full max-w-none rounded-lg text-2xl font-bold transition duration-200",style:{whiteSpace:"nowrap",textOverflow:"ellipsis"}}),s.jsx(ki,{onClick:()=>{d(),clearTimeout(r.current)},variant:"ghost",size:"sm",className:"h-10 flex-shrink-0","aria-label":"Save prompt name",children:s.jsx($c,{className:"icon-md"})})]}):s.jsxs(s.Fragment,{children:[s.jsx(dl,{className:"text-2xl font-bold",style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:l}),s.jsx(ki,{onClick:()=>{i(!0)},variant:"ghost",size:"sm","aria-label":"Edit prompt name",className:"h-10 flex-shrink-0",children:s.jsx(ec,{className:"icon-md"})})]})})})},{promptsEditorMode:OL,alwaysMakeProd:DL}=Ny,FL=()=>{const e=Fk(),[t,n]=Re(OL),a=Pe(DL);return s.jsx("div",{className:"relative flex h-10 items-center justify-center rounded-xl border border-border-light bg-surface-primary transition-all duration-300",children:s.jsxs("div",{className:"relative flex w-48 items-stretch md:w-64",children:[s.jsx("div",{className:"absolute rounded-lg bg-surface-hover shadow-lg transition-all duration-300 ease-in-out",style:{top:"1px",left:t===Kd.SIMPLE?"2px":"calc(50% + 2px)",width:"calc(50% - 4px)",height:"calc(100% - 2px)"}}),s.jsx("button",{type:"button",onClick:()=>{a(!0),n(Kd.SIMPLE)},className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===Kd.SIMPLE?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:s.jsx("span",{className:"relative",children:e("com_ui_simple")})}),s.jsx("button",{type:"button",onClick:()=>n(Kd.ADVANCED),className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===Kd.ADVANCED?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:s.jsx("span",{className:"relative",children:e("com_ui_advanced")})})]})})},zL=({control:e,promptPerm:t,label:n,confirmChange:a})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,s.jsx(Uo,{name:t,control:e,render:({field:e})=>s.jsx(Cl,{...e,checked:e.value,onCheckedChange:t=>{!1===t&&a?a(t,e.onChange):e.onChange(t)},value:e.value.toString()})})]}),UL=()=>{const e=Fk(),{user:t,roles:a}=Kk(),{showToast:r}=Bd(),[o,i]=n.useState(null),{mutate:l,isLoading:c}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Yg.partial().parse(e.updates),Rx.updatePromptPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([xx.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{r({status:"success",message:e("com_ui_saved")})},onError:()=>{r({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[d,u]=n.useState(!1),[m,p]=n.useState(Qg.USER),f=n.useMemo((()=>{var e,t;return(null==(e=null==a?void 0:a[m])?void 0:e.permissions)?null==(t=a[m])?void 0:t.permissions[hg.PROMPTS]:gx[m].permissions[hg.PROMPTS]}),[a,m]),{reset:h,control:g,setValue:x,getValues:v,handleSubmit:b,formState:{isSubmitting:_}}=zo({mode:"onChange",defaultValues:f});if(n.useEffect((()=>{var e,t;h(null==(t=null==(e=null==a?void 0:a[m])?void 0:e.permissions)?void 0:t[hg.PROMPTS])}),[a,m,h]),(null==t?void 0:t.role)!==Qg.ADMIN)return null;const y=[{promptPerm:gg.SHARED_GLOBAL,label:e("com_ui_prompts_allow_share")},{promptPerm:gg.CREATE,label:e("com_ui_prompts_allow_create")},{promptPerm:gg.USE,label:e("com_ui_prompts_allow_use")}],j=[{label:Qg.USER,onClick:()=>{p(Qg.USER)}},{label:Qg.ADMIN,onClick:()=>{p(Qg.ADMIN)}}];return s.jsxs(s.Fragment,{children:[s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsxs(ki,{size:"sm",variant:"outline",className:"mr-2 h-10 w-fit gap-1 border transition-all dark:bg-transparent dark:hover:bg-surface-tertiary sm:m-0",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),s.jsx("span",{className:"hidden sm:flex",children:e("com_ui_admin")})]})}),s.jsxs(gl,{className:"max-w-lg border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(bl,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_prompts")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(wd,{unmountOnHide:!0,menuId:"prompt-role-dropdown",isOpen:d,setIsOpen:u,trigger:s.jsx(ie,{className:"inline-flex w-1/5 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:m}),items:j,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:b((e=>{l({roleName:m,updates:e})})),children:[s.jsx("div",{className:"py-5",children:y.map((({promptPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(zL,{control:g,promptPerm:t,label:n,getValues:v,setValue:x,...m===Qg.ADMIN&&t===gg.USE?{confirmChange:(e,t)=>i({newValue:e,callback:t})}:{}}),m===Qg.ADMIN&&t===gg.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsxs("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-blue-500 underline",children:[e("com_ui_more_info"),s.jsx(qt,{size:16,className:"ml-1"})]})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx(ki,{type:"submit",disabled:_||c,variant:"submit",children:e("com_ui_save")})})]})]})]})]}),s.jsx(ul,{open:null!==o,onOpenChange:e=>{e||i(null)},children:s.jsx(zd,{showCloseButton:!0,title:e("com_ui_confirm_change"),className:"w-11/12 max-w-lg",main:s.jsx("p",{className:"mb-4",children:e("com_ui_confirm_admin_use_change")}),selection:{selectHandler:()=>{o&&o.callback(o.newValue),i(null)},selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover text-white transition-colors duration-200",selectText:e("com_ui_confirm_action"),isLoading:!1}})})]})},VL=/prompts\/(?!new(?:\/|$)).*$/,BL=e=>{if(!e||e.includes("/d/"))return"new";const t=e.split("/");return t[t.length-1]};function $L(){const e=De(),t=Fk(),{user:a}=Kk(),{prevLocationPath:r}=hS(),o=n.useMemo((()=>BL(r)),[r]),i=Pe(Ny.promptsName),l=Pe(Ny.promptsCategory);Ae(Ny.promptsEditorMode);const c=hE("/c/"+o,n.useCallback((()=>{i(""),l("")}),[i,l])),d=hE("/d/prompts"),u=n.useMemo((()=>VL.test(e.pathname)),[e.pathname]);return s.jsxs("div",{className:"mr-2 mt-2 flex h-10 items-center justify-between",children:[s.jsx(_i,{className:"mt-1 px-2 dark:text-gray-200",children:s.jsxs(yi,{children:[s.jsx(ji,{className:"hover:dark:text-white",children:s.jsxs(wi,{href:"/",className:"flex flex-row items-center gap-1",onClick:c,children:[s.jsx(Tn,{className:"icon-xs","aria-hidden":"true"}),s.jsx("span",{className:"hidden md:flex",children:t("com_ui_back_to_chat")}),s.jsx("span",{className:"flex md:hidden",children:t("com_ui_chat")})]})}),s.jsx(Ni,{}),s.jsx(ji,{className:"hover:dark:text-white",children:s.jsxs(wi,{href:"/d/prompts",className:"flex flex-row items-center gap-1",onClick:d,children:[s.jsx(jn,{className:"h-4 w-4 dark:text-gray-300","aria-hidden":"true"}),t("com_ui_prompts")]})})]})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u&&s.jsx(FL,{}),(null==a?void 0:a.role)===Qg.ADMIN&&s.jsx(UL,{})]})]})}function HL(){const e=nt(),t=Fe(),a=n.useMemo((()=>!(!e.promptId&&"new"!==e["*"])),[e]),r=Wk({permissionType:hg.PROMPTS,permission:gg.USE});return n.useEffect((()=>{let e;return r||(e=setTimeout((()=>{t("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[r,t]),r?s.jsx($S,{children:s.jsxs("div",{className:"flex h-screen w-full flex-col bg-surface-primary p-0 lg:p-2",children:[s.jsx($L,{}),s.jsxs("div",{className:"flex w-full flex-grow flex-row divide-x overflow-hidden dark:divide-gray-600",children:[s.jsx(VM,{isDetailView:a,children:s.jsx("div",{className:"mt-1 flex flex-row items-center justify-between px-2 md:px-2",children:s.jsx($M,{})})}),s.jsx("div",{className:n_("scrollbar-gutter-stable w-full overflow-y-auto lg:w-3/4 xl:w-3/4",a?"block":"hidden md:block"),children:s.jsx(En,{})})]})]})}):null}function GL({onCheckedChange:e,className:t=""}){const[n,a]=Re(Ny.alwaysMakeProd),r=Fk();return s.jsxs("div",{className:n_("flex select-none items-center justify-end gap-2 text-xs",t),children:[s.jsx(Cl,{id:"alwaysMakeProd",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"alwaysMakeProd","aria-label":"Always make prompt production"}),s.jsxs("div",{children:[r("com_nav_always_make_prod")," "]})]})}const KL=Object.keys(Oh).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function WL({fieldName:e="prompt",className:t=""}){const a=n.useId(),r=Fk(),o=Vo(),{setValue:i,getValues:l}=o,[c,d]=n.useState(!1);return s.jsx("div",{className:t,title:`${r("com_ui_add")} ${r("com_ui_special_variables")}`,children:s.jsx(wd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:c,setIsOpen:d,trigger:s.jsxs(ie,{id:"variables-menu-button","aria-label":`${r("com_ui_add")} ${r("com_ui_special_variables")}`,className:"flex h-8 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[s.jsx(bt,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),r("com_ui_special_variables")]}),items:KL.map((t=>({label:r(t.label)||t.label,onClick:()=>((t,n)=>{const s=l(e)||"",a=s.length>0?"\n\n":"",o=r(t);i(e,s+a+o+": "+n),d(!1)})(t.label,t.value)}))),menuId:a,className:"z-30"})})}const{promptsEditorMode:qL}=Ny,QL=n.memo((({name:e,isEditing:t,setIsEditing:a})=>{const r=Fk(),{control:o}=Vo(),i=Ae(qL),{dirtyFields:l}=Go({control:o}),{prompt:c}=l,d=n.useMemo((()=>t&&null==(null==c?void 0:c.length)?ic:t?$c:vn),[t,c]),u=[[ei],[Xo,{detect:!0,ignoreMissing:!0,subset:jb}]];return s.jsxs("div",{className:"flex max-h-[85vh] flex-col sm:max-h-[85vh]",children:[s.jsxs("h2",{className:"flex items-center justify-between rounded-t-xl border border-border-light py-1.5 pl-3 text-sm font-semibold text-text-primary sm:py-2 sm:pl-4 sm:text-base",children:[s.jsx("span",{className:"max-w-[200px] truncate sm:max-w-none",children:r("com_ui_prompt_text")}),s.jsxs("div",{className:"flex flex-shrink-0 flex-row items-center gap-3 sm:gap-6",children:[i===Kd.ADVANCED&&s.jsx(GL,{className:"hidden sm:flex"}),s.jsx(WL,{fieldName:e}),s.jsx("button",{type:"button",onClick:()=>a((e=>!e)),"aria-label":r(t?"com_ui_save":"com_ui_edit"),className:"mr-1 rounded-lg p-1.5 sm:mr-2 sm:p-1",children:s.jsx(d,{className:n_("h-5 w-5 sm:h-6 sm:w-6",t?"p-[0.05rem]":"text-secondary-alt hover:text-text-primary")})})]})]}),s.jsxs("div",{role:"button",className:n_("w-full flex-1 overflow-auto rounded-b-xl border border-border-light p-2 shadow-md transition-all duration-150 sm:p-4",{"cursor-pointer bg-surface-primary hover:bg-surface-secondary active:bg-surface-tertiary":!t}),onClick:()=>!t&&a(!0),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!t&&a(!0)},tabIndex:0,children:[!t&&s.jsx(vn,{className:"icon-xl absolute inset-0 m-auto hidden h-6 w-6 text-text-primary opacity-25 group-hover:block sm:h-8 sm:w-8"}),s.jsx(Uo,{name:e,control:o,render:({field:e})=>t?s.jsx(Ml,{...e,autoFocus:!0,className:"w-full resize-none overflow-y-auto rounded bg-transparent text-sm text-text-primary focus:outline-none sm:text-base",minRows:3,maxRows:14,onBlur:()=>a(!1),onKeyDown:e=>{"Escape"===e.key&&(e.preventDefault(),a(!1))}}):s.jsx("div",{className:n_("overflow-y-auto text-sm sm:text-base"),style:{minHeight:"4.5em",maxHeight:"21em",overflow:"auto"},children:s.jsx(Yo,{remarkPlugins:[Zo,Jo,[ti,{singleDollarTextMath:!1}]],rehypePlugins:u,components:{p:SM,code:wM},className:"markdown prose dark:prose-invert light my-1 w-full break-words text-text-primary",children:e.value})})})]})]})})),YL=({currentCategory:e,onValueChange:t,className:a=""})=>{const{t:r}=lo(),o=Vo(),{categories:i,emptyCategory:l}=lT(),[c,d]=n.useState(!1),u=null==o?void 0:o.control,m=null==o?void 0:o.watch,p=null==o?void 0:o.setValue,f=m?m("category"):e,h=n.useMemo((()=>(i??[]).find((t=>t.value===(f??e)))??l),[f,i,e,l]),g=n.useMemo((()=>h.value||"icon"in h?h:{...h,icon:s.jsx("span",{className:"i-heroicons-tag"}),label:h.label||r("com_ui_empty_category")}),[h,r]),x=n.useMemo((()=>i?i.map((e=>({id:e.value,label:e.label,icon:"icon"in e?e.icon:void 0,onClick:()=>{const n=e.value||"";o&&p&&p("category",n,{shouldDirty:!1}),localStorage.setItem(Eh.LAST_PROMPT_CATEGORY,n),null==t||t(n),d(!1)}}))):[]),[i,o,p,t]),v=s.jsxs(ie,{className:n_("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary","w-fit gap-2",a),onClick:()=>d(!c),"aria-label":"Prompt's category selector","aria-labelledby":"category-selector-label",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:["icon"in g&&null!=g.icon&&s.jsx("span",{children:g.icon}),s.jsx("span",{children:g.value?g.label:r("com_ui_category")})]}),s.jsx(le,{})]});return o?s.jsx(Uo,{name:"category",control:u,render:()=>s.jsx(wd,{trigger:v,items:x,isOpen:c,setIsOpen:d,menuId:"category-selector-menu",className:"mt-2",portal:!0})}):s.jsx(wd,{trigger:v,items:x,isOpen:c,setIsOpen:d,menuId:"category-selector-menu",className:"mt-2",portal:!0})};function XL(){const e=Fe(),t=Fk();return s.jsx("div",{className:"relative min-h-full w-full px-4",children:s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("div",{className:"text-center font-bold dark:text-gray-200",children:[s.jsx("h1",{className:"text-lg font-bold dark:text-gray-200 md:text-2xl",children:t("com_ui_prompt_preview_not_shared")}),s.jsx(ki,{className:"mt-4",onClick:()=>{e("/d/prompts")},children:t("com_ui_back_to_prompts")})]})})})}const ZL=({description:e})=>s.jsx(Ol,{description:e,"aria-label":e,render:s.jsx("div",{className:"flex items-center justify-center",children:s.jsx(Pn,{className:"h-4 w-4 text-amber-500"})})}),JL=({tags:e})=>{const t=Fk();return e.includes("latest")&&e.includes("production")?s.jsx("span",{className:"absolute bottom-3 right-3",children:s.jsx(ZL,{description:t("com_ui_latest_production_version")})}):s.jsx("span",{className:"flex gap-1 text-sm",children:e.map(((e,n)=>s.jsx(Ol,{description:t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),"aria-label":t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),render:s.jsx(Al,{label:e,className:n_("w-24 justify-center border border-transparent","production"===e?"bg-green-100 text-green-500 dark:border-green-500 dark:bg-transparent dark:text-green-500":"bg-blue-100 text-blue-500 dark:border-blue-500 dark:bg-transparent dark:text-blue-500"),labelClassName:"flex items-center m-0 justify-center gap-1",LabelNode:"production"===e?s.jsx("div",{className:"flex items-center",children:s.jsx("span",{className:"slow-pulse size-2 rounded-full bg-green-400"})}):"latest"===e?s.jsx("div",{className:"flex items-center",children:s.jsx(Rn,{className:"size-4"})}):null})},`${e}-${n}`)))})},eO=({prompt:e,index:t,isSelected:n,totalVersions:a,onClick:r,authorName:o,tags:i})=>{const l=Fk();return s.jsx("button",{type:"button",className:n_("group relative w-full rounded-lg border border-border-light p-4 transition-all duration-300",n?"bg-surface-hover shadow-xl":"bg-surface-primary shadow-sm hover:bg-surface-secondary"),onClick:r,"aria-selected":n,role:"tab","aria-label":l("com_ui_version_var",{0:""+(a-t)}),children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-start justify-between lg:flex-col xl:flex-row",children:[s.jsx("h3",{className:"font-bold text-text-primary",children:l("com_ui_version_var",{0:""+(a-t)})}),s.jsx("time",{className:"text-xs text-text-secondary",dateTime:e.createdAt,children:Oo(new Date(e.createdAt),"yyyy-MM-dd HH:mm")})]}),s.jsxs("div",{className:"flex items-center gap-1 lg:flex-col xl:flex-row",children:[o&&s.jsxs(dl,{className:"text-left text-xs text-text-secondary",children:["by ",o]}),i.length>0&&s.jsx(JL,{tags:i})]})]})})},tO=({prompts:e,group:t,selectionIndex:n,setSelectionIndex:a})=>{const r=Fk();return s.jsxs("section",{className:"my-6","aria-label":"Prompt Versions",children:[s.jsx("header",{className:"mb-6",children:s.jsxs("h2",{className:"flex items-center gap-2 text-base font-semibold text-text-primary",children:[s.jsx(In,{className:"h-5 w-5 text-green-500"}),r("com_ui_versions")]})}),s.jsx("div",{className:"flex flex-col gap-3",role:"tablist","aria-label":"Version history",children:e.map(((r,o)=>{const i=[];return 0===o&&i.push("latest"),r._id===(null==t?void 0:t.productionId)&&i.push("production"),s.jsx(eO,{prompt:r,index:o,isSelected:o===n,totalVersions:e.length,onClick:()=>a(o),authorName:null==t?void 0:t.authorName,tags:i},r._id)}))})]})},nO=({name:e,disabled:t,selectHandler:n})=>{const a=Fk();return s.jsxs(ul,{children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"destructive",size:"sm","aria-label":"Delete version",className:"h-10 w-10 p-0.5",disabled:t,onClick:e=>{e.stopPropagation()},children:s.jsx(An,{className:"size-5 cursor-pointer text-white"})})}),s.jsx(zd,{showCloseButton:!1,title:a("com_ui_delete_prompt"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(dl,{htmlFor:"dialog-delete-confirm-prompt",className:"text-left text-sm font-medium",children:a("com_ui_delete_confirm_prompt_version_var",{0:e})})})})}),selection:{selectHandler:n,selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover transition-colors duration-200 text-white",selectText:a("com_ui_delete")}})]})},sO=S.memo((({promptId:e,groupId:t,promptName:a,disabled:r})=>{const o=(e=>{const t=pr(),{onSuccess:n,...s}={},a=Ae(Ny.promptsName),r=Ae(Ny.promptsPageSize),o=Ae(Ny.promptsCategory);return fr({mutationFn:e=>Rx.deletePrompt(e),...s,onSuccess:(e,s,i)=>{if(e.promptGroup){const n=e.promptGroup.id;t.setQueryData([xx.promptGroups,a,o,r],(e=>e?Hb(e,n):e)),qb(t,n)}else t.setQueryData([xx.prompts,s.groupId],(e=>{const n=e?e.filter((e=>e._id!==s._id)):[];return t.setQueryData([xx.promptGroup,s.groupId],(e=>{if(!e)return e;e.productionId===s._id&&(e.productionId=n[0]._id,e.productionPrompt=n[0])})),n}));n&&n(e,s,i)}})})(),i=n.useCallback((()=>{e?o.mutate({_id:e,groupId:t}):console.warn("No prompt ID provided for deletion")}),[e,t,o]);return e?s.jsx(nO,{name:a,disabled:r||!e,selectHandler:i}):null}));function aO(){return s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col items-center justify-between px-4 dark:text-gray-200 sm:flex-row",children:s.jsx(Nl,{className:"mb-1 flex h-10 w-32 flex-row items-center font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"})}),s.jsx("div",{className:"flex h-full w-full flex-col md:flex-row",children:s.jsx("div",{className:"flex-1 overflow-y-auto border-border-medium-alt p-4 md:max-h-[calc(100vh-150px)] md:border-r",children:s.jsx(Nl,{className:"h-96"})})})]})}sO.displayName="DeletePrompt";const rO=S.memo((({group:e,disabled:t})=>{const{user:n}=Kk(),a=Wk({permissionType:hg.PROMPTS,permission:gg.SHARED_GLOBAL}),r=(null==e?void 0:e._id)||"",{hasPermission:o,isLoading:i}=IT(mx.PROMPTGROUP,r);if(!e||!r)return null;const l=o(px.SHARE);return(e.author===(null==n?void 0:n.id)||(null==n?void 0:n.role)===Qg.ADMIN||l)&&a&&!i?s.jsx(cP,{resourceDbId:r,resourceName:e.name,resourceType:mx.PROMPTGROUP,disabled:t,children:s.jsx(ki,{variant:"default",size:"sm","aria-label":"Share prompt",className:"h-10 w-10 border border-transparent bg-blue-500/90 p-0.5 transition-all hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-800",disabled:t,children:s.jsx(Qt,{className:"size-5 cursor-pointer text-white"})})}):null}));rO.displayName="SharePrompt";const oO=S.memo((({group:e,prompts:t,selectedPrompt:n,selectedPromptId:a,isLoadingPrompts:r,canEdit:o,selectionIndex:i,setSelectionIndex:l})=>{const c=Fk(),{showToast:d}=Bd(),u=Ae(Ny.promptsEditorMode),m=Wk({permissionType:hg.PROMPTS,permission:gg.SHARED_GLOBAL}),p=Oj({onError:()=>{d({status:"error",message:c("com_ui_prompt_update_error")})}}),f=Fj(),h=(null==e?void 0:e._id)||"",g=(null==e?void 0:e.name)||"",x=(null==e?void 0:e.category)||"",v=!e;return s.jsxs("div",{className:"h-full w-full overflow-y-auto bg-surface-primary px-4",style:{maxHeight:"calc(100vh - 100px)"},children:[s.jsxs("div",{className:"mb-2 flex flex-col lg:flex-row lg:items-center lg:justify-center lg:gap-x-2 xl:flex-row xl:space-y-0",children:[s.jsx(YL,{currentCategory:x,onValueChange:o?e=>p.mutate({id:h,payload:{name:g,category:e}}):void 0}),s.jsxs("div",{className:"mt-2 flex flex-row items-center justify-center gap-x-2 lg:mt-0",children:[m&&s.jsx(rO,{group:e,disabled:v}),u===Kd.ADVANCED&&o&&s.jsx(ki,{variant:"submit",size:"sm","aria-label":"Make prompt production",className:"h-10 w-10 border border-transparent p-0.5 transition-all",onClick:()=>{if(!n)return void console.warn("No prompt is selected");const{_id:e="",prompt:t}=n;f.mutate({id:e,groupId:h,productionPrompt:{prompt:t}})},disabled:v||!n||n._id===(null==e?void 0:e.productionId)||f.isLoading||!o,children:s.jsx(Mn,{className:"size-5 cursor-pointer text-white"})}),s.jsx(sO,{promptId:a,groupId:h,promptName:g,disabled:v})]})]}),u===Kd.ADVANCED&&(r?Array.from({length:6}).map(((e,t)=>s.jsx("div",{className:"my-2",children:s.jsx(Nl,{className:"h-[72px] w-full"})},t))):t.length>0&&s.jsx(tO,{group:e,prompts:t,selectionIndex:i,setSelectionIndex:l}))]})}));oO.displayName="RightPanel";const iO=()=>{const e=nt(),t=Fk(),{showToast:a}=Bd(),r=Ae(Ny.alwaysMakeProd),o=e.promptId||"",i=Ae(Ny.promptsEditorMode),[l,c]=n.useState(0),d=n.useRef(!1),[u,m]=n.useState(!1),[p,f]=n.useState(!0),[h,g]=n.useState(!1),x="320px",{data:v,isLoading:b}=(_=o,mr([xx.promptGroup,_],(()=>Rx.getPromptGroup(_)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...y,enabled:!0}));var _,y;const{data:j=[],isLoading:w}=((e,t)=>mr([xx.prompts,e.groupId??""],(()=>Rx.getPrompts(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0===(null==t?void 0:t.enabled)||t.enabled}))({groupId:o},{enabled:!!o}),{hasPermission:N,isLoading:C}=IT(mx.PROMPTGROUP,(null==v?void 0:v._id)||""),k=N(px.EDIT),S=N(px.VIEW),E=zo({defaultValues:{prompt:"",promptName:v?v.name:"",category:v?v.category:""}}),{handleSubmit:T,setValue:I,reset:R,watch:P}=E,A=P("prompt"),M=n.useMemo((()=>j.length>0?j[l]:void 0),[j,l]),L=n.useMemo((()=>null==M?void 0:M._id),[null==M?void 0:M._id]),{groupsQuery:O}=HS(),D=Oj({onError:()=>{a({status:"error",message:t("com_ui_prompt_update_error")})}}),F=Fj(),z=(e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr({mutationFn:({groupId:e,...t})=>Rx.addPromptToGroup(e,t),...s,onSuccess:(e,s,a)=>{const{prompt:r}=e;t.setQueryData([xx.prompts,s.prompt.groupId],(e=>[r,...e??[]])),n&&n(e,s,a)}})})({onMutate:e=>{R({prompt:e.prompt.prompt,category:(null==v?void 0:v.category)||""},{keepDirtyValues:!0})},onSuccess(e){r&&null!=e.prompt._id&&e.prompt._id&&e.prompt.groupId&&F.mutate({id:e.prompt._id,groupId:e.prompt.groupId,productionPrompt:{prompt:e.prompt.prompt}}),R({prompt:e.prompt.prompt,promptName:(null==v?void 0:v.name)||"",category:(null==v?void 0:v.category)||""})}}),U=n.useCallback((e=>{if(!k)return;if(!e)return;if(!M)return;const t=M.groupId||(null==v?void 0:v._id);if(!t)return void console.error("No groupId available");const n={prompt:{type:M.type??"text",groupId:t,prompt:e}};e!==M.prompt&&z.mutate({...n,groupId:t})}),[M,v,z,k]),V=n.useCallback((()=>{b||w||f(!1)}),[b,w]);n.useEffect((()=>{d.current&&!u&&k&&T((e=>U(e.prompt)))(),d.current=u}),[u,U,T,k]),n.useEffect((()=>{V()}),[e.promptId,i,null==v?void 0:v.productionId,j,V]),n.useEffect((()=>{I("prompt",M?M.prompt:"",{shouldDirty:!1}),I("category",v?v.category:"",{shouldDirty:!1})}),[M,v,I]),n.useEffect((()=>{const e=()=>{window.matchMedia("(min-width: 1022px)").matches&&g(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const B=n.useMemo((()=>ko(((e,t,n)=>{n({id:e,payload:{oneliner:t}})}),950)),[]),$=n.useMemo((()=>ko(((e,t,n)=>{n({id:e,payload:{command:t}})}),950)),[]),H=n.useCallback((e=>{if(!v||!v._id)return console.warn("Group not found");B(v._id,e,D.mutate)}),[v,D.mutate,B]),G=n.useCallback((e=>{if(!v||!v._id)return console.warn("Group not found");$(v._id,e,D.mutate)}),[v,D.mutate,$]);if(p)return s.jsx(aO,{});if(!k&&!C&&O.data){const t=Kb(O.data,(t=>t._id===e.promptId));if(!t&&!S)return s.jsx(XL,{});if(t||v)return s.jsx(LM,{group:t||v})}if(!v||null==v._id)return null;const K=v.name;return s.jsx(Bo,{...E,children:s.jsx("form",{className:"mt-4 flex w-full",onSubmit:T((e=>U(e.prompt))),children:s.jsxs("div",{className:"relative w-full",children:[s.jsx("div",{className:"h-full w-full",style:{transform:`translateX(${h?`-${x}`:"0"})`,transition:"transform 0.3s ease-in-out"},children:s.jsxs("div",{className:"flex h-full",children:[s.jsxs("div",{className:"flex-1 overflow-hidden px-4",children:[s.jsx("div",{className:"mb-4 flex items-center gap-2 text-text-primary",children:b?s.jsx(Nl,{className:"mb-1 flex h-10 w-32 font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"}):s.jsxs(s.Fragment,{children:[s.jsx(LL,{name:K,onSave:e=>{k&&v._id&&D.mutate({id:v._id,payload:{name:e}})}}),s.jsx("div",{className:"flex-1"}),s.jsx(ki,{type:"button",variant:"ghost",className:"h-10 w-10 border border-border-light p-0 lg:hidden",onClick:()=>g(!0),"aria-label":t("com_endpoint_open_menu"),children:s.jsx(gn,{className:"size-5"})}),s.jsx("div",{className:"hidden lg:block",children:i===Kd.SIMPLE&&s.jsx(oO,{group:v,prompts:j,selectedPrompt:M,selectionIndex:l,selectedPromptId:L,isLoadingPrompts:w,canEdit:k,setSelectionIndex:c})})]})}),w?s.jsx(Nl,{className:"h-96","aria-live":"polite"}):s.jsxs("div",{className:"mb-2 flex h-full flex-col gap-4",children:[s.jsx(QL,{name:"prompt",isEditing:u,setIsEditing:e=>k&&m(e)}),s.jsx(PM,{promptText:A}),s.jsx(AM,{initialValue:v.oneliner??"",onValueChange:k?H:void 0,disabled:!k}),s.jsx(MM,{initialValue:v.command??"",onValueChange:k?G:void 0,disabled:!k})]})]}),i===Kd.ADVANCED&&s.jsx("div",{className:"hidden w-1/4 border-l border-border-light lg:block",children:s.jsx(oO,{group:v,prompts:j,selectionIndex:l,selectedPrompt:M,selectedPromptId:L,isLoadingPrompts:w,canEdit:k,setSelectionIndex:c})})]})}),s.jsx("button",{type:"button",className:n_("absolute inset-0 z-40 cursor-default",h?"opacity-100":"pointer-events-none opacity-0"),style:{transition:"opacity 0.3s ease-in-out"},onClick:()=>g(!1),"aria-hidden":!h,tabIndex:h?0:-1,"aria-label":t("com_ui_close_menu")}),s.jsx("div",{className:"absolute inset-y-0 right-0 z-50 lg:hidden",style:{width:x,transform:`translateX(${h?"0":"100%"})`,transition:"transform 0.3s ease-in-out"},role:"dialog","aria-modal":"true","aria-label":"Mobile navigation panel",children:s.jsx("div",{className:"h-full",children:s.jsx("div",{className:"h-full overflow-auto",children:s.jsx(oO,{group:v,prompts:j,selectionIndex:l,selectedPrompt:M,selectedPromptId:L,isLoadingPrompts:w,canEdit:k,setSelectionIndex:c})})})})]})})})};function lO(){const e=Fk();return s.jsx("div",{className:"h-full w-full content-center text-center font-bold text-text-secondary",children:e("com_ui_select_or_create_prompt")})}const cO={name:"",prompt:"",type:"text",category:"",oneliner:void 0,command:void 0},dO=({defaultValues:e=cO})=>{const t=Fk(),a=Fe(),r=Wk({permissionType:hg.PROMPTS,permission:gg.CREATE});n.useEffect((()=>{let e;return r||(e=setTimeout((()=>{a("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[r,a]);const o=zo({defaultValues:{...e,category:localStorage.getItem(Eh.LAST_PROMPT_CATEGORY)??""}}),{watch:i,control:l,handleSubmit:c,formState:{isDirty:d,isSubmitting:u,errors:m,isValid:p}}=o,f=Dj({onSuccess:e=>{a(`/d/prompts/${e.prompt.groupId}`,{replace:!0})}}),h=i("prompt");return r?s.jsx(Bo,{...o,children:s.jsxs("form",{onSubmit:c((e=>{const{name:t,category:n,oneliner:s,command:a,...r}=e,o={name:t,category:n};((null==s?void 0:s.length)??0)>0&&(o.oneliner=s),((null==a?void 0:a.length)??0)>0&&(o.command=a),f.mutate({prompt:r,group:o})})),className:"w-full px-4 py-2",children:[s.jsx("div",{className:"mb-1 flex flex-col items-center justify-between font-bold sm:text-xl md:mb-0 md:text-2xl",children:s.jsxs("div",{className:"flex w-full flex-col items-center justify-between sm:flex-row",children:[s.jsx(Uo,{name:"name",control:l,rules:{required:t("com_ui_prompt_name_required")},render:({field:e})=>s.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[s.jsx(ll,{...e,type:"text",className:"mr-2 w-full border border-border-medium p-2 text-2xl text-text-primary placeholder:text-text-tertiary dark:placeholder:text-text-secondary",placeholder:`${t("com_ui_prompt_name")}*`,tabIndex:0}),s.jsx("div",{className:n_("mt-1 w-56 text-sm text-red-500",m.name?"visible h-auto":"invisible h-0"),children:m.name?m.name.message:" "})]})}),s.jsx(YL,{})]})}),s.jsxs("div",{className:"flex w-full flex-col gap-4 md:mt-[1.075rem]",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-medium py-2 pl-4 pr-1 text-base font-semibold dark:text-gray-200",children:[s.jsxs("span",{children:[t("com_ui_prompt_text"),"*"]}),s.jsx(WL,{fieldName:"prompt",className:"mr-2"})]}),s.jsx("div",{className:"min-h-32 rounded-b-lg border border-border-medium p-4 transition-all duration-150",children:s.jsx(Uo,{name:"prompt",control:l,rules:{required:t("com_ui_prompt_text_required")},render:({field:e})=>s.jsxs("div",{children:[s.jsx(Ml,{...e,className:"w-full rounded border border-border-medium px-2 py-1 focus:outline-none dark:bg-transparent dark:text-gray-200",minRows:6,tabIndex:0}),s.jsx("div",{className:"mt-1 text-sm text-red-500 "+(m.prompt?"visible h-auto":"invisible h-0"),children:m.prompt?m.prompt.message:" "})]})})})]}),s.jsx(PM,{promptText:h}),s.jsx(AM,{onValueChange:e=>o.setValue("oneliner",e),tabIndex:0}),s.jsx(MM,{onValueChange:e=>o.setValue("command",e),tabIndex:0}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(ki,{"aria-label":t("com_ui_create_prompt"),tabIndex:0,type:"submit",disabled:!d||u||!p,children:t("com_ui_create_prompt")})})]})]})}):null};function uO(){const e=pr(),{isAuthenticated:t}=Kk(),a=(()=>{const e=De(),t=n.useRef();return n.useEffect((()=>{var n;t.current=null==(n=e.state)?void 0:n.prevLocation}),[e]),t})(),r=Ny.useClearConvoState(),[o,i]=n.useState("");return n.useEffect((()=>{var e;i((null==(e=a.current)?void 0:e.pathname)||"")}),[a]),n.useEffect((()=>{e.removeQueries([xx.messages,"new"]),r()}),[e,r]),t?s.jsx(fS.Provider,{value:{prevLocationPath:o},children:s.jsx("div",{className:"h-screen w-full",children:s.jsx(En,{})})}):null}const mO={path:"d/*",element:s.jsx(uO,{}),children:[{path:"prompts/*",element:s.jsx(HL,{}),children:[{index:!0,element:s.jsx(lO,{})},{path:"new",element:s.jsx(dO,{})},{path:":promptId",element:s.jsx(iO,{})}]},{path:"*",element:s.jsx(Ln,{to:"/d/files",replace:!0})}]};function pO({message:e,searchResults:t}){const a=Fk(),[r,o]=n.useState(!1),i=qE({text:e.text,content:e.content,searchResults:t});return s.jsx("div",{className:"visible mt-0 flex justify-center gap-1 self-end text-gray-400 lg:justify-start",children:s.jsx("button",{className:"ml-0 flex items-center gap-1.5 rounded-md p-1 text-xs hover:text-gray-900 dark:text-gray-400/70 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400 md:group-hover:visible md:group-[.final-completion]:visible",onClick:()=>i(o),type:"button",title:a(r?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),children:r?s.jsx(oc,{className:"h-[18px] w-[18px]"}):s.jsx(rc,{})})})}const fO={[yh.MODERATION]:"com_error_moderation",[yh.NO_USER_KEY]:"com_error_no_user_key",[yh.INVALID_USER_KEY]:"com_error_invalid_user_key",[yh.NO_BASE_URL]:"com_error_no_base_url",[yh.INVALID_ACTION]:`com_error_${yh.INVALID_ACTION}`,[yh.INVALID_REQUEST]:`com_error_${yh.INVALID_REQUEST}`,[yh.MISSING_MODEL]:(e,t)=>{const{info:n}=e;return t("com_error_missing_model",{0:uh[n??""]??n??"unknown"})},[yh.MODELS_NOT_LOADED]:"com_error_models_not_loaded",[yh.ENDPOINT_MODELS_NOT_LOADED]:(e,t)=>{const{info:n}=e;return t("com_error_endpoint_models_not_loaded",{0:uh[n??""]??n??"unknown"})},[yh.NO_SYSTEM_MESSAGES]:`com_error_${yh.NO_SYSTEM_MESSAGES}`,[yh.EXPIRED_USER_KEY]:(e,t)=>{const{expiredAt:n,endpoint:s}=e;return t("com_error_expired_user_key",{0:s,1:n})},[yh.INPUT_LENGTH]:(e,t)=>{const{info:n}=e;return t("com_error_input_length",{0:n})},[yh.INVALID_AGENT_PROVIDER]:(e,t)=>{const{info:n}=e;return t("com_error_invalid_agent_provider",{0:uh[n]??n})},[yh.GOOGLE_ERROR]:e=>{const{info:t}=e;return t},[yh.GOOGLE_TOOL_CONFLICT]:"com_error_google_tool_conflict",[_h.BAN]:"Your account has been temporarily banned due to violations of our service.",[_h.ILLEGAL_MODEL_REQUEST]:(e,t)=>{const{info:n}=e,[s,a="unknown"]=(null==n?void 0:n.split("|"))??[];return t("com_error_illegal_model_request",{0:a,1:uh[s??""]??s??"unknown"})},invalid_api_key:'Invalid API key. Please check your API key and try again. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',insufficient_quota:'We apologize for any inconvenience caused. The default API key has reached its limit. To continue using this service, please set up your own API key. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',concurrent:e=>{const{limit:t}=e;return`Only ${t} message${t>1?"s":""} at a time. Please allow any other responses to complete before sending another message, or wait one minute.`},message_limit:e=>{const{max:t,windowInMinutes:n}=e;return`You hit the message limit. You have a cap of ${t} message${t>1?"s":""} per ${n>1?`${n} minutes`:"minute"}.`},token_balance:e=>{const{balance:t,tokenCost:n,promptTokens:a,generations:r}=e,o=`Insufficient Funds! Balance: ${t}. Prompt tokens: ${a}. Cost: ${n}.`;return s.jsxs(s.Fragment,{children:[o,r&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("br",{})]}),r&&s.jsx(yM,{lang:"Generations",error:!0,codeChildren:lu(JSON.stringify(r))})]})}},hO=({text:e})=>{const t=Fk(),n=function(e){let t=0,n=-1;for(let s=0;s<e.length;s++)if("{"===e[s])0===t&&(n=s),t++;else if("}"===e[s]&&(t--,0===t&&-1!==n))return e.slice(n,s+1);return""}(e),s=`Something went wrong. Here's the specific error message we encountered: ${e.length>512&&!n?e.slice(0,512)+"...":e}`;if(!iu(n))return s;const a=JSON.parse(n),r=a.code||a.type,o=r&&fO[r];return o&&"function"==typeof fO[r]?fO[r](a,t):o&&o.startsWith("com_error")?t(fO[r]):o?fO[r]:s},gO=({text:e,message:t,isSubmitting:a,ask:r,enterEdit:o,siblingIdx:i,setSiblingIdx:l})=>{const{addedIndex:c}=aS(),d=n.useRef(null),u=n.useRef(null),{getMessages:m,setMessages:p,conversation:f}=Pk(),[h,g]=Re(Ny.latestMessageFamily(c)),x=n.useRef(null),{conversationId:v,parentMessageId:b,messageId:_}=t,y=function(e){var t=pr();return fr((function(e){return function(e){var t=e.conversationId,n=e.messageId,s=e.text;if(!t)throw new Error("conversationId is required");return qC.put(SN({conversationId:t,messageId:n}),{text:s})}(e)}),{onSuccess:function(){t.invalidateQueries([QC.messages,e])}})}(v??""),j=Fk(),w="rtl"===Ae(Ny.chatDirection).toLowerCase(),{register:N,handleSubmit:C,setValue:k}=zo({defaultValues:{text:e??""}});n.useEffect((()=>{const e=x.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const S=n.useCallback((e=>{var t,n;"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(t=u.current)||t.click()),"s"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(n=d.current)||n.click()),"Escape"===e.key&&(e.preventDefault(),o(!0))}),[o]),{ref:E,...T}=N("text",{required:!0,onChange:e=>{k("text",e.target.value,{shouldValidate:!0})}});return s.jsxs(xM,{message:t,children:[s.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:s.jsx(Ml,{...T,ref:e=>{E(e),x.current=e},onKeyDown:S,"data-testid":"message-text-editor",className:n_("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",w?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",m_),dir:w?"rtl":"ltr"})}),s.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[s.jsx(Ol,{description:"Ctrl + Enter / ⌘ + Enter",render:s.jsx("button",{ref:u,className:"btn btn-primary relative mr-2",disabled:a,onClick:C((e=>{if(t.isCreatedByUser)r({text:e.text,parentMessageId:b,conversationId:v},{overrideFiles:t.files}),l((i??0)-1);else{const t=m(),n=null==t?void 0:t.find((e=>e.messageId===b));if(!n)return;r({...n},{editedText:e.text,editedMessageId:_,isRegenerate:!0,isEdited:!0}),l((i??0)-1)}o(!0)})),children:j("com_ui_save_submit")})}),s.jsx(Ol,{description:"Shift + Enter",render:s.jsx("button",{ref:d,className:"btn btn-secondary relative mr-2",disabled:a,onClick:C((e=>{const n=m();if(!n)return;y.mutate({conversationId:v??"",model:(null==f?void 0:f.model)??"gpt-3.5-turbo",text:e.text,messageId:_}),t.messageId===(null==h?void 0:h.messageId)&&g({...h,text:e.text});n.some((e=>e.messageId===_))?p(n.map((t=>t.messageId===_?{...t,text:e.text}:t))):t.text=e.text,o(!0)})),children:j("com_ui_save")})}),s.jsx(Ol,{description:"Esc",render:s.jsx("button",{className:"btn btn-neutral relative",onClick:()=>o(!0),children:j("com_ui_cancel")})})]})]})},xO=({text:e,message:t,className:a=""})=>{const r=Fk();return"Error connecting to server, try refreshing the page."===e?(console.log("error message",t),s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:s.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"submitting relative",children:s.jsx("span",{className:"result-thinking"})})})})}),children:s.jsx(Cd,{delay:5500,children:s.jsx(xM,{message:t,children:s.jsx("div",{className:n_("rounded-md border border-red-500 bg-red-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",a),children:r("com_ui_error_connection")})})})})):s.jsx(xM,{message:t,children:s.jsx("div",{role:"alert","aria-live":"assertive",className:n_("rounded-xl border border-red-500/20 bg-red-500/5 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",a),children:s.jsx(hO,{text:e})})})},vO=({text:e,isCreatedByUser:t,message:a,showCursor:r})=>{const{isSubmitting:o,latestMessage:i}=Pk(),l=Ae(Ny.enableUserMsgMarkdown),c=n.useMemo((()=>!0===r&&o),[r,o]),d=n.useMemo((()=>a.messageId===(null==i?void 0:i.messageId)),[a.messageId,null==i?void 0:i.messageId]);let u;return u=t?l?s.jsx(EA,{content:e}):s.jsx(s.Fragment,{children:e}):s.jsx(WA,{content:e,isLatestMessage:d}),s.jsx(xM,{message:a,children:s.jsx("div",{className:n_(o?"submitting":"",c&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!l&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:u})})},bO=({message:e})=>s.jsx(xO,{message:e,text:"The response is incomplete; it's either still processing, was cancelled, or censored. Refresh or try a different prompt."}),_O=n.memo((({text:e,edit:t,error:a,unfinished:r,isSubmitting:o,isLast:i,...l})=>{const{message:c}=l,{messageId:d}=c,{thinkingContent:u,regularContent:m}=n.useMemo((()=>{const t=e.match(/:::thinking([\s\S]*?):::/);return{thinkingContent:t?t[1].trim():"",regularContent:t?e.replace(/:::thinking[\s\S]*?:::/,"").trim():e}}),[e]),p=n.useMemo((()=>i&&o),[i,o]),f=n.useMemo((()=>!o&&r?s.jsx(n.Suspense,{children:s.jsx(Cd,{delay:250,children:s.jsx(bO,{message:c})})}):null),[o,r,c]);return a?s.jsx(xO,{message:l.message,text:e}):t?s.jsx(gO,{text:e,isSubmitting:o,...l}):s.jsxs(s.Fragment,{children:[u.length>0&&s.jsx(aM,{children:u},`thinking-${d}`),s.jsx(vO,{showCursor:p,text:m,...l},`display-${d}`),f]})}));class yO extends n.Component{constructor(){super(...arguments),t(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){var n,s;console.error("Sources error:",e),null==(s=(n=this.props).onError)||s.call(n,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:s.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[s.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:"Sources temporarily unavailable"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":"Reload the page",children:"Refresh"})]}):this.props.children}}function jO({source:e,expanded:t=!1}){const n=Fk(),a=IA(e.link);return t?s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(RA,{domain:a}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("span",{className:"mt-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet})]})]}):s.jsx("span",{className:"not-prose relative inline-block h-full w-full",children:s.jsx(Ot,{showTimeout:150,hideTimeout:150,children:s.jsxs("div",{className:"flex h-full items-center",children:[s.jsx(Dt,{render:s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(RA,{domain:a}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),s.jsx("div",{className:"mt-1",children:s.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link})})]})}),s.jsxs(Ut,{className:"absolute right-2 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(zt,{children:n("com_citation_more_details",{label:a})}),s.jsx(Pt,{className:"icon-sm"})]}),s.jsx(Vt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"mb-2 flex items-center",children:[s.jsx(RA,{domain:a,className:"mr-2"}),s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||a})]}),s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]}),"imageUrl"in e&&e.imageUrl&&s.jsx("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md",children:s.jsx("img",{src:e.imageUrl,alt:e.title||n("com_sources_image_alt"),className:"h-full w-full object-cover"})})]})})]})})})}function wO({image:e}){const t=Fk();return s.jsx("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"group overflow-hidden rounded-lg bg-surface-secondary transition-all duration-300 hover:bg-surface-tertiary",children:e.imageUrl&&s.jsxs("div",{className:"relative aspect-square w-full overflow-hidden",children:[s.jsx("img",{src:e.imageUrl,alt:e.title||t("com_sources_image_alt"),className:"size-full object-cover"}),e.title&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 w-full border-none bg-gray-900/80 p-1 text-xs font-medium text-white backdrop-blur-sm",children:s.jsx("span",{className:"truncate",children:e.title})})]})})}function NO(e,t){return t&&0!==Object.keys(t).length?[...e].sort(((e,n)=>{const s=t[e]||0;return(t[n]||0)-s})):e}const CO=S.memo((function({file:e,messageId:t,conversationId:a,expanded:r=!1}){var o;const i=Fk(),l=Ae(Ny.user),{showToast:c}=Bd(),{refetch:d}=Xy((null==l?void 0:l.id)??"",e.file_id);n.useCallback((e=>{var t,n,s,a,r;const o=JSON.stringify(e),l=e,c=(null==(t=null==e?void 0:e.message)?void 0:t.includes("local files"))||(null==(a=null==(s=null==(n=null==l?void 0:l.response)?void 0:n.data)?void 0:s.error)?void 0:a.includes("local files"))||403===(null==(r=null==l?void 0:l.response)?void 0:r.status)||o.includes("local files")||o.includes("403");return i(c?"com_sources_download_local_unavailable":"com_sources_download_failed")}),[i]);const u="local"===(null==(o=e.metadata)?void 0:o.storageType),m=n.useCallback((async t=>{if(t.preventDefault(),t.stopPropagation(),!u)try{const t=await d();if(null==t.data||""===t.data)return console.error("Error downloading file: No data found"),void c({status:"error",message:i("com_ui_download_error")});const n=document.createElement("a");n.href=t.data,n.setAttribute("download",e.filename),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t.data)}catch(n){console.error("Error downloading file:",n)}}),[d,e.filename,u,i,c]),p=n.useMemo((()=>{var t;const n=(null==(t=e.type)?void 0:t.toLowerCase())||"";return n.includes("pdf")?"📄":n.includes("image")?"🖼️":n.includes("text")?"📝":n.includes("word")||n.includes("doc")?"📄":n.includes("excel")||n.includes("sheet")?"📊":n.includes("powerpoint")||n.includes("presentation")?"📈":"📎"}),[e.type]),f=i("com_sources_download_aria_label",{filename:e.filename,status:""});return r?s.jsxs("button",{onClick:u?void 0:m,disabled:false,className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(u?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":u?i("com_sources_download_local_unavailable"):f,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-base",children:p}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:i("com_sources_agent_file")}),!u&&s.jsx(On,{className:"ml-auto h-3 w-3"})]}),s.jsxs("div",{className:"mt-1 min-w-0",children:[s.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[i("com_sources_pages"),":"," ",NO(e.pages,e.pageRelevance).join(", ")]}),e.bytes&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-xs text-text-secondary",children:[(e.bytes/1024).toFixed(1)," KB"]})]}),null]}):s.jsxs("button",{onClick:u?void 0:m,disabled:false,className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(u?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":u?i("com_sources_download_local_unavailable"):f,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-base",children:p}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:i("com_sources_agent_file")}),!u&&s.jsx(On,{className:"ml-auto h-3 w-3"})]}),s.jsxs("div",{className:"mt-1 min-w-0",children:[s.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[i("com_sources_pages"),":"," ",NO(e.pages,e.pageRelevance).join(", ")]})]}),null]})}));function kO({sources:e,start:t=0,end:n=3}){let a=[t,n];return t<0&&(a=[t]),s.jsx("div",{className:"relative flex",children:e.slice(...a).map(((e,t)=>s.jsx(RA,{domain:IA(e.link),className:t>0?"ml-[-6px]":""},`icon-${t}`)))})}const SO=S.memo((function({sources:e,limit:t=3}){const a=Fk(),{visibleSources:r,remainingSources:o,hasMoreSources:i}=n.useMemo((()=>{const n=e.slice(0,t),s=e.slice(t);return{visibleSources:n,remainingSources:s,hasMoreSources:s.length>0}}),[e,t]);return s.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:s.jsxs(ul,{children:[r.map(((e,t)=>s.jsx("div",{className:"w-full min-w-[120px]",children:s.jsx(jO,{source:e})},`source-${t}`))),i&&s.jsx(ml,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(kO,{sources:o}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a("com_sources_more_sources",{count:o.length})})]})}),s.jsxs(gl,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[s.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[s.jsx(bl,{className:"text-base font-medium",children:a("com_sources_title")}),s.jsx(fl,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":a("com_ui_close"),children:s.jsx(vt,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:s.jsx("div",{className:"flex flex-col gap-2",children:[...r,...o].map(((e,t)=>s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex gap-2 rounded-lg px-2 py-2 transition-colors hover:bg-surface-tertiary",children:[s.jsx(RA,{domain:IA(e.link),className:"h-5 w-5 flex-shrink-0"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h3",{className:"mb-0.5 truncate text-sm font-medium text-text-primary",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("p",{className:"mb-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet}),s.jsx("span",{className:"text-xs text-text-secondary-alt",children:IA(e.link)})]}),"imageUrl"in e&&e.imageUrl&&s.jsx("div",{className:"hidden h-12 w-12 flex-shrink-0 overflow-hidden rounded-md sm:block",children:s.jsx("img",{src:e.imageUrl,alt:e.title||a("com_sources_image_alt"),className:"h-full w-full object-cover"})})]},`more-source-${t}`)))})})]})]})})}));function EO({files:e,messageId:t,conversationId:n,limit:a=3}){const r=Fk(),o=e.length<=a+1?e.length:a,i=e.slice(0,o),l=e.slice(o),c=l.length>0;return s.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:s.jsxs(ul,{children:[i.map(((e,a)=>s.jsx("div",{className:"w-full min-w-[120px]",children:s.jsx(CO,{file:e,messageId:t,conversationId:n})},`file-${a}`))),c&&s.jsx(ml,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"relative flex",children:l.slice(0,3).map(((e,t)=>s.jsx(zn,{className:"h-4 w-4 "+(t>0?"ml-[-6px]":"")},`file-icon-${t}`)))}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:r("com_sources_more_files",{count:l.length})})]})}),s.jsxs(gl,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[s.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[s.jsx(bl,{className:"text-base font-medium",children:r("com_sources_agent_files")}),s.jsx(fl,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":r("com_ui_close"),children:s.jsx(vt,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:s.jsx("div",{className:"flex flex-col gap-2",children:[...i,...l].map(((e,a)=>s.jsx(CO,{file:e,messageId:t,conversationId:n,expanded:!0},`more-file-${a}`)))})})]})]})})}function TO({label:e,icon:t}){return s.jsxs("div",{className:"flex items-center gap-2 rounded-md px-3 py-1 text-sm transition-colors hover:bg-surface-tertiary hover:text-text-primary",children:[S.cloneElement(t,{size:14}),s.jsx("span",{children:e})]})}function IO({messageId:e,conversationId:t}={}){const a=Fk(),{searchResults:r}=ES(),{organicSources:o,topStories:i,images:l,hasAnswerBox:c,agentFiles:d}=n.useMemo((()=>{var t,n,s,a;const o=new Map,i=new Map,l=new Map,c=new Map;let d=!1;if(!r)return{organicSources:[],topStories:[],images:[],hasAnswerBox:!1,agentFiles:[]};for(const u of Object.values(r))u&&(null==(t=u.organic)||t.forEach((e=>{e.link&&o.set(e.link,e)})),null==(n=u.references)||n.forEach((t=>{if("image"===t.type)l.set(t.link,{...t,imageUrl:t.link});else if("file"===t.type){const n=t.fileId||"unknown",s=t.title||"Unknown File",a=`${n}_${s}`;if(c.has(a)){const e=c.get(a),n=e.pages||[],s=t.pages||[],r=[...new Set([...n,...s])].sort(((e,t)=>e-t));e.pages=r,e.relevance=Math.max(e.relevance||0,t.relevance||0),e.pageRelevance={...e.pageRelevance,...t.pageRelevance}}else{const r={type:hu.file_search,file_id:n,filename:s,bytes:void 0,metadata:t.metadata,pages:t.pages,relevance:t.relevance,pageRelevance:t.pageRelevance,messageId:e||"",toolCallId:"file_search_results"};c.set(a,r)}}else t.link&&o.set(t.link,t)})),null==(s=u.topStories)||s.forEach((e=>{e.link&&i.set(e.link,e)})),null==(a=u.images)||a.forEach((e=>{e.imageUrl&&l.set(e.imageUrl,e)})),u.answerBox&&(d=!0));return{organicSources:Array.from(o.values()),topStories:Array.from(i.values()),images:Array.from(l.values()),hasAnswerBox:d,agentFiles:Array.from(c.values())}}),[r,e]),u=n.useMemo((()=>{const n=[];return(o.length||i.length||c)&&n.push({label:s.jsx(TO,{label:a("com_sources_tab_all"),icon:s.jsx(Wt,{})}),content:s.jsx(SO,{sources:[...o,...i]})}),i.length&&n.push({label:s.jsx(TO,{label:a("com_sources_tab_news"),icon:s.jsx(Dn,{})}),content:s.jsx(SO,{sources:i,limit:3})}),l.length&&n.push({label:s.jsx(TO,{label:a("com_sources_tab_images"),icon:s.jsx(Fn,{})}),content:s.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:l.map(((e,t)=>s.jsx(wO,{image:e},`image-${t}`)))})}),d.length&&e&&t&&n.push({label:s.jsx(TO,{label:a("com_sources_tab_files"),icon:s.jsx(zn,{})}),content:s.jsx(EO,{files:d,messageId:e,conversationId:t,limit:3})}),n}),[o,i,l,c,d,e,t,a]);return u.length?s.jsx("div",{role:"region","aria-label":a("com_sources_region_label"),children:s.jsx(xi,{tabs:u,containerClassName:"flex min-w-full mb-4",tabListClassName:"flex items-center mb-2 border-b border-border-light overflow-x-auto",tabPanelClassName:"w-full overflow-x-auto scrollbar-none md:mx-0 md:px-0",tabClassName:"flex items-center whitespace-nowrap text-xs font-medium text-token-text-secondary px-1 pt-2 pb-1 border-b-2 border-transparent data-[state=active]:text-text-primary outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"})}):null}function RO(e){const t=Fk(),n=s.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[s.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:t("com_sources_error_fallback")}),s.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":t("com_sources_reload_page"),children:t("com_ui_refresh")})]});return s.jsx(yO,{onError:(e,t)=>{console.error("Sources component error:",{error:e,errorInfo:t})},fallback:n,showDetails:!1,children:s.jsx(IO,{...e})})}function PO({radius:e,circumference:t,offset:n}){return s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-brand-purple/25 dark:stroke-brand-purple/50",strokeWidth:"7.826086956521739",fill:"transparent",r:e,cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"7.826086956521739",strokeDasharray:`${t} ${t}`,strokeDashoffset:n,fill:"transparent",r:e,cx:"60",cy:"60"})]})}function AO({error:e,isSubmitting:t,progress:n,children:a}){return!t&&n<1||!0===e?s.jsx(lM,{}):s.jsx(s.Fragment,{children:a})}function MO(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[s.jsxs("defs",{children:[s.jsx("clipPath",{id:"__lottie_element_258",children:s.jsx("rect",{width:"20",height:"20",x:"0",y:"0"})}),s.jsx("clipPath",{id:"__lottie_element_263",children:s.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})}),s.jsx("clipPath",{id:"__lottie_element_270",children:s.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})})]}),s.jsx("g",{clipPath:"url(#__lottie_element_258)",children:s.jsxs("g",{clipPath:"url(#__lottie_element_263)",style:{display:"block"},transform:"matrix(0.9999999403953552,0,0,0.9999999403953552,-10000,-10000)",opacity:"1",children:[s.jsxs("g",{clipPath:"url(#__lottie_element_270)",style:{display:"block"},transform:"matrix(0.9999988675117493,0,0,0.9999988675117493,10.01171875,10.01171875)",opacity:"1",children:[s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,-2.125)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357900083065033 0.3357900083065033,8.881784197001252e-16 0.75,8.881784197001252e-16 C2.4166667461395264,8.881784197001252e-16 4.083333492279053,8.881784197001252e-16 5.75,8.881784197001252e-16 C6.1641998291015625,8.881784197001252e-16 6.5,0.3357900083065033 6.5,0.75 C6.5,1.1642099618911743 6.1641998291015625,1.5 5.75,1.5 C4.083333492279053,1.5 2.4166667461395264,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.1642099618911743 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})}),s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,0.625)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357999920845032 0.3357900083065033,0 0.75,0 C1.9166666269302368,0 3.0833332538604736,0 4.25,0 C4.6641998291015625,0 5,0.3357999920845032 5,0.75 C5,1.164199948310852 4.6641998291015625,1.5 4.25,1.5 C3.0833332538604736,1.5 1.9166666269302368,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.164199948310852 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})})]}),s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsxs("g",{opacity:"1",transform:"matrix(1,0,0,1,10,10)",children:[s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M-3.13,-5.25 C-3.09,-5.25 -3.04,-5.25 -3,-5.25 C-2.59,-5.25 -2.25,-4.91 -2.25,-4.5 C-2.25,-4.09 -2.59,-3.75 -3,-3.75 C-3.03,-3.75 -3.07,-3.75 -3.1,-3.75 C-3.53,-3.75 -3.81,-3.75 -4.02,-3.73 C-4.23,-3.72 -4.3,-3.69 -4.34,-3.67 C-4.48,-3.6 -4.6,-3.48 -4.67,-3.34 C-4.69,-3.3 -4.72,-3.23 -4.73,-3.02 C-4.75,-2.81 -4.75,-2.53 -4.75,-2.1 C-4.75,-2.07 -4.75,-2.03 -4.75,-2 C-4.75,-1.59 -5.09,-1.25 -5.5,-1.25 C-5.91,-1.25 -6.25,-1.59 -6.25,-2 C-6.25,-2.04 -6.25,-2.09 -6.25,-2.13 C-6.25,-2.52 -6.25,-2.87 -6.23,-3.15 C-6.2,-3.44 -6.15,-3.74 -6,-4.02 C-5.79,-4.44 -5.44,-4.79 -5.02,-5 C-4.74,-5.15 -4.44,-5.2 -4.15,-5.23 C-3.87,-5.25 -3.52,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 M6.25,-2.13 C6.25,-2.09 6.25,-2.04 6.25,-2 C6.25,-1.59 5.91,-1.25 5.5,-1.25 C5.09,-1.25 4.75,-1.59 4.75,-2 C4.75,-2.03 4.75,-2.07 4.75,-2.1 C4.75,-2.53 4.75,-2.81 4.73,-3.02 C4.72,-3.23 4.69,-3.3 4.67,-3.34 C4.6,-3.48 4.48,-3.6 4.34,-3.67 C4.3,-3.69 4.23,-3.72 4.02,-3.73 C3.81,-3.75 3.53,-3.75 3.1,-3.75 C3.07,-3.75 3.03,-3.75 3,-3.75 C2.59,-3.75 2.25,-4.09 2.25,-4.5 C2.25,-4.91 2.59,-5.25 3,-5.25 C3.04,-5.25 3.09,-5.25 3.13,-5.25 C3.52,-5.25 3.87,-5.25 4.15,-5.23 C4.44,-5.2 4.74,-5.15 5.02,-5 C5.44,-4.79 5.79,-4.44 6,-4.02 C6.15,-3.74 6.2,-3.44 6.23,-3.15 C6.25,-2.87 6.25,-2.52 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 M-3.13,5.25 C-3.09,5.25 -3.04,5.25 -3,5.25 C-2.59,5.25 -2.25,4.91 -2.25,4.5 C-2.25,4.09 -2.59,3.75 -3,3.75 C-3.03,3.75 -3.07,3.75 -3.1,3.75 C-3.53,3.75 -3.81,3.75 -4.02,3.73 C-4.23,3.72 -4.3,3.69 -4.34,3.67 C-4.48,3.6 -4.6,3.48 -4.67,3.34 C-4.69,3.3 -4.72,3.23 -4.73,3.02 C-4.75,2.81 -4.75,2.53 -4.75,2.1 C-4.75,2.07 -4.75,2.03 -4.75,2 C-4.75,1.59 -5.09,1.25 -5.5,1.25 C-5.91,1.25 -6.25,1.59 -6.25,2 C-6.25,2.04 -6.25,2.09 -6.25,2.13 C-6.25,2.52 -6.25,2.87 -6.23,3.15 C-6.2,3.44 -6.15,3.74 -6,4.02 C-5.79,4.44 -5.44,4.79 -5.02,5 C-4.74,5.15 -4.44,5.2 -4.15,5.23 C-3.87,5.25 -3.52,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 M6.25,2.13 C6.25,2.09 6.25,2.04 6.25,2 C6.25,1.59 5.91,1.25 5.5,1.25 C5.09,1.25 4.75,1.59 4.75,2 C4.75,2.03 4.75,2.07 4.75,2.1 C4.75,2.53 4.75,2.81 4.73,3.02 C4.72,3.23 4.69,3.3 4.67,3.34 C4.6,3.48 4.48,3.6 4.34,3.67 C4.3,3.69 4.23,3.72 4.02,3.73 C3.81,3.75 3.53,3.75 3.1,3.75 C3.07,3.75 3.03,3.75 3,3.75 C2.59,3.75 2.25,4.09 2.25,4.5 C2.25,4.91 2.59,5.25 3,5.25 C3.04,5.25 3.09,5.25 3.13,5.25 C3.52,5.25 3.87,5.25 4.15,5.23 C4.44,5.2 4.74,5.15 5.02,5 C5.44,4.79 5.79,4.44 6,4.02 C6.15,3.74 6.2,3.44 6.23,3.15 C6.25,2.87 6.25,2.52 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13"}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,-5.250000476837158)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,-5.250000476837158)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,1.25)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,1.25)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})})]})})]})})]})}function LO({initialProgress:e=.1,isSubmitting:t}){const n=FE(e),a=56.08695652173913,r=2*Math.PI*a,o=r-n*r,i=n>=2;return s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:n<1?s.jsx(AO,{progress:n,isSubmitting:t,error:i,children:s.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},children:[s.jsx("div",{children:s.jsx(MO,{})}),s.jsx(PO,{radius:a,circumference:r,offset:o})]})}):i?s.jsx(lM,{}):s.jsx(cM,{})}),s.jsx(mM,{progress:n,onClick:()=>({}),inProgressText:"Searching my knowledge",finishedText:"Used Retrieval",hasInput:!1,popover:!1})]})}function OO({initialProgress:e=.1,code:t,outputs:a=[]}){const r=Fk(),o=FE(e),i=Ae(Ny.showCode),[l,c]=n.useState(i),d=a.reduce(((e,t)=>t.logs?e+t.logs+"\n":e),"");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-2.5 flex items-center gap-2.5",children:s.jsx(mM,{progress:o,onClick:()=>c((e=>!e)),inProgressText:r("com_ui_analyzing"),finishedText:r("com_ui_analyzing_finished"),hasInput:!!t.length,isExpanded:l})}),l&&s.jsxs("div",{className:"code-analyze-block mb-3 mt-0.5 overflow-hidden rounded-xl bg-black",children:[s.jsx(EA,{content:t?`\`\`\`python\n${t}\n\`\`\``:""}),d&&s.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[s.jsx("div",{className:"mb-1 text-gray-400",children:r("com_ui_result")}),s.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:s.jsx("pre",{className:"shrink-0",children:d})})]})]})]})}function DO({initialProgress:e=.1,isSubmitting:t,isLast:a,output:r}){const o=Fk(),{searchResults:i}=ES(),l="string"==typeof r&&r.toLowerCase().includes("error processing"),c=!t&&e<1||!0===l,d=!a&&1===e,u=t&&a&&1===e,m=n.useMemo((()=>{if(d&&!u)return[];if(!i)return[];const e=Object.values(i),t=e[e.length-1];return t?u?[...t.organic||[],...t.topStories||[]]:[...t.organic||[],...t.topStories||[]].filter((e=>!0===e.processed)):[]}),[i,d,u]),p=n.useMemo((()=>i?Object.values(i).length:0),[i]),f=n.useMemo((()=>Math.min(e,.99)),[e]),h=m.length>0,g=n.useMemo((()=>{let e=p>1?"com_ui_web_searching_again":"com_ui_web_searching";return h&&(e="com_ui_web_search_processing"),u&&(e="com_ui_web_search_reading"),o(e)}),[p,o,h,u]);return d||c?null:s.jsx(s.Fragment,{children:s.jsxs("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:[h&&s.jsx("div",{className:"mr-2",children:s.jsx(kO,{sources:m,start:-5})}),s.jsx(mM,{finishedText:"",hasInput:!1,error:c,isExpanded:!1,progress:f,inProgressText:g})]})})}const FO=S.memo((({uiResources:e})=>{const[t,a]=n.useState(!1),[r,o]=n.useState(!0),[i,l]=n.useState(!1),c=S.useRef(null),d=S.useCallback((()=>{if(!c.current)return;const{scrollLeft:e,scrollWidth:t,clientWidth:n}=c.current;a(e>0),o(e<t-n-10)}),[]),u=S.useCallback((e=>{if(!c.current)return;const t=c.current.clientWidth,n=Math.floor(.9*t),s=c.current.scrollLeft,a="left"===e?s-n:s+n;c.current.scrollTo({left:a,behavior:"smooth"})}),[]);return S.useEffect((()=>{const e=c.current;if(e)return e.addEventListener("scroll",d),d(),()=>e.removeEventListener("scroll",d)}),[d]),0===e.length?null:s.jsxs("div",{className:"relative mb-4 pt-3",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[s.jsx("div",{className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-24 bg-gradient-to-r from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(t?"opacity-100":"opacity-0")}),s.jsx("div",{className:"pointer-events-none absolute right-0 top-0 z-10 h-full w-24 bg-gradient-to-l from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(r?"opacity-100":"opacity-0")}),t&&s.jsx("button",{type:"button",onClick:()=>u("left"),className:"absolute left-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll left",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("div",{ref:c,className:"hide-scrollbar flex gap-4 overflow-x-auto scroll-smooth",children:e.map(((e,t)=>s.jsx("div",{className:"flex-shrink-0 transform-gpu transition-all duration-300 ease-out animate-in fade-in-0 slide-in-from-bottom-5",style:{width:"230px",minHeight:"360px",animationDelay:100*t+"ms"},children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsx(Un,{resource:{uri:e.uri,mimeType:e.mimeType,text:e.text},onUIAction:async e=>{console.log("Action:",e)},htmlProps:{autoResizeIframe:{width:!0,height:!0}}})})},t)))}),r&&s.jsx("button",{type:"button",onClick:()=>u("right"),className:"absolute right-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll right",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}));function zO({text:e,maxHeight:t=320}){return s.jsx("div",{className:"rounded-lg bg-surface-tertiary p-2 text-xs text-text-primary",style:{position:"relative",maxHeight:t,overflow:"auto"},children:s.jsx("pre",{className:"m-0 whitespace-pre-wrap break-words",style:{overflowWrap:"break-word"},children:s.jsx("code",{children:e})})})}function UO({input:e,output:t,domain:n,function_name:a,pendingAuth:r}){var o;const i=Fk(),l=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}};let c=null!=n&&n?i("com_assistants_domain_info",{0:n}):i("com_assistants_function_use",{0:a});!0===r&&(c=null!=n&&n?i("com_assistants_action_attempt",{0:n}):i("com_assistants_attempt_info"));let d=[];if(null==t?void 0:t.includes("ui_resources"))try{const e=JSON.parse(t),n=e.find((e=>{var t;return"ui_resources"===(null==(t=e.metadata)?void 0:t.type)}));(null==(o=null==n?void 0:n.metadata)?void 0:o.data)&&(d=n.metadata.data,t=JSON.stringify(e.filter((e=>{var t;return"ui_resources"!==(null==(t=e.metadata)?void 0:t.type)}))))}catch(u){console.error("Failed to parse output:",u)}return s.jsx("div",{className:"w-full p-2",children:s.jsxs("div",{style:{opacity:1},children:[s.jsx("div",{className:"mb-2 text-sm font-medium text-text-primary",children:c}),s.jsx("div",{children:s.jsx(zO,{text:l(e),maxHeight:250})}),t&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:i("com_ui_result")}),s.jsx("div",{children:s.jsx(zO,{text:l(t),maxHeight:250})}),d.length>0&&s.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:i("com_ui_ui_resources")}),s.jsxs("div",{children:[d.length>1&&s.jsx(FO,{uiResources:d}),1===d.length&&s.jsx(Un,{resource:d[0],onUIAction:async e=>{console.log("Action:",e)},htmlProps:{autoResizeIframe:{width:!0,height:!0}}})]})]})]})})}function VO({initialProgress:e=.1,isSubmitting:t,name:a,args:r="",output:o,attachments:i,auth:l}){const c=Fk(),[d,u]=n.useState(!1),m=n.useRef(null),[p,f]=n.useState(0),[h,g]=n.useState(!1),x=n.useRef(d),{function_name:v,domain:b,isMCPToolCall:_}=n.useMemo((()=>{if("string"!=typeof a)return{function_name:"",domain:null,isMCPToolCall:!1};if(a.includes(Sh.mcp_delimiter)){const[e,t]=a.split(Sh.mcp_delimiter);return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!0}}const[e,t]=a.includes(Cu)?a.split(Cu):[a,""];return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!1}}),[a]),y="string"==typeof o&&o.toLowerCase().includes("error processing tool"),j=n.useMemo((()=>{if("string"==typeof r)return r;try{return JSON.stringify(r,null,2)}catch(Di){return s_.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to stringify args",Di),""}}),[r]),w=n.useMemo((()=>((null==j?void 0:j.length)??0)>0||((null==o?void 0:o.length)??0)>0),[j,o]),N=n.useMemo((()=>{const e=l??"";if(!e)return"";try{return new URL(e).hostname}catch(Di){return s_.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to parse auth URL",Di),""}}),[l]),C=FE(e),k=!t&&C<1||!0===y;return n.useLayoutEffect((()=>{if(d!==x.current){x.current=d,g(!0),d&&m.current?requestAnimationFrame((()=>{if(m.current){const e=m.current.scrollHeight;f(e+4)}})):f(0);const e=setTimeout((()=>{g(!1)}),400);return()=>clearTimeout(e)}}),[d]),n.useEffect((()=>{if(!m.current)return;const e=new ResizeObserver((e=>{if(d&&!h)for(const t of e)t.target===m.current&&f(t.contentRect.height+4)}));return e.observe(m.current),()=>{e.disconnect()}}),[d,h]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex h-5 shrink-0 items-center gap-2.5",children:s.jsx(mM,{progress:C,onClick:()=>u((e=>!e)),inProgressText:v?c("com_assistants_running_var",{0:v}):c("com_assistants_running_action"),authText:!k&&N.length>0?c("com_ui_requires_auth"):void 0,finishedText:k?c("com_ui_cancelled"):!0===_?c("com_assistants_completed_function",{0:v}):null!=b&&b&&b.length!==Sh.ENCODED_DOMAIN_LENGTH?c("com_assistants_completed_action",{0:b}):c("com_assistants_completed_function",{0:v}),hasInput:w,isExpanded:d,error:k})}),s.jsx("div",{className:"relative",style:{height:d?p:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:d?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx("div",{className:n_("overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-md",d&&"shadow-lg"),style:{transform:d?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:d?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx("div",{ref:m,children:d&&w&&s.jsx(UO,{input:j??"",output:o,domain:N||(b??""),function_name:v,pendingAuth:N.length>0&&!k&&C<1},"tool-call-info")})})}),null!=l&&l&&C<1&&!k&&s.jsxs("div",{className:"flex w-full flex-col gap-2.5",children:[s.jsx("div",{className:"mb-1 mt-2",children:s.jsx(ki,{className:"font-mediu inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm",variant:"default",rel:"noopener noreferrer",onClick:()=>window.open(l,"_blank","noopener,noreferrer"),children:c("com_ui_sign_in_to_domain",{0:N})})}),s.jsxs("p",{className:"flex items-center text-xs text-text-warning",children:[s.jsx($t,{className:"mr-1.5 inline-block h-4 w-4"}),c("com_assistants_allow_sites_you_trust")]})]}),i&&i.length>0&&s.jsx(NA,{attachments:i})]})}function BO({initialProgress:e=.1,args:t=""}){const a=FE(e),r=56.08695652173913,o=2*Math.PI*r,i=o-a*o,[l,c]=n.useState(!1);return s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},"data-projection-id":"106",children:[s.jsx("div",{children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[s.jsx("g",{className:"move-up",children:s.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:"M11.812616,5.914505C11.535567,5.360465,10.744857,5.360465,10.467807,5.914505C9.369731,8.110632,8.271654,10.306758,7.173676,12.502885C6.923041,13.002725,7.286122,13.590845,7.844972,13.590845C10.041112,13.590845,12.237252,13.590845,14.433392,13.590845C14.992292,13.590845,15.355792,13.002725,15.105892,12.502885C14.007888,10.306758,12.909805,8.110632,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505M7.216073,8.914505C6.939024,8.360465,6.148304,8.360465,5.871264,8.914505C5.274365,10.10828,4.677499,11.302055,4.080601,12.495835C3.83003,12.99568,4.193122,13.58379,4.751975,13.58379C5.946767,13.58379,7.14156,13.58379,8.336353,13.58379C8.895213,13.58379,9.258683,12.99568,9.008763,12.495835C8.411867,11.302055,7.81497,10.10828,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505"})}),s.jsx("g",{style:{display:"block"},transform:"matrix(-1,0,0,-1,10,10)",opacity:"1",className:"moon-rise",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,3.75,5.5)",children:s.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:" M2.660290002822876,2.2502501010894775 C2.7567598819732666,2.2502501010894775 2.850860118865967,2.241950035095215 2.9425699710845947,2.225330114364624 C3.034290075302124,2.208709955215454 3.1081299781799316,2.1867599487304688 3.164109945297241,2.1594600677490234 C3.239150047302246,2.120300054550171 3.305850028991699,2.100709915161133 3.364219903945923,2.100709915161133 C3.405900001525879,2.100709915161133 3.438659906387329,2.113770008087158 3.462480068206787,2.1398799419403076 C3.487489938735962,2.165990114212036 3.5,2.2009999752044678 3.5,2.2449100017547607 C3.5,2.2698400020599365 3.4958300590515137,2.2983200550079346 3.487489938735962,2.3303699493408203 C3.4803500175476074,2.362410068511963 3.468440055847168,2.3968300819396973 3.4517600536346436,2.433619976043701 C3.3803000450134277,2.5950300693511963 3.287990093231201,2.7410099506378174 3.1748299598693848,2.871570110321045 C3.0628700256347656,3.002120018005371 2.9348299503326416,3.1142799854278564 2.790709972381592,3.2080399990081787 C2.646589994430542,3.3029799461364746 2.4905600547790527,3.375380039215088 2.3226099014282227,3.425230026245117 C2.15585994720459,3.4750800132751465 1.9825600385665894,3.5 1.8027100563049316,3.5 C1.5430500507354736,3.5 1.3036400079727173,3.4554901123046875 1.0844800472259521,3.3664801120758057 C0.8653200268745422,3.2786500453948975 0.6741499900817871,3.1540400981903076 0.5109699964523315,2.9926199913024902 C0.34898999333381653,2.831209897994995 0.22333000600337982,2.641319990158081 0.1340000033378601,2.4229400157928467 C0.04467000067234039,2.2045600414276123 0,1.9660099744796753 0,1.7072700262069702 C0,1.4639699459075928 0.04645000025629997,1.2325400114059448 0.1393599957227707,1.012969970703125 C0.23226000368595123,0.7922199964523315 0.3626900017261505,0.5975800156593323 0.5306299924850464,0.4290440082550049 C0.6997600197792053,0.2593249976634979 0.8968899846076965,0.12877200543880463 1.121999979019165,0.03738600015640259 C1.1541600227355957,0.024329999461770058 1.1833399534225464,0.01483600027859211 1.2095500230789185,0.008901000022888184 C1.2369400262832642,0.0029670000076293945 1.2631399631500244,2.220446049250313e-16 1.288159966468811,2.220446049250313e-16 C1.335800051689148,2.220446049250313e-16 1.3733199834823608,0.014241999946534634 1.4007099866867065,0.042725998908281326 C1.4292999505996704,0.07121100276708603 1.4435900449752808,0.10681600123643875 1.4435900449752808,0.14954200387001038 C1.4435900449752808,0.1780260056257248 1.438230037689209,0.2076980024576187 1.4275100231170654,0.23855499923229218 C1.41798996925354,0.2682270109653473 1.404289960861206,0.2996779978275299 1.3864200115203857,0.3329089879989624 C1.3625999689102173,0.3768230080604553 1.3423500061035156,0.4302310049533844 1.3256800174713135,0.493133008480072 C1.309000015258789,0.5548499822616577 1.296489953994751,0.6225000023841858 1.288159966468811,0.6960800290107727 C1.2798199653625488,0.7684800028800964 1.2756500244140625,0.8414700031280518 1.2756500244140625,0.9150599837303162 C1.2756500244140625,1.1215699911117554 1.3072099685668945,1.3073099851608276 1.3703399896621704,1.4722800254821777 C1.4346599578857422,1.6372499465942383 1.5269700288772583,1.7778899669647217 1.6472699642181396,1.8941999673843384 C1.7675700187683105,2.0093300342559814 1.9128799438476562,2.097749948501587 2.083209991455078,2.1594600677490234 C2.2547199726104736,2.2199900150299072 2.44707989692688,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775"})})})]})}),s.jsx(PO,{radius:r,circumference:o,offset:i})]})}),s.jsx(mM,{progress:a,onClick:()=>c((e=>!e)),inProgressText:"Creating Image",finishedText:"Finished.",hasInput:!1})]})}const $O=n.memo((({part:e,isSubmitting:t,attachments:n,isLast:a,showCursor:r,isCreatedByUser:o})=>{var i,l;if(!e)return null;if(e.type===Ph.ERROR)return s.jsx(xO,{text:e[Ph.ERROR]??("string"==typeof e[Ph.TEXT]?e[Ph.TEXT]:null==(i=e.text)?void 0:i.value)??"",className:"my-2"});if(e.type===Ph.AGENT_UPDATE)return s.jsxs(s.Fragment,{children:[s.jsx(hM,{currentAgentId:null==(l=e[Ph.AGENT_UPDATE])?void 0:l.agentId}),a&&r&&s.jsx(xM,{children:s.jsx(oM,{})})]});if(e.type===Ph.TEXT){const t="string"==typeof e.text?e.text:e.text.value;return"string"!=typeof t?null:null==e.tool_call_ids||t?s.jsx(xM,{children:s.jsx(qA,{text:t,isCreatedByUser:o,showCursor:r})}):null}if(e.type===Ph.THINK){const t="string"==typeof e.think?e.think:e.think.value;return"string"!=typeof t?null:s.jsx(rM,{reasoning:t})}if(e.type===Ph.TOOL_CALL){const i=e[Ph.TOOL_CALL];if(!i)return null;const l="args"in i&&(!i.type||i.type===Mh.TOOL_CALL);if(l&&i.name===hu.execute_code&&i.args)return s.jsx(fM,{args:"string"==typeof i.args?i.args:"",output:i.output??"",initialProgress:i.progress??.1,attachments:n});if(l&&("image_gen_oai"===i.name||"image_edit_oai"===i.name))return s.jsx(kA,{initialProgress:i.progress??.1,isSubmitting:t,toolName:i.name,args:"string"==typeof i.args?i.args:"",output:i.output??"",attachments:n});if(l&&i.name===hu.web_search)return s.jsx(DO,{output:i.output??"",initialProgress:i.progress??.1,isSubmitting:t,attachments:n,isLast:a});if(l)return s.jsx(VO,{args:i.args??"",name:i.name||"",output:i.output??"",initialProgress:i.progress??.1,isSubmitting:t,attachments:n,auth:i.auth,expires_at:i.expires_at});if(i.type===Mh.CODE_INTERPRETER){const e=i[Mh.CODE_INTERPRETER];return s.jsx(OO,{initialProgress:i.progress??.1,code:e.input,outputs:e.outputs??[]})}if(i.type===Mh.RETRIEVAL||i.type===Mh.FILE_SEARCH)return s.jsx(LO,{initialProgress:i.progress??.1,isSubmitting:t});if(i.type===Mh.FUNCTION&&Mh.FUNCTION in i&&Lh.has(i.function.name))return s.jsx(BO,{initialProgress:i.progress??.1,args:i.function.arguments});if(i.type===Mh.FUNCTION&&Mh.FUNCTION in i)return om(i)?t&&r?s.jsx(xM,{children:s.jsx(qA,{text:"",isCreatedByUser:o,showCursor:r})}):null:s.jsx(VO,{initialProgress:i.progress??.1,isSubmitting:t,args:i.function.arguments,name:i.function.name,output:i.function.output})}else if(e.type===Ph.IMAGE_FILE){const t=e[Ph.IMAGE_FILE],n=t.height??1920,a=t.width??1080;return s.jsx(bA,{imagePath:t.filepath,height:n,width:a,altText:t.filename??"Uploaded Image",placeholderDimensions:{height:n+"px",width:a+"px"}})}return null})),HO=({message:e,attachments:t,searchResults:a})=>{const r=Ae(Ny.enableUserMsgMarkdown),{messageId:o}=e,i=n.useMemo((()=>tu(t??[])),[t]);return Array.isArray(e.content)&&e.content.length>0?s.jsxs(SS.Provider,{value:{searchResults:a},children:[s.jsx(RO,{}),e.content.filter((e=>e)).map(((t,n)=>{var a;if(!t)return null;const r=(null==(a=null==t?void 0:t[Ph.TOOL_CALL])?void 0:a.id)??"",l=i[r];return s.jsx($O,{showCursor:!1,isSubmitting:!1,isCreatedByUser:e.isCreatedByUser,attachments:l,part:t},`display-${o}-${n}`)})),!0===e.unfinished&&s.jsx(n.Suspense,{children:s.jsx(Cd,{delay:250,children:s.jsx(bO,{message:e},`unfinished-${o}`)})})]}):s.jsx("div",{className:n_("markdown prose dark:prose-invert light w-full break-words",e.isCreatedByUser&&!r&&"whitespace-pre-wrap",e.isCreatedByUser?"dark:text-gray-20":"dark:text-gray-70"),dir:"auto",children:s.jsx(EA,{content:e.text||""})})};function GO({siblingIdx:e,siblingCount:t,setSiblingIdx:n}){if(void 0===e)return null;if(void 0===t)return null;const a=n_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none");return t>1?s.jsxs("nav",{className:"visible flex items-center justify-center gap-2 self-center pt-0 text-xs","aria-label":"Sibling message navigation",children:[s.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e-1)},disabled:0==e,"aria-label":"Previous sibling message","aria-disabled":0==e,children:s.jsx(pt,{size:"19","aria-hidden":"true"})}),s.jsxs("span",{className:"flex-shrink-0 flex-grow tabular-nums","aria-live":"polite","aria-atomic":"true",role:"status",children:[e+1," / ",t]}),s.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e+1)},disabled:e==t-1,"aria-label":"Next sibling message","aria-disabled":e==t-1,children:s.jsx(Vn,{size:"19","aria-hidden":"true"})})]}):null}function KO(e){var t;let n="";for(let s=0;s<e.length;s++){n+=lu(`${(null==(t=e[s])?void 0:t.inputStr)??e[s]}`),e.length>1&&s!==e.length-1&&(n+=",\n")}return n}const WO=n.memo((({plugin:e})=>{const{isSharedConvo:t}=n.useContext(eS),{data:a={}}=Gy({enabled:!t,select:e=>{var t;return null==(t=null==e?void 0:e.gptPlugins)?void 0:t.plugins}}),r=n.useCallback((e=>e?"n/a"===e||"self reflection"===e?e:a[e]??"self reflection":null),[a]);if(!e||!e.latest)return null;const o=r(e.latest);if(!o||o&&"n/a"===o)return null;return s.jsx("div",{className:"my-2 flex flex-col items-start",children:s.jsx(to,{children:({open:t})=>{const n={className:n_(t?"rotate-180 transform":"","h-4 w-4")};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n_(e.loading?"bg-green-100":"bg-gray-20","my-1 flex items-center rounded p-3 text-xs text-gray-800"),children:[s.jsx("div",{children:s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("div",{children:e.loading||"self reflection"!==o?"self reflection"===o?"I'm  thinking...":s.jsxs(s.Fragment,{children:[e.loading?"Using":"Used"," ",s.jsx("b",{children:o}),e.loading?"...":""]}):"Finished"})})}),e.loading&&s.jsx(ac,{className:"ml-1 text-black"}),s.jsx(no,{className:"ml-12 flex items-center gap-2",children:s.jsx(Pt,{...n})})]}),s.jsxs(so,{className:"mt-3 flex max-w-full flex-col gap-3",children:[s.jsx(yM,{lang:o?`REQUEST TO ${o.toUpperCase()}`:"REQUEST",codeChildren:KO(e.inputs??[]),plugin:!0,classProp:"max-h-[450px]"}),e.outputs&&e.outputs.length>0&&s.jsx(yM,{lang:o?`RESPONSE FROM ${o.toUpperCase()}`:"RESPONSE",codeChildren:lu(e.outputs??""),plugin:!0,classProp:"max-h-[450px]"})]})]})}})})}));function qO({children:e,classes:t="",onClick:n}){return s.jsx("div",{className:n_("mt-1 flex justify-start gap-3 empty:hidden lg:flex",t),onClick:n,children:e})}function QO(e){const t=Ae(Ny.fontSize),{message:n,siblingIdx:a,siblingCount:r,conversation:o,setSiblingIdx:i,currentEditId:l,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=zE({messageId:null==n?void 0:n.messageId,attachments:null==n?void 0:n.attachments});if(!n)return null;const{text:m="",children:p,error:f=!1,messageId:h="",unfinished:g=!1,isCreatedByUser:x=!0}=n;let v="";return v=x?"anonymous":n.sender??"",s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",children:s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:s.jsx("div",{children:s.jsx("div",{className:"pt-0.5",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(bI,{message:n,conversation:o})})})})}),s.jsxs("div",{className:n_("relative flex w-11/12 flex-col",x?"":"agent-turn"),children:[s.jsx("div",{className:n_("select-none font-semibold",t),children:v}),s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsxs(mS.Provider,{value:{messageId:h,isExpanded:!1,conversationId:null==o?void 0:o.conversationId},children:[n.plugin&&s.jsx(WO,{plugin:n.plugin}),n.content?s.jsx(HO,{message:n,attachments:d,searchResults:u}):s.jsx(_O,{edit:!1,error:f,isLast:!1,ask:()=>({}),text:m||"",message:n,isSubmitting:!1,enterEdit:()=>({}),unfinished:g,siblingIdx:a??0,isCreatedByUser:x,setSiblingIdx:i??(()=>({}))})]})})}),s.jsxs(qO,{classes:"text-xs",children:[s.jsx(GO,{siblingIdx:a,siblingCount:r,setSiblingIdx:i}),s.jsx(pO,{message:n,searchResults:u})]})]})]})})}),s.jsx(YO,{messageId:h,messagesTree:p??[],currentEditId:l,setCurrentEditId:c},h)]})}function YO({messageId:e,messagesTree:t,currentEditId:a,setCurrentEditId:r}){const[o,i]=Re(Ny.messagesSiblingIdxFamily(e));if(n.useEffect((()=>{i(0)}),[null==t?void 0:t.length]),n.useEffect((()=>{null!=(null==t?void 0:t.length)&&o>=t.length&&i(0)}),[o,null==t?void 0:t.length,i]),!t||!t.length)return null;const l=t[t.length-o-1];return l?s.jsx(QO,{message:l,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:e=>{i(((null==t?void 0:t.length)??0)-e-1)}},l.messageId):null}function XO({messagesTree:e,conversationId:t}){const a=Fk(),[r,o]=n.useState(-1);return s.jsx("div",{className:"flex-1 pb-[50px]",children:s.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:s.jsx("div",{style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e&&0==e.length||null===e?s.jsx("div",{className:"flex w-full items-center justify-center gap-1 bg-gray-50 p-3 text-sm text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:a("com_ui_nothing_found")}):s.jsx(s.Fragment,{children:s.jsx("div",{children:s.jsx(YO,{messagesTree:e,messageId:t??null,setCurrentEditId:o,currentEditId:r??null},t)})}),s.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})}function ZO({className:e}){var t,a;const{data:r}=Ky(),o=Fk(),i=null==(t=null==r?void 0:r.interface)?void 0:t.privacyPolicy,l=null==(a=null==r?void 0:r.interface)?void 0:a.termsOfService,c=null!=(null==i?void 0:i.externalUrl)&&s.jsx("a",{className:"text-text-secondary underline",href:i.externalUrl,target:!0===i.openNewTab?"_blank":void 0,rel:"noreferrer",children:o("com_ui_privacy_policy")}),d=null!=(null==l?void 0:l.externalUrl)&&s.jsx("a",{className:"text-text-secondary underline",href:l.externalUrl,target:!0===l.openNewTab?"_blank":void 0,rel:"noreferrer",children:o("com_ui_terms_of_service")}),u=("string"==typeof(null==r?void 0:r.customFooter)?r.customFooter:"[LibreChat "+Sh.VERSION+"](https://librechat.ai) - "+o("com_ui_latest_footer")).split("|");n.useEffect((()=>{if(null!=(null==r?void 0:r.analyticsGtmId)&&void 0===window.google_tag_manager){const e={gtmId:r.analyticsGtmId};Ze.initialize(e)}}),[null==r?void 0:r.analyticsGtmId]);const m=[...u.map(((e,t)=>s.jsx(S.Fragment,{children:s.jsx(Yo,{components:{a:({node:e,href:t,children:n,...a})=>s.jsx("a",{className:"text-text-secondary underline",href:t,target:"_blank",rel:"noreferrer",...a,children:n}),p:({node:e,...t})=>s.jsx("span",{...t})},children:e.trim()})},`main-content-part-${t}`))),c,d].filter(Boolean);return s.jsx("div",{className:"relative w-full",children:s.jsx("div",{className:e??"absolute bottom-0 left-0 right-0 hidden items-center justify-center gap-2 px-2 py-2 text-center text-xs text-text-primary sm:flex md:px-[60px]",role:"contentinfo",children:m.map(((e,t)=>{const n=t===m.length-1;return s.jsxs(S.Fragment,{children:[e,!n&&s.jsx("div",{className:"h-2 border-r-[1px] border-border-medium"},`separator-${t}`)]},`footer-element-${t}`)}))})})}const JO=n.memo((function(){const e=Fk(),{data:t}=Ky(),{shareId:n}=nt(),{data:a,isLoading:r}=ok(n??""),o=a&&Zh({messages:a.messages}),i=0===(null==o?void 0:o.length)?null:o??null;let l,c="";return c=null!=(null==t?void 0:t.appTitle)&&null!=(null==a?void 0:a.title)?`${a.title} | ${t.appTitle}`:(null==a?void 0:a.title)??(null==t?void 0:t.appTitle)??document.title,TT(c),l=r?s.jsx("div",{className:"flex h-screen items-center justify-center",children:s.jsx(ac,{className:""})}):a&&i&&0!==i.length?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"final-completion group mx-auto flex min-w-[40rem] flex-col gap-3 pb-6 pt-4 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[s.jsx("h1",{className:"text-4xl font-bold",children:a.title}),s.jsx("div",{className:"border-b border-border-medium pb-6 text-base text-text-secondary",children:new Date(a.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),s.jsx(XO,{messagesTree:i,conversationId:a.conversationId})]}):s.jsx("div",{className:"flex h-screen items-center justify-center",children:e("com_ui_shared_link_not_found")}),s.jsx(eS.Provider,{value:{isSharedConvo:!0},children:s.jsx("main",{className:"relative flex w-full grow overflow-hidden dark:bg-surface-secondary",style:{paddingBottom:"50px"},children:s.jsx("div",{className:"transition-width relative flex h-full w-full flex-1 flex-col items-stretch overflow-hidden pt-0 dark:bg-surface-secondary",children:s.jsxs("div",{className:"flex h-full flex-col text-text-primary",role:"presentation",children:[l,s.jsx("div",{className:"w-full border-t-0 pl-0 pt-2 md:w-[calc(100%-.5rem)] md:border-t-0 md:border-transparent md:pl-0 md:pt-0 md:dark:border-transparent",children:s.jsx(ZO,{className:"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-center gap-2 bg-gradient-to-t from-surface-secondary to-transparent px-2 pb-2 pt-8 text-xs text-text-secondary md:px-[60px]"})})]})})})})}));function eD(){return s.jsx(JO,{})}const tD=()=>{const{conversation:e}=Pk(),t=Dk(),a=xS(),{data:r}=Gy(),o=n.useMemo((()=>{let t=(null==e?void 0:e.endpoint)??"";return[Uu.chatGPTBrowser,Uu.azureOpenAI,Uu.gptPlugins].includes(t)&&(t=Uu.openAI),Ab({endpointsConfig:r,iconURL:null==e?void 0:e.iconURL,endpoint:t})}),[null==e?void 0:e.endpoint,null==e?void 0:e.iconURL,r]),{data:i=new Map}=vj(o,{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),{entity:l,isAgent:c}=Lb({endpoint:o,agentsMap:t,assistantMap:a,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id}),d=n.useMemo((()=>{var e,t;return(null==(e=null==l?void 0:l.conversation_starters)?void 0:e.length)?l.conversation_starters:c?[]:(null==(t=i.get((null==l?void 0:l.id)??""))?void 0:t.conversation_starters)??[]}),[i,c,l]),{submitMessage:u}=VE(),m=n.useCallback((e=>u({text:e})),[u]);return d.length?s.jsx("div",{className:"mt-8 flex flex-wrap justify-center gap-3 px-4",children:d.slice(0,Sh.MAX_CONVO_STARTERS).map(((e,t)=>s.jsx("button",{onClick:()=>m(e),className:"relative flex w-40 cursor-pointer flex-col gap-2 rounded-2xl border border-border-medium px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] transition-colors duration-300 ease-in-out fade-in hover:bg-surface-tertiary",children:s.jsx("p",{className:"break-word line-clamp-3 overflow-hidden text-balance break-all text-text-secondary",children:e})},t)))}):null};function nD({scrollHandler:e}){return s.jsx("button",{onClick:e,className:"premium-scroll-button absolute bottom-5 right-1/2 cursor-pointer border border-border-light bg-surface-secondary","aria-label":"Scroll to bottom",children:s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-text-secondary",children:s.jsx("path",{d:"M17 13L12 18L7 13M12 6L12 17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}function sD({memoryArtifacts:e}){const t=Fk(),{updatedMemories:a,deletedMemories:r,errorMessages:o}=n.useMemo((()=>({updatedMemories:e.filter((e=>"update"===e.type)),deletedMemories:e.filter((e=>"delete"===e.type)),errorMessages:e.filter((e=>"error"===e.type)).map((e=>{try{const n=JSON.parse(e.value);return"already_exceeded"===n.errorType?t("com_ui_memory_already_exceeded",{tokens:n.tokenCount}):"would_exceed"===n.errorType?t("com_ui_memory_would_exceed",{tokens:n.tokenCount}):t("com_ui_memory_error")}catch{return t("com_ui_memory_error")}}))})),[e,t]);return 0===e.length||0===a.length&&0===r.length&&0===o.length?null:s.jsxs("div",{className:"space-y-4 p-4",children:[a.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_updated_items")}),s.jsx("div",{className:"space-y-2",children:a.map((e=>s.jsxs("div",{className:"rounded-lg p-3",children:[s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),s.jsx("div",{className:"whitespace-pre-wrap text-sm text-text-primary",children:e.value})]},`update-${e.key}`)))})]}),r.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_deleted_items")}),s.jsx("div",{className:"space-y-2",children:r.map((e=>s.jsxs("div",{className:"rounded-lg p-3 opacity-60",children:[s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),s.jsx("div",{className:"text-sm italic text-text-secondary",children:t("com_ui_memory_deleted")})]},`delete-${e.key}`)))})]}),o.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-red-500",children:t("com_ui_memory_storage_full")}),s.jsx("div",{className:"space-y-2",children:o.map((e=>s.jsx("div",{className:"rounded-md bg-red-50 p-3 text-sm text-red-800 dark:bg-red-900/20 dark:text-red-400",children:e},e)))})]})]})}function aD({attachments:e}){const t=Fk(),[a,r]=n.useState(!1),o=n.useRef(null),[i,l]=n.useState(0),[c,d]=n.useState(!1),u=n.useRef(a),{hasErrors:m,memoryArtifacts:p}=n.useMemo((()=>{let t=!1;const n=[];if(!e||0===e.length)return{hasErrors:t,memoryArtifacts:n};for(const s of e)null!=(null==s?void 0:s[hu.memory])&&(n.push(s[hu.memory]),t||"error"!==s[hu.memory].type||(t=!0));return{hasErrors:t,memoryArtifacts:n}}),[e]);return n.useLayoutEffect((()=>{if(a!==u.current){u.current=a,d(!0),a&&o.current?requestAnimationFrame((()=>{if(o.current){const e=o.current.scrollHeight;l(e+4)}})):l(0);const e=setTimeout((()=>{d(!1)}),400);return()=>clearTimeout(e)}}),[a]),n.useEffect((()=>{if(!o.current)return;const e=new ResizeObserver((e=>{if(a&&!c)for(const t of e)t.target===o.current&&l(t.contentRect.height+4)}));return e.observe(o.current),()=>{e.disconnect()}}),[a,c]),p&&0!==p.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"inline-block",children:s.jsxs("button",{className:n_("outline-hidden my-1 flex items-center gap-1 text-sm font-semibold transition-colors",m?"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500":"text-text-secondary-alt hover:text-text-primary"),type:"button",onClick:()=>r((e=>!e)),"aria-expanded":a,"aria-label":t("com_ui_memory_updated"),children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mb-[-1px]",children:[s.jsx("path",{d:"M6 3C4.89543 3 4 3.89543 4 5V13C4 14.1046 4.89543 15 6 15L6 3Z",fill:"currentColor"}),s.jsx("path",{d:"M7 3V15H8.18037L8.4899 13.4523C8.54798 13.1619 8.69071 12.8952 8.90012 12.6858L12.2931 9.29289C12.7644 8.82153 13.3822 8.58583 14 8.58578V3.5C14 3.22386 13.7761 3 13.5 3H7Z",fill:"currentColor"}),s.jsx("path",{d:"M11.3512 15.5297L9.73505 15.8529C9.38519 15.9229 9.07673 15.6144 9.14671 15.2646L9.46993 13.6484C9.48929 13.5517 9.53687 13.4628 9.60667 13.393L12.9996 10C13.5519 9.44771 14.4473 9.44771 14.9996 10C15.5519 10.5523 15.5519 11.4477 14.9996 12L11.6067 15.393C11.5369 15.4628 11.448 15.5103 11.3512 15.5297Z",fill:"currentColor"})]}),t(m?"com_ui_memory_error":"com_ui_memory_updated")]})})}),s.jsx("div",{className:"relative",style:{height:a?i:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:a?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx("div",{className:n_("overflow-hidden rounded-xl border border-border-light bg-surface-primary-alt shadow-md",a&&"shadow-lg"),style:{transform:a?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:a?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx("div",{ref:o,children:a&&s.jsx(sD,{memoryArtifacts:p},"memory-info")})})})]}):null}const rD=n.memo((({content:e,messageId:t,conversationId:a,attachments:r,searchResults:o,isCreatedByUser:i,isLast:l,isSubmitting:c,edit:d,enterEdit:u,siblingIdx:m,setSiblingIdx:p})=>{const f=Fk(),[h,g]=Re(Ny.showThinking),[x,v]=n.useState(h),b=n.useMemo((()=>tu(r??[])),[r]),_=n.useMemo((()=>{const t=(null==e?void 0:e.some((e=>(null==e?void 0:e.type)===Ph.THINK)))??!1,n=(null==e?void 0:e.every((e=>{if((null==e?void 0:e.type)!==Ph.THINK)return!0;if("string"==typeof e.think){return e.think.replace(/<\/?think>/g,"").trim().length>0}return!1})))??!1;return t&&n}),[e]);return e?!0===d&&u&&p?s.jsx(s.Fragment,{children:e.map(((e,n)=>{if(!e)return null;const a=(null==e?void 0:e.type)===Ph.TEXT||"string"!=typeof(null==e?void 0:e.text),r=(null==e?void 0:e.type)===Ph.THINK||"string"!=typeof(null==e?void 0:e.think);if(!a&&!r)return null;return e.type===Ph.TOOL_CALL||null!=e.tool_call_ids?null:s.jsx(vM,{index:n,part:e,messageId:t,isSubmitting:c,enterEdit:u,siblingIdx:m??null,setSiblingIdx:p},`edit-${t}-${n}`)}))}):s.jsx(s.Fragment,{children:s.jsxs(SS.Provider,{value:{searchResults:o},children:[s.jsx(aD,{attachments:r}),s.jsx(RO,{messageId:t,conversationId:a||void 0}),_&&s.jsx("div",{className:"mb-5",children:s.jsx(nM,{isExpanded:x,onClick:()=>v((e=>{const t=!e;return g(t),t})),label:f(c&&l?"com_ui_thinking":"com_ui_thoughts")})}),e.filter((e=>e)).map(((n,r)=>{var o,d;const u=(null==(o=null==n?void 0:n[Ph.TOOL_CALL])?void 0:o.id)??"",m=b[u];return s.jsx(mS.Provider,{value:{messageId:t,isExpanded:x,conversationId:a,partIndex:r,nextType:null==(d=e[r+1])?void 0:d.type},children:s.jsx($O,{part:n,attachments:m,isSubmitting:c,isCreatedByUser:i,isLast:r===e.length-1,showCursor:r===e.length-1&&l},`part-${t}-${r}`)},`provider-${t}-${r}`)}))]})}):null})),oD=n.memo((({isCard:e})=>e?s.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):null)),iD={[Th.DIRECT_PATH]:"com_ui_fork_visible",[Th.INCLUDE_BRANCHES]:"com_ui_fork_branches",[Th.TARGET_LEVEL]:"com_ui_fork_all_target",[Th.DEFAULT]:"com_ui_fork_from_message"},lD=s.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"})}),cD=({children:e,setting:t,onClick:n,setActiveSetting:a,timeoutRef:r,hoverInfo:o,hoverTitle:i,hoverDescription:l,label:c})=>{const d=Fk();return s.jsx(Ot,{placement:"right-start",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(Dt,{render:s.jsxs(Ft,{onClick:()=>n(t),onMouseEnter:()=>{r.current&&(clearTimeout(r.current),r.current=null),a(iD[t])},onMouseLeave:()=>{r.current&&clearTimeout(r.current),r.current=setTimeout((()=>{a(iD[Th.DEFAULT])}),175)},className:"mx-0.5 w-14 flex-1 rounded-xl border-2 border-border-medium bg-surface-secondary text-text-secondary transition duration-200 ease-in-out hover:bg-surface-hover hover:text-text-primary","aria-label":c,children:[e,s.jsx(zt,{children:c})]})}),s.jsxs(Ut,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(zt,{children:d("com_ui_fork_more_details_about",{0:c})}),lD]}),(null!=o&&""!==o||null!=i&&""!==i||null!=l&&""!==l)&&s.jsx(Vt,{gutter:16,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsx("div",{className:"space-y-2",children:s.jsxs("p",{className:"flex flex-col gap-2 text-sm text-text-secondary",children:[o&&o,i&&s.jsx("span",{className:"flex flex-wrap gap-1 font-bold",children:i}),l&&l]})})})]})})},dD=({id:e,checked:t,onToggle:n,labelKey:a,infoKey:r,showToastOnCheck:o=!1})=>{const i=Fk(),{showToast:l}=Bd();return s.jsxs(Ot,{placement:"right-start",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex h-6 w-full select-none items-center justify-start rounded-md text-sm text-text-secondary hover:text-text-primary",children:s.jsx(Dt,{render:s.jsxs("div",{children:[s.jsx(I,{id:e,checked:t,onChange:e=>{const t=e.target.checked;t&&o&&l({message:i("com_ui_fork_remember_checked"),status:"info"}),n(t)},className:"h-4 w-4 rounded-sm border border-primary ring-offset-background transition duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground","aria-label":i(a)}),s.jsx("label",{htmlFor:e,className:"ml-2 cursor-pointer",children:i(a)})]})})}),s.jsxs(Ut,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(zt,{children:i(r)}),lD]})]}),s.jsx(Vt,{gutter:14,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:i(r)})})})]})};function uD({messageId:e,conversationId:t,forkingSupported:a=!1,latestMessageId:r,isLast:o=!1}){const i=Fk(),{showToast:l}=Bd(),[c,d]=n.useState(!1),{navigateToConvo:u}=iE(),[m,p]=n.useState(!1),f=n.useRef(null),[h,g]=Re(Ny.forkSetting),[x,v]=n.useState(iD.default),[b,_]=Re(Ny.splitAtTarget),[y,j]=Re(Ny.rememberDefaultFork),w=Bn({placement:"bottom"}),N=n_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!o&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",m&&"active text-text-primary bg-surface-hover"),C=(e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((e=>Rx.forkConversation(e)),{onSuccess:(e,s,a)=>{if(!s.conversationId)return;const r=e.conversation,o=r.conversationId;o&&(t.setQueryData([xx.conversation,o],r),ib(t,r),t.setQueryData([xx.messages,o],e.messages),t.invalidateQueries({queryKey:[xx.allConversations],refetchPage:(e,t)=>0===t}),null==n||n(e,s,a))},...s})})({onSuccess:e=>{u(e.conversation),l({message:i("com_ui_fork_success"),status:"success"})},onMutate:()=>{l({message:i("com_ui_fork_processing"),status:"info"})},onError:e=>{var t;const n=429===(null==(t=null==e?void 0:e.response)?void 0:t.status)||429===(null==e?void 0:e.status)||429===(null==e?void 0:e.statusCode);l({message:i(n?"com_ui_fork_error_rate_limit":"com_ui_fork_error"),status:"error"})}}),k=t??"";if(!a||!k||!e)return null;const S=t=>{c&&(j(!0),g(t)),C.mutate({messageId:e,conversationId:k,option:t,splitAtTarget:b,latestMessageId:r})},E=[{setting:Th.DIRECT_PATH,label:i(iD[Th.DIRECT_PATH]),icon:s.jsx($n,{className:"h-full w-full rotate-90 p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx($n,{className:"h-5 w-5 rotate-90"}),i(iD[Th.DIRECT_PATH])]}),hoverDescription:i("com_ui_fork_info_visible")},{setting:Th.INCLUDE_BRANCHES,label:i(iD[Th.INCLUDE_BRANCHES]),icon:s.jsx(Hn,{className:"h-full w-full rotate-180 p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx(Hn,{className:"h-4 w-4 rotate-180"}),i(iD[Th.INCLUDE_BRANCHES])]}),hoverDescription:i("com_ui_fork_info_branches")},{setting:Th.TARGET_LEVEL,label:i(iD[Th.TARGET_LEVEL]),icon:s.jsx(Gn,{className:"h-full w-full p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx(Gn,{className:"h-5 w-5"}),`${i(iD[Th.TARGET_LEVEL])} (${i("com_endpoint_default")})`]}),hoverDescription:i("com_ui_fork_info_target")}];return s.jsxs(s.Fragment,{children:[s.jsx(Kn,{store:w,render:s.jsx("button",{className:N,onClick:t=>{y?(t.preventDefault(),C.mutate({messageId:e,splitAtTarget:b,conversationId:k,option:h,latestMessageId:r})):(w.toggle(),p(w.getState().open))},type:"button","aria-label":i("com_ui_fork"),children:s.jsx(Wn,{size:"19"})})}),s.jsxs(qn,{store:w,gutter:10,className:`popover-animate ${m?"open":""} flex w-60 flex-col gap-3 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-2 px-4 shadow-lg`,style:{outline:"none",pointerEvents:"auto",zIndex:50},portal:!0,unmountOnHide:!0,onClose:()=>p(!1),children:[s.jsxs("div",{className:"flex h-8 w-full items-center justify-center text-sm text-text-primary",children:[i(x),s.jsxs(Ot,{placement:"right-start",children:[s.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center gap-1",children:[s.jsx(Dt,{render:s.jsx("button",{className:"flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary","aria-label":i("com_ui_fork_info_button_label"),children:s.jsx(pn,{})})}),s.jsxs(Ut,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(zt,{children:i("com_ui_fork_more_info_options")}),lD]})]}),s.jsx(Vt,{gutter:19,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsxs("div",{className:"flex flex-col gap-2 space-y-2 text-sm text-text-secondary",children:[s.jsx("span",{children:i("com_ui_fork_info_1")}),s.jsx("span",{children:i("com_ui_fork_info_2")}),s.jsx("span",{children:i("com_ui_fork_info_3",{0:i("com_ui_fork_split_target")})})]})})]})]}),s.jsx("div",{className:"flex h-full w-full items-center justify-center gap-1",children:E.map((e=>s.jsx(cD,{setActiveSetting:v,timeoutRef:f,onClick:S,setting:e.setting,label:e.label,hoverTitle:e.hoverTitle,hoverDescription:e.hoverDescription,children:e.icon},e.setting)))}),s.jsx(dD,{id:"split-target-checkbox",checked:b,onToggle:_,labelKey:"com_ui_fork_split_target",infoKey:"com_ui_fork_info_start"}),s.jsx(dD,{id:"remember-checkbox",checked:c,onToggle:e=>{e&&l({message:i("com_ui_fork_remember_checked"),status:"info"}),d(e)},labelKey:"com_ui_fork_remember",infoKey:"com_ui_fork_info_remember",showToastOnCheck:!0})]})]})}function mD({setShowDeleteDialog:e,conversationId:t,setMenuOpen:a,retainView:r,title:o}){const i=Fk(),l=Fe(),c=pr(),{showToast:d}=Bd(),{newConversation:u}=JS(),{conversationId:m}=nt(),p=kj({onSuccess:()=>{e(!1),m!==t&&"new"!==m||(u(),l("/c/new",{replace:!0})),null==a||a(!1),r()},onError:()=>{d({message:i("com_ui_convo_delete_error"),severity:eu.ERROR,showIcon:!0})}}),f=n.useCallback((()=>{var e,n;const s=c.getQueryData([xx.messages,t]),a=null==(e=null==s?void 0:s[s.length-1])?void 0:e.thread_id,r=null==(n=null==s?void 0:s[s.length-1])?void 0:n.endpoint;p.mutate({conversationId:t,thread_id:a,endpoint:r,source:"button"})}),[t,p,c]);return s.jsxs(gl,{title:i("com_ui_delete_confirm")+" "+o,className:"w-11/12 max-w-md",showCloseButton:!1,children:[s.jsx(xl,{children:s.jsx(bl,{children:i("com_ui_delete_conversation")})}),s.jsxs("div",{children:[i("com_ui_delete_confirm")," ",s.jsx("strong",{children:o})," ?"]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[s.jsx(ki,{"aria-label":"cancel",variant:"outline",onClick:()=>e(!1),children:i("com_ui_cancel")}),s.jsx(ki,{variant:"destructive",onClick:f,disabled:p.isLoading,children:p.isLoading?s.jsx(ac,{}):i("com_ui_delete")})]})]})}function pD({conversationId:e,retainView:t,title:n,setMenuOpen:a,showDeleteDialog:r,setShowDeleteDialog:o,triggerRef:i}){return void 0===r||void 0===o?null:e?s.jsx(ul,{open:r,onOpenChange:o,triggerRef:i,children:s.jsx(mD,{setShowDeleteDialog:o,conversationId:e,setMenuOpen:a,retainView:t,title:n})}):null}function fD({share:e,conversationId:t,setShareDialogOpen:a,showQR:r,setShowQR:o,setSharedLink:i}){const l=Fk(),{showToast:c}=Bd(),[d,u]=n.useState(!1),m=(null==e?void 0:e.shareId)??"",{mutateAsync:p,isLoading:f}=yj({onError:()=>{c({message:l("com_ui_share_error"),severity:eu.ERROR,showIcon:!0})}}),{mutateAsync:h,isLoading:g}=jj({onError:()=>{c({message:l("com_ui_share_error"),severity:eu.ERROR,showIcon:!0})}}),x=wj({onSuccess:async()=>{u(!1),a(!1)}}),v=n.useCallback((e=>`${window.location.protocol}//${window.location.host}/share/${e}`),[]);return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex gap-2",children:[!m&&s.jsxs(ki,{disabled:f,variant:"submit",onClick:async()=>{const e=await p({conversationId:t}),n=v(e.shareId);i(n)},children:[!f&&l("com_ui_create_link"),f&&s.jsx(ac,{className:"size-4"})]}),m&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ol,{description:l("com_ui_refresh_link"),render:e=>s.jsx(ki,{...e,onClick:()=>(async()=>{if(!m)return;const e=await h({shareId:m}),t=v(e.shareId);i(t)})(),variant:"outline",disabled:g,children:g?s.jsx(ac,{className:"size-4"}):s.jsx(Qn,{className:"size-4"})})}),s.jsx(Ol,{description:l(r?"com_ui_hide_qr":"com_ui_show_qr"),render:e=>s.jsx(ki,{...e,onClick:()=>o(!r),variant:"outline",children:s.jsx(Yn,{className:"size-4"})})}),s.jsx(Ol,{description:l("com_ui_delete"),render:e=>s.jsx(ki,{...e,onClick:()=>u(!0),variant:"destructive",children:s.jsx(An,{className:"size-4"})})})]}),s.jsx(ul,{open:d,onOpenChange:u,children:s.jsx(zd,{showCloseButton:!1,title:l("com_ui_delete_shared_link"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(dl,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[l("com_ui_delete_confirm")," ",s.jsxs("strong",{children:['"',m,'"']})]})})})}),selection:{selectHandler:async()=>{if(m)try{await x.mutateAsync({shareId:m}),c({message:l("com_ui_shared_link_delete_success"),severity:eu.SUCCESS})}catch(e){console.error("Failed to delete shared link:",e),c({message:l("com_ui_share_delete_error"),severity:eu.ERROR})}},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:l("com_ui_delete")}})})]})})}function hD({conversationId:e,open:t,onOpenChange:a,triggerRef:r,children:o}){const i=Fk(),[l,c]=n.useState(!1),[d,u]=n.useState(""),[m,p]=n.useState(!1),{data:f,isLoading:h}=ik(e),g=qE({text:d});n.useEffect((()=>{if(void 0!==(null==f?void 0:f.shareId)){const e=`${window.location.protocol}//${window.location.host}/share/${f.shareId}`;u(e)}}),[f]);const x=!0===h?null:s.jsx(fD,{share:f,conversationId:e,setShareDialogOpen:a,showQR:l,setShowQR:c,setSharedLink:u}),v=(null==f?void 0:f.shareId)??"";return s.jsxs(ul,{open:t,onOpenChange:a,triggerRef:r,children:[o,s.jsx(zd,{buttons:x,showCloseButton:!0,showCancelButton:!1,title:i("com_ui_share_link_to_chat"),className:"max-w-[550px]",main:s.jsxs("div",{children:[s.jsx("div",{className:"h-full py-2 text-text-primary",children:!0===h?s.jsx(ac,{className:"m-auto h-14 animate-spin"}):!0===(null==f?void 0:f.success)?i("com_ui_share_update_message"):i("com_ui_share_create_message")}),s.jsxs("div",{className:"relative items-center rounded-lg p-2",children:[l&&s.jsx("div",{className:"mb-4 flex flex-col items-center",children:s.jsx(Wo,{value:d,size:200,marginSize:2,className:"rounded-2xl"})}),v&&s.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-surface-secondary p-2",children:[s.jsx("div",{className:"flex-1 break-all text-sm text-text-secondary",children:d}),s.jsx(ki,{size:"sm",variant:"outline",onClick:()=>{m||g(p)},className:n_("shrink-0",m?"cursor-default":""),children:m?s.jsx(ft,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})]})]})]})})]})}const gD=n.memo((function({conversationId:e,title:t,retainView:a,renameHandler:r,isPopoverActive:o,setIsPopoverActive:i,isActiveConvo:l}){const c=Fk(),{index:d}=Pk(),{data:u}=Ky(),{navigateToConvo:m}=iE(d),{showToast:p}=Bd(),f=Fe(),{conversationId:h}=nt(),{newConversation:g}=JS(),x=n.useRef(null),v=n.useRef(null),[b,_]=n.useState(!1),[y,j]=n.useState(!1),w=_j(),N=(e=>{const t=pr(),{onSuccess:n,...s}=e??{};return fr((e=>Rx.duplicateConversation(e)),{onSuccess:(e,s,a)=>{const r=e.conversation;(null==r?void 0:r.conversationId)&&(t.setQueryData([xx.conversation,r.conversationId],r),ib(t,r),t.setQueryData([xx.messages,r.conversationId],e.messages),t.invalidateQueries({queryKey:[xx.allConversations],refetchPage:(e,t)=>0===t}),null==n||n(e,s,a))},...s})})({onSuccess:e=>{m(e.conversation),p({message:c("com_ui_duplication_success"),status:"success"}),i(!1)},onMutate:()=>{p({message:c("com_ui_duplication_processing"),status:"info"})},onError:()=>{p({message:c("com_ui_duplication_error"),status:"error"})}}),C=N.isLoading,k=w.isLoading,S=n.useCallback((()=>{_(!0)}),[]),E=n.useCallback((()=>{j(!0)}),[]),T=n.useCallback((async()=>{const t=e??"";t&&w.mutate({conversationId:t,isArchived:!0},{onSuccess:()=>{h!==t&&"new"!==h||(g(),f("/c/new",{replace:!0})),a(),i(!1)},onError:()=>{p({message:c("com_ui_archive_error"),severity:eu.ERROR,showIcon:!0})}})}),[e,h,w,f,g,a,i,p,c]),I=n.useCallback((()=>{N.mutate({conversationId:e??""})}),[e,N]),R=n.useMemo((()=>[{label:c("com_ui_share"),onClick:S,icon:s.jsx(Qt,{className:"icon-sm mr-2 text-text-primary"}),show:u&&u.sharedLinksEnabled,hideOnClick:!1,ref:x,render:e=>s.jsx("button",{...e})},{label:c("com_ui_rename"),onClick:r,icon:s.jsx(sn,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_duplicate"),onClick:I,hideOnClick:!1,icon:C?s.jsx(ac,{className:"size-4"}):s.jsx(ht,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_archive"),onClick:T,hideOnClick:!1,icon:k?s.jsx(ac,{className:"size-4"}):s.jsx(Xn,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_delete"),onClick:E,icon:s.jsx(Zn,{className:"icon-sm mr-2 text-text-primary"}),hideOnClick:!1,ref:v,render:e=>s.jsx("button",{...e})}]),[c,S,u,r,I,C,T,k,E]),P=n.useId();return s.jsxs(s.Fragment,{children:[s.jsx(wd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:o,setIsOpen:i,trigger:s.jsx(ie,{id:`conversation-menu-${e}`,"aria-label":c("com_nav_convo_menu_options"),className:n_("inline-flex h-7 w-7 items-center justify-center gap-2 rounded-md border-none p-0 text-sm font-medium ring-ring-primary transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50",!0===l||o?"opacity-100":"opacity-0 focus:opacity-100 group-focus-within:opacity-100 group-hover:opacity-100 data-[open]:opacity-100"),onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},children:s.jsx(Jn,{className:"icon-md text-text-secondary","aria-hidden":!0})}),items:R,menuId:P,className:"z-30"}),b&&s.jsx(hD,{conversationId:e??"",open:b,onOpenChange:_,triggerRef:x}),y&&s.jsx(pD,{title:t??"",retainView:a,triggerRef:v,setMenuOpen:i,showDeleteDialog:y,conversationId:e??"",setShowDeleteDialog:j})]})}),((e,t)=>e.conversationId===t.conversationId&&e.title===t.title&&e.isPopoverActive===t.isPopoverActive&&e.isActiveConvo===t.isActiveConvo)),xD=({titleInput:e,setTitleInput:t,onSubmit:a,onCancel:r,localize:o})=>{const i=n.useRef(null);n.useEffect((()=>{i.current&&(i.current.focus(),i.current.select())}),[]);return s.jsxs("div",{className:"absolute inset-0 z-20 flex w-full items-center rounded-lg bg-surface-active-alt p-1.5",role:"form","aria-label":o("com_ui_rename_conversation"),children:[s.jsx("input",{ref:i,type:"text",className:"w-full rounded bg-transparent p-0.5 text-sm leading-tight focus-visible:outline-none",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{switch(t.key){case"Escape":r();break;case"Enter":a(e)}},onBlur:()=>a(e),maxLength:100,"aria-label":o("com_ui_new_conversation_title")}),s.jsxs("div",{className:"flex gap-1",role:"toolbar",children:[s.jsx("button",{onClick:()=>r(),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":o("com_ui_cancel"),children:s.jsx(vt,{className:"h-4 w-4","aria-hidden":"true"})}),s.jsx("button",{onClick:()=>a(e),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":o("com_ui_save"),children:s.jsx(es,{className:"h-4 w-4","aria-hidden":"true"})})]})]})},vD=({isActiveConvo:e,title:t,onRename:n,isSmallScreen:a,localize:r,children:o})=>s.jsxs("div",{className:n_("flex grow items-center gap-2 overflow-hidden rounded-lg px-2",e?"bg-surface-active-alt":""),title:t??void 0,"aria-current":e?"page":void 0,style:{width:"100%"},children:[o,s.jsx("div",{className:"relative flex-1 grow overflow-hidden whitespace-nowrap",style:{textOverflow:"clip"},onDoubleClick:e=>{a||(e.preventDefault(),e.stopPropagation(),n())},role:"button","aria-label":a?void 0:t||r("com_ui_untitled"),children:t||r("com_ui_untitled")}),s.jsx("div",{className:n_("absolute bottom-0 right-0 top-0 w-20 rounded-r-lg bg-gradient-to-l",e?"from-surface-active-alt":"from-surface-primary-alt from-0% to-transparent group-hover:from-surface-active-alt group-hover:from-40%"),"aria-hidden":"true"})]});function bD({conversation:e,retainView:t,toggleNav:a,isLatestConvo:r}){const o=nt(),i=Fk(),{showToast:l}=Bd(),{navigateToConvo:c}=iE(),{data:d}=Gy(),u=n.useMemo((()=>o.conversationId),[o.conversationId]),m=(e=>{const t=pr();return fr((e=>Rx.updateConversation(e)),{onSuccess:(n,s)=>{const a=s.conversationId||e;t.setQueryData([xx.conversation,a],n),lb(t,a,(()=>n))}})})(u??""),p=Ae(Ny.allConversationsSelector),f=Ki("(max-width: 768px)"),{conversationId:h,title:g=""}=e,[x,v]=n.useState(g||""),[b,_]=n.useState(!1),[y,j]=n.useState(!1),w=n.useRef(g);n.useEffect((()=>{g!==w.current&&(v(g),w.current=g)}),[g]);const N=n.useMemo((()=>{if(h===Sh.NEW_CONVO)return u===Sh.NEW_CONVO;if(u!==Sh.NEW_CONVO)return u===h;return(null==p?void 0:p[0])===h}),[u,h,p]),C=()=>{j(!1),v(g),_(!0)},k=t=>{if(t){a();const e=window.location.origin,t=`/c/${h}`;window.open(e+t,"_blank")}else u===h||y||(a(),"string"==typeof g&&g.length>0&&(document.title=g),c(e,{currentConvoId:u,resetLatestMessage:!h||h===Sh.NEW_CONVO}))},S={title:g,retainView:t,renameHandler:C,isActiveConvo:N,conversationId:h,isPopoverActive:y,setIsPopoverActive:j};return s.jsxs("div",{className:n_("group relative flex h-12 w-full items-center rounded-lg transition-colors duration-200 md:h-9",N?"bg-surface-active-alt":"hover:bg-surface-active-alt"),role:"listitem",tabIndex:0,onClick:e=>{b||0===e.button&&k(e.ctrlKey||e.metaKey)},onKeyDown:e=>{b||"Enter"===e.key&&k(!1)},style:{cursor:b?"default":"pointer"},"data-testid":"convo-item",children:[b?s.jsx(xD,{titleInput:x,setTitleInput:v,onSubmit:async e=>{if(h&&e!==g)try{await m.mutateAsync({conversationId:h,title:e.trim()||i("com_ui_untitled")}),_(!1)}catch(t){v(g),l({message:i("com_ui_rename_failed"),severity:eu.ERROR,showIcon:!0}),_(!1)}else _(!1)},onCancel:()=>{v(g),_(!1)},localize:i}):s.jsx(vD,{isActiveConvo:N,title:g,onRename:C,isSmallScreen:f,localize:i,children:s.jsx(GI,{conversation:e,endpointsConfig:d,size:20,context:"menu-item"})}),s.jsx("div",{className:n_("mr-2 flex origin-left",y||N?"pointer-events-auto max-w-[28px] scale-x-100 opacity-100":"pointer-events-none max-w-0 scale-x-0 opacity-0 group-focus-within:pointer-events-auto group-focus-within:max-w-[28px] group-focus-within:scale-x-100 group-focus-within:opacity-100 group-hover:pointer-events-auto group-hover:max-w-[28px] group-hover:scale-x-100 group-hover:opacity-100"),"aria-hidden":!(y||N),children:!b&&s.jsx(gD,{...S})})]})}const _D=n.memo((()=>{const e=Fk();return s.jsxs("div",{className:"mx-auto mt-2 flex items-center justify-center gap-2",children:[s.jsx(ac,{className:"text-text-primary"}),s.jsx("span",{className:"animate-pulse text-text-primary",children:e("com_ui_loading")})]})})),yD=n.memo((({groupName:e})=>{const t=Fk();return s.jsx("div",{className:"mt-2 pl-2 pt-1 text-text-secondary",style:{fontSize:"0.7rem"},children:t(e)||e})}));yD.displayName="DateLabel";const jD=n.memo((({conversation:e,retainView:t,toggleNav:n,isLatestConvo:a})=>s.jsx(bD,{conversation:e,retainView:t,toggleNav:n,isLatestConvo:a})),((e,t)=>e.conversation.conversationId===t.conversation.conversationId&&e.conversation.title===t.conversation.title&&e.isLatestConvo===t.isLatestConvo&&e.conversation.endpoint===t.conversation.endpoint)),wD=n.memo((({conversations:e,moveToTop:t,toggleNav:a,containerRef:r,loadMoreConversations:o,isLoading:i,isSearchLoading:l})=>{const c=Ki("(max-width: 768px)")?44:34,d=n.useMemo((()=>e.filter(Boolean)),[e]),u=n.useMemo((()=>rb(d)),[d]),m=n.useMemo((()=>{var e;return(null==(e=d.find((e=>e.updatedAt&&Ro(Io(e.updatedAt)))))?void 0:e.conversationId)??void 0}),[d]),p=n.useMemo((()=>{const e=[];return u.forEach((([t,n])=>{e.push({type:"header",groupName:t}),e.push(...n.map((e=>({type:"convo",convo:e}))))})),i&&e.push({type:"loading"}),e}),[u,i]),f=n.useMemo((()=>new Vr({fixedWidth:!0,defaultHeight:c,keyMapper:e=>{const t=p[e];return"header"===t.type?`header-${e}`:"convo"===t.type?`convo-${t.convo.conversationId}`:"loading"===t.type?`loading-${e}`:`unknown-${e}`}})),[p,c]),h=n.useCallback((({index:e,key:n,parent:r,style:o})=>{const i=p[e];return"loading"===i.type?s.jsx(Br,{cache:f,columnIndex:0,parent:r,rowIndex:e,children:({registerChild:e})=>s.jsx("div",{ref:e,style:o,children:s.jsx(_D,{})})},n):s.jsx(Br,{cache:f,columnIndex:0,parent:r,rowIndex:e,children:({registerChild:e})=>s.jsx("div",{ref:e,style:o,children:"header"===i.type?s.jsx(yD,{groupName:i.groupName}):"convo"===i.type?s.jsx(jD,{conversation:i.convo,retainView:t,toggleNav:a,isLatestConvo:i.convo.conversationId===m}):null})},n)}),[f,p,m,t,a]),g=n.useCallback((({index:e})=>f.getHeight(e,0)),[f]),x=n.useMemo((()=>Eo(o,300)),[o]),v=n.useCallback((({stopIndex:e})=>{e>=p.length-8&&x()}),[p.length,x]);return s.jsx("div",{className:"relative flex h-full flex-col pb-2 text-sm text-text-primary",children:l?s.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[s.jsx(ac,{className:"text-text-primary"}),s.jsx("span",{className:"ml-2 text-text-primary",children:"Loading..."})]}):s.jsx("div",{className:"flex-1",children:s.jsx($r,{children:({width:e,height:t})=>s.jsx(Hr,{ref:r,width:e,height:t,deferredMeasurementCache:f,rowCount:p.length,rowHeight:g,rowRenderer:h,overscanRowCount:10,className:"outline-none",style:{outline:"none"},role:"list","aria-label":"Conversations",onRowsRendered:v,tabIndex:-1})})})})}));function ND({isLast:e,index:t,messageId:a,content:r,className:o,renderButton:i}){var l,c;const d=Fk(),u=Ae(Ny.playbackRate),{toggleSpeech:m,isSpeaking:p,audioRef:f}=$j({isLast:e,index:t,content:r}),h=()=>!0===p?s.jsx(Oc,{className:"icon-md-heavy h-[18px] w-[18px]"}):s.jsx(Lc,{className:"icon-md-heavy h-[18px] w-[18px]"});n.useEffect((()=>{const e=document.getElementById(`audio-${a}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)}),[f,p,u,a]),s_.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(l=f.current)?void 0:l.src,f.current);const g=()=>{f.current&&(f.current.muted=!1),m()},x=d(!0===p?"com_ui_stop":"com_ui_read_aloud");return s.jsxs(s.Fragment,{children:[i?i({onClick:g,title:x,icon:h(),isActive:p,className:o}):s.jsx("button",{className:o,onClickCapture:g,type:"button",title:x,children:h()}),s.jsx("audio",{ref:f,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=f.current)?void 0:c.src,onError:e=>{s_.error("Error fetching audio:",e)},id:`audio-${a}`,autoPlay:!0})]})}function CD({isLast:e,index:t,messageId:a,content:r,className:o,renderButton:i}){var l,c;const d=Fk(),u=Ae(Ny.playbackRate),{toggleSpeech:m,isSpeaking:p,isLoading:f,audioRef:h}=Bj({isLast:e,index:t,messageId:a,content:r}),g=()=>!0===f?s.jsx(ac,{className:"icon-md-heavy h-[18px] w-[18px]"}):!0===p?s.jsx(Oc,{className:"icon-md-heavy h-[18px] w-[18px]"}):s.jsx(Lc,{className:"icon-md-heavy h-[18px] w-[18px]"});return n.useEffect((()=>{const e=document.getElementById(`audio-${a}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)}),[h,p,u,a]),s_.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(l=h.current)?void 0:l.src,h.current),s.jsxs(s.Fragment,{children:[i?i({onClick:()=>{h.current&&(h.current.muted=!1),m()},title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),icon:g(),isActive:p,className:o}):s.jsx("button",{onClickCapture:()=>{h.current&&(h.current.muted=!1),m()},type:"button",title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),children:g()}),s.jsx("audio",{ref:h,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=h.current)?void 0:c.src,onError:e=>{s_.error("Error fetching audio:",e)},id:`audio-${a}`,autoPlay:!0})]})}const kD=n.memo((function(e){const t=Ae(Ny.engineTTS),n={[Wd.browser]:ND,[Wd.external]:CD}[t];return n?s.jsx(n,{...e}):null})),SD={AlertCircle:gt,PenTool:rs,ImageOff:as,Ban:ss,HelpCircle:ns,CheckCircle:ts,Lightbulb:qe,Search:wt,ThumbsUp:Kc,ThumbsDown:Wc};function ED({tag:e,active:t,onClick:n}){const a=Fk(),r=SD[e.icon]||gt,o=a(e.label);return s.jsxs("button",{className:n_("flex w-full items-center gap-3 rounded-xl p-2 text-text-secondary transition-colors duration-200 hover:bg-surface-hover hover:text-text-primary",t&&"bg-surface-hover font-semibold text-text-primary"),onClick:n,type:"button","aria-label":o,"aria-pressed":t,children:[s.jsx(r,{size:"19",bold:t}),s.jsx("span",{children:o})]})}function TD({isLast:e,feedback:t,onFeedback:a,onOther:r}){var o,i;const l=Fk(),c=Bn({placement:"bottom"}),d=Bn({placement:"bottom"}),u=n.useMemo((()=>Tu("thumbsUp")),[]),m=n.useMemo((()=>Tu("thumbsDown")),[]),p="thumbsUp"===(null==t?void 0:t.rating)?null==(o=t.tag)?void 0:o.key:void 0,f="thumbsDown"===(null==t?void 0:t.rating)?null==(i=t.tag)?void 0:i.key:void 0,h=n.useCallback((e=>{e.preventDefault(),"thumbsUp"===(null==t?void 0:t.rating)?a(void 0):c.toggle()}),[t,a,c]),g=n.useCallback((e=>t=>{t.preventDefault(),c.hide(),a({rating:"thumbsUp",tag:e}),"other"===e.key&&(null==r||r())}),[a,r,c]),x=n.useCallback((e=>{e.preventDefault(),"thumbsDown"===(null==t?void 0:t.rating)?null==r||r():d.toggle()}),[t,r,d]),v=n.useCallback((e=>t=>{t.preventDefault(),d.hide(),a({rating:"thumbsDown",tag:e}),"other"===e.key&&(null==r||r())}),[a,r,d]);return s.jsxs(s.Fragment,{children:[s.jsx(Kn,{store:c,render:s.jsx("button",{className:ID("thumbsUp"===(null==t?void 0:t.rating),e),onClick:h,type:"button",title:l("com_ui_feedback_positive"),"aria-pressed":"thumbsUp"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:s.jsx(Kc,{size:"19",bold:"thumbsUp"===(null==t?void 0:t.rating)})})}),s.jsx(qn,{store:c,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:s.jsx("div",{className:"flex flex-col items-stretch justify-center",children:u.map((e=>s.jsx(ED,{tag:e,active:p===e.key,onClick:g(e)},e.key)))})}),s.jsx(Kn,{store:d,render:s.jsx("button",{className:ID("thumbsDown"===(null==t?void 0:t.rating),e),onClick:x,type:"button",title:l("com_ui_feedback_negative"),"aria-pressed":"thumbsDown"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:s.jsx(Wc,{size:"19",bold:"thumbsDown"===(null==t?void 0:t.rating)})})}),s.jsx(qn,{store:d,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:s.jsx("div",{className:"flex flex-col items-stretch justify-center",children:m.map((e=>s.jsx(ED,{tag:e,active:f===e.key,onClick:v(e)},e.key)))})})]})}function ID(e,t){return n_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!t&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",e&&"active text-text-primary bg-surface-hover")}function RD({isLast:e=!1,handleFeedback:t,feedback:a}){var r;const o=Fk(),[i,l]=n.useState(!1),[c,d]=n.useState(a);n.useEffect((()=>{d(a)}),[a]);const u=n.useCallback((e=>{d(e),t({feedback:e})}),[t]),m=n.useCallback((e=>{var t;"other"===(null==(t=null==e?void 0:e.tag)?void 0:t.key)?l(!0):l(!1),u(e)}),[u]),p=n.useCallback((()=>l(!0)),[]),f=n.useCallback((()=>{var e,t;("other"!==(null==(e=null==c?void 0:c.tag)?void 0:e.key)||(null==(t=null==c?void 0:c.text)?void 0:t.trim()))&&(u(c),l(!1))}),[c,u]),h=n.useCallback((()=>{d(void 0),t({feedback:void 0}),l(!1)}),[t]);return s.jsxs(s.Fragment,{children:[c?(()=>{if(!c)return null;const t="thumbsUp"===c.rating,n=t?Kc:Wc,a=o(t?"com_ui_feedback_positive":"com_ui_feedback_negative");return s.jsx("button",{className:ID(!0,e),onClick:()=>{t?m(void 0):l(!0)},type:"button",title:a,"aria-pressed":"true",children:s.jsx(n,{size:"19",bold:!0})})})():s.jsx(TD,{isLast:e,feedback:c,onFeedback:m,onOther:p}),s.jsx(ul,{open:i,onOpenChange:l,children:s.jsxs(gl,{className:"w-11/12 max-w-lg",children:[s.jsx(bl,{className:"text-token-text-primary text-lg font-semibold leading-6",children:o("com_ui_feedback_more_information")}),s.jsx("textarea",{className:"w-full rounded-xl border border-border-light bg-transparent p-2 text-text-primary",value:(null==c?void 0:c.text)||"",onChange:e=>{d((t=>t?{...t,text:e.target.value}:void 0))},rows:4,placeholder:o("com_ui_feedback_placeholder"),maxLength:500}),s.jsxs("div",{className:"mt-4 flex items-end justify-end gap-2",children:[s.jsx(ki,{variant:"destructive",onClick:h,children:o("com_ui_delete")}),s.jsx(ki,{variant:"submit",onClick:f,disabled:!(null==(r=null==c?void 0:c.text)?void 0:r.trim()),children:o("com_ui_save")})]})]})})]})}const PD=e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.map((e=>{if("string"==typeof e)return e;if("text"in e)return e.text||"";if("think"in e){const t=e.think;return"string"==typeof t?t:t&&"text"in t&&t.text||""}return""})).join(""):e.text||"",AD=n.memo((({id:e,onClick:t,title:n,icon:a,isActive:r=!1,isVisible:o=!0,isDisabled:i=!1,isLast:l=!1,className:c=""})=>{const d=n_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!l&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100",!o&&"opacity-0","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",r&&o&&"active text-text-primary bg-surface-hover",c);return s.jsx("button",{id:e,className:d,onClick:t,type:"button",title:n,disabled:i,children:a})}));AD.displayName="HoverButton";const MD=n.memo((({index:e,isEditing:t,enterEdit:a,copyToClipboard:r,conversation:o,isSubmitting:i,message:l,regenerate:c,handleContinue:d,latestMessage:u,isLast:m,handleFeedback:p})=>{const f=Fk(),[h,g]=n.useState(!1),[x]=Re(Ny.textToSpeech),v=n.useMemo((()=>o?o.endpointType??o.endpoint:""),[o]),b=function({error:e=!1,endpoint:t,messageId:n,isEditing:s=!1,isSubmitting:a,searchResult:r=!1,finish_reason:o="",latestMessageId:i,isCreatedByUser:l=!1}){const c=Boolean([Uu.openAI,Uu.custom,Uu.google,Uu.agents,Uu.bedrock,Uu.anthropic,Uu.gptPlugins,Uu.azureOpenAI].find((e=>e===t))),d=i===n&&o&&"stop"!==o&&!s&&!r&&c,u=Boolean([Uu.azureOpenAI,Uu.openAI,Uu.custom,Uu.agents,Uu.bedrock,Uu.chatGPTBrowser,Uu.google,Uu.gptPlugins,Uu.anthropic].find((e=>e===t))),m=!l&&!r&&!s&&!a&&u,p=a||e||r||!u||!c&&!l;return{forkingSupported:!Yu(t)&&!r,continueSupported:d,regenerateEnabled:m,isEditableEndpoint:c,hideEditButton:p}}({isEditing:t,isSubmitting:i,error:l.error,endpoint:v??"",messageId:l.messageId,searchResult:l.searchResult,finish_reason:l.finish_reason,isCreatedByUser:l.isCreatedByUser,latestMessageId:null==u?void 0:u.messageId}),{hideEditButton:_,regenerateEnabled:y,continueSupported:j,forkingSupported:w,isEditableEndpoint:N}=b;if(!o)return null;const{isCreatedByUser:C,error:k}=l;if(!0===k)return s.jsx("div",{className:"visible flex justify-center self-end lg:justify-start",children:y&&s.jsx(AD,{onClick:c,title:f("com_ui_regenerate"),icon:s.jsx(mc,{size:"19"}),isLast:m})});return s.jsxs("div",{className:"group visible flex justify-center gap-0.5 self-end focus-within:outline-none lg:justify-start",children:[x&&s.jsx(kD,{index:e,isLast:m,messageId:l.messageId,content:PD(l),renderButton:e=>s.jsx(AD,{onClick:e.onClick,title:e.title,icon:e.icon,isActive:e.isActive,isLast:m})}),s.jsx(AD,{onClick:()=>r(g),title:f(h?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),icon:h?s.jsx(oc,{className:"h-[18px] w-[18px]"}):s.jsx(rc,{size:"19"}),isLast:m,className:"ml-0 flex items-center gap-1.5 text-xs "+(i&&C?"md:opacity-0 md:group-hover:opacity-100":"")}),N&&s.jsx(AD,{id:`edit-${l.messageId}`,onClick:()=>{if(t)return a(!0);a()},title:f("com_ui_edit"),icon:s.jsx(ec,{size:"19"}),isActive:t,isVisible:!_,isDisabled:_,isLast:m,className:C?"":"active"}),s.jsx(uD,{messageId:l.messageId,conversationId:o.conversationId,forkingSupported:w,latestMessageId:null==u?void 0:u.messageId,isLast:m}),!C&&s.jsx(RD,{handleFeedback:p,feedback:l.feedback,isLast:m}),y&&s.jsx(AD,{onClick:c,title:f("com_ui_regenerate"),icon:s.jsx(mc,{size:"19"}),isLast:m,className:"active"}),j&&s.jsx(AD,{onClick:e=>e&&d(e),title:f("com_ui_continue"),icon:s.jsx(pc,{className:"w-19 h-19 -rotate-180"}),isLast:m,className:"active"})]})})),LD=n.memo((({iconData:e,assistant:t,agent:a})=>{s_.log("icon_data",e,t,a);const{data:r}=Gy(),o=n.useMemo((()=>(null==a?void 0:a.name)??""),[a]),i=n.useMemo((()=>{var e;return(null==(e=null==a?void 0:a.avatar)?void 0:e.filepath)??""}),[a]),l=n.useMemo((()=>(null==t?void 0:t.name)??""),[t]),c=n.useMemo((()=>{var e;return(null==(e=null==t?void 0:t.metadata)?void 0:e.avatar)??""}),[t]),d=n.useMemo((()=>{let e="";return t?e=c:a&&(e=i),e}),[t,a,c,i]),u=null==e?void 0:e.iconURL,m=n.useMemo((()=>Ab({endpointsConfig:r,iconURL:u,endpoint:null==e?void 0:e.endpoint})),[r,u,null==e?void 0:e.endpoint]),p=n.useMemo((()=>kb(r,m,"iconURL")),[r,m]);return!0!==(null==e?void 0:e.isCreatedByUser)&&null!=u&&u.includes("http")?s.jsx(vI,{iconURL:u,modelLabel:null==e?void 0:e.modelLabel,context:"message",assistantAvatar:c,agentAvatar:i,endpointIconURL:p,assistantName:l,agentName:o}):s.jsx(BI,{isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1,endpoint:m,iconURL:d||p,model:null==e?void 0:e.model,assistantName:l,agentName:o,size:28.8})}));LD.displayName="MessageIcon";const OD=n.memo((({message:e,isCard:t=!1,siblingIdx:a,siblingCount:r,setSiblingIdx:o,currentEditId:i,isMultiMessage:l=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{attachments:m,searchResults:p}=zE({messageId:null==e?void 0:e.messageId,attachments:null==e?void 0:e.attachments}),{edit:f,index:h,agent:g,assistant:x,enterEdit:v,conversation:b,messageLabel:_,isSubmitting:y,latestMessage:j,handleContinue:w,copyToClipboard:N,setLatestMessage:C,regenerateMessage:k,handleFeedback:S}=QE({message:e,searchResults:p,currentEditId:i,isMultiMessage:l,setCurrentEditId:c}),E=Ae(Ny.maximizeChatSpace),T=Ae(Ny.fontSize),I=n.useCallback((()=>k()),[k]),R=n.useMemo((()=>{var t;return!(null==(t=null==e?void 0:e.children)?void 0:t.length)&&((null==e?void 0:e.depth)===(null==j?void 0:j.depth)||-1===(null==e?void 0:e.depth))}),[null==e?void 0:e.children,null==e?void 0:e.depth,null==j?void 0:j.depth]),P=(null==e?void 0:e.messageId)===(null==j?void 0:j.messageId),A=R&&!d&&t,M=t&&!d&&P,L=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==b?void 0:b.endpoint),model:(null==e?void 0:e.model)??(null==b?void 0:b.model),iconURL:null==e?void 0:e.iconURL,modelLabel:_,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[_,null==b?void 0:b.endpoint,null==b?void 0:b.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),O=n.useMemo((()=>A&&!P?()=>{s_.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),s_.dir(e),C(e)}:void 0),[A,P,e,C]);if(!e)return null;const D={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:E?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},F={latestCard:M?"bg-surface-secondary":"",cardRender:A?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return s.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:n_(D.common,t?D.card:D.chat,F.latestCard,F.cardRender,F.focus,"message-render"),onClick:O,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!O||O()},role:A?"button":void 0,tabIndex:A?0:void 0,children:[M&&s.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(LD,{iconData:L,assistant:x,agent:g})})}),s.jsxs("div",{className:n_("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:n_("select-none font-semibold",T),children:_}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsx(rD,{edit:f,isLast:R,enterEdit:v,siblingIdx:a,messageId:e.messageId,attachments:m,isSubmitting:y,searchResults:p,setSiblingIdx:o,isCreatedByUser:e.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,content:e.content})}),!d&&!y||(null==(u=e.children)?void 0:u.length)?s.jsxs(qO,{classes:"text-xs",children:[s.jsx(GO,{siblingIdx:a,siblingCount:r,setSiblingIdx:o}),s.jsx(MD,{index:h,isEditing:f,message:e,enterEdit:v,isSubmitting:y,conversation:b??null,regenerate:I,copyToClipboard:N,handleContinue:w,latestMessage:j,handleFeedback:S,isLast:R})]}):s.jsx(oD,{isCard:t})]})]})]})})),DD=S.memo((({handleScroll:e,children:t})=>s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function FD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:r,latestMultiMessage:o,isSubmittingFamily:i}=YE({message:e.message}),{message:l,currentEditId:c,setCurrentEditId:d}=e;if(!l||"object"!=typeof l)return null;const{children:u,messageId:m=null}=l;return s.jsxs(s.Fragment,{children:[s.jsx(DD,{handleScroll:a,children:t?s.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"flex w-full flex-row flex-wrap justify-between gap-1 md:max-w-5xl md:flex-nowrap md:gap-2 lg:max-w-5xl xl:max-w-6xl",children:[s.jsx(OD,{...e,message:l,isSubmittingFamily:i,isCard:!0}),s.jsx(OD,{...e,isMultiMessage:!0,isCard:!0,message:r??o??void 0,isSubmittingFamily:i})]})}):s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6 ",children:s.jsx(OD,{...e})})}),s.jsx($D,{messageId:m,conversation:n,messagesTree:u??[],currentEditId:c,setCurrentEditId:d},m)]})}function zD(e){const t=Fk(),{message:a,siblingIdx:r,siblingCount:o,setSiblingIdx:i,currentEditId:l,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=zE({messageId:null==a?void 0:a.messageId,attachments:null==a?void 0:a.attachments}),{edit:m,index:p,agent:f,isLast:h,enterEdit:g,assistant:x,handleScroll:v,conversation:b,isSubmitting:_,latestMessage:y,handleContinue:j,copyToClipboard:w,regenerateMessage:N}=function(e){const t=n.useRef(""),{message:s,currentEditId:a,setCurrentEditId:r}=e,{ask:o,index:i,regenerate:l,isSubmitting:c,conversation:d,latestMessage:u,setAbortScroll:m,handleContinue:p,setLatestMessage:f}=Pk(),h=xS(),g=Dk(),{text:x,content:v,children:b,messageId:_=null,isCreatedByUser:y}=s??{},j=_===a,w=0===(null==b?void 0:b.length)||void 0===(null==b?void 0:b.length);n.useEffect((()=>{const e=null==d?void 0:d.conversationId;if(e===Sh.NEW_CONVO)return;if(!s)return;if(!w)return;const n=_b(s,e),a={textKey:n,"latestText.current":t.current,messageId:s.messageId,convoId:e};n!==t.current||t.current&&e!==t.current.split(Sh.COMMON_DIVIDER)[2]?(s_.log("[useMessageHelpers] Setting latest message: ",a),t.current=n,f({...s})):s_.log("No change in latest message",a)}),[w,s,f,null==d?void 0:d.conversationId]);const N=n.useCallback((e=>r&&r(!0===e?-1:_)),[_,r]),C=n.useCallback((e=>{Eo((()=>{s_.log("message_scrolling",`useMessageHelpers: setting abort scroll to ${c}, handleScroll event`,e),m(!!c)}),500)()}),[c,m]),k=n.useMemo((()=>{if(!Yu(null==d?void 0:d.endpoint))return;const e=(null==d?void 0:d.endpoint)??"",t=(null==s?void 0:s.model)??"";return(null==h?void 0:h[e])?h[e][t]:void 0}),[null==d?void 0:d.endpoint,null==s?void 0:s.model,h]),S=n.useMemo((()=>{if(!Xu(null==d?void 0:d.endpoint))return;const e=(null==s?void 0:s.model)??"";return g?g[e]:void 0}),[g,null==d?void 0:d.endpoint,null==s?void 0:s.model]),E=qE({text:x,content:v});return{ask:o,edit:j,agent:S,index:i,isLast:w,assistant:k,enterEdit:N,conversation:d,isSubmitting:c,handleScroll:C,latestMessage:u,handleContinue:p,copyToClipboard:E,regenerateMessage:()=>{c&&!0===y||!s||l(s)}}}(e),C=Ae(Ny.fontSize),k=Ae(Ny.maximizeChatSpace),{children:S,messageId:E=null,isCreatedByUser:T}=a??{},I=n.useMemo((()=>{let e="";return!0===T?e=t("com_user_message"):x?e=x.name??t("com_ui_assistant"):f&&(e=f.name??t("com_ui_agent")),e}),[x,f,T,t]),R=n.useMemo((()=>({endpoint:(null==a?void 0:a.endpoint)??(null==b?void 0:b.endpoint),model:(null==a?void 0:a.model)??(null==b?void 0:b.model),iconURL:(null==a?void 0:a.iconURL)??(null==b?void 0:b.iconURL),modelLabel:I,isCreatedByUser:null==a?void 0:a.isCreatedByUser})),[I,null==b?void 0:b.endpoint,null==b?void 0:b.iconURL,null==b?void 0:b.model,null==a?void 0:a.model,null==a?void 0:a.iconURL,null==a?void 0:a.endpoint,null==a?void 0:a.isCreatedByUser]);if(!a)return null;const P={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu",chat:k?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:v,onTouchMove:v,children:s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{id:E??"","aria-label":`message-${a.depth}-${E}`,className:n_(P.common,P.chat,"message-render"),children:[s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full pt-0.5",children:s.jsx(LD,{iconData:R,assistant:x,agent:f})})}),s.jsxs("div",{className:n_("relative flex w-11/12 flex-col",T?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:n_("select-none font-semibold text-text-primary",C),children:I}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsx(rD,{edit:m,isLast:h,enterEdit:g,siblingIdx:r,attachments:d,isSubmitting:_,searchResults:u,messageId:a.messageId,setSiblingIdx:i,isCreatedByUser:a.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,content:a.content})}),h&&_?s.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):s.jsxs(qO,{classes:"text-xs",children:[s.jsx(GO,{siblingIdx:r,siblingCount:o,setSiblingIdx:i}),s.jsx(MD,{index:p,isEditing:m,message:a,enterEdit:g,isSubmitting:_,conversation:b??null,regenerate:()=>N(),copyToClipboard:w,handleContinue:j,latestMessage:y,isLast:h})]})]})]})]})})}),s.jsx($D,{messageId:E,conversation:b,messagesTree:S??[],currentEditId:l,setCurrentEditId:c},E)]})}const UD=n.memo((({message:e,isCard:t=!1,siblingIdx:a,siblingCount:r,setSiblingIdx:o,currentEditId:i,isMultiMessage:l=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{ask:m,edit:p,index:f,agent:h,assistant:g,enterEdit:x,conversation:v,messageLabel:b,isSubmitting:_,latestMessage:y,handleContinue:j,copyToClipboard:w,setLatestMessage:N,regenerateMessage:C,handleFeedback:k}=QE({message:e,currentEditId:i,isMultiMessage:l,setCurrentEditId:c}),S=Ae(Ny.maximizeChatSpace),E=Ae(Ny.fontSize),T=n.useCallback((()=>C()),[C]),I=!(null==(u=null==e?void 0:e.children)?void 0:u.length),R=n.useMemo((()=>I&&((null==e?void 0:e.depth)===(null==y?void 0:y.depth)||-1===(null==e?void 0:e.depth))),[I,null==e?void 0:e.depth,null==y?void 0:y.depth]),P=(null==e?void 0:e.messageId)===(null==y?void 0:y.messageId),A=R&&!d&&t,M=t&&!d&&P,L=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==v?void 0:v.endpoint),model:(null==e?void 0:e.model)??(null==v?void 0:v.model),iconURL:null==e?void 0:e.iconURL,modelLabel:b,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[b,null==v?void 0:v.endpoint,null==v?void 0:v.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),O=n.useMemo((()=>A&&!P?()=>{s_.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),s_.dir(e),N(e)}:void 0),[A,P,e,N]);if(!e)return null;const D={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:S?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},F={latestCard:M?"bg-surface-secondary":"",cardRender:A?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return s.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:n_(D.common,t?D.card:D.chat,F.latestCard,F.cardRender,F.focus,"message-render"),onClick:O,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!O||O()},role:A?"button":void 0,tabIndex:A?0:void 0,children:[M&&s.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(LD,{iconData:L,assistant:g,agent:h})})}),s.jsxs("div",{className:n_("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:n_("select-none font-semibold",E),children:b}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsxs(mS.Provider,{value:{messageId:e.messageId,conversationId:null==v?void 0:v.conversationId,isExpanded:!1},children:[e.plugin&&s.jsx(WO,{plugin:e.plugin}),s.jsx(_O,{ask:m,edit:p,isLast:R,text:e.text||"",message:e,enterEdit:x,error:!!e.error,isSubmitting:_,unfinished:e.unfinished??!1,isCreatedByUser:e.isCreatedByUser??!0,siblingIdx:a??0,setSiblingIdx:o??(()=>({}))})]})}),I&&(!0===d||_)?s.jsx(oD,{isCard:t}):s.jsxs(qO,{classes:"text-xs",children:[s.jsx(GO,{siblingIdx:a,siblingCount:r,setSiblingIdx:o}),s.jsx(MD,{index:f,isEditing:p,message:e,enterEdit:x,isSubmitting:_,conversation:v??null,regenerate:T,copyToClipboard:w,handleContinue:j,latestMessage:y,handleFeedback:k,isLast:R})]})]})]})]})})),VD=S.memo((({handleScroll:e,children:t})=>s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function BD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:r,latestMultiMessage:o,isSubmittingFamily:i}=YE({message:e.message}),{message:l,currentEditId:c,setCurrentEditId:d}=e,u=Ae(Ny.maximizeChatSpace);if(!l||"object"!=typeof l)return null;const{children:m,messageId:p=null}=l;return s.jsxs(s.Fragment,{children:[s.jsx(VD,{handleScroll:a,children:t?s.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:n_("flex w-full flex-row flex-wrap justify-between gap-1 md:flex-nowrap md:gap-2",u?"w-full max-w-full":"md:max-w-5xl xl:max-w-6xl"),children:[s.jsx(UD,{...e,message:l,isSubmittingFamily:i,isCard:!0}),s.jsx(UD,{...e,isMultiMessage:!0,isCard:!0,message:r??o??void 0,isSubmittingFamily:i})]})}):s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6 ",children:s.jsx(UD,{...e})})}),s.jsx($D,{messageId:p,conversation:n,messagesTree:m??[],currentEditId:c,setCurrentEditId:d},p)]})}function $D({messageId:e,messagesTree:t,currentEditId:a,setCurrentEditId:r}){const[o,i]=Re(Ny.messagesSiblingIdxFamily(e)),l=n.useCallback((e=>{i(((null==t?void 0:t.length)??0)-e-1)}),[null==t?void 0:t.length,i]);if(n.useEffect((()=>{i(0)}),[null==t?void 0:t.length]),n.useEffect((()=>{(null==t?void 0:t.length)&&o>=t.length&&i(0)}),[o,null==t?void 0:t.length,i]),!t||!t.length)return null;const c=t[t.length-o-1];return c?Yu(c.endpoint)&&c.content?s.jsx(zD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):c.content?s.jsx(FD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):s.jsx(BD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):null}function HD({messagesTree:e}){const t=Fk(),a=Ae(Ny.fontSize),{screenshotTargetRef:r}=uE(),o=Ae(Ny.showScrollButton),[i,l]=n.useState(-1),{conversation:c,scrollableRef:d,messagesEndRef:u,showScrollButton:m,handleSmoothToRef:p,debouncedHandleScroll:f}=JE(e),{conversationId:h}=c??{};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:"scrollbar-gutter-stable",onScroll:f,ref:d,style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 dark:bg-transparent",children:[e&&0==e.length||null===e?s.jsx("div",{className:n_("flex w-full items-center justify-center p-3 text-text-secondary",a),children:t("com_ui_nothing_found")}):s.jsx(s.Fragment,{children:s.jsx("div",{ref:r,children:s.jsx($D,{messagesTree:e,messageId:h??null,setCurrentEditId:l,currentEditId:i??null},h)})}),s.jsx("div",{id:"messages-end",className:"group h-0 w-full flex-shrink-0",ref:u})]})}),s.jsx(Fr,{in:m&&o,timeout:{enter:550,exit:700},classNames:"scroll-animation",unmountOnExit:!0,appear:!0,children:s.jsx(nD,{scrollHandler:p})})]})})})}const GD=n.memo((({isActive:e})=>{const t=Fk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`fixed inset-0 z-[9998] transition-opacity duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{backgroundColor:"rgba(0, 0, 0, 0.4)",willChange:"opacity"}}),s.jsx("div",{className:`fixed inset-0 z-[9999] flex flex-col items-center justify-center gap-2 text-text-primary transition-all duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{transform:e?"scale(1)":"scale(0.95)",willChange:"opacity, transform"},children:s.jsxs("div",{className:"bg-surface-primary/95 flex flex-col items-center rounded-lg p-8 shadow-xl",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 132 108",fill:"none",width:"132",height:"108",style:{transform:e?"translateY(0)":"translateY(-10px)",transition:"transform 0.2s ease-in-out"},children:[s.jsx("g",{clipPath:"url(#clip0_3605_64419)",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.2025 29.3514C10.778 33.2165 8.51524 37.1357 11.8281 49.4995L13.4846 55.6814C16.7975 68.0453 20.7166 70.308 35.1411 66.443L43.3837 64.2344C57.8082 60.3694 60.0709 56.4502 56.758 44.0864L55.1016 37.9044C51.7887 25.5406 47.8695 23.2778 33.445 27.1428L29.3237 28.2471L25.2025 29.3514ZM18.1944 42.7244C18.8572 41.5764 20.325 41.1831 21.4729 41.8459L27.3517 45.24C28.4996 45.9027 28.8929 47.3706 28.2301 48.5185L24.836 54.3972C24.1733 55.5451 22.7054 55.9384 21.5575 55.2757C20.4096 54.613 20.0163 53.1451 20.6791 51.9972L22.8732 48.1969L19.0729 46.0028C17.925 45.3401 17.5317 43.8723 18.1944 42.7244ZM29.4091 56.3843C29.066 55.104 29.8258 53.7879 31.1062 53.4449L40.3791 50.9602C41.6594 50.6172 42.9754 51.377 43.3184 52.6573C43.6615 53.9376 42.9017 55.2536 41.6214 55.5967L32.3485 58.0813C31.0682 58.4244 29.7522 57.6646 29.4091 56.3843Z",fill:"#AFC1FF"})}),s.jsx("g",{clipPath:"url(#clip1_3605_64419)",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M86.8124 13.4036C81.0973 11.8722 78.5673 13.2649 77.0144 19.0603L68.7322 49.97C67.1793 55.7656 68.5935 58.2151 74.4696 59.7895L97.4908 65.958C103.367 67.5326 105.816 66.1184 107.406 60.1848L115.393 30.379C115.536 29.8456 115.217 29.2959 114.681 29.16C113.478 28.8544 112.435 28.6195 111.542 28.4183C106.243 27.2253 106.22 27.2201 109.449 20.7159C109.73 20.1507 109.426 19.4638 108.816 19.3004L86.8124 13.4036ZM87.2582 28.4311C86.234 28.1567 85.1812 28.7645 84.9067 29.7888C84.6323 30.813 85.2401 31.8658 86.2644 32.1403L101.101 36.1158C102.125 36.3902 103.178 35.7824 103.453 34.7581C103.727 33.7339 103.119 32.681 102.095 32.4066L87.2582 28.4311ZM82.9189 37.2074C83.1934 36.1831 84.2462 35.5753 85.2704 35.8497L100.107 39.8252C101.131 40.0996 101.739 41.1524 101.465 42.1767C101.19 43.201 100.137 43.8088 99.1132 43.5343L84.2766 39.5589C83.2523 39.2844 82.6445 38.2316 82.9189 37.2074ZM83.2826 43.2683C82.2584 42.9939 81.2056 43.6017 80.9311 44.626C80.6567 45.6502 81.2645 46.703 82.2888 46.9775L89.7071 48.9652C90.7313 49.2396 91.7841 48.6318 92.0586 47.6076C92.333 46.5833 91.7252 45.5305 90.7009 45.256L83.2826 43.2683Z",fill:"#7989FF"})}),s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M40.4004 71.8426C40.4004 57.2141 44.0575 53.5569 61.1242 53.5569H66.0004H70.8766C87.9432 53.5569 91.6004 57.2141 91.6004 71.8426V79.1569C91.6004 93.7855 87.9432 97.4426 70.8766 97.4426H61.1242C44.0575 97.4426 40.4004 93.7855 40.4004 79.1569V71.8426ZM78.8002 67.4995C78.8002 70.1504 76.6512 72.2995 74.0002 72.2995C71.3492 72.2995 69.2002 70.1504 69.2002 67.4995C69.2002 64.8485 71.3492 62.6995 74.0002 62.6995C76.6512 62.6995 78.8002 64.8485 78.8002 67.4995ZM60.7204 70.8597C60.2672 70.2553 59.5559 69.8997 58.8004 69.8997C58.045 69.8997 57.3337 70.2553 56.8804 70.8597L47.2804 83.6597C46.4851 84.72 46.7 86.2244 47.7604 87.0197C48.8208 87.8149 50.3251 87.6 51.1204 86.5397L58.8004 76.2997L66.4804 86.5397C66.8979 87.0962 67.5363 87.4443 68.2303 87.4936C68.9243 87.5429 69.6055 87.2887 70.0975 86.7967L74.8004 82.0938L79.5034 86.7967C80.4406 87.734 81.9602 87.734 82.8975 86.7967C83.8347 85.8595 83.8347 84.3399 82.8975 83.4026L76.4975 77.0026C75.5602 76.0653 74.0406 76.0653 73.1034 77.0026L68.6601 81.4459L60.7204 70.8597Z",fill:"#3C46FF"}),s.jsxs("defs",{children:[s.jsx("clipPath",{id:"clip0_3605_64419",children:s.jsx("rect",{width:"56",height:"56",fill:"white",transform:"translate(0 26.9939) rotate(-15)"})}),s.jsx("clipPath",{id:"clip1_3605_64419",children:s.jsx("rect",{width:"64",height:"64",fill:"white",transform:"translate(69.5645 0.5) rotate(15)"})})]})]}),s.jsx("h3",{className:"mt-4 text-lg font-semibold",children:t("com_ui_upload_files")}),s.jsx("h4",{className:"text-sm text-text-secondary",children:t("com_ui_drag_drop")})]})})]})}));GD.displayName="DragDropOverlay";const KD=({onOptionSelect:e,setShowModal:t,files:a,isVisible:r})=>{const o=Fk(),{agentsConfig:i}=$k(),l=Bk((null==i?void 0:i.capabilities)??Sf),{conversation:c}=Pk(),{fileSearchAllowedByAgent:d,codeAllowedByAgent:u}=GS(null==c?void 0:c.agent_id),m=n.useMemo((()=>{const e=[{label:o("com_ui_upload_image_input"),value:void 0,icon:s.jsx(os,{className:"icon-md"}),condition:a.every((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))}];return l.fileSearchEnabled&&d&&e.push({label:o("com_ui_upload_file_search"),value:gu.file_search,icon:s.jsx(is,{className:"icon-md"})}),l.codeEnabled&&u&&e.push({label:o("com_ui_upload_code_files"),value:gu.execute_code,icon:s.jsx(Ve,{className:"icon-md"})}),l.ocrEnabled&&e.push({label:o("com_ui_upload_ocr_text"),value:gu.ocr,icon:s.jsx(ls,{className:"icon-md"})}),e}),[l,a,o,d,u]);return r?s.jsx(ul,{open:r,onOpenChange:t,children:s.jsx(zd,{title:o("com_ui_upload_type"),className:"w-11/12 sm:w-[440px] md:w-[400px] lg:w-[360px]",main:s.jsx("div",{className:"flex flex-col gap-2",children:m.map(((t,n)=>!1!==t.condition&&s.jsxs("button",{onClick:()=>e(t.value),className:"flex items-center gap-2 rounded-lg p-2 hover:bg-surface-active-alt",children:[t.icon,s.jsx("span",{children:t.label})]},n)))})})}):null};function WD({children:e,className:t}){const{isOver:a,canDrop:r,drop:o,showModal:i,setShowModal:l,draggedFiles:c,handleOptionSelect:d}=function(){const e=pr(),[t,s]=n.useState(!1),[a,r]=n.useState([]),o=Ae(Ny.conversationByIndex(0))||void 0,i=Pe(yy((null==o?void 0:o.conversationId)??Sh.NEW_CONVO)),l=n.useMemo((()=>Yu(null==o?void 0:o.endpoint)),[null==o?void 0:o.endpoint]),{handleFiles:c}=wE({overrideEndpoint:l?void 0:Uu.agents}),d=n.useCallback((e=>{e&&e!==gu.file_search&&i((t=>({...t,[e]:!0}))),c(a,e),s(!1),r([])}),[a,c,i]),u=n.useRef(c),m=n.useRef(o);u.current=c,m.current=o;const p=n.useCallback((t=>{var n;if(l)return void u.current(t.files);const a=e.getQueryData([xx.endpoints]),o=null==a?void 0:a[Uu.agents],i=(null==o?void 0:o.capabilities)??Sf,c=!0===i.includes(vf.file_search),d=!0===i.includes(vf.execute_code),p=!0===i.includes(vf.ocr),f=null==(n=m.current)?void 0:n.agent_id;let h=!0,g=!0;if(f&&f!==Sh.EPHEMERAL_AGENT_ID){const t=e.getQueryData([xx.agent,f]);if(t){const e=t.tools;h=(null==e?void 0:e.includes(hu.file_search))??!1,g=(null==e?void 0:e.includes(hu.execute_code))??!1}else h=!1,g=!1}t.files.every((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))||c&&h||d&&g||p?(r(t.files),s(!0)):u.current(t.files)}),[l,e]),[{canDrop:f,isOver:h},g]=er((()=>({accept:[tr],drop:p,canDrop:()=>!0,collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})})),[p]);return{canDrop:f,isOver:h,drop:g,showModal:t,setShowModal:s,draggedFiles:a,handleOptionSelect:d}}(),u=r&&a;return s.jsxs("div",{ref:o,className:n_("relative flex h-full w-full",t),children:[e,s.jsx(GD,{isActive:u}),s.jsx(KD,{files:c,isVisible:i,setShowModal:l,onOptionSelect:d})]})}var qD,QD=Object.freeze,YD=Object.defineProperty;const XD={"application/vnd.mermaid":"App.tsx","application/vnd.react":"App.tsx","text/html":"index.html","application/vnd.code-html":"index.html",default:"index.html"},ZD={"text/html":"static","application/vnd.react":"react-ts","application/vnd.mermaid":"react-ts","application/vnd.code-html":"static",default:"static"};function JD(e,t){return`${e}${((null==t?void 0:t.length)??0)>0?`-${t}`:""}`}const eF={three:"^0.167.1","lucide-react":"^0.394.0","react-router-dom":"^6.11.2","class-variance-authority":"^0.6.0",clsx:"^1.2.1","date-fns":"^3.3.1","tailwind-merge":"^1.9.1","tailwindcss-animate":"^1.0.5",recharts:"2.12.7","@radix-ui/react-accordion":"^1.1.2","@radix-ui/react-alert-dialog":"^1.0.2","@radix-ui/react-aspect-ratio":"^1.1.0","@radix-ui/react-avatar":"^1.1.0","@radix-ui/react-checkbox":"^1.0.3","@radix-ui/react-collapsible":"^1.0.3","@radix-ui/react-dialog":"^1.0.2","@radix-ui/react-dropdown-menu":"^2.1.1","@radix-ui/react-hover-card":"^1.0.5","@radix-ui/react-label":"^2.0.0","@radix-ui/react-menubar":"^1.1.1","@radix-ui/react-navigation-menu":"^1.2.0","@radix-ui/react-popover":"^1.0.7","@radix-ui/react-progress":"^1.1.0","@radix-ui/react-radio-group":"^1.1.3","@radix-ui/react-select":"^2.0.0","@radix-ui/react-separator":"^1.0.3","@radix-ui/react-slider":"^1.1.1","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-tabs":"^1.0.3","@radix-ui/react-toast":"^1.1.5","@radix-ui/react-slot":"^1.1.0","@radix-ui/react-toggle":"^1.1.0","@radix-ui/react-toggle-group":"^1.1.0","embla-carousel-react":"^8.2.0","react-day-picker":"^9.0.8","dat.gui":"^0.7.9",vaul:"^0.9.1"},tF={"application/vnd.mermaid":Object.assign({mermaid:"^11.4.1","react-zoom-pan-pinch":"^3.6.1"},eF),"application/vnd.react":eF,"text/html":eF,"application/vnd.code-html":eF,default:eF};function nF(e){return tF[e]??eF}const sF={externalResources:["https://unpkg.com/@tailwindcss/ui/dist/tailwind-ui.min.css"]},aF={"/lib/utils.ts":xg.utils,"/components/ui/accordion.tsx":xg.accordian,"/components/ui/alert-dialog.tsx":xg.alertDialog,"/components/ui/alert.tsx":xg.alert,"/components/ui/avatar.tsx":xg.avatar,"/components/ui/badge.tsx":xg.badge,"/components/ui/breadcrumb.tsx":xg.breadcrumb,"/components/ui/button.tsx":xg.button,"/components/ui/calendar.tsx":xg.calendar,"/components/ui/card.tsx":xg.card,"/components/ui/carousel.tsx":xg.carousel,"/components/ui/checkbox.tsx":xg.checkbox,"/components/ui/collapsible.tsx":xg.collapsible,"/components/ui/dialog.tsx":xg.dialog,"/components/ui/drawer.tsx":xg.drawer,"/components/ui/dropdown-menu.tsx":xg.dropdownMenu,"/components/ui/input.tsx":xg.input,"/components/ui/label.tsx":xg.label,"/components/ui/menubar.tsx":xg.menuBar,"/components/ui/navigation-menu.tsx":xg.navigationMenu,"/components/ui/pagination.tsx":xg.pagination,"/components/ui/popover.tsx":xg.popover,"/components/ui/progress.tsx":xg.progress,"/components/ui/radio-group.tsx":xg.radioGroup,"/components/ui/select.tsx":xg.select,"/components/ui/separator.tsx":xg.separator,"/components/ui/skeleton.tsx":xg.skeleton,"/components/ui/slider.tsx":xg.slider,"/components/ui/switch.tsx":xg.switchComponent,"/components/ui/table.tsx":xg.table,"/components/ui/tabs.tsx":xg.tabs,"/components/ui/textarea.tsx":xg.textarea,"/components/ui/toast.tsx":xg.toast,"/components/ui/toaster.tsx":xg.toaster,"/components/ui/toggle-group.tsx":xg.toggleGroup,"/components/ui/toggle.tsx":xg.toggle,"/components/ui/tooltip.tsx":xg.tooltip,"/components/ui/use-toast.tsx":xg.useToast,"/public/index.html":cs(qD||(rF=['\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Document</title>\n        <script src="https://cdn.tailwindcss.com"><\/script>\n      </head>\n      <body>\n        <div id="root"></div>\n      </body>\n    </html>\n  '],qD=QD(YD(rF,"raw",{value:QD(rF.slice())}))))};var rF;const oF=cs('import React, { useEffect, useRef, useState } from "react";\nimport {\n  TransformWrapper,\n  TransformComponent,\n  ReactZoomPanPinchRef,\n} from "react-zoom-pan-pinch";\nimport mermaid from "mermaid";\nimport { ZoomIn, ZoomOut, RefreshCw } from "lucide-react";\nimport { Button } from "/components/ui/button";\n\ninterface MermaidDiagramProps {\n  content: string;\n}\n\nconst MermaidDiagram: React.FC<MermaidDiagramProps> = ({ content }) => {\n  const mermaidRef = useRef<HTMLDivElement>(null);\n  const transformRef = useRef<ReactZoomPanPinchRef>(null);\n  const [isRendered, setIsRendered] = useState(false);\n\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: false,\n      theme: "base",\n      themeVariables: {\n        background: "#282C34",\n        primaryColor: "#333842",\n        secondaryColor: "#333842",\n        tertiaryColor: "#333842",\n        primaryTextColor: "#ABB2BF",\n        secondaryTextColor: "#ABB2BF",\n        lineColor: "#636D83",\n        fontSize: "16px",\n        nodeBorder: "#636D83",\n        mainBkg: \'#282C34\',\n        altBackground: \'#282C34\',\n        textColor: \'#ABB2BF\',\n        edgeLabelBackground: \'#282C34\',\n        clusterBkg: \'#282C34\',\n        clusterBorder: "#636D83",\n        labelBoxBkgColor: "#333842",\n        labelBoxBorderColor: "#636D83",\n        labelTextColor: "#ABB2BF",\n      },\n      flowchart: {\n        curve: "basis",\n        nodeSpacing: 50,\n        rankSpacing: 50,\n        diagramPadding: 8,\n        htmlLabels: true,\n        useMaxWidth: true,\n        padding: 15,\n        wrappingWidth: 200,\n      },\n    });\n\n    const renderDiagram = async () => {\n      if (mermaidRef.current) {\n        try {\n          const { svg } = await mermaid.render("mermaid-diagram", content);\n          mermaidRef.current.innerHTML = svg;\n\n          const svgElement = mermaidRef.current.querySelector("svg");\n          if (svgElement) {\n            svgElement.style.width = "100%";\n            svgElement.style.height = "100%";\n\n            const pathElements = svgElement.querySelectorAll("path");\n            pathElements.forEach((path) => {\n              path.style.strokeWidth = "1.5px";\n            });\n\n            const rectElements = svgElement.querySelectorAll("rect");\n            rectElements.forEach((rect) => {\n              const parent = rect.parentElement;\n              if (parent && parent.classList.contains("node")) {\n                rect.style.stroke = "#636D83";\n                rect.style.strokeWidth = "1px";\n              } else {\n                rect.style.stroke = "none";\n              }\n            });\n          }\n          setIsRendered(true);\n        } catch (error) {\n          console.error("Mermaid rendering error:", error);\n          mermaidRef.current.innerHTML = "Error rendering diagram";\n        }\n      }\n    };\n\n    renderDiagram();\n  }, [content]);\n\n  const centerAndFitDiagram = () => {\n    if (transformRef.current && mermaidRef.current) {\n      const { centerView, zoomToElement } = transformRef.current;\n      zoomToElement(mermaidRef.current as HTMLElement);\n      centerView(1, 0);\n    }\n  };\n\n  useEffect(() => {\n    if (isRendered) {\n      centerAndFitDiagram();\n    }\n  }, [isRendered]);\n\n  const handlePanning = () => {\n    if (transformRef.current) {\n      const { state, instance } = transformRef.current;\n      if (!state) {\n        return;\n      }\n      const { scale, positionX, positionY } = state;\n      const { wrapperComponent, contentComponent } = instance;\n\n      if (wrapperComponent && contentComponent) {\n        const wrapperRect = wrapperComponent.getBoundingClientRect();\n        const contentRect = contentComponent.getBoundingClientRect();\n        const maxX = wrapperRect.width - contentRect.width * scale;\n        const maxY = wrapperRect.height - contentRect.height * scale;\n\n        let newX = positionX;\n        let newY = positionY;\n\n        if (newX > 0) {\n          newX = 0;\n        }\n        if (newY > 0) {\n          newY = 0;\n        }\n        if (newX < maxX) {\n          newX = maxX;\n        }\n        if (newY < maxY) {\n          newY = maxY;\n        }\n\n        if (newX !== positionX || newY !== positionY) {\n          instance.setTransformState(scale, newX, newY);\n        }\n      }\n    }\n  };\n\n  return (\n    <div className="relative h-screen w-screen cursor-move bg-[#282C34] p-5">\n      <TransformWrapper\n        ref={transformRef}\n        initialScale={1}\n        minScale={0.1}\n        maxScale={10}\n        limitToBounds={false}\n        centerOnInit={true}\n        initialPositionY={0}\n        wheel={{ step: 0.1 }}\n        panning={{ velocityDisabled: true }}\n        alignmentAnimation={{ disabled: true }}\n        onPanning={handlePanning}\n      >\n        {({ zoomIn, zoomOut }) => (\n          <>\n            <TransformComponent\n              wrapperStyle={{\n                width: "100%",\n                height: "100%",\n                overflow: "hidden",\n              }}\n            >\n              <div\n                ref={mermaidRef}\n                style={{\n                  width: "auto",\n                  height: "auto",\n                  minWidth: "100%",\n                  minHeight: "100%",\n                }}\n              />\n            </TransformComponent>\n            <div className="absolute bottom-2 right-2 flex space-x-2">\n              <Button onClick={() => zoomIn(0.1)} variant="outline" size="icon">\n                <ZoomIn className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={() => zoomOut(0.1)}\n                variant="outline"\n                size="icon"\n              >\n                <ZoomOut className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={centerAndFitDiagram}\n                variant="outline"\n                size="icon"\n              >\n                <RefreshCw className="h-4 w-4" />\n              </Button>\n            </div>\n          </>\n        )}\n      </TransformWrapper>\n    </div>\n  );\n};\n\nexport default MermaidDiagram;'),iF=e=>cs(`import React from 'react';\nimport MermaidDiagram from '/components/ui/MermaidDiagram';\n\nexport default App = () => (\n  <MermaidDiagram content={\`${e}\`} />\n);\n`),lF=e=>({"App.tsx":iF(e),"index.tsx":cs('import React, { StrictMode } from "react";\nimport { createRoot } from "react-dom/client";\nimport "./styles.css";\n\nimport App from "./App";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n;'),"/components/ui/MermaidDiagram.tsx":oF});function cF({artifact:e}){const[t,s]=n.useMemo((()=>{if(JD(e.type??"",e.language).includes("mermaid"))return["App.tsx",lF(e.content??"")];const t=function(e,t){const n=JD(e,t);return XD[n]??XD.default}(e.type??"",e.language);return[t,Am({[t]:e.content})]}),[e.type,e.content,e.language]);return{files:s,fileKey:t,template:n.useMemo((()=>function(e,t){const n=JD(e,t);return ZD[n]??ZD.default}(e.type??"",e.language)),[e.type,e.language]),sharedProps:n.useMemo((()=>({customSetup:{dependencies:nF(e.type??"")}})),[e.type])}}const dF=({artifact:e,className:t=""})=>{const a=Fk(),{currentCode:r}=iS(),[o,i]=n.useState(!1),{fileKey:l}=cF({artifact:e});return s.jsx("button",{className:`mr-2 text-text-secondary ${t}`,onClick:()=>{try{const t=r??e.content??"";if(!t)return;const n=new Blob([t],{type:"text/plain"}),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),i(!0),setTimeout((()=>i(!1)),3e3)}catch(t){console.error("Download failed:",t)}},"aria-label":a("com_ui_download_artifact"),children:o?s.jsx(oc,{className:"h-4 w-4"}):s.jsx(On,{className:"h-4 w-4"})})},uF=({ref:e,content:t,isSubmitting:s})=>{const[a,r]=n.useState(!1);return n.useEffect((()=>{const t=e.current;if(!t)return;const n=()=>{const{scrollTop:e,scrollHeight:n,clientHeight:s}=t;r(!(n-e-s<50))};return t.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",n)}}),[e]),n.useEffect((()=>{const t=e.current;t&&s&&!a&&(t.scrollTop=t.scrollHeight)}),[t,s,a,e]),{userScrolled:a}},mF=({fileKey:e,readOnly:t,artifact:a,editorRef:r})=>{const{sandpack:o}=ai(),[i,l]=n.useState(null),{isMutating:c,setIsMutating:d,setCurrentCode:u}=iS(),m=(e=>{const t=pr(),{onSuccess:n,...s}=e??{};return fr({mutationFn:e=>Rx.editArtifact(e),onSuccess:(e,s,a)=>{let r=!0;const o=n=>{n&&t.setQueryData([xx.messages,n],(t=>{if(!t)return t;const n=[...t];let a;for(let e=n.length-1;e>=0;e--)if(n[e].messageId===s.messageId){a=e,r=!1;break}return null==a?t:(n[a]={...n[a],content:e.content,text:e.text},n)}))};o(e.conversationId),r&&(console.warn("Edited Artifact Message not found in cache, trying `new` as `conversationId`"),o(Sh.NEW_CONVO)),null==n||n(e,s,a)},...s})})({onMutate:e=>{d(!0),l(e.updated)},onSuccess:()=>{d(!1),l(null)},onError:()=>{d(!1)}}),p=n.useCallback((e=>{m.mutate(e)}),[m]),f=n.useMemo((()=>ko(p,500)),[p]);return n.useEffect((()=>{var n;if(t)return;if(c)return;if(null==a.index)return;const s=null==(n=o.files["/"+e])?void 0:n.code,r=s&&null!=a.content&&s.trim()!==a.content.trim(),l=null==i||null!=s&&s.trim()!==i.trim();return a.content&&r&&l&&(u(s),f({index:a.index,messageId:a.messageId??"",original:a.content,updated:s})),()=>{f.cancel()}}),[e,a.index,a.content,a.messageId,t,c,i,d,o.files,u,f]),s.jsx(ri,{ref:r,showTabs:!1,showRunButton:!1,showLineNumbers:!0,showInlineErrors:!0,readOnly:!0===t,className:"hljs language-javascript bg-black"})},pF=function({files:e,fileKey:t,template:a,artifact:r,editorRef:o,sharedProps:i}){const{data:l}=Ky(),{isSubmitting:c}=FS(),d=n.useMemo((()=>l?{...sF,bundlerURL:"static"===a?l.staticBundlerURL:l.bundlerURL}:sF),[l,a]),[u,m]=n.useState(c??!1);return n.useEffect((()=>{m(c??!1)}),[c]),0===Object.keys(e).length?null:s.jsx(si,{theme:"dark",files:{...e,...aF},options:d,...i,template:a,children:s.jsx(mF,{fileKey:t,artifact:r,editorRef:o,readOnly:u})})},fF=n.memo((function({files:e,fileKey:t,template:a,sharedProps:r,previewRef:o,currentCode:i,startupConfig:l}){const c=n.useMemo((()=>{if(0===Object.keys(e).length)return e;const n=i??"";return n?{...e,[t]:{code:n}}:e}),[i,e,t]),d=n.useMemo((()=>{if(!l)return sF;return{...sF,bundlerURL:"static"===a?l.staticBundlerURL:l.bundlerURL}}),[l,a]);return 0===Object.keys(c).length?null:s.jsx(oi,{files:{...c,...aF},options:d,...r,template:a,children:s.jsx(ii,{showOpenInCodeSandbox:!1,showRefreshButton:!1,tabIndex:0,ref:o})})}));function hF({artifact:e,isMermaid:t,editorRef:a,previewRef:r}){const{isSubmitting:o}=FS(),{currentCode:i,setCurrentCode:l}=iS(),{data:c}=Ky(),d=n.useRef(null);n.useEffect((()=>{e.id!==d.current&&l(void 0),d.current=e.id}),[l,e.id]);const u=e.content??"",m=n.useRef(null);uF({ref:m,content:u,isSubmitting:o});const{files:p,fileKey:f,template:h,sharedProps:g}=cF({artifact:e});return s.jsxs(s.Fragment,{children:[s.jsx(Na,{ref:m,value:"code",id:"artifacts-code",className:n_("flex-grow overflow-auto"),children:s.jsx(pF,{files:p,fileKey:f,template:h,artifact:e,editorRef:a,sharedProps:g})}),s.jsx(Na,{value:"preview",className:n_("flex-grow overflow-auto",t?"bg-[#282C34]":"bg-white"),children:s.jsx(fF,{files:p,fileKey:f,template:h,previewRef:r,sharedProps:g,currentCode:i,startupConfig:c})})]})}const gF=n.memo((({inline:e,className:t,children:n})=>{const a=/language-(\w+)/.exec(t??""),r=a&&a[1];return e?s.jsx("code",{onDoubleClick:g_,className:t,children:n}):s.jsx("code",{className:`hljs language-${r} !whitespace-pre`,children:n})}));n.memo((({content:e="",isSubmitting:t})=>{const a=n.useRef(null),[r,o]=n.useState(!1),i=e,l=[[ei],[Xo,{detect:!0,ignoreMissing:!0,subset:jb}]];return n.useEffect((()=>{const e=a.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;o(!(n-t-s<50))};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}}),[]),n.useEffect((()=>{const e=a.current;e&&t&&!r&&(e.scrollTop=e.scrollHeight)}),[e,t,r]),s.jsx("div",{ref:a,className:"max-h-full overflow-y-auto",children:s.jsx(Yo,{rehypePlugins:l,components:{code:gF},children:i})})}));const xF=({content:e})=>{const t=Fk(),[a,r]=n.useState(!1);return s.jsx("button",{className:"mr-2 text-text-secondary",onClick:()=>{ot(e,{format:"text/plain"}),r(!0),setTimeout((()=>r(!1)),3e3)},"aria-label":t(a?"com_ui_copied":"com_ui_copy_code"),children:a?s.jsx(oc,{className:"h-[18px] w-[18px]"}):s.jsx(rc,{})})};function vF(){const e=Fk(),{isMutating:t}=iS(),a=n.useRef(),r=n.useRef(),[o,i]=n.useState(!1),[l,c]=n.useState(!1),d=Pe(Ny.artifactsVisibility);n.useEffect((()=>{i(!0)}),[]);const{activeTab:u,isMermaid:m,setActiveTab:p,currentIndex:f,cycleArtifact:h,currentArtifact:g,orderedArtifactIds:x}=function(){const[e,t]=n.useState("preview"),{isSubmitting:s,latestMessageId:a,latestMessageText:r,conversationId:o}=FS(),i=Ae(Ny.artifactsState),l=Oe(Ny.artifactsState),c=Oe(Ny.currentArtifactId),[d,u]=Re(Ny.currentArtifactId),m=n.useMemo((()=>Object.keys(i??{}).sort(((e,t)=>{var n,s;return((null==(n=null==i?void 0:i[e])?void 0:n.lastUpdateTime)??0)-((null==(s=null==i?void 0:i[t])?void 0:s.lastUpdateTime)??0)}))),[i]),p=n.useRef(null),f=n.useRef(!1),h=n.useRef(!1),g=n.useRef(null),x=n.useRef(null);n.useEffect((()=>{const e=()=>{l(),c(),x.current=o,g.current=null,p.current=null,f.current=!1};return(o!==x.current&&null!=x.current||o===Sh.NEW_CONVO)&&e(),x.current=o,()=>{s_.log("artifacts_visibility","Unmounting artifacts"),e()}}),[o,l,c]),n.useEffect((()=>{if(m.length>0){const e=m[m.length-1];u(e)}}),[u,m]),n.useEffect((()=>{var e;if(!s)return;if(0===m.length)return;if(null==a)return;const n=m[m.length-1],o=null==i?void 0:i[n];if((null==o?void 0:o.content)!==p.current)if(u(n),p.current=(null==o?void 0:o.content)??null,/:::artifact(?:\{[^}]*\})?(?:\s|\n)*(?:```[\s\S]*?```(?:\s|\n)*)?:::/m.test(r.trim())&&!f.current)t("preview"),f.current=!0,h.current=!1;else if(!f.current&&!h.current){const n=(null==(e=null==o?void 0:o.content)?void 0:e.slice(0,50))??"";n.length>0&&r.includes(n)&&(t("code"),h.current=!0)}}),[i,s,a,r,m,u]),n.useEffect((()=>{a!==g.current&&(g.current=a,f.current=!1,h.current=!1)}),[a]);const v=null!=d?null==i?void 0:i[d]:null,b=m.indexOf(d??"");return{activeTab:e,isMermaid:n.useMemo((()=>null!=(null==v?void 0:v.type)&&JD(v.type,v.language).includes("mermaid")),[null==v?void 0:v.type,null==v?void 0:v.language]),setActiveTab:t,currentIndex:b,cycleArtifact:e=>{let t;t="next"===e?(b+1)%m.length:(b-1+m.length)%m.length,u(m[t])},currentArtifact:v,orderedArtifactIds:m}}();if(null==g)return null;const v=()=>{i(!1),setTimeout((()=>d(!1)),300)};return s.jsx(Qa,{value:u,onValueChange:p,asChild:!0,children:s.jsx("div",{className:"flex h-full w-full items-center justify-center",children:s.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden border border-border-medium bg-surface-primary text-xl text-text-primary shadow-xl transition-all duration-500 ease-in-out "+(o?"scale-100 opacity-100 blur-0":"scale-105 opacity-0 blur-sm"),children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-border-medium bg-surface-primary-alt p-2",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{className:"mr-2 text-text-secondary",onClick:v,children:s.jsx(Tn,{className:"h-4 w-4"})}),s.jsx("h3",{className:"truncate text-sm text-text-primary",children:g.title})]}),s.jsxs("div",{className:"flex items-center",children:["preview"===u&&s.jsx("button",{className:"mr-2 text-text-secondary transition-transform duration-500 ease-in-out "+(l?"rotate-180":""),onClick:()=>{var e;c(!0);const t=null==(e=r.current)?void 0:e.getClient();null!=t&&t.dispatch({type:"refresh"}),setTimeout((()=>c(!1)),750)},disabled:l,"aria-label":"Refresh",children:s.jsx(Ht,{size:16,className:"transform "+(l?"animate-spin":"")})}),"preview"!==u&&t&&s.jsx(Ht,{size:16,className:"mr-2 animate-spin text-text-secondary"}),s.jsxs(ja,{className:"mr-2 inline-flex h-7 rounded-full border border-border-medium bg-surface-tertiary",children:[s.jsx(wa,{value:"preview",disabled:t,className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_preview")}),s.jsx(wa,{value:"code",className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_code")})]}),s.jsx("button",{className:"text-text-secondary",onClick:v,children:s.jsx(vt,{className:"h-4 w-4"})})]})]}),s.jsx(hF,{isMermaid:m,artifact:g,editorRef:a,previewRef:r}),s.jsxs("div",{className:"flex items-center justify-between border-t border-border-medium bg-surface-primary-alt p-2 text-sm text-text-secondary",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>h("prev"),className:"mr-2 text-text-secondary",children:s.jsx(pt,{className:"h-4 w-4"})}),s.jsx("span",{className:"text-xs",children:`${f+1} / ${x.length}`}),s.jsx("button",{onClick:()=>h("next"),className:"ml-2 text-text-secondary",children:s.jsx(Vn,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(xF,{content:g.content??""}),s.jsx(dF,{artifact:g})]})]})]})})})}function bF({children:e}){const t=Ae(Ny.artifactsState),a=Ae(Ny.artifactsVisibility),r=KS(),{mutateAsync:o}=Wy({onSuccess:()=>{console.log("Temporary Files deleted"),r({})},onError:e=>{console.log("Error deleting temporary files:",e)}});n.useEffect((()=>{const e=localStorage.getItem(Eh.FILES_TO_DELETE),t=JSON.parse(e??"{}"),n=Object.values(t).filter((e=>null!=e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,filepath:e.filepath,source:e.source,embedded:!!e.embedded})));0!==n.length&&o({files:n})}),[o]);const i=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),l=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),c=n.useMemo((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]);return s.jsx(WD,{className:"relative flex w-full grow overflow-hidden bg-presentation",children:s.jsx(AS,{children:s.jsx(aL,{defaultLayout:i,fullPanelCollapse:c,defaultCollapsed:l,artifacts:!0===a&&Object.keys(t??{}).length>0?s.jsx(DS,{children:s.jsx(oS,{children:s.jsx(vF,{})})}):null,children:s.jsx("main",{className:"flex h-full flex-col overflow-y-auto",role:"main",children:e})})})})}const _F=S.memo((({agentId:e,disabled:t,conversationId:a,endpointFileConfig:r})=>{const o=Fk(),i=t??!1,l=n.useRef(null),[c,d]=n.useState(!1),u=Pe(yy(a)),[m,p]=n.useState(),{handleFileChange:f}=wE({overrideEndpoint:Uu.agents,overrideEndpointFileConfig:r}),{handleSharePointFiles:h,isProcessing:g,downloadProgress:x}=CE({overrideEndpoint:Uu.agents,overrideEndpointFileConfig:r,toolResource:m}),{data:v}=Ky(),b=null==v?void 0:v.sharePointFilePickerEnabled,[_,y]=n.useState(!1),{agentsConfig:j}=$k(),w=Bk((null==j?void 0:j.capabilities)??Sf),{fileSearchAllowedByAgent:N,codeAllowedByAgent:C}=GS(e),k=e=>{l.current&&(l.current.value="",l.current.accept=!0===e?"image/*":"",l.current.click(),l.current.accept="")},S=n.useMemo((()=>{const e=e=>{const t=[{label:o("com_ui_upload_image_input"),onClick:()=>{p(void 0),e(!0)},icon:s.jsx(os,{className:"icon-md"})}];return w.ocrEnabled&&t.push({label:o("com_ui_upload_ocr_text"),onClick:()=>{p(gu.ocr),e()},icon:s.jsx(ls,{className:"icon-md"})}),w.fileSearchEnabled&&N&&t.push({label:o("com_ui_upload_file_search"),onClick:()=>{p(gu.file_search),u((e=>({...e,[gu.file_search]:!0}))),e()},icon:s.jsx(is,{className:"icon-md"})}),w.codeEnabled&&C&&t.push({label:o("com_ui_upload_code_files"),onClick:()=>{p(gu.execute_code),u((e=>({...e,[gu.execute_code]:!0}))),e()},icon:s.jsx(Ve,{className:"icon-md"})}),t},t=e(k);if(b){const n=e((()=>{y(!0)}));return t.push({label:o("com_files_upload_sharepoint"),onClick:()=>{},icon:s.jsx(td,{className:"icon-md"}),subItems:n}),t}return t}),[w,o,p,u,b,C,N,y]),E=s.jsx(Ol,{render:s.jsx(ie,{disabled:i,id:"attach-file-menu-button","aria-label":"Attach File Options",className:n_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(dc,{})})}),id:"attach-file-menu-button",description:o("com_sidepanel_attach_files"),disabled:i});return s.jsxs(s.Fragment,{children:[s.jsx(_d,{ref:l,handleFileChange:e=>{f(e,m)},children:s.jsx(wd,{menuId:"attach-file-menu",className:"overflow-visible",isOpen:c,setIsOpen:d,modal:!0,unmountOnHide:!0,trigger:E,items:S,iconClassName:"mr-0"})}),s.jsx(UI,{isOpen:_,onOpenChange:y,onFilesSelected:async e=>{try{await h(e),y(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:g,downloadProgress:x,maxSelectionCount:null==r?void 0:r.fileLimit})]})})),yF=S.memo((({disabled:e})=>{const t=Fk(),a=n.useRef(null),r=e??!1,{handleFileChange:o}=wE();return s.jsx(_d,{ref:a,handleFileChange:o,children:s.jsx(Ol,{description:t("com_sidepanel_attach_files"),id:"attach-file",disabled:r,render:s.jsx("button",{type:"button","aria-label":t("com_sidepanel_attach_files"),disabled:r,className:n_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),onKeyDownCapture:e=>{a.current&&("Enter"!==e.key&&" "!==e.key||(a.current.value="",a.current.click()))},onClick:()=>{a.current&&(a.current.value="",a.current.click())},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(dc,{})})})})})}));const jF=n.memo((function({disableInputs:e,conversation:t}){const a=(null==t?void 0:t.conversationId)??Sh.NEW_CONVO,{endpoint:r,endpointType:o}=t??{endpoint:null},i=n.useMemo((()=>Xu(r)),[r]),l=n.useMemo((()=>Yu(r)),[r]),{data:c=cp}=Yy({select:e=>fp(e)}),d=c.endpoints[r??""],u=Km[o??r??""]??!1,m=(e||(null==d?void 0:d.disabled))??!1;return l&&u&&!m?s.jsx(yF,{disabled:e}):i||u&&!m?s.jsx(_F,{disabled:e,conversationId:a,agentId:null==t?void 0:t.agent_id,endpointFileConfig:d}):null}));const wF=n.memo((function({conversation:e}){const{files:t,setFiles:n,setFilesLoading:a}=Pk(),r=Ae(Ny.chatDirection).toLowerCase(),{endpoint:o}=e??{endpoint:null},{abortUpload:i}=wE(),l="rtl"===r;return s.jsx(s.Fragment,{children:s.jsx(vR,{files:t,setFiles:n,abortUpload:i,setFilesLoading:a,isRTL:l,Wrapper:({children:e})=>s.jsx("div",{className:"mx-2 mt-2 flex flex-wrap gap-2",children:e})})})}));function NF({addedConvo:e,setAddedConvo:t}){const a=WS(),{data:r}=Gy(),o=n.useMemo((()=>`+ ${a(e)}: ${db(e)}`),[e,a]);return e?s.jsxs("div",{className:"flex items-start gap-4 py-2.5 pl-3 pr-1.5 text-sm",children:[s.jsx("span",{className:"mt-0 flex h-6 w-6 flex-shrink-0 items-center justify-center",children:s.jsx("div",{className:"icon-md",children:s.jsx(GI,{conversation:e,endpointsConfig:r,containerClassName:"shadow-stroke overflow-hidden rounded-full",context:"menu-item",size:20})})}),s.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:o}),s.jsx("button",{className:"text-token-text-secondary flex-shrink-0",type:"button","aria-label":"Close added conversation",onClick:()=>t(null),children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",className:"icon-lg","aria-hidden":"true",children:s.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.293 7.293a1 1 0 0 1 1.414 0L12 10.586l3.293-3.293a1 1 0 1 1 1.414 1.414L13.414 12l3.293 3.293a1 1 0 0 1-1.414 1.414L12 13.414l-3.293 3.293a1 1 0 0 1-1.414-1.414L10.586 12 7.293 8.707a1 1 0 0 1 0-1.414",clipRule:"evenodd"})})})]}):null}function CF({addedConvo:e,setAddedConvo:t}){return e?s.jsx("div",{className:"m-1.5 flex flex-col divide-y overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:s.jsx(NF,{addedConvo:e,setAddedConvo:t})}):null}function kF({name:e,onClick:t,index:n,icon:a,isActive:r,description:o,style:i,type:l="mention"}){return s.jsx("button",{tabIndex:n,onClick:t,id:`${l}-item-${n}`,className:"w-full",style:i,children:s.jsxs("div",{className:n_("text-token-text-primary bg-token-main-surface-secondary group flex h-10 items-center gap-2 rounded-lg px-2 text-sm font-medium hover:bg-surface-secondary",!0===r?"bg-surface-active":"bg-transparent"),children:[s.jsx("div",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center",children:a}),s.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[s.jsxs("div",{className:"truncate",children:[s.jsx("span",{className:"font-medium",children:e}),null!=o&&o?s.jsx("span",{className:"text-token-text-tertiary ml-2 text-sm font-light",children:o}):null]}),s.jsx(ds,{size:16,className:"ml-2 flex-shrink-0"})]})]})})}const SF=n.memo((({index:e,children:t,isVariableDialogOpen:n,variableGroup:a,setVariableDialogOpen:r})=>{const o=Ae(Ny.showPromptsPopoverFamily(e));return s.jsxs(s.Fragment,{children:[o?t:null,s.jsx(IM,{open:n,onClose:()=>r(!1),group:a})]})}));const EF=n.memo((function({index:e,textAreaRef:t,submitPrompt:a}){const r=Fk(),o=Wk({permissionType:hg.PROMPTS,permission:gg.USE}),{allPromptGroups:i}=HS(),{data:l,isLoading:c}=i,[d,u]=n.useState(0),m=n.useRef(null),p=n.useRef(null),[f,h]=n.useState(!1),[g,x]=n.useState(null),v=Pe(Ny.showPromptsPopoverFamily(e)),b=n.useMemo((()=>null==l?void 0:l.promptGroups),[l]),_=n.useMemo((()=>null==l?void 0:l.promptsMap),[l]),{open:y,setOpen:j,searchValue:w,setSearchValue:N,matches:C}=Hi({value:"",options:b??[]}),k=n.useCallback(((e,n)=>{var s,r;if(!e)return;N(""),j(!1),v(!1),t.current&&gb(t.current,"/");const o=null==_?void 0:_[e.id];if(!o)return;if(mb((null==(s=o.productionPrompt)?void 0:s.prompt)??""))return n&&"Tab"===n.key&&n.preventDefault(),x(o),void h(!0);a((null==(r=o.productionPrompt)?void 0:r.prompt)??"")}),[N,j,v,t,_,a]);if(n.useEffect((()=>{y?x(null):u(0)}),[y]),n.useEffect((()=>()=>{m.current&&clearTimeout(m.current)}),[]),n.useEffect((()=>{const e=document.getElementById(`prompt-item-${d}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[d]),!o)return null;const S=({index:e,key:t,style:n})=>{const a=C[e];return s.jsx(kF,{index:e,type:"prompt",style:n,onClick:()=>{m.current&&clearTimeout(m.current),m.current=null,k(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===d},t)};return s.jsx(SF,{index:e,isVariableDialogOpen:f,variableGroup:g,setVariableDialogOpen:h,children:s.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:s.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-surface-tertiary-alt p-2 shadow-lg",children:[s.jsx("input",{autoFocus:!0,ref:p,placeholder:r("com_ui_command_usage_placeholder"),className:"mb-1 w-full border-0 bg-surface-tertiary-alt p-2 text-sm focus:outline-none dark:text-gray-200",autoComplete:"off",value:w,onKeyDown:e=>{var n,s;"Escape"===e.key&&(j(!1),v(!1),null==(n=t.current)||n.focus()),"ArrowDown"===e.key?u((e=>(e+1)%C.length)):"ArrowUp"===e.key?u((e=>(e-1+C.length)%C.length)):"Enter"===e.key||"Tab"===e.key?("Enter"===e.key&&e.preventDefault(),k(C[d],e)):"Backspace"===e.key&&""===w&&(j(!1),v(!1),null==(s=t.current)||s.focus())},onChange:e=>N(e.target.value),onFocus:()=>j(!0),onBlur:()=>{m.current=setTimeout((()=>{j(!1),v(!1)}),150)}}),s.jsx("div",{className:"max-h-40 overflow-y-auto",children:c&&y?s.jsx("div",{className:"flex h-32 items-center justify-center text-text-primary",children:s.jsx(ac,{})}):!c&&y?s.jsx("div",{className:"max-h-40",children:s.jsx($r,{disableHeight:!0,children:({width:e})=>s.jsx(Hr,{width:e,overscanRowCount:5,rowHeight:40,rowCount:C.length,rowRenderer:S,scrollToIndex:d,height:Math.min(40*C.length,160)})})}):null})]})})})})),TF=e=>"external"===e;function IF({disabled:e,ask:t,methods:a,textAreaRef:r,isSubmitting:o}){const{setValue:i,reset:l,getValues:c}=a,d=Fk(),{showToast:u}=Bd(),{speechToTextEndpoint:m}=PE(),p=n.useRef(""),f=n.useCallback((e=>{if(o)u({message:d("com_ui_speech_while_submitting"),status:"error"});else if(e){const n=document.getElementById(Qd);n&&(console.log("Unmuting global audio"),n.muted=!1);const s=TF(m)&&p.current?`${p.current} ${e}`:e;t({text:s}),l({text:""}),p.current=""}}),[t,l,u,d,o,m]),h=n.useCallback((e=>{let t=e;t=(TF(m),p.current?`${p.current} ${e}`:e),i("text",t,{shouldValidate:!0})}),[i,m]),{isListening:g,isLoading:x,startRecording:v,stopRecording:b}=ME(h,f);if(!r.current)return null;return s.jsx(Ol,{description:d("com_ui_use_micrphone"),render:s.jsx("button",{id:"audio-recorder",type:"button","aria-label":d("com_ui_use_micrphone"),onClick:!0===g?async()=>{b(),TF(m)||(p.current="")}:async()=>{p.current=c("text")||"",v()},disabled:e,className:n_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover"),title:d("com_ui_use_micrphone"),"aria-pressed":g,children:!0===g?s.jsx(Mc,{className:"stroke-red-500"}):!0===x?s.jsx(ac,{className:"stroke-text-secondary"}):s.jsx(Mc,{className:"stroke-text-secondary"})})})}const RF=({isScrollable:e,isCollapsed:t,setIsCollapsed:n})=>{const a=Fk();if(!e)return null;const r=a(t?"com_ui_expand_chat":"com_ui_collapse_chat");return s.jsx("div",{className:"relative ml-auto items-end justify-end",children:s.jsx(Ol,{description:r,render:s.jsx("button",{"aria-label":r,onClick:e=>{e.preventDefault(),e.stopPropagation(),n((e=>!e))},className:n_("z-10 size-5 rounded-full transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-opacity-50"),children:t?s.jsx(mn,{className:"h-full w-full"}):s.jsx(Pt,{className:"h-full w-full"})})})})};function PF(e,t){return new Promise(((n,s)=>setTimeout((()=>s(new Error(t))),e)))}const AF="Reader promise timed out";function MF({index:e=0}){const{token:t}=Kk(),a=Ae(Ny.cacheTTS),r=Ae(Ny.playbackRate),o=Ae(Ny.voice),i=Ae(Ny.activeRunFamily(e)),l=Ae(Ny.automaticPlayback),c=Ae(Ny.isSubmittingFamily(e)),d=Ae(Ny.latestMessageFamily(e)),u=Pe(Ny.globalAudioPlayingFamily(e)),[m,p]=Re(Ny.audioRunFamily(e)),[f,h]=Re(Ny.globalAudioFetchingFamily(e)),[g,x]=Re(Ny.globalAudioURLFamily(e)),{audioRef:v}=function({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect((()=>{let n=null,s=0;const a=()=>{e(!1),console.log("global audio ended"),t.current&&(t.current.customEnded=!0,URL.revokeObjectURL(t.current.src))},r=()=>{e(!0),console.log("global audio started"),t.current&&(t.current.customStarted=!0)},o=()=>{console.log("global audio paused"),t.current&&(t.current.customPaused=!0)},i=()=>{if(t.current){const e=t.current.currentTime;e===n?s+=1:s=0,n=e,s>=1&&(console.log("Detected end of audio based on time update"),t.current.pause(),a())}},l=t.current;return t.current&&(t.current.addEventListener("ended",a),t.current.addEventListener("play",r),t.current.addEventListener("pause",o),t.current.addEventListener("timeupdate",i),t.current.customProps={customStarted:!1,customEnded:!1,customPaused:!1}),()=>{l&&(l.removeEventListener("ended",a),l.removeEventListener("play",r),l.removeEventListener("pause",o),l.removeEventListener("timeupdate",i),URL.revokeObjectURL(l.src))}}),[e]),{audioRef:t}}({setIsPlaying:u}),{pauseGlobalAudio:b}=Cy(),{conversationId:_}=nt(),y="new"===_?_:(null==d?void 0:d.conversationId)??_??"",j=pr(),w=n.useCallback((()=>j.getQueryData([xx.messages,y])),[y,j]);return n.useEffect((()=>{const e=vb(d);!(null==t||!l||c||!d||d.isCreatedByUser||!e||!d.messageId||d.messageId.includes("_")||f||null==i||i===m)&&async function(){h(!0);try{v.current&&(v.current.pause(),URL.revokeObjectURL(v.current.src),x(null));let e=(null==d?void 0:d.text)??"";const n=await caches.open("tts-responses"),s=await n.match(e);if(p(i),s){s_.log("Audio found in cache");const e=await s.blob(),t=URL.createObjectURL(e);return x(t),void h(!1)}s_.log("Fetching audio...",navigator.userAgent);const r=await fetch("/api/files/speech/tts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({messageId:null==d?void 0:d.messageId,runId:i,voice:o})});if(!r.ok)throw new Error("Failed to fetch audio");if(!r.body)throw new Error("Null Response body");const l=r.body.getReader(),c="audio/mpeg",u="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(c);let m;u&&(m=new Hd(c),x(m.mediaSourceUrl));let f=!1;const g=[];for(;!f;){const e=l.read(),{value:t,done:n}=await Promise.race([e,PF(15e3,AF)]);a&&t&&g.push(t),t&&m&&m.addData(t),f=n}if(g.length){s_.log("Adding audio to cache");const t=(w()??[]).find((e=>e.messageId===(null==d?void 0:d.messageId)));if(e=(null==t?void 0:t.text)??"",!e)throw new Error("Cache key not found");const s=new Blob(g,{type:c}),a=new Response(s);if(await n.put(e,a),!u){const t=await n.match(e);if(!t)throw new Error("Failed to fetch audio from cache");const s=await t.blob(),a=URL.createObjectURL(s);x(a)}h(!1)}s_.log("Audio stream reading ended")}catch(e){if((null==e?void 0:e.message)!==AF)return void s_.log(AF);s_.error("Error fetching audio:",e),h(!1),x(null)}finally{h(!1)}}()}),[l,x,p,h,d,c,i,w,f,m,a,v,o,t]),n.useEffect((()=>{null!=r&&null!=g&&r>0&&v.current&&v.current.playbackRate!==r&&(v.current.playbackRate=r)}),[v,g,r]),n.useEffect((()=>{b()}),[_]),s_.log("StreamAudio.tsx - globalAudioURL:",g),s.jsx("audio",{ref:v,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:g??void 0,id:Qd,autoPlay:!0})}function LF({stop:e,setShowStopButton:t}){const n=Fk();return s.jsx(Ol,{description:n("com_nav_stop_generating"),render:s.jsx("button",{type:"button",className:n_("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"aria-label":n("com_nav_stop_generating"),onClick:n=>{t(!1),e(n)},children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-lg text-surface-primary",children:s.jsx("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1.25",fill:"currentColor"})})})})}const OF=S.memo(n.forwardRef(((e,t)=>{const n=Fk();return s.jsx(Ol,{description:n("com_nav_send_message"),render:s.jsx("button",{ref:t,"aria-label":n("com_nav_send_message"),id:"send-button",disabled:e.disabled,className:n_("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"data-testid":"send-button",type:"submit",children:s.jsx("span",{className:"","data-state":"closed",children:s.jsx(jc,{size:24})})})})}))),DF=S.memo(n.forwardRef(((e,t)=>{const n=$o({control:e.control});return s.jsx(OF,{ref:t,disabled:e.disabled||!n.text})}))),FF=S.memo((({isEditingChatBadges:e,handleCancelBadges:t,handleSaveBadges:a,setBadges:r})=>{const o=Fk(),i=(ZS()||[]).filter((e=>!e.isAvailable)),l=n.useCallback((e=>{r((t=>[...t,{id:e}]))}),[r]);return e?s.jsxs("div",{className:"m-1.5 flex flex-col overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:[s.jsxs("div",{className:"flex items-center gap-4 py-2 pl-3 pr-1.5 text-sm",children:[s.jsx("span",{className:"mt-0 flex size-6 flex-shrink-0 items-center justify-center",children:s.jsx("div",{className:"icon-md",children:s.jsx(Qe,{className:"icon-md","aria-hidden":"true"})})}),s.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:o("com_ui_save_badge_changes")}),s.jsxs("div",{className:"flex h-8 gap-2",children:[s.jsx(ki,{size:"sm",variant:"destructive","aria-label":"Cancel",onClick:t,className:"h-8",children:s.jsx(vt,{className:"icon-md","aria-hidden":"true"})}),s.jsx(ki,{size:"sm",variant:"submit","aria-label":"Save changes",onClick:a,className:"h-8 rounded-b-lg rounded-tr-xl",children:s.jsx(es,{className:"icon-md","aria-hidden":"true"})})]})]}),i&&i.length>0&&s.jsx("div",{className:"flex flex-wrap items-center gap-2 p-2",children:i.map((e=>s.jsx("div",{className:"badge-icon",children:s.jsx(Yl,{icon:e.icon,label:e.label,isAvailable:!1,isEditing:!0,onBadgeAction:()=>l(e.id)})},e.id)))})]}):null}));const zF=n.memo((function(){const e=Fk(),{codeInterpreter:t,codeApiKeyForm:n}=IS(),{toggleState:a,debouncedChange:r,isPinned:o}=t,{badgeTriggerRef:i}=n;return Wk({permissionType:hg.RUN_CODE,permission:gg.USE})?(a||o)&&s.jsx(Ld,{ref:i,className:"max-w-fit",checked:a,setValue:r,label:e("com_assistants_code_interpreter"),isCheckedClassName:"border-purple-600/40 bg-purple-500/10 hover:bg-purple-700/10",icon:s.jsx(Ve,{className:"icon-md"})}):null})),UF=S.forwardRef((({isArtifactsPinned:e,setIsArtifactsPinned:t,artifactsMode:n,handleArtifactsToggle:a,handleShadcnToggle:r,handleCustomToggle:o,...i},l)=>{const c=Fk(),d=te({focusLoop:!0,showTimeout:100,placement:"right"}),u=""!==n&&void 0!==n,m=n===$h.SHADCNUI,p=n===$h.CUSTOM;return s.jsx("div",{ref:l,children:s.jsxs(ne,{store:d,children:[s.jsxs(ce,{...i,hideOnClick:!1,render:s.jsx(ie,{onClick:e=>{e.stopPropagation(),a()},onMouseEnter:()=>{u&&d.show()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(us,{className:"icon-md"}),s.jsx("span",{children:c("com_ui_artifacts")}),u&&s.jsx(Vn,{className:"ml-auto h-3 w-3"})]}),s.jsx("button",{type:"button",onClick:n=>{n.stopPropagation(),t(!e)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!e&&"text-text-secondary hover:text-text-primary"),"aria-label":e?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(Cc,{unpin:e})})})]}),u&&s.jsx(re,{portal:!0,unmountOnHide:!0,className:n_("animate-popover-left z-50 ml-3 flex min-w-[250px] flex-col rounded-xl","border border-border-light bg-surface-secondary px-1.5 py-1 shadow-lg"),children:s.jsxs("div",{className:"px-2 py-1.5",children:[s.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:c("com_ui_artifacts_options")}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},disabled:p,className:n_("mb-1 flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer text-text-primary outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10",p&&"cursor-not-allowed opacity-50"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:m}),s.jsx("span",{className:"text-sm",children:c("com_ui_include_shadcnui")})]})}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),o()},className:n_("flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer text-text-primary outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:p}),s.jsx("span",{className:"text-sm",children:c("com_ui_custom_prompt_mode")})]})})]})})]})})}));UF.displayName="ArtifactsSubMenu";const VF=S.memo(UF),BF=S.forwardRef((({placeholder:e,...t},n)=>{const{mcpServerManager:a}=IS(),{isPinned:r,mcpValues:o,setIsPinned:i,isInitializing:l,placeholderText:c,configuredServers:d,getConfigDialogProps:u,toggleServerSelection:m,getServerStatusIconProps:p}=a,f=te({focusLoop:!0,showTimeout:100,placement:"right"});if(!d||0===d.length)return null;const h=u();return s.jsxs("div",{ref:n,children:[s.jsxs(ne,{store:f,children:[s.jsxs(ce,{...t,render:s.jsx(ie,{onClick:e=>{e.stopPropagation(),f.toggle()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Yc,{className:"icon-md"}),s.jsx("span",{children:e||c}),s.jsx(Vn,{className:"ml-auto h-3 w-3"})]}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),i(!r)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!r&&"text-text-secondary hover:text-text-primary"),"aria-label":r?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(Cc,{unpin:r})})})]}),s.jsx(re,{portal:!0,unmountOnHide:!0,className:n_("animate-popover-left z-50 ml-3 flex min-w-[200px] flex-col rounded-xl","border border-border-light bg-surface-secondary p-1 shadow-lg"),children:d.map((e=>{const t=p(e),n=(null==o?void 0:o.includes(e))??!1,a=l(e),r=t&&s.jsx(LR,{...t});return s.jsxs(ce,{onClick:t=>{t.preventDefault(),m(e)},disabled:a,className:n_("flex items-center gap-2 rounded-lg px-2 py-1.5 text-text-primary hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 justify-between text-sm",a&&"opacity-50 hover:bg-transparent dark:hover:bg-transparent"),children:[s.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[s.jsx(ms,{checked:n}),s.jsx("span",{children:e})]}),r&&s.jsx("div",{className:"ml-2 flex items-center",children:r})]},e)}))})]}),h&&s.jsx($R,{...h})]})}));BF.displayName="MCPSubMenu";const $F=S.memo(BF),HF=S.memo((({disabled:e})=>{var t,a;const r=Fk(),o=e??!1,[i,l]=n.useState(!1),{webSearch:c,artifacts:d,fileSearch:u,agentsConfig:m,mcpServerNames:p,codeApiKeyForm:f,codeInterpreter:h,searchApiKeyForm:g}=IS(),{data:x}=Ky(),{codeEnabled:v,webSearchEnabled:b,artifactsEnabled:_,fileSearchEnabled:y}=Bk((null==m?void 0:m.capabilities)??Sf),{setIsDialogOpen:j,menuTriggerRef:w}=f,{setIsDialogOpen:N,menuTriggerRef:C}=g,{isPinned:k,setIsPinned:S,authData:E}=c,{isPinned:T,setIsPinned:I,authData:R}=h,{isPinned:P,setIsPinned:A}=u,{isPinned:M,setIsPinned:L}=d,O=Wk({permissionType:hg.WEB_SEARCH,permission:gg.USE}),D=Wk({permissionType:hg.RUN_CODE,permission:gg.USE}),F=Wk({permissionType:hg.FILE_SEARCH,permission:gg.USE}),z=n.useMemo((()=>{const e=(null==E?void 0:E.authTypes)??[];return 0===e.length||!e.every((([,e])=>e===Mu.SYSTEM_DEFINED))}),[null==E?void 0:E.authTypes]),U=n.useMemo((()=>(null==R?void 0:R.message)!==Mu.SYSTEM_DEFINED),[null==R?void 0:R.message]),V=n.useCallback((()=>{const e=!c.toggleState;c.debouncedChange({value:e})}),[c]),B=n.useCallback((()=>{const e=!h.toggleState;h.debouncedChange({value:e})}),[h]),$=n.useCallback((()=>{const e=!u.toggleState;u.debouncedChange({value:e})}),[u]),H=n.useCallback((()=>{const e=d.toggleState;e&&""!==e?d.debouncedChange({value:""}):d.debouncedChange({value:$h.DEFAULT})}),[d]),G=n.useCallback((()=>{d.toggleState===$h.SHADCNUI?d.debouncedChange({value:$h.DEFAULT}):d.debouncedChange({value:$h.SHADCNUI})}),[d]),K=n.useCallback((()=>{d.toggleState===$h.CUSTOM?d.debouncedChange({value:$h.DEFAULT}):d.debouncedChange({value:$h.CUSTOM})}),[d]),W=null==(a=null==(t=null==x?void 0:x.interface)?void 0:t.mcpServers)?void 0:a.placeholder,q=[];if(y&&F&&q.push({onClick:$,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Xc,{className:"icon-md"}),s.jsx("span",{children:r("com_assistants_file_search")})]}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),A(!P)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!P&&"text-text-secondary hover:text-text-primary"),"aria-label":P?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(Cc,{unpin:P})})})]})}),O&&b&&q.push({onClick:V,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Wt,{className:"icon-md"}),s.jsx("span",{children:r("com_ui_web_search")})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[z&&s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),N(!0)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure web search",ref:C,children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(ze,{className:"h-4 w-4"})})}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),S(!k)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!k&&"text-text-secondary hover:text-text-primary"),"aria-label":k?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(Cc,{unpin:k})})})]})]})}),D&&v&&q.push({onClick:B,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ve,{className:"icon-md"}),s.jsx("span",{children:r("com_assistants_code_interpreter")})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[U&&s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),j(!0)},ref:w,className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure code interpreter",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(ze,{className:"h-4 w-4"})})}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),I(!T)},className:n_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!T&&"text-text-primary hover:text-text-primary"),"aria-label":T?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(Cc,{unpin:T})})})]})]})}),_&&q.push({hideOnClick:!1,render:e=>s.jsx(VF,{...e,isArtifactsPinned:M,setIsArtifactsPinned:L,artifactsMode:d.toggleState,handleArtifactsToggle:H,handleShadcnToggle:G,handleCustomToggle:K})}),p&&p.length>0&&q.push({hideOnClick:!1,render:e=>s.jsx($F,{...e,placeholder:W})}),0===q.length)return null;const Q=s.jsx(Ol,{render:s.jsx(ie,{disabled:o,id:"tools-dropdown-button","aria-label":"Tools Options",className:n_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(Jt,{className:"icon-md"})})}),id:"tools-dropdown-button",description:r("com_ui_tools"),disabled:o});return s.jsx(wd,{itemClassName:"flex w-full cursor-pointer rounded-lg items-center justify-between hover:bg-surface-hover gap-5",menuId:"tools-dropdown-menu",isOpen:i,setIsOpen:l,modal:!0,unmountOnHide:!0,trigger:Q,items:q,iconClassName:"mr-0"})}));function GF(){const{webSearch:e,codeInterpreter:t,searchApiKeyForm:a,codeApiKeyForm:r}=IS(),{authData:o}=e,{authData:i}=t,{methods:l,onSubmit:c,isDialogOpen:d,setIsDialogOpen:u,handleRevokeApiKey:m,badgeTriggerRef:p,menuTriggerRef:f}=a,{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:v,handleRevokeApiKey:b,badgeTriggerRef:_,menuTriggerRef:y}=r,j=n.useMemo((()=>(null==o?void 0:o.authTypes)??[]),[null==o?void 0:o.authTypes]),w=n.useMemo((()=>(null==i?void 0:i.message)??!1),[null==i?void 0:i.message]);return s.jsxs(s.Fragment,{children:[s.jsx(yR,{onSubmit:c,authTypes:j,isOpen:d,onRevoke:m,register:l.register,onOpenChange:u,handleSubmit:l.handleSubmit,triggerRefs:[f,p],isToolAuthenticated:(null==o?void 0:o.authenticated)??!1}),s.jsx(TR,{onSubmit:g,isOpen:x,onRevoke:b,register:h.register,onOpenChange:v,handleSubmit:h.handleSubmit,triggerRefs:[y,_],isUserProvided:w===Mu.USER_PROVIDED,isToolAuthenticated:(null==i?void 0:i.authenticated)??!1})]})}const KF=n.memo((function(){const e=Fk(),{fileSearch:t}=IS(),{toggleState:n,debouncedChange:a,isPinned:r}=t;return Wk({permissionType:hg.FILE_SEARCH,permission:gg.USE})?s.jsx(s.Fragment,{children:(n||r)&&s.jsx(Ld,{className:"max-w-fit",checked:n,setValue:a,label:e("com_assistants_file_search"),isCheckedClassName:"border-green-600/40 bg-green-500/10 hover:bg-green-700/10",icon:s.jsx(Xc,{className:"icon-md"})})}):null}));const WF=n.memo((function(){const e=Fk(),{artifacts:t}=IS(),{toggleState:a,debouncedChange:r,isPinned:o}=t,[i,l]=n.useState(!1),c=n.useMemo((()=>"string"==typeof a&&a?{enabled:!0,mode:a}:{enabled:!1,mode:""}),[a]),d=c.enabled,u=c.mode===$h.SHADCNUI,m=c.mode===$h.CUSTOM,p=n.useCallback((()=>{r(d?{value:""}:{value:$h.DEFAULT})}),[d,r]),f=n.useCallback((()=>{r(u?{value:$h.DEFAULT}:{value:$h.SHADCNUI})}),[u,r]),h=n.useCallback((()=>{r(m?{value:$h.DEFAULT}:{value:$h.CUSTOM})}),[m,r]);return d||o?s.jsxs("div",{className:"flex",children:[s.jsx(Ld,{className:n_("max-w-fit",d&&"rounded-r-none border-r-0"),checked:d,setValue:p,label:e("com_ui_artifacts"),isCheckedClassName:"border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10",icon:s.jsx(us,{className:"icon-md"})}),d&&s.jsxs(ne,{open:i,setOpen:l,children:[s.jsx(ie,{className:n_("w-7 rounded-l-none rounded-r-full border-b border-l-0 border-r border-t border-border-light md:w-6","border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10","transition-colors"),onClick:e=>e.stopPropagation(),children:s.jsx(Pt,{className:"ml-1 h-4 w-4 text-text-secondary md:ml-0"})}),s.jsx(re,{gutter:8,className:n_("animate-popover z-50 flex max-h-[300px]","flex-col overflow-auto overscroll-contain rounded-xl","bg-surface-secondary px-1.5 py-1 text-text-primary shadow-lg","border border-border-light","min-w-[250px] outline-none"),portal:!0,children:s.jsxs("div",{className:"px-2 py-1.5",children:[s.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:e("com_ui_artifacts_options")}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),f()},disabled:m,className:n_("mb-1 flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10",m&&"cursor-not-allowed opacity-50"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:u}),s.jsx("span",{className:"text-sm",children:e("com_ui_include_shadcnui")})]})}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),h()},className:n_("flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:m}),s.jsx("span",{className:"text-sm",children:e("com_ui_custom_prompt_mode")})]})})]})})]})]}):null}));function qF(){const{conversationId:e,mcpServerManager:t}=IS(),{localize:a,isPinned:r,mcpValues:o,isInitializing:i,placeholderText:l,configuredServers:c,batchToggleServers:d,getConfigDialogProps:u,getServerStatusIconProps:m}=t,p=n.useCallback(((e,t)=>0===e.length?t||a("com_ui_select")+"...":1===e.length?e[0]:a("com_ui_x_selected",{0:e.length})),[a]),f=n.useCallback(((e,t)=>{const n=m(e),a=i(e),r=s.jsx("button",{type:"button",className:"flex flex-grow items-center rounded bg-transparent p-0 text-left transition-colors focus:outline-none "+(a?"opacity-50":""),tabIndex:0,disabled:a,children:t}),o=n&&s.jsx(LR,{...n});return o?s.jsxs("div",{className:"flex w-full items-center justify-between",children:[r,s.jsx("div",{className:"ml-2 flex items-center",children:o})]}):r}),[m,i]);if(!(o&&0!==o.length||r))return null;if(!c||0===c.length)return null;const h=u();return s.jsxs(s.Fragment,{children:[s.jsx(jd,{items:c,selectedValues:o??[],setSelectedValues:d,renderSelectedValues:p,renderItemContent:f,placeholder:l,popoverClassName:"min-w-fit",className:"badge-icon min-w-fit",selectIcon:s.jsx(Yc,{className:"icon-md text-text-primary"}),selectItemsClassName:"border border-blue-600/50 bg-blue-500/10 hover:bg-blue-700/10",selectClassName:"group relative inline-flex items-center justify-center md:justify-start gap-1.5 rounded-full border border-border-medium text-sm font-medium transition-all md:w-full size-9 p-2 md:p-3 bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner"}),h&&s.jsx($R,{...h,conversationId:e})]})}const QF=n.memo((function(){const{mcpServerNames:e}=IS();return 0===((null==e?void 0:e.length)??0)?null:s.jsx(qF,{})}));const YF=n.memo((function(){const e=Fk(),{webSearch:t,searchApiKeyForm:n}=IS(),{toggleState:a,debouncedChange:r,isPinned:o,authData:i}=t,{badgeTriggerRef:l}=n;return Wk({permissionType:hg.WEB_SEARCH,permission:gg.USE})?(o||a&&(null==i?void 0:i.authenticated))&&s.jsx(Ld,{ref:l,className:"max-w-fit",checked:a,setValue:r,label:e("com_ui_search"),isCheckedClassName:"border-blue-600/40 bg-blue-500/10 hover:bg-blue-700/10",icon:s.jsx(Wt,{className:"icon-md"})}):null})),XF=S.memo(n.forwardRef((({badge:e,isEditing:t,isInChat:n,onToggle:a,onDelete:r,onMouseDown:o,badgeRefs:i},l)=>{const c=Ae(e.atom),d=!!e.atom&&c;return s.jsx("div",{ref:t=>{t&&(i.current[e.id]=t),"function"==typeof l?l(t):l&&(l.current=t)},onMouseDown:t=>o(t,e,d),className:t?"ios-wiggle badge-icon h-full":"badge-icon h-full",children:s.jsx(Yl,{id:e.id,icon:e.icon,label:e.label,isActive:d,isEditing:t,isAvailable:e.isAvailable,isInChat:n,onToggle:()=>a(e),onBadgeAction:()=>r(e.id)})})})),((e,t)=>e.badge.id===t.badge.id&&e.isEditing===t.isEditing&&e.isInChat===t.isInChat&&e.onToggle===t.onToggle&&e.onDelete===t.onDelete&&e.onMouseDown===t.onMouseDown&&e.badgeRefs===t.badgeRefs));XF.displayName="BadgeWrapper";const ZF=(e,t)=>{switch(t.type){case"START_DRAG":return{draggedBadge:t.badge,mouseX:t.mouseX,offsetX:t.offsetX,insertIndex:t.insertIndex,draggedBadgeActive:t.isActive};case"UPDATE_POSITION":return{...e,mouseX:t.mouseX,insertIndex:t.insertIndex};case"END_DRAG":return{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1};default:return e}};const JF=n.memo((function({showEphemeralBadges:e,conversationId:t,isSubmitting:a,onChange:r,onToggle:o,isInChat:i}){var l;const[c,d]=n.useState([]),[u,m]=n.useReducer(ZF,{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1}),p=n.useRef({}),f=n.useRef(null),h=n.useRef(null),g=n.useRef(null),x=ZS(),v=Ae(Ny.isEditingBadges),b=n.useMemo((()=>x.filter((e=>!1!==e.isAvailable))),[x]),_=Ie((({snapshot:e,set:t})=>async n=>{const s=await e.getPromise(n);t(n,!s)}),[]);n.useEffect((()=>{d((e=>{const t=new Set(e.map((e=>e.id))),n=b.filter((e=>!t.has(e.id)));return n.length>0?[...e,...n]:e}))}),[b]);const y=u.draggedBadge?c.filter((e=>{var t;return e.id!==(null==(t=u.draggedBadge)?void 0:t.id)})):c,j=u.draggedBadge||null,w=n.useCallback((e=>{if(!u.draggedBadge||!f.current||!g.current)return 0;const t=e-g.current.left,n=y.map((e=>p.current[e.id])).filter(Boolean);if(0===n.length)return 0;let s=0;for(let a=0;a<n.length;a++){const e=n[a].getBoundingClientRect();if(t<e.left-g.current.left+e.width/2)break;s=a+1}return s}),[u.draggedBadge,y]),N=n.useCallback(((e,t,n)=>{if(!v||!f.current)return;const s=p.current[t.id];if(!s)return;const a=s.getBoundingClientRect(),r=e.clientX-a.left,o=e.clientX,i=c.findIndex((e=>e.id===t.id));g.current=f.current.getBoundingClientRect(),m({type:"START_DRAG",badge:t,mouseX:o,offsetX:r,insertIndex:i,isActive:n})}),[v,c]),C=n.useCallback((e=>{u.draggedBadge&&(h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame((()=>{const t=e.clientX,n=w(t);n!==u.insertIndex?m({type:"UPDATE_POSITION",mouseX:t,insertIndex:n}):m({type:"UPDATE_POSITION",mouseX:t,insertIndex:u.insertIndex})})))}),[u.draggedBadge,u.insertIndex,w]),k=n.useCallback((()=>{if(u.draggedBadge&&null!==u.insertIndex){const e=c.filter((e=>{var t;return e.id!==(null==(t=u.draggedBadge)?void 0:t.id)})),t=[...e.slice(0,u.insertIndex),u.draggedBadge,...e.slice(u.insertIndex)];d(t),r(t.map((e=>({id:e.id}))))}m({type:"END_DRAG"}),g.current=null}),[u.draggedBadge,u.insertIndex,c,r]),E=n.useCallback((e=>{const t=c.filter((t=>t.id!==e));d(t),r(t.map((e=>({id:e.id}))))}),[c,r]),T=n.useCallback((e=>{e.atom&&_(e.atom),o&&o(e.id,!!e.atom)}),[_,o]);return n.useEffect((()=>{if(u.draggedBadge)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",k),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",k),h.current&&(cancelAnimationFrame(h.current),h.current=null)}}),[u.draggedBadge,C,k]),s.jsxs(RS,{conversationId:t,isSubmitting:a,children:[s.jsxs("div",{ref:f,className:"relative flex flex-wrap items-center gap-2",children:[!0===e&&s.jsx(HF,{}),y.map(((e,t)=>s.jsxs(S.Fragment,{children:[u.draggedBadge&&u.insertIndex===t&&j&&s.jsx("div",{className:"badge-icon h-full",children:s.jsx(Yl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isEditing:v,isAvailable:j.isAvailable,isInChat:i})}),s.jsx(XF,{badge:e,isEditing:v,isInChat:i,onToggle:T,onDelete:E,onMouseDown:N,badgeRefs:p})]},e.id))),u.draggedBadge&&u.insertIndex===y.length&&j&&s.jsx("div",{className:"badge-icon h-full",children:s.jsx(Yl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isEditing:v,isAvailable:j.isAvailable,isInChat:i})}),!0===e&&s.jsxs(s.Fragment,{children:[s.jsx(YF,{}),s.jsx(zF,{}),s.jsx(KF,{}),s.jsx(WF,{}),s.jsx(QF,{})]}),j&&s.jsx("div",{className:"ghost-badge h-full",style:{position:"absolute",top:0,left:0,transform:`translateX(${u.mouseX-u.offsetX-((null==(l=g.current)?void 0:l.left)||0)}px)`,zIndex:10,pointerEvents:"none"},children:s.jsx(Yl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isAvailable:j.isAvailable,isInChat:i,isEditing:!0,isDragging:!0})})]}),s.jsx(GF,{})]})}));function ez({presets:e,modelSpecs:t,assistantsMap:s,endpointsConfig:a,newConversation:r,returnHandlers:o}){const{conversation:i}=Pk(),l=Ik(),c=Ae(Ny.modularChat),d=Ae(Ny.availableTools),u=n.useCallback((e=>{var t,n;if(!e)return;const{preset:o}=e;o.iconURL=Pb(e),o.spec=e.name;const{endpoint:d}=o,u=d??"";if(!u)return;const{template:m,shouldSwitch:p,isNewModular:f,newEndpointType:h,isCurrentModular:g,isExistingConversation:x}=Tb({newEndpoint:u,modularChat:c,conversation:i,endpointsConfig:a});h&&(o.endpointType=h),Yu(u)&&null!=o.assistant_id&&!o.model&&(o.model=null==(n=null==(t=null==s?void 0:s[u])?void 0:t[o.assistant_id])?void 0:n.model);const v=g&&f&&p;if(x&&v){m.endpointType=h;const e=l({conversation:{...i??{},endpointType:m.endpointType},preset:m,cleanOutput:!0});return s_.info("conversation","Switching conversation to new spec (modular)",i),void r({template:e,preset:o,keepLatestMessage:!0,keepAddedConvos:!0})}s_.info("conversation","Switching conversation to new spec",i),r({template:{...m},preset:o,keepAddedConvos:v})}),[i,l,c,r,a,s]),m=n.useCallback(((e,t={})=>{const n=e??"";if(!n)return;const{shouldSwitch:s,isNewModular:o,isCurrentModular:d,isExistingConversation:u,newEndpointType:m,template:p}=Tb({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a}),f=t.model??"";f&&(p.model=f);const h=t.assistant_id??"";h&&(p.assistant_id=h);const g=t.agent_id??"";if(g&&(p.agent_id=g),p.spec=null,p.iconURL=null,p.modelLabel=null,u&&d&&o&&s){p.endpointType=m;const e=l({conversation:{...i??{},spec:null,iconURL:null,modelLabel:null,endpointType:p.endpointType},preset:p});return s_.info("conversation","Switching conversation to new endpoint/model (modular)",e),void r({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0})}s_.info("conversation","Switching conversation to new endpoint/model",p),r({template:{...p},preset:{...t,spec:null,iconURL:null,modelLabel:null,endpoint:n},keepAddedConvos:o})}),[i,l,c,r,a]),p=n.useCallback((e=>{if(!e)return;const t=ub(e,d),n=t.endpoint??"",{template:s,shouldSwitch:o,isNewModular:u,newEndpointType:m,isCurrentModular:p,isExistingConversation:f}=Tb({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a});t.spec=null,t.iconURL=t.iconURL??null,t.modelLabel=t.modelLabel??null;const h=p&&u&&o,g=!0===t.defaultPreset;if(f&&h){s.endpointType=m,s.spec=null,s.iconURL=null,s.modelLabel=null;const e=l({conversation:{...i??{},endpointType:s.endpointType},preset:s,cleanInput:!0});return s_.info("conversation","Switching conversation to new preset (modular)",e),void r({template:e,preset:t,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:g})}s_.info("conversation","Switching conversation to new preset",s),r({preset:t,keepAddedConvos:h,disableParams:g})}),[c,i,d,r,a,l]),f=n.useCallback((n=>{var a,r;const o=n.value;if("preset"===n.type){const t=null==e?void 0:e.find((e=>e.presetId===o));p(t)}else if("modelSpec"===n.type){const e=t.find((e=>e.name===o));u(e)}else"model"===n.type?m(o,{model:n.label}):"endpoint"===n.type?m(o):Yu(n.type)?m(n.type,{assistant_id:o,model:(null==(r=null==(a=null==s?void 0:s[n.type])?void 0:a[o])?void 0:r.model)??""}):Xu(n.type)&&m(n.type,{agent_id:o})}),[t,m,p,u,e,s]);return o?{onSelectSpec:u,onSelectEndpoint:m}:{onSelectMention:f}}const tz=lh().interface,nz=({endpoint:e,assistantMap:t,endpointsConfig:n})=>({id:s,name:a,description:r})=>({type:e,label:a??"",value:s,description:r??"",icon:GI({conversation:{assistant_id:s,endpoint:e},endpointsConfig:n,context:"menu-item",assistantMap:t})});function sz({setShowMentionPopover:e,newConversation:t,textAreaRef:a,commandChar:r="@",placeholder:o="com_ui_mention",includeAssistants:i=!0}){const l=Fk(),c=xS(),{options:d,presets:u,modelSpecs:m,agentsList:p,modelsConfig:f,endpointsConfig:h,assistantListMap:g}=function({assistantMap:e,includeAssistants:t}){const s=Wk({permissionType:hg.AGENTS,permission:gg.USE}),a=Dk(),{data:r}=uj(),{data:o}=mk(),{data:i}=Ky(),{data:l}=Gy(),{data:c=[]}=Gy({select:Sb}),d=Mk((e=>e.data.map((({id:e,name:t,description:n})=>({id:e,name:t,description:n}))))),u=n.useMemo((()=>(null==i?void 0:i.interface)??tz),[null==i?void 0:i.interface]),{data:m=null}=Ry({requiredPermission:px.VIEW},{enabled:s&&!0===u.modelSelect,select:e=>{const{data:t}=e;return t.map((({id:e,name:t,avatar:n})=>({value:e,label:t??"",type:Uu.agents,icon:GI({conversation:{endpoint:Uu.agents,iconURL:null==n?void 0:n.filepath},endpointsConfig:l,context:"menu-item"})})))}}),p=n.useMemo((()=>{var t,n;return{[Uu.assistants]:null==(t=d[Uu.assistants])?void 0:t.map(nz({endpoint:Uu.assistants,assistantMap:e,endpointsConfig:l})).filter(Boolean),[Uu.azureAssistants]:null==(n=d[Uu.azureAssistants])?void 0:n.map(nz({endpoint:Uu.azureAssistants,assistantMap:e,endpointsConfig:l})).filter(Boolean)}}),[d,e,l]),f=n.useMemo((()=>{var e;const t=(null==(e=null==i?void 0:i.modelSpecs)?void 0:e.list)??[];return a?t.filter((e=>{var t,n;return(null==(t=e.preset)?void 0:t.endpoint)!==Uu.agents||!(null==(n=e.preset)?void 0:n.agent_id)||e.preset.agent_id in a})):t}),[i,a]);return{options:n.useMemo((()=>{var n;let s=c;t||(s=c.filter((e=>!Yu(e))));const a=s.flatMap((e=>Yu(e)||Xu(e)||!0!==u.modelSelect?[]:((null==o?void 0:o[e])??[]).map((t=>({value:e,label:t,type:"model",icon:GI({conversation:{endpoint:e,model:t},endpointsConfig:l,context:"menu-item"})})))));return[...(f.length>0?f:[]).map((e=>({value:e.name,label:e.label,description:e.description,icon:GI({conversation:{...e.preset,iconURL:e.iconURL},endpointsConfig:l,context:"menu-item"}),type:"modelSpec"}))),...(!0===u.modelSelect?s:[]).map((e=>({value:e,label:uh[e]??e??"",type:"endpoint",icon:GI({conversation:{endpoint:e},endpointsConfig:l,context:"menu-item"})}))),...!0===u.modelSelect?m??[]:[],...(null==l?void 0:l[Uu.assistants])&&t&&!0===u.modelSelect&&p[Uu.assistants]||[],...(null==l?void 0:l[Uu.azureAssistants])&&t&&!0===u.modelSelect&&p[Uu.azureAssistants]||[],...(null==(n=!0===u.modelSelect&&!0===u.presets?r:[])?void 0:n.map(((t,n)=>({value:t.presetId??`preset-${n}`,label:t.title??t.modelLabel??t.chatGptLabel??"",description:db(t,!0),icon:GI({conversation:t,endpointsConfig:l,context:"menu-item",assistantMap:e}),type:"preset"}))))??[],...a]}),[r,c,f,m,e,o,l,p,t,u.presets,u.modelSelect]),presets:r,modelSpecs:f,agentsList:m,modelsConfig:o,endpointsConfig:l,assistantListMap:p}}({assistantMap:c||{},includeAssistants:i}),{onSelectMention:x}=ez({presets:u,modelSpecs:m,assistantsMap:c,endpointsConfig:h,newConversation:t}),[v,b]=n.useState(0),_=n.useRef(null),y=n.useRef(null),[j,w]=n.useState(d),{open:N,setOpen:C,searchValue:k,setSearchValue:S,matches:E}=Hi({value:"",options:j}),T=t=>{var n,s,o,i;if(!t)return;if("endpoint"===t.type&&t.value===Uu.agents)S(""),w(p??[]),b(0),null==(n=y.current)||n.focus();else if("endpoint"===t.type&&t.value===Uu.assistants)S(""),w(g[Uu.assistants]??[]),b(0),null==(s=y.current)||s.focus();else if("endpoint"===t.type&&t.value===Uu.azureAssistants)S(""),w(g[Uu.azureAssistants]??[]),b(0),null==(o=y.current)||o.focus();else if("endpoint"===t.type){const e=((null==f?void 0:f[t.value||""])??[]).map((e=>({value:t.value,label:e,type:"model"})));b(0),S(""),w(e),null==(i=y.current)||i.focus()}else S(""),C(!1),e(!1),null==x||x(t),a.current&&gb(a.current,r)};n.useEffect((()=>{N||(w(d),b(0))}),[N,d]),n.useEffect((()=>()=>{_.current&&clearTimeout(_.current)}),[]);const I="@"!==r?"add-convo":"mention";n.useEffect((()=>{const e=document.getElementById(`${I}-item-${v}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[I,v]);const R=({index:e,key:t,style:n})=>{const a=E[e];return s.jsx(kF,{type:I,index:e,style:n,onClick:e=>{e.preventDefault(),e.stopPropagation(),_.current&&clearTimeout(_.current),_.current=null,T(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===v},t)};return s.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:s.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-white p-2 shadow-lg dark:bg-gray-700",children:[s.jsx("input",{autoFocus:!0,ref:y,placeholder:l(o),className:"mb-1 w-full border-0 bg-white p-2 text-sm focus:outline-none dark:bg-gray-700 dark:text-gray-200",autoComplete:"off",value:k,onKeyDown:t=>{var n,s;if("Escape"===t.key&&(C(!1),e(!1),null==(n=a.current)||n.focus()),"ArrowDown"===t.key)b((e=>(e+1)%E.length));else if("ArrowUp"===t.key)b((e=>(e-1+E.length)%E.length));else if("Enter"===t.key||"Tab"===t.key){const e=E[v];("endpoint"===(null==e?void 0:e.type)||"Enter"===t.key)&&t.preventDefault(),T(E[v])}else"Backspace"===t.key&&""===k&&(C(!1),e(!1),null==(s=a.current)||s.focus())},onChange:e=>S(e.target.value),onFocus:()=>C(!0),onBlur:()=>{_.current=setTimeout((()=>{C(!1),e(!1)}),150)}}),N&&s.jsx("div",{className:"max-h-40",children:s.jsx($r,{disableHeight:!0,children:({width:e})=>s.jsx(Hr,{width:e,overscanRowCount:5,rowHeight:40,rowCount:E.length,rowRenderer:R,scrollToIndex:v,height:Math.min(40*E.length,160)})})})]})})}const az=n.memo((({index:e=0})=>{var t;const a=n.useRef(null),r=n.useRef(null);!function(e){var t;const s=De(),a=Fe();n.useEffect((()=>{var t,n,r;(null==e?void 0:e.current)&&(null==(t=s.state)?void 0:t.focusChat)&&(s_.log("conversation",`Focusing textarea on location state change: ${s.pathname}`),(null==(n=window.matchMedia)?void 0:n.call(window,"(pointer: coarse)").matches)||null==(r=e.current)||r.focus(),a(`${s.pathname}${window.location.search??""}`,{replace:!0,state:{}}))}),[a,e,s.pathname,null==(t=s.state)?void 0:t.focusChat])}(r);const[o,i]=n.useState(!1),[,l]=n.useState(!1),[c,d]=n.useState(1),[u,m]=n.useState(!1),[p,f]=n.useState([]),h=Ae(Ny.speechToText),g=Ae(Ny.textToSpeech),x=Ae(Ny.chatDirection),v=Ae(Ny.automaticPlayback),b=Ae(Ny.maximizeChatSpace),_=Ae(Ny.centerFormOnLanding),y=Ae(Ny.isTemporary),[j,w]=Re(Ny.chatBadges),[N,C]=Re(Ny.isEditingBadges),[k,S]=Re(Ny.showStopButtonByIndex(e)),[E,T]=Re(Ny.showPlusPopoverFamily(e)),[I,R]=Re(Ny.showMentionPopoverFamily(e)),{requiresKey:P}=function(){const{conversation:e}=Pk(),{data:t}=Gy(),{endpoint:n}=e||{},s=kb(t,n,"userProvide"),{getExpiry:a}=qS(n??"");return{requiresKey:!a()&&s}}(),A=cS(),{files:M,setFiles:L,conversation:O,isSubmitting:D,filesLoading:F,newConversation:z,handleStopGenerating:U}=Pk(),{addedIndex:V,generateConversation:B,conversation:$,setConversation:H,isSubmitting:G}=aS(),K=xS(),W=Ae(Ny.showStopButtonByIndex(V)),q=n.useMemo((()=>(null==O?void 0:O.endpointType)??(null==O?void 0:O.endpoint)),[null==O?void 0:O.endpointType,null==O?void 0:O.endpoint]),Q=n.useMemo((()=>(null==O?void 0:O.conversationId)??Sh.NEW_CONVO),[null==O?void 0:O.conversationId]),Y=n.useMemo((()=>null!=x&&"rtl"===(null==x?void 0:x.toLowerCase())),[x]),X=n.useMemo((()=>{var e;return Yu(q)&&(!(null==O?void 0:O.assistant_id)||!(null==(e=null==K?void 0:K[q??""])?void 0:e[(null==O?void 0:O.assistant_id)??""]))}),[null==O?void 0:O.assistant_id,q,K]),Z=n.useMemo((()=>P||X),[P,X]),J=n.useCallback((()=>{var e,t;(null==(e=window.matchMedia)?void 0:e.call(window,"(pointer: coarse)").matches)||null==(t=r.current)||t.focus()}),[]),ee=n.useCallback((()=>{o&&i(!1)}),[o]);(({isSubmitting:e,conversationId:t,textAreaRef:s,setFiles:a,files:r})=>{const{setValue:o}=cS(),i=Ae(Ny.saveDrafts),l=e?Sh.PENDING_CONVO:t,[c,d]=n.useState(null),u=n.useMemo((()=>Array.from(r.keys())),[r]),{data:m}=qy(),p=n.useCallback((e=>{const t=JSON.parse((localStorage.getItem(`${Eh.FILES_DRAFT}${e}`)??"")||"[]");0!==t.length?t.forEach((e=>{const t=null==m?void 0:m.find((t=>t.file_id===e)),n=null==m?void 0:m.find((t=>t.temp_file_id===e)),{fileToRecover:s,fileIdToRecover:r}=t?{fileToRecover:t,fileIdToRecover:e}:{fileToRecover:n,fileIdToRecover:((null==n?void 0:n.temp_file_id)??"")||e};s&&a((e=>{const t=new Map(e);return t.set(r,{...s,progress:1,attached:!0,size:s.bytes}),t}))})):a(new Map)}),[m,a]),f=n.useCallback((e=>{const t=eb(e);t&&o("text",t)}),[o]),h=n.useCallback((e=>{(null==s?void 0:s.current)&&(""===s.current.value||1===s.current.value.length?Zv(e):Jv({id:e,value:s.current.value}))}),[s]);n.useEffect((()=>{if(!i||null==l||""===l)return;const e=ko((e=>Jv({id:l,value:e})),750),t=t=>{const n=t.target;e(n.value)},n=null==s?void 0:s.current;return n&&n.addEventListener("input",t),()=>{n&&n.removeEventListener("input",t),e.cancel()}}),[l,i,s]);const g=n.useRef(null);n.useEffect((()=>{var e;if(i&&null!=l&&""!==l&&l!==c){a(new Map);try{if(g.current===Sh.PENDING_CONVO&&l!==Sh.PENDING_CONVO&&l.length>3){const t=localStorage.getItem(`${Eh.TEXT_DRAFT}${Sh.PENDING_CONVO}`);localStorage.removeItem(`${Eh.TEXT_DRAFT}${Sh.PENDING_CONVO}`),t?localStorage.setItem(`${Eh.TEXT_DRAFT}${l}`,t):(null==(e=null==s?void 0:s.current)?void 0:e.value)&&Jv({id:l,value:s.current.value});const n=localStorage.getItem(`${Eh.FILES_DRAFT}${Sh.PENDING_CONVO}`);n&&(localStorage.setItem(`${Eh.FILES_DRAFT}${l}`,n),localStorage.removeItem(`${Eh.FILES_DRAFT}${Sh.PENDING_CONVO}`),JSON.parse(n||"[]").length>0&&p(l))}else null!=c&&c&&h(c);f(l),p(l)}catch(Di){console.error(Di)}g.current=l,d(l)}}),[c,l,p,s,f,i,h,a]),n.useEffect((()=>{i&&null!=l&&""!==l&&c===l&&(0===u.length?localStorage.removeItem(`${Eh.FILES_DRAFT}${l}`):localStorage.setItem(`${Eh.FILES_DRAFT}${l}`,JSON.stringify(u)))}),[r,l,i,c,u])})({files:M,setFiles:L,textAreaRef:r,conversationId:Q,isSubmitting:D||G});const{submitMessage:te,submitPrompt:ne}=VE(),se=(({index:e,textAreaRef:t,setShowPlusPopover:s,setShowMentionPopover:a})=>{const r=Wk({permissionType:hg.PROMPTS,permission:gg.USE}),o=Wk({permissionType:hg.MULTI_CONVO,permission:gg.USE}),i=Ae(Ny.latestMessageFamily(e)),l=Pe(Ny.showPromptsPopoverFamily(e)),c=Ae(Ny.atCommand),d=Ae(Ny.plusCommand),u=Ae(Ny.slashCommand),m=n.useCallback((()=>{c&&RE(t,"@")&&a(!0)}),[t,a,c]),p=n.useCallback((()=>{o&&d&&RE(t,"+")&&s(!0)}),[t,s,d,o]),f=n.useCallback((()=>{r&&u&&RE(t,"/")&&l(!0)}),[t,r,l,u]),h=n.useMemo((()=>({"@":m,"+":p,"/":f})),[m,p,f]),g=n.useCallback((e=>{if(!i)return;const t=document.getElementById(`edit-${i.parentMessageId}`);t&&(e.preventDefault(),t.click())}),[i]);return n.useCallback((e=>{var n;const s=null==(n=t.current)?void 0:n.value;if("ArrowUp"===e.key&&0===(null==s?void 0:s.length))return void g(e);if("string"!=typeof s||0===s.length)return;if(IE[e.key])return;const a=s[0],r=h[a];"function"==typeof r&&r()}),[t,h,g])})({index:e,textAreaRef:r,setShowPlusPopover:T,setShowMentionPopover:R}),{isNotAppendable:ae,handlePaste:re,handleKeyDown:oe,handleCompositionStart:ie,handleCompositionEnd:le}=SE({textAreaRef:r,submitButtonRef:a,setIsScrollable:l,disabled:Z});TE({textAreaRef:r});const{ref:ce,...de}=A.register("text",{required:!0,onChange:n.useCallback((e=>A.setValue("text",e.target.value,{shouldValidate:!0})),[A])}),ue=$o({control:A.control,name:"text"});n.useEffect((()=>{if(r.current){const e=window.getComputedStyle(r.current),t=parseFloat(e.lineHeight);d(Math.floor(r.current.scrollHeight/t))}}),[ue]),n.useEffect((()=>{N&&0===p.length&&f([...j])}),[N,j,p.length]);const me=n.useCallback((()=>{C(!1),f([])}),[C,f]),pe=n.useCallback((()=>{p.length>0&&w([...p]),C(!1),f([])}),[p,w,C]),fe=c>3,he=n.useMemo((()=>n_("md:py-3.5 m-0 w-full resize-none py-[13px] placeholder-black/50 bg-transparent dark:placeholder-white/50 [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",o?"max-h-[52px]":"max-h-[45vh] md:max-h-[55vh]",fe?"pl-5":"px-5")),[o,fe]);return s.jsx("form",{onSubmit:A.handleSubmit(te),className:n_("mx-auto flex w-full flex-row gap-3 transition-[max-width] duration-300 sm:px-2",b?"max-w-full":"md:max-w-3xl xl:max-w-4xl",!_||null!=Q&&Q!==Sh.NEW_CONVO||D||0!==(null==(t=null==O?void 0:O.messages)?void 0:t.length)?"sm:mb-10":"transition-all duration-200 sm:mb-28"),children:s.jsx("div",{className:"relative flex h-full flex-1 items-stretch md:flex-col",children:s.jsxs("div",{className:n_("flex w-full items-center",Y&&"flex-row-reverse"),children:[E&&!Yu(q)&&s.jsx(sz,{setShowMentionPopover:T,newConversation:B,textAreaRef:r,commandChar:"+",placeholder:"com_ui_add_model_preset",includeAssistants:!1}),I&&s.jsx(sz,{setShowMentionPopover:R,newConversation:z,textAreaRef:r}),s.jsx(EF,{index:e,textAreaRef:r,submitPrompt:ne}),s.jsxs("div",{onClick:J,className:n_("relative flex w-full flex-grow flex-col overflow-hidden rounded-t-3xl border pb-4 text-text-primary transition-all duration-200 sm:rounded-3xl sm:pb-0",u?"shadow-lg":"shadow-md",y?"border-violet-800/60 bg-violet-950/10":"border-border-light bg-surface-chat"),children:[s.jsx(CF,{addedConvo:$,setAddedConvo:H}),s.jsx(FF,{isEditingChatBadges:N,handleCancelBadges:pe,handleSaveBadges:me,setBadges:w}),s.jsx(wF,{conversation:O}),q&&s.jsxs("div",{className:n_("flex",Y?"flex-row-reverse":"flex-row"),children:[s.jsx(Ml,{...de,ref:e=>{ce(e),r.current=e},disabled:Z||ae,onPaste:re,onKeyDown:oe,onKeyUp:se,onCompositionStart:ie,onCompositionEnd:le,id:qd,tabIndex:0,"data-testid":"text-input",rows:1,onFocus:()=>{ee(),m(!0)},onBlur:m.bind(null,!1),onClick:ee,style:{height:44,overflowY:"auto"},className:n_(he,m_,"transition-[max-height] duration-200 disabled:cursor-not-allowed")}),s.jsx("div",{className:"flex flex-col items-start justify-start pt-1.5",children:s.jsx(RF,{isCollapsed:o,isScrollable:fe,setIsCollapsed:i})})]}),s.jsxs("div",{className:n_("items-between flex gap-2 pb-2",Y?"flex-row-reverse":"flex-row"),children:[s.jsx("div",{className:""+(Y?"mr-2":"ml-2"),children:s.jsx(jF,{conversation:O,disableInputs:Z})}),s.jsx(JF,{showEphemeralBadges:!Xu(q)&&!Yu(q),isSubmitting:D||G,conversationId:Q,onChange:w,isInChat:Array.isArray(null==O?void 0:O.messages)&&O.messages.length>=1}),s.jsx("div",{className:"mx-auto flex"}),h&&s.jsx(IF,{methods:A,ask:te,textAreaRef:r,disabled:Z||ae,isSubmitting:D}),s.jsx("div",{className:""+(Y?"ml-2":"mr-2"),children:(D||G)&&(k||W)?s.jsx(LF,{stop:U,setShowStopButton:S}):q&&s.jsx(DF,{ref:a,control:A.control,disabled:F||D||Z||ae})})]}),g&&v&&s.jsx(MF,{index:e})]})]})})})})),rz="shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white dark:bg-presentation dark:text-white text-black dark:after:shadow-none ";function oz(e){return e?e.length<40?"text-2xl sm:text-4xl":e.length<70?"text-xl sm:text-2xl":"text-lg sm:text-md":"text-xl sm:text-2xl"}function iz({centerFormOnLanding:e}){var t,a;const{conversation:r}=Pk(),o=Dk(),i=xS(),{data:l}=Ky(),{data:c}=Gy(),{user:d}=Kk(),u=Fk(),[m,p]=n.useState(!1),[f,h]=n.useState(1),[g,x]=n.useState(0),v=n.useRef(null),b=n.useMemo((()=>{let e=(null==r?void 0:r.endpoint)??"";return[Uu.chatGPTBrowser,Uu.azureOpenAI,Uu.gptPlugins].includes(e)&&(e=Uu.openAI),Ab({endpointsConfig:c,iconURL:null==r?void 0:r.iconURL,endpoint:e})}),[null==r?void 0:r.endpoint,null==r?void 0:r.iconURL,c]),{entity:_,isAgent:y,isAssistant:j}=Lb({endpoint:b,agentsMap:o,assistantMap:i,agent_id:null==r?void 0:r.agent_id,assistant_id:null==r?void 0:r.assistant_id}),w=(null==_?void 0:_.name)??"",N=((null==_?void 0:_.description)||(null==r?void 0:r.greeting))??"",C=n.useCallback((()=>{var e;if("string"==typeof(null==(e=null==l?void 0:l.interface)?void 0:e.customWelcome)){const e=l.interface.customWelcome;return(null==d?void 0:d.name)&&e.includes("{{user.name}}")?e.replace(/{{user.name}}/g,d.name):e}const t=new Date,n=t.getHours(),s=t.getDay();return u(n>=0&&n<5?"com_ui_late_night":n<12?0===s||6===s?"com_ui_weekend_morning":"com_ui_good_morning":n<17?"com_ui_good_afternoon":"com_ui_good_evening")}),[u,null==(t=null==l?void 0:l.interface)?void 0:t.customWelcome,null==d?void 0:d.name]),k=n.useCallback((e=>{p(e>1),h(e)}),[]);n.useEffect((()=>{v.current&&x(v.current.offsetHeight)}),[f,N]);const S=n.useMemo((()=>{let e="mb-0";return f>2||N&&N.length>100?e="mb-10":f>1||N&&N.length>0?e="mb-6":m&&(e="mb-4"),g>200?e="mb-16":g>150&&(e="mb-12"),e}),[f,N,m,g]),E="string"==typeof(null==(a=null==l?void 0:l.interface)?void 0:a.customWelcome)?C():C()+((null==d?void 0:d.name)?", "+d.name:"");return s.jsx("div",{className:`flex h-full transform-gpu flex-col items-center justify-center pb-16 transition-all duration-200 ${e?"max-h-full sm:max-h-0":"max-h-full"} ${S}`,children:s.jsxs("div",{ref:v,className:"flex flex-col items-center gap-0 p-2",children:[s.jsxs("div",{className:`flex ${m?"flex-col":"flex-col md:flex-row"} items-center justify-center gap-2`,children:[s.jsxs("div",{className:"relative size-10 justify-center "+(m?"mb-2":""),children:[s.jsx(HI,{agentsMap:o,assistantMap:i,conversation:r,endpointsConfig:c,containerClassName:rz,context:"landing",className:"h-2/3 w-2/3 text-black dark:text-white",size:41}),(null==l?void 0:l.showBirthdayIcon)&&s.jsx(Ol,{className:"absolute bottom-[27px] right-2",description:u("com_ui_happy_birthday"),children:s.jsx(zc,{})})]}),(y||j)&&w||w?s.jsx("div",{className:"flex flex-col items-center gap-0 p-2",children:s.jsx(id,{text:w,className:`${oz(w)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:zr.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${w}`)}):s.jsx(id,{text:E,className:`${oz(E)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:zr.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${E}${(null==d?void 0:d.name)?"-user":""}`)]}),N&&s.jsx("div",{className:"animate-fadeIn mt-4 max-w-md text-center text-sm font-normal text-text-primary",children:N})]})})}const lz=n.createContext(void 0);function cz({children:e}){const{conversation:t,newConversation:a}=Pk(),r=n.useMemo((()=>({endpoint:null==t?void 0:t.endpoint,model:null==t?void 0:t.model,spec:null==t?void 0:t.spec,agent_id:null==t?void 0:t.agent_id,assistant_id:null==t?void 0:t.assistant_id,newConversation:a})),[null==t?void 0:t.endpoint,null==t?void 0:t.model,null==t?void 0:t.spec,null==t?void 0:t.agent_id,null==t?void 0:t.assistant_id,a]);return s.jsx(lz.Provider,{value:r,children:e})}const dz=n.memo((({currentSpec:e,endpointsConfig:t})=>{const n=Pb(e),{endpoint:a}=e.preset,r=kb(t,a,"iconURL"),o=Mb({endpoint:a,endpointsConfig:t,endpointIconURL:r});let i;if(n.includes("http")){if(n)return s.jsx(fI,{iconURL:n,altName:e.name,containerStyle:{width:20,height:20},className:"icon-md shrink-0 overflow-hidden rounded-full",endpoint:a||void 0});i=kT[a??""]??kT[o]??kT.unknown}else i=kT[n]??kT[o]??kT.unknown;return s.jsx(i,{size:20,endpoint:a,context:"menu-item",iconURL:r,className:"icon-md shrink-0 text-text-primary"})}));const uz=({localize:e,mappedEndpoints:t,selectedValues:n,modelSpecs:s,agentsMap:a})=>{if(n.modelSpec){const t=s.find((e=>e.name===n.modelSpec));return(null==t?void 0:t.label)||(null==t?void 0:t.name)||e("com_ui_select_model")}if(n.model&&n.endpoint){const s=t.find((e=>e.value===n.endpoint));if(!s)return e("com_ui_select_model");if(Xu(s.value)&&s.agentNames&&s.agentNames[n.model])return s.agentNames[n.model];if(Xu(s.value)&&a){const e=a[n.model];return(null==e?void 0:e.name)||n.model}return Yu(s.value)&&s.assistantNames&&s.assistantNames[n.model]?s.assistantNames[n.model]:n.model}if(n.endpoint){const s=t.find((e=>e.value===n.endpoint));return(null==s?void 0:s.label)||e("com_ui_select_model")}return e("com_ui_select_model")},mz=n.createContext(void 0);function pz(){const e=n.useContext(mz);if(void 0===e)throw new Error("useModelSelectorContext must be used within a ModelSelectorProvider");return e}function fz({children:e,startupConfig:t}){const a=Dk(),r=xS(),{data:o}=Gy(),{endpoint:i,model:l,spec:c,agent_id:d,assistant_id:u,newConversation:m}=function(){const e=n.useContext(lz);if(!e)throw new Error("useModelSelectorChatContext must be used within ModelSelectorChatProvider");return e}(),p=n.useMemo((()=>{var e;const n=(null==(e=null==t?void 0:t.modelSpecs)?void 0:e.list)??[];return a?n.filter((e=>{var t,n;return(null==(t=e.preset)?void 0:t.endpoint)!==Uu.agents||!(null==(n=e.preset)?void 0:n.agent_id)||e.preset.agent_id in a})):n}),[t,a]),f=qk(),{data:h=null}=Ry({requiredPermission:f},{select:e=>null==e?void 0:e.data}),{mappedEndpoints:g,endpointRequiresUserKey:x}=ST({agents:h,assistantsMap:r,startupConfig:t,endpointsConfig:o}),{onSelectEndpoint:v,onSelectSpec:b}=ez({modelSpecs:p,assistantsMap:r,endpointsConfig:o,newConversation:m,returnHandlers:!0}),[_,y]=n.useState({endpoint:i||"",model:l||"",modelSpec:c||""});!function({index:e=0,agentsMap:t,conversation:s,assistantsMap:a,setSelectedValues:r}){const{setOption:o}=lE(),i=n.useMemo((()=>Object.values(t??{})),[t]),{agent_id:l=null,assistant_id:c=null,endpoint:d}=s??{},u=n.useMemo((()=>Yu(d)?Object.values((null==a?void 0:a[d??""])??{}):[]),[a,d]);n.useEffect((()=>{var n;if(Xu(d)&&null==l&&i.length>0){let s=localStorage.getItem(`${Eh.AGENT_ID_PREFIX}${e}`);null==s&&(s=null==(n=i[0])?void 0:n.id),void 0!==(null==t?void 0:t[s])&&(o("model")(""),o("agent_id")(s))}}),[e,i,l,t,d,o]),n.useEffect((()=>{var t,n;if(Yu(d)&&null==c&&u.length>0){let s=localStorage.getItem(`${Eh.ASST_ID_PREFIX}${e}`);null==s&&(s=null==(t=u[0])?void 0:t.id);const r=null==(n=null==a?void 0:a[d??""])?void 0:n[s];void 0!==r&&(o("model")(r.model),o("assistant_id")(s))}}),[e,u,c,a,d,o]);const m=n.useRef(null),p=e=>{m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{r(e)}),150)};n.useEffect((()=>{if(null==s?void 0:s.endpoint){if((null==s?void 0:s.assistant_id)||(null==s?void 0:s.agent_id)||(null==s?void 0:s.model)||(null==s?void 0:s.spec)){if(Xu(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.agent_id??"",modelSpec:s.spec||""});if(Yu(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.assistant_id||"",modelSpec:s.spec||""});p({endpoint:s.endpoint||"",model:s.model||"",modelSpec:s.spec||""})}return()=>{m.current&&clearTimeout(m.current)}}}),[null==s?void 0:s.spec,null==s?void 0:s.model,null==s?void 0:s.endpoint,null==s?void 0:s.agent_id,null==s?void 0:s.assistant_id])}({agentsMap:a,conversation:i?{endpoint:i??null,model:l??null,spec:c??null,agent_id:d??null,assistant_id:u??null}:null,assistantsMap:r,setSelectedValues:y});const[j,w]=n.useState(""),[N,C]=n.useState({}),k=_T(),S=n.useMemo((()=>{if(!j)return null;return function(e,t,n,s){const a=t.trim().toLowerCase();return a?e.filter((e=>!!(e.label.toLowerCase().includes(a)||e.name&&e.name.toLowerCase().includes(a)||e.value&&e.value.toLowerCase().includes(a))||!!(e.models&&e.models.length>0)&&e.models.some((t=>{var r;if(t.name.toLowerCase().includes(a))return!0;if(Xu(e.value)&&n&&t.name in n){const e=null==(r=n[t.name])?void 0:r.name;return"string"==typeof e&&e.toLowerCase().includes(a)}if(Yu(e.value)&&s){const n=e.value??"",r=s[n][t.name];return!(!r||"string"!=typeof r.name)&&r.name.toLowerCase().includes(a)}return!1})))):null}([...p,...g],j,a,r||{})}),[j,p,g,a,r]),E=n.useMemo((()=>ko((e=>{w(e)}),200)),[]),T={searchValue:j,searchResults:S,selectedValues:_,endpointSearchValues:N,agentsMap:a,modelSpecs:p,assistantsMap:r,mappedEndpoints:g,endpointsConfig:o,handleSelectSpec:e=>{let t=e.preset.model??null;null==b||b(e),Xu(e.preset.endpoint)?t=e.preset.agent_id??"":Yu(e.preset.endpoint)&&(t=e.preset.assistant_id??""),y({endpoint:e.preset.endpoint,model:t,modelSpec:e.name})},handleSelectModel:(e,t)=>{var n,s,o;Xu(e.value)?null==v||v(e.value,{agent_id:t,model:(null==(n=null==a?void 0:a[t])?void 0:n.model)??""}):Yu(e.value)?null==v||v(e.value,{assistant_id:t,model:(null==(o=null==(s=null==r?void 0:r[e.value])?void 0:s[t])?void 0:o.model)??""}):e.value&&(null==v||v(e.value,{model:t})),y({endpoint:e.value,model:t,modelSpec:""})},setSelectedValues:y,handleSelectEndpoint:e=>{e.hasModels||(e.value&&(null==v||v(e.value)),y({endpoint:e.value,model:"",modelSpec:""}))},setEndpointSearchValue:(e,t)=>{C((n=>({...n,[e]:t})))},endpointRequiresUserKey:x,setSearchValue:E,...k};return s.jsx(mz.Provider,{value:T,children:e})}const hz=n.forwardRef((function({label:e,children:t,values:n,onValuesChange:a,searchValue:r,onSearch:o,combobox:i,trigger:l,defaultOpen:c,...d},u){const m=ae(),p=null!=r||!!o||!!i,f=te({showTimeout:100,placement:m?"right":"left",defaultOpen:c}),h=s.jsxs(ne,{store:f,values:n,setValues:a,children:[s.jsxs(ie,{ref:u,...d,className:n_(!m&&"flex h-10 w-full items-center justify-center gap-2 rounded-xl border border-border-light px-3 py-2 text-sm text-text-primary",f.useState("open")?"bg-surface-tertiary hover:bg-surface-tertiary":"bg-surface-secondary hover:bg-surface-tertiary",d.className),render:m?s.jsx(xz,{render:l}):l,children:[s.jsx("span",{className:"flex-1",children:e}),s.jsx(le,{className:"stroke-1 text-base opacity-75"})]}),s.jsx(re,{open:f.useState("open"),portal:!0,overlap:!0,unmountOnHide:!0,gutter:m?-4:4,className:n_((m?"animate-popover-left ml-3":"animate-popover")+" outline-none! z-50 flex max-h-[min(450px,var(--popover-available-height))] w-full","w-[var(--menu-width,auto)] min-w-[300px] flex-col overflow-auto rounded-xl border border-border-light","bg-surface-secondary px-3 py-2 text-sm text-text-primary shadow-lg","max-w-[calc(100vw-4rem)] sm:max-h-[calc(65vh)] sm:max-w-[400px]",p&&"p-0"),children:s.jsx(gz.Provider,{value:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"sticky top-0 z-10 bg-inherit p-1",children:s.jsx(z,{autoSelect:!0,render:i,className:n_("h-10 w-full rounded-lg border-none bg-transparent px-2 text-base","sm:h-8 sm:text-sm","focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white")})}),s.jsx(U,{className:"p-0.5 pt-0",children:t})]}):t})})]});return p?s.jsx(G,{resetValueOnHide:!0,includesBaseElement:!1,value:r,setValue:o,children:h}):h}));n.forwardRef((function(e,t){return s.jsx(oe,{ref:t,...e,className:n_("my-0.5 h-0 w-full border-t border-slate-200 dark:border-slate-700",e.className)})})),n.forwardRef((function({label:e,...t},n){return s.jsxs(ps,{ref:n,...t,className:n_("",t.className),children:[e&&s.jsx(fs,{className:"cursor-default p-2 text-sm font-medium opacity-60 sm:py-1 sm:text-xs",children:e}),t.children]})}));const gz=n.createContext(!1),xz=n.forwardRef((function({name:e,value:t,...a},r){const o=ae(),l=n.useContext(gz),c={ref:r,focusOnHover:!0,blurOnHoverEnd:!1,...a,className:n_("relative flex cursor-default items-center gap-2 rounded-lg p-2 outline-none! scroll-m-1 scroll-mt-[calc(var(--combobox-height,0px)+var(--label-height,4px))] aria-disabled:opacity-25 data-[active-item]:bg-black/[0.075] data-[active-item]:text-black dark:data-[active-item]:bg-white/10 dark:data-[active-item]:text-white sm:py-1 sm:text-sm min-w-0 w-full before:absolute before:left-0 before:top-1 before:bottom-1 before:w-0.5 before:bg-transparent before:rounded-full data-[active-item]:before:bg-black dark:data-[active-item]:before:bg-white",a.className)},d=i(o,(n=>!!e&&(null!=t&&null!=(null==n?void 0:n.values[e])))),u=i(o,(n=>!!e&&(null==n?void 0:n.values[e])===t));if(d&&(c.children=s.jsxs(n.Fragment,{children:[s.jsx("span",{className:"flex-1",children:c.children}),s.jsx(ms,{checked:u}),l&&s.jsx(zt,{children:u?"checked":"not checked"})]})),!l){if(null!=e&&null!=t){const n={...c,name:e,value:t,hideOnClick:!0};return s.jsx(hs,{...n})}return s.jsx(ce,{...c})}return s.jsx(B,{...c,setValueOnClick:!1,value:d?t:void 0,selectValueOnClick:()=>null!=e&&null!=t&&(null==o||o.setValue(e,t),!0),hideOnClick:e=>!e.currentTarget.hasAttribute("aria-expanded")&&(null==o||o.hideAll(),!0)})}));function vz({spec:e,isSelected:t}){const{handleSelectSpec:n,endpointsConfig:a}=pz(),{showIconInMenu:r=!0}=e;return s.jsxs(xz,{onClick:()=>n(e),className:n_("flex w-full cursor-pointer items-center justify-between rounded-lg px-2 text-sm"),children:[s.jsxs("div",{className:n_("flex w-full min-w-0 gap-2 px-1 py-1",e.description?"items-start":"items-center"),children:[r&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx(dz,{currentSpec:e,endpointsConfig:a})}),s.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[s.jsx("span",{className:"truncate text-left",children:e.label}),e.description&&s.jsx("span",{className:"break-words text-xs font-normal",children:e.description})]})]}),t&&s.jsx("div",{className:"flex-shrink-0 self-center",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},e.name)}function bz({modelId:e,endpoint:t,isSelected:n}){var a,r,o,i;const{handleSelectModel:l}=pz();let c=!1,d=e;const u=(null==(a=null==t?void 0:t.modelIcons)?void 0:a[e??""])||null;if(t&&e&&Xu(t.value)&&(null==(r=t.agentNames)?void 0:r[e])){d=t.agentNames[e];const n=null==(o=null==t?void 0:t.models)?void 0:o.find((t=>t.name===e));c=(null==n?void 0:n.isGlobal)??!1}else t&&e&&Yu(t.value)&&(null==(i=t.assistantNames)?void 0:i[e])&&(d=t.assistantNames[e]);return s.jsxs(xz,{onClick:()=>l(t,e??""),className:"flex h-8 w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[u?s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:s.jsx("img",{src:u,alt:d??"",className:"h-full w-full object-cover"})}):(Xu(t.value)||Yu(t.value))&&t.icon?s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:t.icon}):null,s.jsx("span",{children:d})]}),c&&s.jsx(we,{className:"ml-auto size-4 text-green-400"}),n&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},e)}function _z(e,t,n,a){return(a||t.map((e=>e.name))).map((t=>e&&s.jsx(bz,{modelId:t,endpoint:e,isSelected:n===t},t)))}const yz=({endpoint:e,className:t,handleOpenKeyDialog:n})=>{const a=Fk()("com_endpoint_config_key");return s.jsx("button",{id:`endpoint-${e.value}-settings`,onClick:t=>{e.value&&(t.stopPropagation(),n(e.value,t))},className:n_("flex items-center overflow-visible text-text-primary transition-all duration-300 ease-in-out","group/button rounded-md px-1 hover:bg-surface-secondary focus:bg-surface-secondary",t),"aria-label":`${a} ${e.label}`,children:s.jsxs("div",{className:"flex w-[28px] items-center gap-1 whitespace-nowrap transition-all duration-300 ease-in-out group-hover:w-auto group-focus/button:w-auto",children:[s.jsx(ze,{className:"h-4 w-4 flex-shrink-0"}),s.jsx("span",{className:"max-w-0 overflow-hidden whitespace-nowrap opacity-0 transition-all duration-300 ease-in-out group-hover:max-w-[100px] group-hover:opacity-100 group-focus/button:max-w-[100px] group-focus/button:opacity-100",children:a})]})})};function jz({endpoint:e}){const t=Fk(),{agentsMap:a,assistantsMap:r,selectedValues:o,handleOpenKeyDialog:i,handleSelectEndpoint:l,endpointSearchValues:c,setEndpointSearchValue:d,endpointRequiresUserKey:u}=pz(),{model:m,endpoint:p}=o,f=c[e.value]||"",h=n.useMemo((()=>u(e.value)),[e.value]),g=()=>s.jsxs("div",{className:"flex items-center gap-2",children:[e.icon&&s.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:e.icon}),s.jsx("span",{className:n_("truncate text-left",h?"group-hover:w-24 group-focus:w-24":""),children:e.label}),"gptPlugins"===e.value&&s.jsx(Ol,{description:t("com_endpoint_deprecated_info"),"aria-label":t("com_endpoint_deprecated_info_a11y"),render:s.jsx("span",{className:"ml-2 rounded bg-amber-600/70 px-2 py-0.5 text-xs font-semibold text-white",children:t("com_endpoint_deprecated")})})]});if(e.hasModels){const n=f?function(e,t,n,s,a){const r=n.trim().toLowerCase();return r?t.filter((t=>{var n;let o=t;if(Xu(e.value)&&s&&s[t])o=(null==(n=s[t])?void 0:n.name)||t;else if(Yu(e.value)&&a&&a[e.value]){const n=a[e.value][t];o="string"==typeof n.name&&n.name?n.name:t}return o.toLowerCase().includes(r)})):t}(e,(e.models||[]).map((e=>e.name)),f,a,r):null,o=Xu(e.value)||Yu(e.value)?t("com_endpoint_search_var",{0:e.label}):t("com_endpoint_search_endpoint_models",{0:e.label});return s.jsx(hz,{id:`endpoint-${e.value}-menu`,className:"transition-opacity duration-200 ease-in-out",defaultOpen:e.value===p,searchValue:f,onSearch:t=>d(e.value,t),combobox:s.jsx("input",{placeholder:o}),label:s.jsxs("div",{onClick:()=>l(e),className:"group flex w-full flex-shrink cursor-pointer items-center justify-between rounded-xl px-1 py-1 text-sm",children:[g(),h&&s.jsx(yz,{endpoint:e,handleOpenKeyDialog:i})]}),children:Yu(e.value)&&void 0===e.models?s.jsx("div",{className:"flex items-center justify-center p-2",children:s.jsx(ac,{})}):n?_z(e,e.models||[],m,n):e.models&&_z(e,e.models,m)},`endpoint-${e.value}-item`)}return s.jsx(xz,{id:`endpoint-${e.value}-menu`,onClick:()=>l(e),className:"flex h-8 w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:s.jsxs("div",{className:"group flex w-full min-w-0 items-center justify-between",children:[g(),s.jsxs("div",{className:"flex items-center gap-2",children:[u(e.value)&&s.jsx(yz,{endpoint:e,handleOpenKeyDialog:i}),p===e.value&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})},`endpoint-${e.value}-item`)}function wz(e){return e.map((e=>s.jsx(jz,{endpoint:e},`endpoint-${e.value}-item`)))}function Nz({results:e,localize:t,searchValue:a}){const{selectedValues:r,handleSelectSpec:o,handleSelectModel:i,handleSelectEndpoint:l,endpointsConfig:c}=pz(),{modelSpec:d,endpoint:u,model:m}=r;return e?e.length?s.jsx(s.Fragment,{children:e.map(((e,t)=>{if("name"in e&&"label"in e){const t=e;return s.jsxs(xz,{onClick:()=>o(t),className:n_("flex w-full cursor-pointer justify-between rounded-lg px-2 text-sm",t.description?"items-start":"items-center"),children:[s.jsxs("div",{className:n_("flex w-full min-w-0 gap-2 px-1 py-1",t.description?"items-start":"items-center"),children:[(t.showIconInMenu??!0)&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx(dz,{currentSpec:t,endpointsConfig:c})}),s.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[s.jsx("span",{className:"truncate text-left",children:t.label}),t.description&&s.jsx("span",{className:"break-words text-xs font-normal",children:t.description})]})]}),d===t.name&&s.jsx("div",{className:n_("flex-shrink-0",t.description?"pt-1":""),children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},t.name)}{const r=e;if(r.hasModels&&r.models&&r.models.length>0){const e=a.toLowerCase(),o=r.label.toLowerCase().includes(e)?r.models:r.models.filter((t=>{let n=t.name;return Xu(r.value)&&r.agentNames&&r.agentNames[t.name]?n=r.agentNames[t.name]:Yu(r.value)&&r.assistantNames&&r.assistantNames[t.name]&&(n=r.assistantNames[t.name]),n.toLowerCase().includes(e)}));return o.length?s.jsxs(n.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-sm font-medium",children:[r.icon&&s.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full p-1",children:r.icon}),r.label]}),o.map((e=>{var n,a;const o=e.name;let l=!1,c=o;if(Xu(r.value)&&r.agentNames&&r.agentNames[o]){c=r.agentNames[o];const e=null==(n=null==r?void 0:r.models)?void 0:n.find((e=>e.name===o));l=(null==e?void 0:e.isGlobal)??!1}else Yu(r.value)&&r.assistantNames&&r.assistantNames[o]&&(c=r.assistantNames[o]);return s.jsxs(xz,{onClick:()=>i(r,o),className:"flex w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 pl-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[(null==(a=r.modelIcons)?void 0:a[o])&&s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:s.jsx("img",{src:r.modelIcons[o],alt:c,className:"h-full w-full object-cover"})}),s.jsx("span",{children:c})]}),l&&s.jsx(we,{className:"ml-auto size-4 text-green-400"}),u===r.value&&m===o&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`${r.value}-${o}-search-${t}`)}))]},`endpoint-${r.value}-search-${t}`):null}return s.jsxs(xz,{onClick:()=>l(r),className:"flex w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[r.icon&&s.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full border border-gray-200 p-1 dark:border-gray-700",style:{borderRadius:"50%"},children:r.icon}),s.jsx("span",{children:r.label})]}),u===r.value&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`endpoint-${r.value}-search-item`)}}))}):s.jsx("div",{className:"cursor-default p-2 sm:py-1 sm:text-sm",children:t("com_files_no_results")}):null}function Cz(e,t,n){return s.jsx(Nz,{results:e,localize:t,searchValue:n},`search-results-${n}`)}const kz=[{value:"screenshot",label:"screenshot (.png)"},{value:"text",label:"text (.txt)"},{value:"markdown",label:"markdown (.md)"},{value:"json",label:"json (.json)"},{value:"csv",label:"csv (.csv)"}];function Sz({open:e,onOpenChange:t,conversation:a,triggerRef:r,children:o}){const i=Fk(),[l,c]=n.useState(""),[d,u]=n.useState("screenshot"),[m,p]=n.useState(!0),[f,h]=n.useState(!1),[g,x]=n.useState(!0);n.useEffect((()=>{!e&&r&&r.current&&r.current.focus()}),[e,r]),n.useEffect((()=>{c(Je(String((null==a?void 0:a.title)??"file"))),u("screenshot"),p(!0),h(!1),x(!0)}),[null==a?void 0:a.title,e]);const v=n.useCallback((e=>{const t="csv"!==e&&"screenshot"!==e;h("json"===e||"csv"===e||"webpage"===e),p(t),u(e)}),[]),b=n.useMemo((()=>"json"===d||"csv"===d||"webpage"===d),[d]),_=n.useMemo((()=>"csv"!==d&&"screenshot"!==d),[d]),{exportConversation:y}=pE({conversation:a,filename:Je(l),type:d,includeOptions:m,exportBranches:f,recursive:g});return s.jsxs(ul,{open:e,onOpenChange:t,triggerRef:r,children:[o,s.jsx(zd,{title:i("com_nav_export_conversation"),className:"max-w-full sm:max-w-2xl",main:s.jsxs("div",{className:"flex w-full flex-col items-center gap-6",children:[s.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[s.jsxs("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:[s.jsx(dl,{htmlFor:"filename",className:"text-left text-sm font-medium",children:i("com_nav_export_filename")}),s.jsx(ll,{id:"filename",value:l,onChange:e=>c(e.target.value||""),placeholder:i("com_nav_export_filename_placeholder")})]}),s.jsxs("div",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",children:[s.jsx(dl,{htmlFor:"type",className:"text-left text-sm font-medium",children:i("com_nav_export_type")}),s.jsx(rd,{value:d,onChange:v,options:kz,className:"z-50",portal:!1})]})]}),s.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[s.jsx("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"includeOptions",className:"text-left text-sm font-medium",children:i("com_nav_export_include_endpoint_options")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Si,{id:"includeOptions",disabled:!_,checked:m,onCheckedChange:p}),s.jsx("label",{htmlFor:"includeOptions",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i(_?"com_nav_enabled":"com_nav_not_supported")})]})]})}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"exportBranches",className:"text-left text-sm font-medium",children:i("com_nav_export_all_message_branches")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Si,{id:"exportBranches",disabled:!b,checked:f,onCheckedChange:h}),s.jsx("label",{htmlFor:"exportBranches",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i(b?"com_nav_enabled":"com_nav_not_supported")})]})]}),"json"===d?s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(dl,{htmlFor:"recursive",className:"text-left text-sm font-medium",children:i("com_nav_export_recursive_or_sequential")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Si,{id:"recursive",checked:g,onCheckedChange:x}),s.jsx("label",{htmlFor:"recursive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i("com_nav_export_recursive")})]})]}):null]})]}),buttons:s.jsx(s.Fragment,{children:s.jsx(ki,{onClick:y,variant:"submit",children:i("com_endpoint_export")})}),selection:void 0})]})}const Ez={isArchived:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function Tz({onOpenChange:e}){const t=Fk(),a=Ki("(max-width: 768px)"),{showToast:r}=Bd(),o=Ae(Ny.search),[i,l]=n.useState(!1),[c,d]=n.useState(Ez),[u,m]=n.useState(null),{data:p,fetchNextPage:f,hasNextPage:h,isFetchingNextPage:g,refetch:x,isLoading:v}=mj(c,{staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),b=n.useCallback(((e,t)=>{d((n=>({...n,sortBy:e,sortDirection:t})))}),[]),_=n.useCallback((e=>{const t=encodeURIComponent(e.trim());d((e=>({...e,search:t})))}),[]),y=n.useMemo((()=>ko(_,300)),[_]);n.useEffect((()=>()=>{y.cancel()}),[y]);const j=n.useMemo((()=>(null==p?void 0:p.pages)?p.pages.flatMap((e=>{var t;return(null==(t=null==e?void 0:e.conversations)?void 0:t.filter(Boolean))??[]})):[]),[null==p?void 0:p.pages]),w=kj({onSuccess:async()=>{l(!1),await x()},onError:e=>{r({message:t("com_ui_archive_delete_error"),severity:eu.ERROR})}}),N=_j({onSuccess:async()=>{await x()},onError:e=>{r({message:t("com_ui_unarchive_error"),severity:eu.ERROR})}}),C=n.useCallback((async()=>{h&&!g&&await f()}),[f,h,g]),k=n.useMemo((()=>[{accessorKey:"title",header:()=>{const e="title"===c.sortBy,n=c.sortDirection;return s.jsxs(ki,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("title",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_name"),e&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{conversationId:t,title:n}=e.original;return s.jsxs("button",{type:"button",className:"flex items-center gap-2 truncate",onClick:()=>window.open(`/c/${t}`,"_blank"),children:[s.jsx($I,{endpoint:e.original.endpoint,size:28,isCreatedByUser:!1,iconClassName:"size-4"}),s.jsx("span",{className:"underline",children:n})]})},meta:{size:a?"70%":"50%",mobileSize:"70%"}},{accessorKey:"createdAt",header:()=>{const e="createdAt"===c.sortBy,n=c.sortDirection;return s.jsxs(ki,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("createdAt",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_created_at"),e&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Lv((null==(t=e.original.createdAt)?void 0:t.toString())??"",a)},meta:{size:a?"30%":"35%",mobileSize:"30%"}},{accessorKey:"actions",header:()=>s.jsx(dl,{className:"px-2 py-0 text-xs sm:px-2 sm:py-2 sm:text-sm",children:t("com_assistants_actions")}),cell:({row:e})=>{const n=e.original;return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ol,{description:t("com_ui_unarchive"),render:s.jsx(ki,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>N.mutate({conversationId:n.conversationId,isArchived:!1}),title:t("com_ui_unarchive"),disabled:N.isLoading,children:N.isLoading?s.jsx(ac,{}):s.jsx(vs,{className:"size-4"})})}),s.jsx(Ol,{description:t("com_ui_delete"),render:s.jsx(ki,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{m(e.original),l(!0)},title:t("com_ui_delete"),children:s.jsx(Zn,{className:"size-4"})})})]})},meta:{size:"15%",mobileSize:"25%"}}]),[b,a,t,c,N]);return s.jsxs(s.Fragment,{children:[s.jsx(pd,{columns:k,data:j,filterColumn:"title",onFilterChange:y,filterValue:c.search,fetchNextPage:C,hasNextPage:h,isFetchingNextPage:g,isLoading:v,showCheckboxes:!1,enableSearch:o}),s.jsx(ul,{open:i,onOpenChange:e,children:s.jsxs(gl,{title:t("com_ui_delete_confirm")+" "+((null==u?void 0:u.title)??""),className:"w-11/12 max-w-md",children:[s.jsx(xl,{children:s.jsxs(bl,{children:[t("com_ui_delete_confirm")," ",s.jsx("strong",{children:null==u?void 0:u.title})]})}),s.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[s.jsx(ki,{"aria-label":"cancel",variant:"outline",onClick:()=>l(!1),children:t("com_ui_cancel")}),s.jsx(ki,{variant:"destructive",onClick:()=>w.mutate({conversationId:(null==u?void 0:u.conversationId)??""}),disabled:w.isLoading,children:w.isLoading?s.jsx(ac,{}):t("com_ui_delete")})]})]})})]})}function Iz(){const e=Fk(),[t,a]=n.useState(!1);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_archived_chats")}),s.jsxs(ul,{open:t,onOpenChange:a,children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"outline","aria-label":"Archived chats",children:e("com_ui_manage")})}),s.jsx(zd,{title:e("com_nav_archived_chats"),className:"max-w-[1000px]",showCancelButton:!1,main:s.jsx(Tz,{isOpen:t,onOpenChange:a})})]})]})}const Rz=({stateAtom:e,localizationKey:t,hoverCardText:n,switchId:a,onCheckedChange:r})=>{const[o,i]=Re(e),l=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:l(t)}),n&&s.jsx(Md,{side:Li.Bottom,text:l(n)})]}),s.jsx(Cl,{id:a,checked:o,onCheckedChange:e=>{i(e),null==r||r(e)},className:"ml-4","data-testid":a})]})},Pz=[{stateAtom:Ny.enableUserMsgMarkdown,localizationKey:"com_nav_user_msg_markdown",switchId:"enableUserMsgMarkdown",hoverCardText:void 0,key:"enableUserMsgMarkdown"},{stateAtom:Ny.autoScroll,localizationKey:"com_nav_auto_scroll",switchId:"autoScroll",hoverCardText:void 0,key:"autoScroll"},{stateAtom:Ny.hideSidePanel,localizationKey:"com_nav_hide_panel",switchId:"hideSidePanel",hoverCardText:void 0,key:"hideSidePanel"}],Az=({theme:e,onChange:t})=>{const n=Fk(),a=[{value:"system",label:n("com_nav_theme_system")},{value:"dark",label:n("com_nav_theme_dark")},{value:"light",label:n("com_nav_theme_light")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_theme")}),s.jsx(rd,{value:e,onChange:t,options:a,sizeClasses:"w-[180px]",testId:"theme-selector",className:"z-50"})]})},Mz=({langcode:e,onChange:t})=>{const n=Fk(),a=[{value:"auto",label:n("com_nav_lang_auto")},{value:"en-US",label:n("com_nav_lang_english")},{value:"zh-Hans",label:n("com_nav_lang_chinese")},{value:"zh-Hant",label:n("com_nav_lang_traditional_chinese")},{value:"ar-EG",label:n("com_nav_lang_arabic")},{value:"bs",label:n("com_nav_lang_bosnian")},{value:"da-DK",label:n("com_nav_lang_danish")},{value:"de-DE",label:n("com_nav_lang_german")},{value:"es-ES",label:n("com_nav_lang_spanish")},{value:"ca-ES",label:n("com_nav_lang_catalan")},{value:"et-EE",label:n("com_nav_lang_estonian")},{value:"fa-IR",label:n("com_nav_lang_persian")},{value:"fr-FR",label:n("com_nav_lang_french")},{value:"he-HE",label:n("com_nav_lang_hebrew")},{value:"hu-HU",label:n("com_nav_lang_hungarian")},{value:"hy-AM",label:n("com_nav_lang_armenian")},{value:"it-IT",label:n("com_nav_lang_italian")},{value:"nb",label:n("com_nav_lang_norwegian_bokmal")},{value:"pl-PL",label:n("com_nav_lang_polish")},{value:"pt-BR",label:n("com_nav_lang_brazilian_portuguese")},{value:"pt-PT",label:n("com_nav_lang_portuguese")},{value:"ru-RU",label:n("com_nav_lang_russian")},{value:"ja-JP",label:n("com_nav_lang_japanese")},{value:"ka-GE",label:n("com_nav_lang_georgian")},{value:"cs-CZ",label:n("com_nav_lang_czech")},{value:"sv-SE",label:n("com_nav_lang_swedish")},{value:"ko-KR",label:n("com_nav_lang_korean")},{value:"lv-LV",label:n("com_nav_lang_latvian")},{value:"vi-VN",label:n("com_nav_lang_vietnamese")},{value:"th-TH",label:n("com_nav_lang_thai")},{value:"tr-TR",label:n("com_nav_lang_turkish")},{value:"ug",label:n("com_nav_lang_uyghur")},{value:"nl-NL",label:n("com_nav_lang_dutch")},{value:"id-ID",label:n("com_nav_lang_indonesia")},{value:"fi-FI",label:n("com_nav_lang_finnish")},{value:"sl",label:n("com_nav_lang_slovenian")},{value:"bo",label:n("com_nav_lang_tibetan")},{value:"uk-UA",label:n("com_nav_lang_ukrainian")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_language")}),s.jsx(rd,{value:e,onChange:t,sizeClasses:"[--anchor-max-height:256px]",options:a,className:"z-50"})]})};const Lz=S.memo((function(){const{theme:e,setTheme:t}=n.useContext(Td),[a,r]=Re(Ny.lang),o=n.useCallback((e=>{t(e)}),[t]),i=n.useCallback((e=>{let t=e;"auto"===e&&(t=navigator.language||navigator.languages[0]),requestAnimationFrame((()=>{document.documentElement.lang=t})),r(t),Me.set("lang",t,{expires:365})}),[r]);return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Az,{theme:e,onChange:o})}),s.jsx("div",{className:"pb-3",children:s.jsx(Mz,{langcode:a,onChange:i})}),Pz.map((e=>s.jsx("div",{className:"pb-3",children:s.jsx(Rz,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),s.jsx("div",{className:"pb-3",children:s.jsx(Iz,{})})]})}));function Oz(){const[e,t]=Re(Ny.fontSize),n=Fk(),a=[{value:"text-xs",label:n("com_nav_font_size_xs")},{value:"text-sm",label:n("com_nav_font_size_sm")},{value:"text-base",label:n("com_nav_font_size_base")},{value:"text-lg",label:n("com_nav_font_size_lg")},{value:"text-xl",label:n("com_nav_font_size_xl")}];return s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsx("div",{children:n("com_nav_font_size")}),s.jsx(rd,{value:e,options:a,onChange:e=>{t(e),di(e)},testId:"font-size-selector",sizeClasses:"w-[150px]",className:"z-50"})]})}const Dz=()=>{const e=Fk(),[t,n]=Re(Ny.forkSetting),[a,r]=Re(Ny.splitAtTarget),[o,i]=Re(Ny.rememberDefaultFork),l=[{value:Th.DIRECT_PATH,label:e("com_ui_fork_visible")},{value:Th.INCLUDE_BRANCHES,label:e("com_ui_fork_branches")},{value:Th.TARGET_LEVEL,label:e("com_ui_fork_all_target")}];return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[" ",e("com_ui_fork_default")," "]}),s.jsx(Cl,{id:"rememberDefaultFork",checked:o,onCheckedChange:i,className:"ml-4","data-testid":"rememberDefaultFork"})]})}),o&&s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:e("com_ui_fork_change_default")}),s.jsx(Md,{side:Li.Bottom,text:e("com_nav_info_fork_change_default")})]}),s.jsx(rd,{value:t,onChange:n,options:l,sizeClasses:"w-[200px]",testId:"fork-setting-dropdown",className:"z-[50]"})]})}),s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:e("com_ui_fork_split_target_setting")}),s.jsx(Md,{side:Li.Bottom,text:e("com_nav_info_fork_split_target_setting")})]}),s.jsx(Cl,{id:"splitAtTarget",checked:a,onCheckedChange:r,className:"ml-4","data-testid":"splitAtTarget"})]})})]})},Fz=()=>{const[e,t]=Re(Ny.chatDirection),n=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("span",{id:"chat-direction-label",children:n("com_nav_chat_direction")})}),s.jsxs(ki,{variant:"outline","aria-label":"Toggle chat direction",onClick:()=>{t((e=>"LTR"===e?"RTL":"LTR"))},"data-testid":"chatDirection",children:[s.jsx("span",{"aria-hidden":"true",children:e.toLowerCase()}),s.jsx("span",{id:"chat-direction-status",className:"sr-only",children:n("LTR"===e?"chat_direction_left_to_right":"chat_direction_right_to_left")})]})]})},zz=[{stateAtom:Ny.enterToSend,localizationKey:"com_nav_enter_to_send",switchId:"enterToSend",hoverCardText:"com_nav_info_enter_to_send",key:"enterToSend"},{stateAtom:Ny.maximizeChatSpace,localizationKey:"com_nav_maximize_chat_space",switchId:"maximizeChatSpace",hoverCardText:void 0,key:"maximizeChatSpace"},{stateAtom:Ny.centerFormOnLanding,localizationKey:"com_nav_center_chat_input",switchId:"centerFormOnLanding",hoverCardText:void 0,key:"centerFormOnLanding"},{stateAtom:Ny.showThinking,localizationKey:"com_nav_show_thinking",switchId:"showThinking",hoverCardText:void 0,key:"showThinking"},{stateAtom:Ny.showCode,localizationKey:"com_nav_show_code",switchId:"showCode",hoverCardText:void 0,key:"showCode"},{stateAtom:Ny.LaTeXParsing,localizationKey:"com_nav_latex_parsing",switchId:"latexParsing",hoverCardText:"com_nav_info_latex_parsing",key:"latexParsing"},{stateAtom:Ny.saveDrafts,localizationKey:"com_nav_save_drafts",switchId:"saveDrafts",hoverCardText:"com_nav_info_save_draft",key:"saveDrafts"},{stateAtom:Ny.showScrollButton,localizationKey:"com_nav_scroll_button",switchId:"showScrollButton",hoverCardText:void 0,key:"showScrollButton"},{stateAtom:Ny.saveBadgesState,localizationKey:"com_nav_save_badges_state",switchId:"showBadges",hoverCardText:"com_nav_info_save_badges_state",key:"showBadges"},{stateAtom:Ny.modularChat,localizationKey:"com_nav_modular_chat",switchId:"modularChat",hoverCardText:void 0,key:"modularChat"}];const Uz=n.memo((function(){return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Oz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(Fz,{})}),zz.map((e=>s.jsx("div",{className:"pb-3",children:s.jsx(Rz,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),s.jsx(Dz,{})]})}));function Vz(){const e=Fk(),t=n.useRef(null),{showToast:a}=Bd(),[,r]=n.useState([]),[o,i]=n.useState(!0),l=e=>r((t=>[...t,e])),c=Sj({onSuccess:()=>{a({message:e("com_ui_import_conversation_success")}),i(!0)},onError:t=>{var n,s;console.error("Error: ",t),i(!0),l((null==(s=null==(n=t.response)?void 0:n.data)?void 0:s.message)??"An error occurred while uploading the file."),!0===(null==t?void 0:t.toString().includes("Unsupported import type"))?a({message:e("com_ui_import_conversation_file_type_error"),status:"error"}):a({message:e("com_ui_import_conversation_error"),status:"error"})},onMutate:()=>{i(!1)}}),d=async e=>{try{await(async e=>{const t=new FormData;t.append("file",e,encodeURIComponent(e.name||"File")),c.mutate(t)})(e)}catch(t){console.log("file handling error",t),l("An error occurred while processing the file.")}},u=()=>{var e;null==(e=t.current)||e.click()};return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_ui_import_conversation_info")}),s.jsxs("button",{onClick:u,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),u())},disabled:!o,"aria-label":e("com_ui_import"),className:"btn btn-neutral relative",children:[o?s.jsx(bs,{className:"mr-1 flex h-4 w-4 items-center stroke-1"}):s.jsx(ac,{className:"mr-1 w-4"}),s.jsx("span",{children:e("com_ui_import")})]}),s.jsx("input",{ref:t,type:"file",className:n_("hidden"),accept:".json",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];n&&d(n)},"aria-hidden":"true"})]})}const Bz=({endpoint:e="",all:t=!1,disabled:a=!1,setDialogOpen:r})=>{const o=Fk(),[i,l]=n.useState(!1),c=dk(e),d=uk(),u=()=>{r&&r(!1)},m=t?o("com_ui_revoke_keys"):o("com_ui_revoke_key_endpoint",{0:e}),p=o(t?"com_ui_revoke_keys_confirm":"com_ui_revoke_key_confirm"),f=c.isLoading||d.isLoading;return s.jsxs(ul,{open:i,onOpenChange:l,children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>l(!0),disabled:a,children:o("com_ui_revoke")})}),s.jsx(zd,{showCloseButton:!1,title:m,className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:p}),selection:{selectHandler:()=>{t?d.mutate({}):c.mutate({},{onSuccess:u})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:f?s.jsx(ac,{}):o("com_ui_revoke")}})]})},$z=()=>{const e=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(dl,{className:"font-light",children:e("com_ui_revoke_info")}),s.jsx(Bz,{all:!0})]})},Hz=({disabled:e=!1})=>{const t=Fk(),[a,r]=n.useState(!1),[o,i]=n.useState(!0),[l,c]=n.useState(!1),[d,u]=n.useState(!1);Wi(n.useRef(null),(()=>l&&c(!1)),[]);const m=n.useCallback((async()=>{const e=await caches.open("tts-responses"),t=await e.keys();i(0===t.length)}),[]);n.useEffect((()=>{m()}),[m]);const p=n.useCallback((async()=>{u(!0);const e=await caches.open("tts-responses");await e.keys().then((t=>Promise.all(t.map((t=>e.delete(t)))))),u(!1)}),[]);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(dl,{className:"font-light",children:t("com_nav_delete_cache_storage")}),s.jsxs(ul,{open:a,onOpenChange:r,children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>r(!0),disabled:e||o,children:t("com_ui_delete")})}),s.jsx(zd,{showCloseButton:!1,title:t("com_nav_confirm_clear"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:t("com_nav_clear_cache_confirm_message")}),selection:{selectHandler:p,selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:d?s.jsx(ac,{}):t("com_ui_delete")}})]})]})},Gz=()=>{const e=Fk(),[t,a]=n.useState(!1),{newConversation:r}=JS(),o=ck();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(dl,{className:"font-light",children:e("com_nav_clear_all_chats")}),s.jsxs(ul,{open:t,onOpenChange:a,children:[s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>a(!0),children:e("com_ui_delete")})}),s.jsx(zd,{showCloseButton:!1,title:e("com_nav_confirm_clear"),className:"max-w-[450px]",main:s.jsx(dl,{className:"text-left text-sm font-medium",children:e("com_nav_clear_conversation_confirm_message")}),selection:{selectHandler:()=>{o.mutate({},{onSuccess:()=>{Ub(),r()}})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:o.isLoading?s.jsx(ac,{}):e("com_ui_delete")}})]})]})},Kz={pageSize:25,isPublic:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function Wz(){const e=Fk(),{showToast:t}=Bd(),a=Ki("(max-width: 768px)"),r=Ae(Ny.search),[o,i]=n.useState(Kz),[l,c]=n.useState(null),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{data:f,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:x,refetch:v,isLoading:b}=pj(o,{enabled:m,staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),_=n.useCallback(((e,t)=>{i((n=>({...n,sortBy:e,sortDirection:t})))}),[]),y=n.useCallback((e=>{const t=encodeURIComponent(e.trim());i((e=>({...e,search:t})))}),[]),j=n.useMemo((()=>ko(y,300)),[y]);n.useEffect((()=>()=>{j.cancel()}),[j]);const w=n.useMemo((()=>(null==f?void 0:f.pages)?f.pages.flatMap((e=>e.links.filter(Boolean))):[]),[null==f?void 0:f.pages]),N=wj({onSuccess:async()=>{u(!1),c(null),await v()}}),C=n.useCallback((async n=>{const s=n.filter((e=>"string"==typeof e.shareId&&e.shareId.length>0));if(0!==s.length)try{for(const e of s)await N.mutateAsync({shareId:e.shareId});t({message:e(1===s.length?"com_ui_shared_link_delete_success":"com_ui_shared_link_bulk_delete_success"),severity:eu.SUCCESS})}catch(a){console.error("Failed to delete shared links:",a),t({message:e("com_ui_bulk_delete_error"),severity:eu.ERROR})}else t({message:e("com_ui_no_valid_items"),severity:eu.WARNING})}),[N,t,e]),k=n.useCallback((async()=>{!0!==g||x||await h()}),[h,g,x]),S=n.useCallback((()=>{l&&C([l]),u(!1)}),[l,C]),E=n.useMemo((()=>[{accessorKey:"title",header:()=>{const t="title"===o.sortBy,n=o.sortDirection;return s.jsxs(ki,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>_("title",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_name"),t&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{title:t,shareId:n}=e.original;return s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(As,{to:`/share/${n}`,target:"_blank",rel:"noopener noreferrer",className:"block truncate text-blue-500 hover:underline",title:t,children:t})})},meta:{size:"35%",mobileSize:"50%"}},{accessorKey:"createdAt",header:()=>{const t="createdAt"===o.sortBy,n=o.sortDirection;return s.jsxs(ki,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>_("createdAt",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_date"),t&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Lv((null==(t=e.original.createdAt)?void 0:t.toString())??"",a)},meta:{size:"10%",mobileSize:"20%"}},{accessorKey:"actions",header:()=>s.jsx(dl,{className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",children:e("com_assistants_actions")}),meta:{size:"7%",mobileSize:"25%"},cell:({row:t})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ol,{description:e("com_ui_view_source"),render:s.jsx(ki,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{window.open(`/c/${t.original.conversationId}`,"_blank")},title:e("com_ui_view_source"),children:s.jsx(_s,{className:"size-4"})})}),s.jsx(Ol,{description:e("com_ui_delete"),render:s.jsx(ki,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{c(t.original),u(!0)},title:e("com_ui_delete"),children:s.jsx(Zn,{className:"size-4"})})})]})}]),[a,e,o,_]);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_shared_links")}),s.jsxs(ul,{open:m,onOpenChange:p,children:[s.jsx(ml,{asChild:!0,onClick:()=>p(!0),children:s.jsx(ki,{variant:"outline",children:e("com_ui_manage")})}),s.jsxs(gl,{title:e("com_nav_my_files"),className:"w-11/12 max-w-5xl bg-background text-text-primary shadow-2xl",children:[s.jsx(xl,{children:s.jsx(bl,{children:e("com_nav_shared_links")})}),s.jsx(pd,{columns:E,data:w,onDelete:C,filterColumn:"title",hasNextPage:g,isFetchingNextPage:x,fetchNextPage:k,showCheckboxes:!1,onFilterChange:j,filterValue:o.search,isLoading:b,enableSearch:r})]})]}),s.jsx(ul,{open:d,onOpenChange:u,children:s.jsx(zd,{showCloseButton:!1,title:e("com_ui_delete_shared_link"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(dl,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[e("com_ui_delete_confirm")," ",s.jsx("strong",{children:null==l?void 0:l.title})]})})})}),selection:{selectHandler:S,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white "+(N.isLoading?"cursor-not-allowed opacity-80":""),selectText:N.isLoading?s.jsx(ac,{}):e("com_ui_delete")}})})]})}const qz=S.memo((function(){const e=n.useRef(null),[t,a]=n.useState(!1);return Wi(e,(()=>t&&a(!1)),[]),s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Vz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(Wz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx($z,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(Hz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(Gz,{})})]})}));function Qz(){const[e,t]=Re(Ny.slashCommand),n=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_slash_command_description")}),s.jsx(Cl,{id:"slashCommand",checked:e,onCheckedChange:e=>{t(e)},"data-testid":"slashCommand"})]})}function Yz(){const[e,t]=Re(Ny.plusCommand),n=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_plus_command_description")}),s.jsx(Cl,{id:"plusCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"plusCommand"})]})}function Xz(){const[e,t]=Re(Ny.atCommand),n=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_at_command_description")}),s.jsx(Cl,{id:"atCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"atCommand"})]})}const Zz=n.memo((function(){const e=Fk(),t=Wk({permissionType:hg.PROMPTS,permission:gg.USE}),n=Wk({permissionType:hg.MULTI_CONVO,permission:gg.USE});return s.jsxs("div",{className:"space-y-4 p-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary",children:e("com_nav_chat_commands")}),s.jsx(Md,{side:Li.Bottom,text:e("com_nav_chat_commands_info")})]}),s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Xz,{})}),!0===n&&s.jsx("div",{className:"pb-3",children:s.jsx(Yz,{})}),!0===t&&s.jsx("div",{className:"pb-3",children:s.jsx(Qz,{})})]})]})}));function Jz(){const e=Fk(),[t,n]=Re(Ny.UsernameDisplay);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(dl,{className:"font-light",children:e("com_nav_user_name_display")}),s.jsx(Md,{side:Li.Bottom,text:e("com_nav_info_user_name_display")})]}),s.jsx(Cl,{id:"UsernameDisplay",checked:t,onCheckedChange:e=>{n(e)},className:"ml-4","data-testid":"UsernameDisplay"})]})}const eU=({disabled:e=!1})=>{const t=Fk(),{user:a,logout:r}=Kk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),n=Ey(),s=Oe(Ny.defaultPreset);return fr([yx.deleteUser],{mutationFn:()=>Rx.deleteUser(),...e||{},onSuccess:(...a)=>{var r;s(),n(),Ub(),t.removeQueries(),null==(r=null==e?void 0:e.onSuccess)||r.call(e,...a)}})})({onMutate:()=>r()}),[l,c]=n.useState(!1),[d,u]=n.useState(!0),m=n.useCallback((e=>{const t=e.trim().toLowerCase()===(null==a?void 0:a.email.trim().toLowerCase());u(!t)}),[null==a?void 0:a.email]);return s.jsx(s.Fragment,{children:s.jsxs(ul,{open:l,onOpenChange:c,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:t("com_nav_delete_account")}),s.jsx(ml,{asChild:!0,children:s.jsx(ki,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>c(!0),disabled:e,children:t("com_ui_delete")})})]}),s.jsxs(gl,{className:"w-11/12 max-w-md",children:[s.jsx(xl,{children:s.jsx(bl,{className:"text-lg font-medium leading-6",children:t("com_nav_delete_account_confirm")})}),s.jsx("div",{className:"mb-8 text-sm text-black dark:text-white",children:s.jsxs("ul",{className:"font-semibold text-amber-600",children:[s.jsx("li",{children:t("com_nav_delete_warning")}),s.jsx("li",{children:t("com_nav_delete_data_info")})]})}),s.jsxs("div",{className:"flex-col items-center justify-center",children:[s.jsx("div",{className:"mb-4",children:tU(t("com_nav_delete_account_email_placeholder"),"email-confirm-input",(null==a?void 0:a.email)??"",(e=>m(e.target.value)))}),nU((()=>{d||o(void 0)}),i,d,t)]})]})]})})},tU=(e,t,n,a)=>s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-black dark:text-white",htmlFor:t,children:e}),s.jsx(ll,{id:t,onChange:a,placeholder:n})]}),nU=(e,t,n,a)=>s.jsx("button",{className:n_("mt-4 flex w-full items-center justify-center rounded-lg bg-surface-tertiary px-4 py-2 transition-all duration-200",n?"cursor-not-allowed opacity-30":"bg-destructive text-destructive-foreground"),onClick:e,disabled:t||n,children:t?s.jsx("div",{className:"flex h-6 justify-center",children:s.jsx(ac,{className:"icon-sm m-auto"})}):s.jsx(s.Fragment,{children:n?s.jsxs(s.Fragment,{children:[s.jsx(ys,{className:"size-5"}),s.jsx("span",{className:"ml-2",children:a("com_ui_locked")})]}):s.jsxs(s.Fragment,{children:[s.jsx(Zn,{className:"size-5"}),s.jsx("span",{className:"ml-2",children:a("com_nav_delete_account_button")})]})})});function sU(){const e=Pe(Ny.user),[t,a]=n.useState(1),[r,o]=n.useState(0),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(null),[m,p]=n.useState(!1),{data:f=cp}=Yy({select:e=>fp(e)}),h=Fk(),{showToast:g}=Bd(),{mutate:x,isLoading:v}=Ej({onSuccess:t=>{var n;g({message:h("com_ui_upload_success")}),e((e=>({...e,avatar:t.url}))),null==(n=c.current)||n.click()},onError:e=>{console.error("Error:",e),g({message:h("com_ui_upload_error"),status:"error"})}}),b=e=>{if(null!=f.avatarSizeLimit&&e&&e.size<=f.avatarSizeLimit)u(e),a(1),o(0);else{const e=null!=f.avatarSizeLimit?Dv(f.avatarSizeLimit):2;g({message:h("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}},_=n.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.files[0];b(t)}),[]),y=n.useCallback((e=>{e.preventDefault()}),[]),j=n.useCallback((()=>{u(null),a(1),o(0)}),[]);return s.jsxs(ul,{open:m,onOpenChange:e=>{p(e),e||(j(),setTimeout((()=>{var e;null==(e=c.current)||e.focus()}),0))},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:h("com_nav_profile_picture")}),s.jsx(ml,{ref:c,children:s.jsxs(ki,{variant:"outline",children:[s.jsx(js,{className:"mr-2 flex w-[22px] items-center stroke-1"}),s.jsx("span",{children:h("com_nav_change_picture")})]})})]}),s.jsxs(gl,{className:"w-11/12 max-w-sm",style:{borderRadius:"12px"},children:[s.jsx(xl,{children:s.jsx(bl,{className:"text-lg font-medium leading-6 text-text-primary",children:h(null!=d?"com_ui_preview":"com_ui_upload_image")})}),s.jsx("div",{className:"flex flex-col items-center justify-center",children:null!=d?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative overflow-hidden rounded-full",children:s.jsx(ws,{ref:i,image:d,width:250,height:250,border:0,borderRadius:125,color:[255,255,255,.6],scale:t,rotate:r})}),s.jsxs("div",{className:"mt-4 flex w-full flex-col items-center space-y-4",children:[s.jsxs("div",{className:"flex w-full items-center justify-center space-x-4",children:[s.jsx("span",{className:"text-sm",children:h("com_ui_zoom")}),s.jsx(yl,{value:[t],min:1,max:5,step:.001,onValueChange:e=>{a(e[0])},className:"w-2/3 max-w-xs"})]}),s.jsx("button",{onClick:()=>{o((e=>(e+90)%360))},className:"rounded-full bg-gray-200 p-2 transition-colors hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:s.jsx(Qn,{className:"h-5 w-5"})})]}),s.jsxs(ki,{className:n_("btn btn-primary mt-4 flex w-full hover:bg-green-600",v?"cursor-not-allowed opacity-90":""),onClick:()=>{if(i.current){i.current.getImageScaledToCanvas().toBlob((e=>{if(e){const t=new FormData;t.append("file",e,"avatar.png"),t.append("manual","true"),x(t)}}),"image/png")}},disabled:v,children:[v?s.jsx(ac,{className:"icon-sm mr-2"}):s.jsx(Ns,{className:"mr-2 h-5 w-5"}),h("com_ui_upload")]})]}):s.jsxs("div",{className:"flex h-64 w-11/12 flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-transparent dark:border-gray-600",onDrop:_,onDragOver:y,children:[s.jsx(js,{className:"mb-4 size-12 text-gray-400"}),s.jsx("p",{className:"mb-2 text-center text-sm text-gray-500 dark:text-gray-400",children:h("com_ui_drag_drop")}),s.jsx(ki,{variant:"secondary",onClick:()=>{var e;null==(e=l.current)||e.click()},children:h("com_ui_select_file")}),s.jsx("input",{ref:l,type:"file",className:"hidden",accept:".png, .jpg, .jpeg",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];b(n)}})]})})]})]})}const aU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},rU=({backupCodes:e,onDownload:t,downloaded:n,onNext:a})=>{const r=Fk();return s.jsxs(oo.div,{...aU,className:"space-y-6",children:[s.jsx(dl,{className:"break-keep text-sm",children:r("com_ui_download_backup_tooltip")}),s.jsx("div",{className:"grid grid-cols-2 gap-4 rounded-xl bg-surface-secondary p-6",children:e.map(((e,t)=>s.jsx(oo.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"rounded-lg bg-surface-tertiary p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"hidden text-sm text-text-secondary sm:inline",children:["#",t+1]}),s.jsx("span",{className:"font-mono text-lg",children:e})]})},e)))}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs(ki,{variant:"outline",onClick:t,className:"flex-1 gap-2",children:[s.jsx(On,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:r("com_ui_download_backup")})]}),s.jsx(ki,{onClick:a,disabled:!n,className:"flex-1",children:r("com_ui_complete_setup")})]})]})},oU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},iU=({secret:e,otpauthUrl:t,onNext:a})=>{const r=Fk(),[o,i]=n.useState(!1);return s.jsxs(oo.div,{...oU,className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[s.jsx(oo.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"rounded-2xl bg-white p-4 shadow-lg",children:s.jsx(Wo,{value:t,size:240})}),s.jsxs("div",{className:"w-full space-y-3",children:[s.jsx(dl,{className:"text-sm font-medium text-text-secondary",children:r("com_ui_secret_key")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(ll,{value:e,readOnly:!0,className:"font-mono text-lg tracking-wider"}),s.jsx(ki,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(e),i(!0),setTimeout((()=>i(!1)),2e3)},className:n_("h-auto shrink-0",o?"cursor-default":""),children:o?s.jsx(es,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})]})]})]}),s.jsx(ki,{onClick:a,className:"w-full",children:r("com_ui_continue")})]})},lU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},cU=({token:e,onTokenChange:t,isVerifying:n,onNext:a})=>{const r=Fk();return s.jsxs(oo.div,{...lU,className:"space-y-8",children:[s.jsx("div",{className:"flex justify-center",children:s.jsxs(Fl,{value:e,onChange:t,maxLength:6,pattern:dt,className:"gap-2",children:[s.jsx(zl,{children:Array.from({length:3}).map(((e,t)=>s.jsx(Ul,{index:t},t)))}),s.jsx(Vl,{}),s.jsx(zl,{children:Array.from({length:3}).map(((e,t)=>s.jsx(Ul,{index:t+3},t+3)))})]})}),s.jsx(ki,{onClick:a,disabled:n||6!==e.length,className:"w-full",children:r("com_ui_verify")})]})},dU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},uU=({isGenerating:e,onGenerate:t})=>{const n=Fk();return s.jsx(oo.div,{...dU,className:"space-y-6",children:s.jsxs("div",{className:"rounded-xl bg-surface-secondary p-6",children:[s.jsx("h3",{className:"mb-4 flex justify-center text-lg font-medium",children:n("com_ui_2fa_account_security")}),s.jsxs(ki,{variant:"default",onClick:t,className:"flex w-full",disabled:e,children:[e?s.jsx(ac,{className:"size-5"}):s.jsx(Yn,{className:"size-5"}),n(e?"com_ui_generating":"com_ui_generate_qrcode")]})]})})},mU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},pU=({onDisable:e,isDisabling:t})=>{const a=Fk(),[r,o]=n.useState(""),[i,l]=n.useState(!1);return s.jsxs(oo.div,{...mU,className:"space-y-8",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx(Fl,{value:r,onChange:o,maxLength:i?8:6,pattern:i?ut:dt,className:"gap-2",children:i?s.jsxs(zl,{children:[s.jsx(Ul,{index:0}),s.jsx(Ul,{index:1}),s.jsx(Ul,{index:2}),s.jsx(Ul,{index:3}),s.jsx(Ul,{index:4}),s.jsx(Ul,{index:5}),s.jsx(Ul,{index:6}),s.jsx(Ul,{index:7})]}):s.jsxs(s.Fragment,{children:[s.jsxs(zl,{children:[s.jsx(Ul,{index:0}),s.jsx(Ul,{index:1}),s.jsx(Ul,{index:2})]}),s.jsx(Vl,{}),s.jsxs(zl,{children:[s.jsx(Ul,{index:3}),s.jsx(Ul,{index:4}),s.jsx(Ul,{index:5})]})]})})}),s.jsxs(ki,{variant:"destructive",onClick:()=>e(r,i),disabled:t||r.length!==(i?8:6),className:"w-full rounded-xl px-6 py-3 transition-all disabled:opacity-50",children:[t&&s.jsx(ac,{className:"mr-2"}),a(t?"com_ui_disabling":"com_ui_2fa_disable")]}),s.jsx("button",{onClick:()=>l(!i),className:"text-sm text-primary hover:underline",children:a(i?"com_ui_use_2fa_code":"com_ui_use_backup_code")})]})},fU=({enabled:e,onChange:t,disabled:n})=>{const a=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs(dl,{className:"font-light",children:[" ",a("com_nav_2fa")]})}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(ki,{variant:e?"destructive":"outline",onClick:t,disabled:n,children:a(e?"com_ui_2fa_disable":"com_ui_2fa_enable")})})]})},hU={initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},gU=S.memo((()=>{const e=Fk(),{user:t}=Kk(),a=Pe(Ny.user),{showToast:r}=Bd(),[o,i]=n.useState(""),[l,c]=n.useState(""),[d,u]=n.useState(!1),[m,p]=n.useState([]),[f,h]=n.useState(""),[g,x]=n.useState(!1),[v,b]=n.useState(""),[_,y]=n.useState((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),{mutate:j}=(()=>{const e=pr();return fr((e=>Rx.confirmTwoFactor(e)),{onSuccess:t=>{e.setQueryData([xx.user,"2fa"],t)}})})(),{mutate:w,isLoading:N}=(()=>{const e=pr();return fr((()=>Rx.enableTwoFactor()),{onSuccess:t=>{e.setQueryData([xx.user,"2fa"],t)}})})(),{mutate:C,isLoading:k}=(()=>{const e=pr();return fr((e=>Rx.verifyTwoFactor(e)),{onSuccess:t=>{e.setQueryData([xx.user,"2fa"],t)}})})(),{mutate:S,isLoading:E}=(()=>{const e=pr();return fr((e=>Rx.disableTwoFactor(e)),{onSuccess:()=>{e.setQueryData([xx.user,"2fa"],null)}})})(),T=["Setup","Scan QR","Verify","Backup"],I={setup:"Setup",qr:"Scan QR",verify:"Verify",backup:"Backup",disable:""},R=T.indexOf(I[_]),P=n.useCallback((()=>{(null==t?void 0:t.twoFactorEnabled)&&l&&S(void 0,{onError:()=>r({message:e("com_ui_2fa_disable_error"),status:"error"})}),c(""),i(""),p([]),b(""),h(""),y((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),u(!1)}),[t,l,S,e,r]),A=n.useCallback((()=>{w(void 0,{onSuccess:({otpauthUrl:e,backupCodes:t})=>{c(e),i(e.split("secret=")[1].split("&")[0]),p(t),y("qr")},onError:()=>r({message:e("com_ui_2fa_generate_error"),status:"error"})})}),[w,e,r]),M=n.useCallback((()=>{v&&C({token:v},{onSuccess:()=>{r({message:e("com_ui_2fa_verified")}),j({token:v},{onSuccess:()=>y("backup"),onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})},onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})}),[v,C,j,e,r]),L=n.useCallback((()=>{if(!m.length)return;const e=new Blob([m.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="backup-codes.txt",n.click(),URL.revokeObjectURL(t),u(!0)}),[m]),O=n.useCallback((()=>{x(!1),y("disable"),r({message:e("com_ui_2fa_enabled")}),a((e=>({...e,backupCodes:m.map((e=>({code:e,codeHash:e,used:!1,usedAt:null}))),twoFactorEnabled:!0})))}),[a,e,r,m]),D=n.useCallback(((t,n)=>{if(!n&&t.trim().length<6)return;if(n&&t.trim().length<8)return;const s={};n?s.backupCode=t.trim():s.token=t.trim(),S(s,{onSuccess:()=>{r({message:e("com_ui_2fa_disabled")}),x(!1),a((e=>({...e,totpSecret:"",backupCodes:[],twoFactorEnabled:!1}))),y("setup"),c("")},onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})}),[S,r,e,a]);return s.jsxs(ul,{open:g,onOpenChange:e=>{x(e),e||P()},children:[s.jsx(fU,{enabled:!!(null==t?void 0:t.twoFactorEnabled),onChange:()=>x(!0),disabled:k||E||N}),s.jsx(gl,{className:"w-11/12 max-w-lg p-6",children:s.jsx(io,{mode:"wait",children:s.jsxs(oo.div,{variants:hU,initial:"initial",animate:"animate",exit:"exit",className:"space-y-6",children:[s.jsxs(xl,{children:[s.jsxs(bl,{className:"mb-2 flex items-center gap-3 text-2xl font-bold",children:[s.jsx(Cs,{className:"h-6 w-6 text-primary"}),(null==t?void 0:t.twoFactorEnabled)?e("com_ui_2fa_disable"):e("com_ui_2fa_setup")]}),(null==t?void 0:t.twoFactorEnabled)&&"disable"!==_&&s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsx(Dl,{value:T.indexOf(I[_])/(T.length-1)*100,className:"h-2 rounded-full"}),s.jsx("div",{className:"flex justify-between text-sm",children:T.map(((e,t)=>s.jsx(oo.span,{animate:{color:R>=t?"var(--text-primary)":"var(--text-tertiary)"},className:"font-medium",children:e},e)))})]})]}),s.jsxs(io,{mode:"wait",children:["setup"===_&&s.jsx(uU,{isGenerating:N,onGenerate:A,onNext:()=>y("qr"),onError:e=>r({message:e.message,status:"error"})}),"qr"===_&&s.jsx(iU,{secret:o,otpauthUrl:l,onNext:()=>y("verify"),onError:e=>r({message:e.message,status:"error"})}),"verify"===_&&s.jsx(cU,{token:v,onTokenChange:b,isVerifying:k,onNext:M,onError:e=>r({message:e.message,status:"error"})}),"backup"===_&&s.jsx(rU,{backupCodes:m,onDownload:L,downloaded:d,onNext:O,onError:e=>r({message:e.message,status:"error"})}),"disable"===_&&s.jsx(pU,{onDisable:D,isDisabling:E,onError:e=>r({message:e.message,status:"error"})})]})]},_)})})]})})),xU=S.memo((()=>{const e=Fk(),{user:t}=Kk(),{showToast:a}=Bd(),r=Pe(Ny.user),[o,i]=n.useState(!1),{mutate:l,isLoading:c}=(()=>{const e=pr();return fr((()=>Rx.regenerateBackupCodes()),{onSuccess:t=>{e.setQueryData([xx.user,"2fa","backup"],t)}})})(),d=()=>{((t=!1)=>{l(void 0,{onSuccess:n=>{const s=n.backupCodesHash.map((e=>({codeHash:e,used:!1,usedAt:null})));if(r((e=>({...e,backupCodes:s}))),a({message:e("com_ui_backup_codes_regenerated"),status:"success"}),!t&&s.length){const e=n.backupCodes.join("\n"),t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="backup-codes.txt",a.click(),URL.revokeObjectURL(s)}},onError:()=>a({message:e("com_ui_backup_codes_regenerate_error"),status:"error"})})})(!1)};return s.jsxs(ul,{open:o,onOpenChange:i,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-3",children:s.jsx(dl,{className:"font-light",children:e("com_ui_backup_codes")})}),s.jsx(ml,{asChild:!0,children:s.jsx(ki,{"aria-label":"Manage Backup Codes",variant:"outline",children:e("com_ui_manage")})})]}),s.jsxs(gl,{className:"w-11/12 max-w-lg",children:[s.jsx(bl,{className:"mb-6 text-2xl font-semibold",children:e("com_ui_backup_codes")}),s.jsx(io,{children:s.jsx(oo.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-4",children:Array.isArray(null==t?void 0:t.backupCodes)&&(null==t?void 0:t.backupCodes.length)>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-warning-300 bg-warning-50 dark:border-warning-700 dark:bg-warning-900/20 mb-6 rounded-lg border p-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_backup_codes_security_info")})}),s.jsx("h3",{className:"mb-4 text-lg font-medium",children:e("com_ui_backup_codes_status")}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:null==t?void 0:t.backupCodes.map(((t,n)=>{const a=t.used,r=`Backup code number ${n+1}, ${a?`used on ${t.usedAt?new Date(t.usedAt).toLocaleDateString():"an unknown date"}`:"not used yet"}`;return s.jsx(oo.div,{role:"listitem",tabIndex:0,"aria-label":r,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},onFocus:()=>{const e=new CustomEvent("announce",{detail:{message:r}});document.dispatchEvent(e)},className:`flex flex-col rounded-xl border p-4 backdrop-blur-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary ${a?"border-red-200 bg-red-50/80 dark:border-red-800 dark:bg-red-900/20":"border-green-200 bg-green-50/80 dark:border-green-800 dark:bg-green-900/20"} `,children:s.jsxs("div",{className:"flex items-center justify-between","aria-hidden":"true",children:[s.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e("com_ui_backup_code_number",{number:n+1})}),s.jsx(Ol,{description:t.usedAt?new Date(t.usedAt).toLocaleDateString():"",disabled:!a,focusable:!1,className:a?"cursor-pointer":"cursor-default",render:s.jsx("span",{className:"rounded-full px-3 py-1 text-sm font-medium "+(a?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300"),children:e(a?"com_ui_used":"com_ui_not_used")})})]})},t.codeHash)}))}),s.jsx("div",{className:"mt-12 flex justify-center",children:s.jsxs(ki,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c?s.jsx(ac,{className:"mr-2"}):s.jsx(ks,{className:"mr-2 h-4 w-4"}),e(c?"com_ui_regenerating":"com_ui_regenerate_backup")]})})]}):s.jsx("div",{className:"flex flex-col items-center gap-4 p-6 text-center",children:s.jsxs(ki,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c&&s.jsx(ac,{className:"mr-2"}),e("com_ui_regenerate_backup")]})})})})]})]})}));const vU=S.memo((function(){const{user:e}=Kk();return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Jz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(sU,{})}),"local"===(null==e?void 0:e.provider)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"pb-3",children:s.jsx(gU,{})}),(null==e?void 0:e.twoFactorEnabled)&&s.jsx("div",{className:"pb-3",children:s.jsx(xU,{})})]}),s.jsx("div",{className:"pb-3",children:s.jsx(eU,{})})]})})),bU=({tokenCredits:e})=>{const t=Fk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(dl,{className:"font-light",children:t("com_nav_balance")}),s.jsx(Md,{side:Li.Bottom,text:t("com_nav_info_balance")})]}),s.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:void 0!==e?e.toFixed(2):"0.00"})]})},_U=(e,t,n)=>{const s=new Date(e);switch(n){case"seconds":s.setSeconds(s.getSeconds()+t);break;case"minutes":s.setMinutes(s.getMinutes()+t);break;case"hours":s.setHours(s.getHours()+t);break;case"days":s.setDate(s.getDate()+t);break;case"weeks":s.setDate(s.getDate()+7*t);break;case"months":s.setMonth(s.getMonth()+t)}return s};const yU=({lastRefill:e,refillAmount:t,refillIntervalUnit:n,refillIntervalValue:a})=>{const r=Fk(),o=e?new Date(e):null,i=o?function(e,t,n){const s=new Date;if(e>s)return _U(e,t,n);if("months"===n){let a=new Date(e);for(;a<=s;)a=_U(a,t,n);return a}const a={seconds:1e3*t,minutes:1e3*t*60,hours:1e3*t*60*60,days:1e3*t*60*60*24,weeks:1e3*t*60*60*24*7}[n];if(a<=0)return _U(e,t,n);const r=s.getTime()-e.getTime(),o=Math.floor(r/a)+1,i=e.getTime()+o*a;return new Date(i)}(o,a,n):null;return s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:r("com_nav_balance_auto_refill_settings")}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_last_refill")}),s.jsx("span",{children:o?o.toLocaleString():"-"})]}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_refill_amount")}),s.jsx("span",{children:void 0!==t?t:"-"})]}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_interval")}),s.jsxs("span",{children:[r("com_nav_balance_every")," ",a," ",((e,t)=>{let n;switch(t){case"seconds":n=1===e?"com_nav_balance_second":"com_nav_balance_seconds";break;case"minutes":n=1===e?"com_nav_balance_minute":"com_nav_balance_minutes";break;case"hours":n=1===e?"com_nav_balance_hour":"com_nav_balance_hours";break;case"days":n=1===e?"com_nav_balance_day":"com_nav_balance_days";break;case"weeks":n=1===e?"com_nav_balance_week":"com_nav_balance_weeks";break;case"months":n=1===e?"com_nav_balance_month":"com_nav_balance_months";break;default:n="com_nav_balance_seconds"}return r(n)})(a,n)]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(dl,{className:"font-light",children:r("com_nav_balance_next_refill")}),s.jsx(Md,{side:Li.Bottom,text:r("com_nav_balance_next_refill_info")})]}),s.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:i?i.toLocaleString():"-"})]})]})};const jU=S.memo((function(){var e;const t=Fk(),{isAuthenticated:n}=Kk(),{data:a}=Ky(),r=aj({enabled:!!n&&!!(null==(e=null==a?void 0:a.balance)?void 0:e.enabled)}).data,{tokenCredits:o=0,autoRefillEnabled:i=!1,lastRefill:l,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}=r??{},m=void 0!==l&&void 0!==c&&void 0!==d&&void 0!==u;return s.jsxs("div",{className:"flex flex-col gap-4 p-4 text-sm text-text-primary",children:[s.jsx(bU,{tokenCredits:o}),i?m?s.jsx(yU,{lastRefill:l,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}):s.jsx("div",{className:"text-sm text-red-600",children:t("com_nav_balance_auto_refill_error")}):s.jsx("div",{className:"text-sm text-gray-600",children:t("com_nav_balance_auto_refill_disabled")})]})}));function wU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.cloudBrowserVoices),[r]=Re(Ny.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_enable_cloud_browser_voice")}),s.jsx(Cl,{id:"CloudBrowserVoices",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"CloudBrowserVoices",disabled:!r})]})}function NU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.automaticPlayback);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_automatic_playback")}),s.jsx(Cl,{id:"AutomaticPlayback",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"AutomaticPlayback"})]})}function CU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_text_to_speech")})}),s.jsx(Cl,{id:"TextToSpeech",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"TextToSpeech"})]})}const kU=({external:e})=>{const t=Fk(),[n,a]=Re(Ny.engineTTS),r=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_engine")}),s.jsx(rd,{value:n,onChange:e=>{a(e)},options:r,sizeClasses:"w-[180px]",testId:"EngineTTSDropdown",className:"z-50"})]})};function SU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.cacheTTS),[r]=Re(Ny.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_enable_cache_tts")}),s.jsx(Cl,{id:"CacheTTS",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"CacheTTS",disabled:!r})]})}const EU={[Wd.browser]:function(){const e=Fk(),{voices:t=[]}=$j(),[n,a]=Re(Ny.voice);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_voice_select")}),s.jsx(rd,{value:n??"",options:t,onChange:e=>{s_.log("Browser Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"BrowserVoiceDropdown",className:"z-50"},`browser-voice-dropdown-${t.length}`)]})},[Wd.external]:function(){const e=Fk(),{voices:t=[]}=Bj(),[n,a]=Re(Ny.voice);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_voice_select")}),s.jsx(rd,{value:n??"",options:t,onChange:e=>{s_.log("External Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"ExternalVoiceDropdown",className:"z-50"},`external-voice-dropdown-${t.length}`)]})}};function TU(){const e=Ae(Ny.engineTTS),t=EU[e];return t?s.jsx(t,{}):null}function IU(){const e=Fk(),t=Ae(Ny.textToSpeech),[n,a]=Re(Ny.playbackRate);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_playback_rate")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"1"}),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(yl,{value:[n??1],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(null),min:.1,max:2,step:.1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(cl,{value:n??1,disabled:!t,onChange:e=>a(e?e[0]:0),min:.1,max:2,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function RU(){const e=Fk(),t=Ae(Ny.speechToText),[n,a]=Re(Ny.autoSendText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_auto_send_text")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_nav_auto_send_text_disabled"),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(yl,{value:[n??-1],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(-1),min:-1,max:60,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(cl,{value:`${n} s`,disabled:!t,onChange:e=>a(e?e[0]:0),min:-1,max:60,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function PU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.speechToText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_speech_to_text")})}),s.jsx(Cl,{id:"SpeechToText",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"SpeechToText"})]})}const AU=({external:e})=>{const t=Fk(),[n,a]=Re(Ny.engineSTT),r=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_engine")}),s.jsx(rd,{value:n,onChange:e=>{a(e)},options:r,sizeClasses:"w-[180px]",testId:"EngineSTTDropdown",className:"z-50"})]})};function MU(){const e=Fk(),t=Ae(Ny.speechToText),[n,a]=Re(Ny.decibelValue);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_db_sensitivity")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"-45"}),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(yl,{value:[n??-45],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(-45),min:-100,max:-30,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(cl,{value:n,disabled:!t,onChange:e=>a(e?e[0]:0),min:-100,max:-30,className:n_(f_,n_(h_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function LU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.autoTranscribeAudio),r=Ae(Ny.speechToText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_auto_transcribe_audio")}),s.jsx(Cl,{id:"AutoTranscribeAudio",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"AutoTranscribeAudio",disabled:!r})]})}function OU(){const e=Fk(),[t,n]=Re(Ny.languageSTT);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_language")}),s.jsx(rd,{value:t,onChange:e=>{n(e)},options:[{value:"af",label:"Afrikaans"},{value:"eu",label:"Basque"},{value:"bg",label:"Bulgarian"},{value:"ca",label:"Catalan"},{value:"ar-EG",label:"Arabic (Egypt)"},{value:"ar-JO",label:"Arabic (Jordan)"},{value:"ar-KW",label:"Arabic (Kuwait)"},{value:"ar-LB",label:"Arabic (Lebanon)"},{value:"ar-QA",label:"Arabic (Qatar)"},{value:"ar-AE",label:"Arabic (UAE)"},{value:"ar-MA",label:"Arabic (Morocco)"},{value:"ar-IQ",label:"Arabic (Iraq)"},{value:"ar-DZ",label:"Arabic (Algeria)"},{value:"ar-BH",label:"Arabic (Bahrain)"},{value:"ar-LY",label:"Arabic (Libya)"},{value:"ar-OM",label:"Arabic (Oman)"},{value:"ar-SA",label:"Arabic (Saudi Arabia)"},{value:"ar-TN",label:"Arabic (Tunisia)"},{value:"ar-YE",label:"Arabic (Yemen)"},{value:"cs",label:"Czech"},{value:"nl-NL",label:"Dutch"},{value:"en-AU",label:"English (Australia)"},{value:"en-CA",label:"English (Canada)"},{value:"en-IN",label:"English (India)"},{value:"en-NZ",label:"English (New Zealand)"},{value:"en-ZA",label:"English (South Africa)"},{value:"en-GB",label:"English (UK)"},{value:"en-US",label:"English (US)"},{value:"et-EE",label:"Estonian"},{value:"fi",label:"Finnish"},{value:"fr-FR",label:"French"},{value:"gl",label:"Galician"},{value:"de-DE",label:"German"},{value:"el-GR",label:"Greek"},{value:"he",label:"Hebrew"},{value:"hu",label:"Hungarian"},{value:"is",label:"Icelandic"},{value:"it-IT",label:"Italian"},{value:"id",label:"Indonesian"},{value:"ja",label:"Japanese"},{value:"ko",label:"Korean"},{value:"la",label:"Latin"},{value:"lv-LV",label:"Latvian"},{value:"lt-LT",label:"Lithuanian"},{value:"zh-CN",label:"Mandarin Chinese"},{value:"zh-TW",label:"Taiwanese"},{value:"zh-HK",label:"Cantonese"},{value:"ms-MY",label:"Malaysian"},{value:"no-NO",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"xx-piglatin",label:"Pig Latin"},{value:"pt-PT",label:"Portuguese"},{value:"pt-br",label:"Portuguese (Brasil)"},{value:"ro-RO",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr-SP",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"es-AR",label:"Spanish (Argentina)"},{value:"es-BO",label:"Spanish (Bolivia)"},{value:"es-CL",label:"Spanish (Chile)"},{value:"es-CO",label:"Spanish (Colombia)"},{value:"es-CR",label:"Spanish (Costa Rica)"},{value:"es-DO",label:"Spanish (Dominican Republic)"},{value:"es-EC",label:"Spanish (Ecuador)"},{value:"es-SV",label:"Spanish (El Salvador)"},{value:"es-GT",label:"Spanish (Guatemala)"},{value:"es-HN",label:"Spanish (Honduras)"},{value:"es-MX",label:"Spanish (Mexico)"},{value:"es-NI",label:"Spanish (Nicaragua)"},{value:"es-PA",label:"Spanish (Panama)"},{value:"es-PY",label:"Spanish (Paraguay)"},{value:"es-PE",label:"Spanish (Peru)"},{value:"es-PR",label:"Spanish (Puerto Rico)"},{value:"es-ES",label:"Spanish (Spain)"},{value:"es-US",label:"Spanish (US)"},{value:"es-UY",label:"Spanish (Uruguay)"},{value:"es-VE",label:"Spanish (Venezuela)"},{value:"sv-SE",label:"Swedish"},{value:"tr",label:"Turkish"},{value:"zu",label:"Zulu"}],sizeClasses:"[--anchor-max-height:256px]",testId:"LanguageSTTDropdown",className:"z-50"})]})}function DU({onCheckedChange:e}){const t=Fk(),[n,a]=Re(Ny.conversationMode),r=Ae(Ny.speechToText),o=Ae(Ny.textToSpeech),[,i]=Re(Ny.autoSendText),[,l]=Re(Ny.decibelValue),[,c]=Re(Ny.autoTranscribeAudio);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_conversation_mode")})}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsx(Cl,{id:"ConversationMode",checked:n,onCheckedChange:t=>{c(t),i(3),l(-45),a(t),e&&e(t)},className:"ml-4","data-testid":"ConversationMode",disabled:!o||!r})})]})}const FU=S.memo((function(){const e=Fk(),[t,a]=n.useState(!1),{data:r}=jk(),o=Ki("(max-width: 767px)"),[i,l]=n.useState(!1),[c,d]=n.useState(!1),[u,m]=Re(Ny.advancedMode),[p,f]=Re(Ny.autoTranscribeAudio),[h,g]=Re(Ny.conversationMode),[x,v]=Re(Ny.speechToText),[b,_]=Re(Ny.textToSpeech),[y,j]=Re(Ny.cacheTTS),[w,N]=Re(Ny.engineSTT),[C,k]=Re(Ny.languageSTT),[S,E]=Re(Ny.decibelValue),[T,I]=Re(Ny.autoSendText),[R,P]=Re(Ny.engineTTS),[A,M]=Re(Ny.voice),[L,O]=Re(Ny.cloudBrowserVoices),[D,F]=Re(Ny.languageTTS),[z,U]=Re(Ny.automaticPlayback),[V,B]=Re(Ny.playbackRate),$=n.useCallback(((e,t)=>{const n={sttExternal:{value:i,setFunc:l},ttsExternal:{value:c,setFunc:d},conversationMode:{value:h,setFunc:g},advancedMode:{value:u,setFunc:m},speechToText:{value:x,setFunc:v},textToSpeech:{value:b,setFunc:_},cacheTTS:{value:y,setFunc:j},engineSTT:{value:w,setFunc:N},languageSTT:{value:C,setFunc:k},autoTranscribeAudio:{value:p,setFunc:f},decibelValue:{value:S,setFunc:E},autoSendText:{value:T,setFunc:I},engineTTS:{value:R,setFunc:P},voice:{value:A,setFunc:M},cloudBrowserVoices:{value:L,setFunc:O},languageTTS:{value:D,setFunc:F},automaticPlayback:{value:z,setFunc:U},playbackRate:{value:V,setFunc:B}}[e];n&&n.setFunc(t)}),[i,c,h,u,x,b,y,w,C,p,S,T,R,A,L,D,z,V,l,d,g,m,v,_,j,N,k,f,E,I,P,M,O,F,U,B]);return n.useEffect((()=>{r&&"not_found"!==r.message&&Object.entries(r).forEach((([e,t])=>{null===localStorage.getItem(e)&&"sttExternal"!==e&&"ttsExternal"!==e?$(e,t):"sttExternal"!==e&&"ttsExternal"!==e||$(e,t)}))}),[r]),n.useEffect((()=>{["browser","external"].includes(R)||P("browser")}),[R,P]),Wi(n.useRef(null),(()=>t&&a(!1)),[]),s.jsxs(Qa,{defaultValue:"simple",orientation:"horizontal",value:u?"advanced":"simple",children:[s.jsx("div",{className:"sticky -top-1 z-50 mb-4 bg-white dark:bg-gray-700",children:s.jsxs(ja,{className:"flex justify-center bg-background",children:[s.jsxs(wa,{onClick:()=>m(!1),className:n_("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",o?"flex-row rounded-lg":"rounded-xl","w-full"),value:"simple",style:{userSelect:"none"},children:[s.jsx(qe,{}),e("com_ui_simple")]}),s.jsxs(wa,{onClick:()=>m(!0),className:n_("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",o?"flex-row rounded-lg":"rounded-xl","w-full"),value:"advanced",style:{userSelect:"none"},children:[s.jsx(Ss,{}),e("com_ui_advanced")]})]})}),s.jsx(Na,{value:"simple",children:s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx(PU,{}),s.jsx(AU,{external:i}),s.jsx(OU,{}),s.jsx("div",{className:"h-px bg-border-medium",role:"none"}),s.jsx(CU,{}),s.jsx(kU,{external:c}),s.jsx(TU,{})]})}),s.jsx(Na,{value:"advanced",children:s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx(DU,{}),s.jsx("div",{className:"mt-2 h-px bg-border-medium",role:"none"}),s.jsx(PU,{}),s.jsx(AU,{external:i}),s.jsx(OU,{}),s.jsx("div",{className:"pb-2",children:s.jsx(LU,{})}),p&&s.jsx("div",{className:"pb-2",children:s.jsx(MU,{})}),s.jsx("div",{className:"pb-2",children:s.jsx(RU,{})}),s.jsx("div",{className:"h-px bg-border-medium",role:"none"}),s.jsx("div",{className:"pb-3",children:s.jsx(CU,{})}),s.jsx(NU,{}),s.jsx(kU,{external:c}),s.jsx(TU,{}),"browser"===R&&s.jsx("div",{className:"pb-2",children:s.jsx(wU,{})}),s.jsx("div",{className:"pb-2",children:s.jsx(IU,{})}),s.jsx(SU,{})]})})]})}));function zU({setNavVisible:e}){const t=Fk(),n=pr(),{newConversation:a}=JS(),r=Ae(Ny.conversationByIndex(0)),{title:o="New Chat"}=r||{};return s.jsxs("div",{className:"bg-token-main-surface-primary sticky top-0 z-10 flex min-h-[40px] items-center justify-center bg-white pl-1 dark:bg-gray-800 dark:text-white md:hidden",children:[s.jsxs("button",{type:"button","data-testid":"mobile-header-new-chat-button","aria-label":t("com_nav_open_sidebar"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),children:[s.jsx("span",{className:"sr-only",children:t("com_nav_open_sidebar")}),s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})]}),s.jsx("h1",{className:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap text-center text-sm font-normal",children:o??t("com_ui_new_chat")}),s.jsx("button",{type:"button","aria-label":t("com_ui_new_chat"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>{n.setQueryData([xx.messages,(null==r?void 0:r.conversationId)??Sh.NEW_CONVO],[]),n.invalidateQueries([xx.messages]),a()},children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})})]})}const UU=n.forwardRef(((e,t)=>{const a=Fk(),r=De(),o=pr(),i=Fe(),{isSmallScreen:l}=e,[c,d]=n.useState(""),u=n.useRef(null),[m,p]=n.useState(!1),{newConversation:f}=JS(),[h,g]=Re(Ny.search),x=n.useCallback((()=>{r.pathname.includes("/search")&&(f({disableFocus:!0}),i("/c/new",{replace:!0}))}),[f,r.pathname,i]),v=n.useCallback((()=>{var e;p(!1),d(""),g((e=>({...e,query:"",debouncedQuery:"",isTyping:!1}))),x(),null==(e=u.current)||e.focus()}),[g,x]),b=n.useCallback((e=>{e&&o.invalidateQueries([xx.messages])}),[o]),_=n.useMemo((()=>ko((e=>{g((t=>({...t,debouncedQuery:e,isTyping:!1}))),b(e)}),500)),[g,b]);return n.useEffect((()=>{h.isTyping&&!h.isSearching&&h.debouncedQuery===h.query&&g((e=>({...e,isTyping:!1})))}),[h.isTyping,h.isSearching,h.debouncedQuery,h.query,g]),s.jsxs("div",{ref:t,className:n_("group relative mt-1 flex h-10 cursor-pointer items-center gap-3 rounded-lg border-border-medium px-3 py-2 text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===l?"mb-2 h-14 rounded-xl":""),children:[s.jsx(wt,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),s.jsx("input",{type:"text",ref:u,className:"m-0 mr-0 w-full border-none bg-transparent p-0 pl-7 text-sm leading-tight placeholder-text-secondary placeholder-opacity-100 focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary",value:c,onChange:e=>{const t=e.target.value;p(t.length>0),d(t),g((e=>({...e,query:t,isTyping:!0}))),_(t),t.length>0&&"/search"!==r.pathname?i("/search",{replace:!0}):0===t.length&&"/search"===r.pathname&&i("/c/new",{replace:!0})},onKeyDown:e=>{"Space"===e.code&&e.stopPropagation()},"aria-label":a("com_nav_search_placeholder"),placeholder:a("com_nav_search_placeholder"),onKeyUp:e=>{const{value:t}=e.target;"Backspace"===e.key&&""===t&&v()},onFocus:()=>g((e=>({...e,isSearching:!0}))),onBlur:()=>g((e=>({...e,isSearching:!1}))),autoComplete:"off",dir:"auto"}),s.jsx("button",{type:"button","aria-label":`${a("com_ui_clear")} ${a("com_ui_search")}`,className:n_("absolute right-[7px] flex h-5 w-5 items-center justify-center rounded-full border-none bg-transparent p-0 transition-opacity duration-200",m?"opacity-100":"opacity-0",!0===l?"right-[16px]":""),onClick:v,tabIndex:m?0:-1,disabled:!m,children:s.jsx(vt,{className:"h-5 w-5 cursor-pointer"})})]})}));const VU=n.lazy((()=>li((()=>import("./BookmarkNav.DkcamgBI.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),BU=n.lazy((()=>li((()=>import("./AccountSettings.0d2sBFCE.js")),__vite__mapDeps([30,1,2,3,4,5,6,8,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),$U=n.lazy((()=>li((()=>import("./AgentMarketplaceButton.B8b4jdrn.js")),__vite__mapDeps([31,1,2,3,4,5,6,8,11,12,13,7,9,14,15,16,17,10,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),HU="260px",GU=n.memo((({navVisible:e,toggleNavVisible:t})=>s.jsx("div",{id:"mobile-nav-mask-toggle",role:"button",tabIndex:0,className:"nav-mask transition-opacity duration-200 ease-in-out "+(e?"active opacity-100":"opacity-0"),onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},"aria-label":"Toggle navigation"}))),KU=n.memo((function({index:e=0,toggleNav:t,subHeaders:a,isSmallScreen:r,headerButtons:o}){const i=pr(),{newConversation:l}=JS(e),c=Fe(),d=Fk(),{conversation:u}=Ny.useCreateConversationAtom(e),m=n.useCallback((e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(i.setQueryData([xx.messages,(null==u?void 0:u.conversationId)??Sh.NEW_CONVO],[]),i.invalidateQueries([xx.messages]),l(),c("/c/new",{state:{focusChat:!0}}),r&&t()):window.open("/c/new","_blank")}),[i,u,l,c,t,r]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between py-[2px] md:py-2",children:[s.jsx(Ol,{description:d("com_nav_close_sidebar"),render:s.jsxs(ki,{size:"icon",variant:"outline","data-testid":"close-sidebar-button","aria-label":d("com_nav_close_sidebar"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:t,children:[s.jsx(nc,{className:"max-md:hidden"}),s.jsx(sc,{className:"m-1 inline-flex size-10 items-center justify-center md:hidden"})]})}),s.jsxs("div",{className:"flex gap-0.5",children:[o,s.jsx(Ol,{description:d("com_ui_new_chat"),render:s.jsx(ki,{size:"icon",variant:"outline","data-testid":"nav-new-chat-button","aria-label":d("com_ui_new_chat"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:m,children:s.jsx(Fc,{className:"icon-lg text-text-primary"})})})]})]}),null!=a?a:null]})})),WU=n.memo((({navVisible:e,setNavVisible:t})=>{const a=Fk(),{isAuthenticated:r}=Kk(),[o,i]=n.useState(HU),l=Ki("(max-width: 768px)"),[c,d]=ET("newUser",!0),[u,m]=n.useState(!1),[p,f]=n.useState([]),h=Wk({permissionType:hg.BOOKMARKS,permission:gg.USE}),g=Ae(Ny.search),{data:x,fetchNextPage:v,isFetchingNextPage:b,isLoading:_,isFetching:y,refetch:j}=mj({tags:0===p.length?void 0:p,search:g.debouncedQuery||void 0},{enabled:r,staleTime:3e4,cacheTime:3e5}),w=n.useMemo((()=>{if((null==x?void 0:x.pages)&&x.pages.length>0){return null!==x.pages[x.pages.length-1].nextCursor}return!1}),[null==x?void 0:x.pages]),N=n.useRef(null),C=n.useRef(null),{moveToTop:k}=fE({setShowLoading:m,fetchNextPage:async e=>w?v(e):Promise.resolve({}),isFetchingNext:b}),S=n.useMemo((()=>x?x.pages.flatMap((e=>e.conversations)):[]),[x]),E=n.useCallback((()=>{t((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),c&&d(!1)}),[c,t,d]),T=n.useCallback((()=>{l&&E()}),[l,E]);n.useEffect((()=>{if(l){null===localStorage.getItem("navVisible")&&E(),i("320px")}else i(HU)}),[l,E]),n.useEffect((()=>{j()}),[p,j]);const I=n.useCallback((()=>{!b&&w&&v()}),[b,w,v]),R=n.useMemo((()=>!0===g.enabled&&s.jsx(UU,{isSmallScreen:l})),[g.enabled,l]),P=n.useMemo((()=>s.jsxs(s.Fragment,{children:[s.jsx(n.Suspense,{fallback:null,children:s.jsx($U,{isSmallScreen:l,toggleNav:E})}),h&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-1.5"}),s.jsx(n.Suspense,{fallback:null,children:s.jsx(VU,{tags:p,setTags:f,isSmallScreen:l})})]})]})),[h,p,l,E]),[A,M]=n.useState(!!g.query&&(g.isTyping||_||y));return n.useEffect((()=>{g.isTyping?M(!0):_||y?g.query&&(_||y)&&M(!0):M(!1)}),[g.query,g.isTyping,_,y]),s.jsxs(s.Fragment,{children:[s.jsx("div",{"data-testid":"nav",className:n_("nav active max-w-[320px] flex-shrink-0 transform overflow-x-hidden bg-surface-primary-alt transition-all duration-200 ease-in-out","md:max-w-[260px]"),style:{width:e?o:"0px",transform:e?"translateX(0)":"translateX(-100%)"},children:s.jsx("div",{className:"h-full w-[320px] md:w-[260px]",children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsx("div",{className:"flex h-full flex-col transition-opacity duration-200 ease-in-out "+(e?"opacity-100":"opacity-0"),children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsxs("nav",{id:"chat-history-nav","aria-label":a("com_ui_chat_history"),className:"flex h-full flex-col px-2 pb-3.5 md:px-3",children:[s.jsxs("div",{className:"flex flex-1 flex-col",ref:N,children:[s.jsx(KU,{subHeaders:R,toggleNav:E,headerButtons:P,isSmallScreen:l}),s.jsx(wD,{conversations:S,moveToTop:k,toggleNav:T,containerRef:C,loadMoreConversations:I,isLoading:b||u||_,isSearchLoading:A})]}),s.jsx(n.Suspense,{fallback:null,children:s.jsx(BU,{})})]})})})})})}),l&&s.jsx(GU,{navVisible:e,toggleNavVisible:E})]})}));WU.displayName="Nav",n.forwardRef(((e,t)=>{const{svg:n,text:a,clickHandler:r,disabled:o,className:i=""}=e,l={className:n_("w-full flex gap-2 rounded p-2.5 text-sm cursor-pointer group items-center transition-colors duration-200 text-text-primary",i,{"opacity-50 pointer-events-none":o})};return r&&(l.onClick=r),s.jsxs("button",{...l,ref:t,children:[n(),a]})}));const qU=n.forwardRef(((e,t)=>{const{id:n,value:a,label:r,subLabel:o,onChange:i,labelClassName:l="",inputClassName:c=""}=e,d=Fk();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n_("mt-4 flex flex-row",l),children:[s.jsx(dl,{htmlFor:n,className:"text-left text-sm font-medium",children:r}),dl&&s.jsx(dl,{className:"mx-1 text-right text-sm text-text-secondary",children:o}),s.jsx("br",{})]}),s.jsx("div",{className:"h-1"}),s.jsx(ll,{id:n,"data-testid":`input-${n}`,value:a??"",onChange:i,ref:t,placeholder:`${d("com_endpoint_config_value")} ${r}`,className:n_("flex h-10 max-h-10 w-full resize-none px-3 py-2")})]})})),QU=mo({client_email:po().email().min(3),project_id:po().min(3),private_key:po().min(601)}),YU=e=>QU.safeParse(e).success,XU=({endpoint:e,userProvideURL:t})=>{const{control:n}=Vo(),a=e===Uu.azureOpenAI;return s.jsxs("form",{className:"flex-wrap",children:[!a&&s.jsx(Uo,{name:"apiKey",control:n,render:({field:e})=>s.jsx(qU,{id:"apiKey",...e,label:(a?"Azure q":"")+"OpenAI API Key",labelClassName:"mb-1",inputClassName:"mb-2"})}),a&&s.jsxs(s.Fragment,{children:[s.jsx(Uo,{name:"azureOpenAIApiKey",control:n,render:({field:e})=>s.jsx(qU,{id:"azureOpenAIApiKey",...e,label:"Azure OpenAI API Key",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Uo,{name:"azureOpenAIApiInstanceName",control:n,render:({field:e})=>s.jsx(qU,{id:"azureOpenAIApiInstanceName",...e,label:"Azure OpenAI Instance Name",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Uo,{name:"azureOpenAIApiDeploymentName",control:n,render:({field:e})=>s.jsx(qU,{id:"azureOpenAIApiDeploymentName",...e,label:"Azure OpenAI Deployment Name",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Uo,{name:"azureOpenAIApiVersion",control:n,render:({field:e})=>s.jsx(qU,{id:"azureOpenAIApiVersion",...e,label:"Azure OpenAI API Version",labelClassName:"mb-1"})})]}),t&&s.jsx("div",{className:"mt-3",children:s.jsx(Uo,{name:"baseURL",control:n,render:({field:e})=>s.jsx(qU,{id:"baseURL",...e,label:"API Base URL",subLabel:"(Optional)",labelClassName:"mb-1"})})})]})};const ZU=n.memo((function({endpoint:e}){const t=Fk();return{[Uu.google]:s.jsxs(s.Fragment,{children:[s.jsxs("small",{className:"mt-4 break-all text-text-secondary",children:[t("com_endpoint_config_google_service_key"),": ",t("com_endpoint_config_key_google_need_to")," ",s.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/vertex-ai",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_vertex_ai")})," ",t("com_endpoint_config_key_google_vertex_api")," ",s.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/projectselector/iam-admin/serviceaccounts/create?walkthrough_id=iam--create-service-account#step_index=1",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_service_account")}),". ",t("com_endpoint_config_key_google_vertex_api_role")]}),s.jsxs("small",{className:"break-all text-text-secondary",children:[t("com_endpoint_config_google_api_key"),": ",t("com_endpoint_config_google_api_info")," ",s.jsx("a",{target:"_blank",href:"https://makersuite.google.com/app/apikey",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_click_here")})," "]})]})}[e]||null})),JU={[Uu.google]:({userKey:e,setUserKey:t})=>{const n=Fk(),{getMultiKey:a,setMultiKey:r}=function(e){return{getMultiKey:function(e,t){return iu(t)?JSON.parse(t)[e]:""},setMultiKey:function(t,n,s){let a={};iu(s)&&(a=JSON.parse(s)),a[t]=n,e(JSON.stringify(a))}}}(t);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-row",children:[s.jsx(dl,{htmlFor:jh.GOOGLE_SERVICE_KEY,className:"text-left text-sm font-medium",children:n("com_endpoint_config_google_service_key")}),s.jsx(dl,{className:"mx-1 text-right text-sm text-text-secondary",children:n("com_endpoint_config_google_cloud_platform")}),s.jsx("br",{})]}),s.jsx(iL,{id:jh.GOOGLE_SERVICE_KEY,className:"w-full",containerClassName:"dark:bg-gray-700 h-10 max-h-10 w-full resize-none py-2 dark:ring-1 dark:ring-gray-600",text:n("com_endpoint_config_key_import_json_key"),successText:n("com_endpoint_config_key_import_json_key_success"),invalidText:n("com_endpoint_config_key_import_json_key_invalid"),validator:YU,onFileSelected:t=>{r(jh.GOOGLE_SERVICE_KEY,JSON.stringify(t),e)}}),s.jsx(qU,{id:jh.GOOGLE_API_KEY,value:a(jh.GOOGLE_API_KEY,e)??"",onChange:t=>r(jh.GOOGLE_API_KEY,t.target.value??"",e),label:n("com_endpoint_config_google_api_key"),subLabel:n("com_endpoint_config_google_gemini_api")})]})},[Uu.openAI]:XU,[Uu.custom]:({endpoint:e,userProvideURL:t})=>{const{control:n}=Vo();return s.jsxs("form",{className:"flex-wrap",children:[s.jsx(Uo,{name:"apiKey",control:n,render:({field:t})=>s.jsx(qU,{id:"apiKey",...t,label:`${e} API Key`,labelClassName:"mb-1",inputClassName:"mb-2"})}),t&&s.jsx(Uo,{name:"baseURL",control:n,render:({field:t})=>s.jsx(qU,{id:"baseURL",...t,label:`${e} API URL`,labelClassName:"mb-1"})})]})},[Uu.azureOpenAI]:XU,[Uu.gptPlugins]:XU,[Uu.assistants]:XU,[Uu.azureAssistants]:XU,default:({userKey:e,setUserKey:t,endpoint:n})=>{const a=Fk();return s.jsx(qU,{id:n,value:e??"",onChange:e=>t(e.target.value??""),label:a("com_endpoint_config_key_name")})}},eV=new Set([Uu.openAI,Uu.custom,Uu.azureOpenAI,Uu.gptPlugins,Uu.assistants,Uu.azureAssistants]),tV={THIRTY_MINUTES:{label:"in 30 minutes",value:18e5},TWO_HOURS:{label:"in 2 hours",value:72e5},TWELVE_HOURS:{label:"in 12 hours",value:432e5},ONE_DAY:{label:"in 1 day",value:864e5},ONE_WEEK:{label:"in 7 days",value:6048e5},ONE_MONTH:{label:"in 30 days",value:2592e6},NEVER:{label:"never",value:0}},nV=({open:e,onOpenChange:t,endpoint:a,endpointType:r,userProvideURL:o})=>{const i=zo({defaultValues:{apiKey:"",baseURL:"",azureOpenAIApiKey:"",azureOpenAIApiInstanceName:"",azureOpenAIApiDeploymentName:"",azureOpenAIApiVersion:""}}),[l,c]=n.useState(""),{data:d}=Gy(),[u,m]=n.useState(tV.TWELVE_HOURS.label),{getExpiry:p,saveUserKey:f}=qS(a),{showToast:h}=Bd(),g=Fk(),x=Object.values(tV),v=JU[r??a]??JU.default,b=p(),_=null==d?void 0:d[a];return s.jsx(ul,{open:e,onOpenChange:t,children:s.jsx(zd,{title:`${g("com_endpoint_config_key_for")} ${uh[a]??a}`,className:"w-11/12 max-w-2xl",showCancelButton:!1,main:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx("small",{className:"text-red-600",children:"never"===b?g("com_endpoint_config_key_never_expires"):`${g("com_endpoint_config_key_encryption")} ${new Date(b??0).toLocaleString()}`}),s.jsx(rd,{label:"Expires ",value:u,onChange:e=>{m(e)},options:x.map((e=>e.label)),sizeClasses:"w-[185px]",portal:!1}),s.jsx("div",{className:"mt-2"}),s.jsx(Bo,{...i,children:s.jsx(v,{userKey:l,setUserKey:c,endpoint:a===Uu.gptPlugins&&(null==_?void 0:_.azure)?Uu.azureOpenAI:a,userProvideURL:o})}),s.jsx(ZU,{endpoint:a})]}),selection:{selectHandler:()=>{const e=x.find((e=>e.label===u));let n;n=0===(null==e?void 0:e.value)?null:Date.now()+(e?e.value:0);const s=e=>{f(e,n),t(!1)};eV.has(a)||eV.has(r??"")?i.handleSubmit((e=>{const n=a===Uu.azureOpenAI,r=n||a===Uu.openAI||a===Uu.gptPlugins||Yu(a);n&&(e.apiKey="n/a");const l=Object.keys(e).filter((t=>!(!n&&t.startsWith("azure"))&&((!r||"baseURL"!==t)&&(!("baseURL"===t&&!o)&&""===e[t]))));if(l.length>0)return h({message:"The following fields are required: "+l.join(", "),status:"error"}),void t(!0);const{apiKey:c,baseURL:d,...u}=e,m={apiKey:c,baseURL:d};n&&(m.apiKey=JSON.stringify({azureOpenAIApiKey:u.azureOpenAIApiKey,azureOpenAIApiInstanceName:u.azureOpenAIApiInstanceName,azureOpenAIApiDeploymentName:u.azureOpenAIApiDeploymentName,azureOpenAIApiVersion:u.azureOpenAIApiVersion})),s(JSON.stringify(m)),i.reset()}))():(s(l),c(""))},selectClasses:"btn btn-primary",selectText:g("com_ui_submit")},leftButtons:s.jsx(Bz,{endpoint:a,disabled:!b,setDialogOpen:t})})})},sV=({keyDialogOpen:e,keyDialogEndpoint:t,onOpenChange:n,endpointsConfig:a})=>s.jsx(s.Fragment,{children:t&&s.jsx(nV,{open:e,endpoint:t,endpointType:kb(a,t,"type"),onOpenChange:n,userProvideURL:kb(a,t,"userProvideURL")})});function aV(){const e=Fk(),{agentsMap:t,modelSpecs:a,mappedEndpoints:r,endpointsConfig:o,searchValue:i,searchResults:l,selectedValues:c,setSearchValue:d,setSelectedValues:u,keyDialogOpen:m,onOpenChange:p,keyDialogEndpoint:f}=pz(),h=n.useMemo((()=>function({mappedEndpoints:e,selectedValues:t,modelSpecs:n,endpointsConfig:s}){var a;const{endpoint:r,model:o,modelSpec:i}=t;if(i){const e=n.find((e=>e.name===i));if(!e)return null;const{showIconInHeader:t=!0}=e;return t?S.createElement(dz,{currentSpec:e,endpointsConfig:s}):null}if(r&&o){const t=e.find((e=>e.value===r));if(!t)return null;if(null==(a=t.modelIcons)?void 0:a[o]){const e=t.modelIcons[o];return S.createElement("div",{className:"h-5 w-5 overflow-hidden rounded-full"},S.createElement("img",{src:e,alt:o,className:"h-full w-full object-cover"}))}return t.icon||S.createElement(Ne,{size:20,className:"icon-md shrink-0 text-text-primary"})}if(r){const t=e.find((e=>e.value===r));return(null==t?void 0:t.icon)||null}return null}({mappedEndpoints:r??[],selectedValues:c,modelSpecs:a,endpointsConfig:o})),[r,c,a,o]),g=n.useMemo((()=>uz({localize:e,agentsMap:t,modelSpecs:a,selectedValues:c,mappedEndpoints:r})),[e,t,a,c,r]),x=s.jsxs("button",{className:"my-1 flex h-10 w-full max-w-[70vw] items-center justify-center gap-2 rounded-xl border border-border-light bg-surface-secondary px-3 py-2 text-sm text-text-primary hover:bg-surface-tertiary","aria-label":e("com_ui_select_model"),children:[h&&S.isValidElement(h)&&s.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:h}),s.jsx("span",{className:"flex-grow truncate text-left",children:g})]});return s.jsxs("div",{className:"relative flex w-full max-w-md flex-col items-center gap-2",children:[s.jsx(hz,{values:c,onValuesChange:e=>{u({endpoint:e.endpoint||"",model:e.model||"",modelSpec:e.modelSpec||""})},onSearch:e=>d(e),combobox:s.jsx("input",{placeholder:e("com_endpoint_search_models")}),trigger:x,children:l?Cz(l,e,i):s.jsxs(s.Fragment,{children:[(v=a,b=c.modelSpec||"",v&&0!==v.length?v.map((e=>s.jsx(vz,{spec:e,isSelected:b===e.name},e.name))):null),wz(r??[])]})}),s.jsx(sV,{keyDialogOpen:m,onOpenChange:p,endpointsConfig:o||{},keyDialogEndpoint:f||void 0})]});var v,b}function rV({startupConfig:e}){return s.jsx(cz,{children:s.jsx(fz,{startupConfig:e,children:s.jsx(aV,{})})})}function oV({isSharedButtonEnabled:e}){const t=Fk(),[a,r]=n.useState(!1),[o,i]=n.useState(!1),[l,c]=n.useState(!1),d=n.useId(),u=n.useRef(null),m=n.useRef(null),p=Ki("(max-width: 768px)"),f=Ae(Ny.conversationByIndex(0));if(!1===(f&&null!=f.conversationId&&"new"!==f.conversationId&&"search"!==f.conversationId))return null;const h=[{label:t("com_ui_share"),onClick:()=>{c(!0)},icon:s.jsx(Qt,{className:"icon-md mr-2 text-text-secondary"}),show:e,hideOnClick:!1,ref:u,render:e=>s.jsx("button",{...e})},{label:t("com_endpoint_export"),onClick:()=>{r(!0)},icon:s.jsx(Ns,{className:"icon-md mr-2 text-text-secondary"}),hideOnClick:!1,ref:m,render:e=>s.jsx("button",{...e})}];return s.jsxs(s.Fragment,{children:[s.jsx(wd,{portal:!0,menuId:d,focusLoop:!0,unmountOnHide:!0,isOpen:o,setIsOpen:i,trigger:s.jsx(Ol,{description:t("com_endpoint_export_share"),render:s.jsx(ie,{id:"export-menu-button","aria-label":"Export options",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(Qt,{className:"icon-md text-text-secondary","aria-hidden":"true",focusable:"false"})})}),items:h,className:p?"":"absolute right-0 top-0 mt-2"}),s.jsx(Sz,{open:a,onOpenChange:r,conversation:f,triggerRef:m,"aria-label":t("com_ui_export_convo_modal")}),s.jsx(hD,{triggerRef:u,conversationId:f.conversationId??"",open:l,onOpenChange:c})]})}const iV=()=>{const e=Fk(),t=pr(),{showToast:a}=Bd(),r=Ae(Ny.conversationByIndex(0))||void 0,o=(null==r?void 0:r.conversationId)??"",i=(e=>{const t=Pe(Ny.updateConversationSelector(e)),{updateTagsInConversation:n}=dj();return s=>{e&&(n(e,s),t({tags:s}))}})(o),l=null==r?void 0:r.tags,c=null!=(null==r?void 0:r.expiredAt),d=n.useId(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),h=((e,t)=>{const n=fj(),{updateTagsInConversation:s}=dj();return fr((t=>Rx.addTagToConversation(e,t)),{onSuccess:(a,...r)=>{var o;n.refetch(),s(e,a),null==(o=null==t?void 0:t.onSuccess)||o.call(t,a,...r)},onError:null==t?void 0:t.onError,onMutate:null==t?void 0:t.onMutate})})(o,{onSuccess:(e,t)=>{i(e);const n=document.getElementById(t.tag);console.log("tagElement",n),n&&setTimeout((()=>n.focus()),2)},onError:()=>{a({message:"Error adding bookmark",severity:eu.ERROR})},onMutate:e=>{const t=document.getElementById(e.tag);console.log("tagElement",t),t&&setTimeout((()=>t.focus()),2)}}),{data:g}=fj(),x=Boolean(r&&o&&o!==Sh.NEW_CONVO&&"search"!==o),v=n.useCallback((e=>{if(void 0===e||""===e||!o)return void a({message:"Invalid tag or conversationId",severity:eu.ERROR});s_.log("tag_mutation","BookmarkMenu - handleSubmit: tags before setting",l);const n=(t.getQueryData([xx.conversationTags])??[]).map((e=>e.tag)),s=null==l?void 0:l.filter((e=>n.includes(e)));s_.log("tag_mutation","BookmarkMenu - handleSubmit: tags after filtering",s);const r=!0===(null==s?void 0:s.includes(e))?s.filter((t=>t!==e)):[...s??[],e];s_.log("tag_mutation","BookmarkMenu - handleSubmit: tags after",r),h.mutate({tags:r,tag:e})}),[l,o,h,t,a]),b=n.useRef(null),_=n.useMemo((()=>{const t=[{id:"%___new___bookmark___%",label:e("com_ui_bookmarks_new"),icon:s.jsx(nn,{className:"size-4"}),hideOnClick:!1,ref:b,render:e=>s.jsx("button",{...e}),onClick:()=>f(!0)}];if(g)for(const e of g){const n=null==l?void 0:l.includes(e.tag);t.push({id:e.tag,label:e.tag,hideOnClick:!1,icon:!0===n?s.jsx(Ya,{className:"size-4"}):s.jsx(Xa,{className:"size-4"}),onClick:()=>v(e.tag),disabled:h.isLoading})}return t}),[l,g,v,h.isLoading,e]);if(!x)return null;if(c)return null;return s.jsxs(dS.Provider,{value:{bookmarks:g||[]},children:[s.jsx(wd,{portal:!0,menuId:d,focusLoop:!0,isOpen:u,unmountOnHide:!0,setIsOpen:m,keyPrefix:`${o}-bookmark-`,trigger:s.jsx(Ol,{description:e("com_ui_bookmarks_add"),render:s.jsx(ie,{id:"bookmark-menu-button","aria-label":e("com_ui_bookmarks_add"),className:n_("mt-text-sm flex size-10 flex-shrink-0 items-center justify-center gap-2 rounded-xl border border-border-light text-sm transition-colors duration-200 hover:bg-surface-hover",u?"bg-surface-hover":""),"data-testid":"bookmark-menu",children:h.isLoading?s.jsx(ac,{"aria-label":"Spinner"}):((null==l?void 0:l.length)??0)>0?s.jsx(Ya,{className:"icon-sm","aria-label":"Filled Bookmark"}):s.jsx(Xa,{className:"icon-sm","aria-label":"Bookmark"})})}),items:_}),s.jsx(EP,{tags:l,open:p,setTags:i,setOpen:f,triggerRef:b,conversationId:o,context:"BookmarkMenu - BookmarkEditDialog"})]})};function lV(){const e=Fk(),[t,n]=Re(Ny.isTemporary),{conversation:a,isSubmitting:r}=Pk(),o={icon:Es,label:"com_ui_temporary",atom:Ny.isTemporary},i=Ie((()=>()=>{n(!t)}),[t]);return Array.isArray(null==a?void 0:a.messages)&&a.messages.length>=1||r?null:s.jsx("div",{className:"relative flex flex-wrap items-center gap-2",children:s.jsx(Ol,{description:e(o.label),render:s.jsx("button",{onClick:i,"aria-label":e(o.label),className:n_("inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",t?"bg-surface-active shadow-md":"bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md","active:shadow-inner"),children:o.icon&&s.jsx(o.icon,{className:n_("relative h-5 w-5 md:h-4 md:w-4",!1)})})})})}function cV(){const{conversation:e}=Pk(),{setConversation:t}=aS(),n=Fk();return e?Yu(e.endpoint)?null:s.jsx(Ol,{id:"add-multi-conversation-button","aria-label":n("com_ui_add_multi_conversation"),description:n("com_ui_add_multi_conversation"),tabIndex:0,role:"button",onClick:()=>{const{title:n,...s}=e??{};t({...s,title:""});const a=document.getElementById(qd);a&&a.focus()},"data-testid":"parameters-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(bt,{size:16,"aria-label":"Plus Icon"})}):null}const dV=lh().interface;function uV(){const{data:e}=Ky(),{navVisible:t,setNavVisible:a}=ct(),r=n.useMemo((()=>(null==e?void 0:e.interface)??dV),[e]),o=Wk({permissionType:hg.BOOKMARKS,permission:gg.USE}),i=Wk({permissionType:hg.MULTI_CONVO,permission:gg.USE}),l=Ki("(max-width: 768px)");return s.jsxs("div",{className:"sticky top-0 z-10 flex h-14 w-full items-center justify-between bg-white p-2 font-semibold text-text-primary dark:bg-gray-800",children:[s.jsxs("div",{className:"hide-scrollbar flex w-full items-center justify-between gap-2 overflow-x-auto",children:[s.jsxs("div",{className:"mx-1 flex items-center gap-2",children:[s.jsxs("div",{className:`flex items-center gap-2 ${l?"":"transition-all duration-200 ease-in-out"} ${t?"pointer-events-none translate-x-[-100px] opacity-0":"translate-x-0 opacity-100"}`,children:[s.jsx(mL,{setNavVisible:a,className:"max-md:hidden"}),s.jsx(pL,{})]}),s.jsxs("div",{className:`flex items-center gap-2 ${l?"":"transition-all duration-200 ease-in-out"} ${t?"translate-x-[-100px]":"translate-x-0"}`,children:[s.jsx(rV,{startupConfig:e}),!0===r.presets&&r.modelSelect&&s.jsx(uL,{}),!0===o&&s.jsx(iV,{}),!0===i&&s.jsx(cV,{}),l&&s.jsxs(s.Fragment,{children:[s.jsx(oV,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),s.jsx(lV,{})]})]})]}),!l&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(oV,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),s.jsx(lV,{})]})]}),s.jsx("div",{})]})}function mV(){return s.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:s.jsx("div",{className:"relative flex h-full items-center justify-center",children:s.jsx(ac,{className:"text-text-primary"})})})}const pV=n.memo((function({index:e=0}){const{conversationId:t}=nt(),a=Ae(Ny.submissionByIndex(e)),r=Ae(Ny.submissionByIndex(e+1)),o=Ae(Ny.centerFormOnLanding),i=nS(),{data:l=null,isLoading:c}=sj(t??"",{select:n.useCallback((e=>{const t=Zh({messages:e,fileMap:i});return 0===(null==t?void 0:t.length)?null:t??null}),[i]),enabled:!!i}),d=eE(e,t),u=function({rootIndex:e}){const t=n.useMemo((()=>e+1),[e]),{ask:s,regenerate:a,setMessages:r,getMessages:o,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d}=tE({rootIndex:e,currentIndex:t}),{generateConversation:u}=nE({index:t,rootIndex:e,setConversation:c});return{ask:s,regenerate:a,getMessages:o,setMessages:r,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d,generateConversation:u,addedIndex:t}}({rootIndex:e});gT(a,d,!1),gT(r,u,!0);const m=zo({defaultValues:{text:""}});let p;const f=!(l&&0!==l.length||t!==Sh.NEW_CONVO&&t),h=(!l||0===l.length)&&null!=t;return p=c&&t!==Sh.NEW_CONVO?s.jsx(mV,{}):!c&&!h||f?f?s.jsx(iz,{centerFormOnLanding:o}):s.jsx(HD,{messagesTree:l}):s.jsx(mV,{}),s.jsx(lS,{...m,children:s.jsx(Rk.Provider,{value:d,children:s.jsx(sS.Provider,{value:u,children:s.jsx(bF,{children:s.jsxs("div",{className:"flex h-full w-full flex-col",children:[!c&&s.jsx(uV,{}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n_("flex flex-col",f?"flex-1 items-center justify-end sm:justify-center":"h-full overflow-y-auto"),children:[p,s.jsxs("div",{className:n_("w-full",f&&"max-w-3xl transition-all duration-200 xl:max-w-4xl"),children:[s.jsx(az,{index:e}),f?s.jsx(tD,{}):s.jsx(ZO,{})]})]}),f&&s.jsx(ZO,{})]})]})})})})})}));function fV(){const{data:e}=Ky(),{isAuthenticated:t,user:a}=function(){const{user:e,isAuthenticated:t}=Kk(),s=Fe();return n.useEffect((()=>{const e=setTimeout((()=>{t||s("/login",{replace:!0})}),300);return()=>{clearTimeout(e)}}),[t,s]),{user:e,isAuthenticated:t}}(),r=Ie((({set:e})=>t=>{e(_y.isTemporary,t)}),[]);aE({startupConfig:e,user:a});const{conversationId:o=""}=nt();!function(e){const t=n.useRef(null),s=Oe(Ny.visibleArtifacts);n.useEffect((()=>{e!==t.current&&(s_.log("conversation","Conversation ID change"),s()),t.current=e}),[e,s])}(o);const{hasSetConversation:i,conversation:l}=Ny.useCreateConversationAtom(0),{newConversation:c}=JS(),d=mk({enabled:t,refetchOnMount:"always"}),u=((e,t)=>{const n=pr();return mr([xx.conversation,e],(()=>{const t=ob(n.getQueryData([xx.allConversations],{exact:!1}),e);return t&&null!=t.messages?t:Rx.getConversationById(e)}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})(o,{enabled:t&&o!==Sh.NEW_CONVO&&!i.current}),m=Gy({enabled:t}),p=Mk(),f=!(!l||!l.expiredAt);return n.useEffect((()=>{o===Sh.NEW_CONVO||f?f&&r(f):r(!1)}),[o,f,r]),n.useEffect((()=>{var t;if((e&&!i.current&&!(null==(t=d.data)?void 0:t.initial))??!1)if(o===Sh.NEW_CONVO&&m.data&&d.data){const t=Ib(e);s_.log("conversation","ChatRoute, new convo effect",l),c({modelsData:d.data,template:l||void 0,...t?{preset:Rb(t)}:{}}),i.current=!0}else if(u.data&&m.data&&d.data)s_.log("conversation","ChatRoute initialConvoQuery",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),i.current=!0;else if(o===Sh.NEW_CONVO&&p[Uu.assistants]&&p[Uu.azureAssistants]){const t=Ib(e);s_.log("conversation","ChatRoute new convo, assistants effect",l),c({modelsData:d.data,template:l||void 0,...t?{preset:Rb(t)}:{}}),i.current=!0}else p[Uu.assistants]&&p[Uu.azureAssistants]&&(s_.log("conversation","ChatRoute convo, assistants effect",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),i.current=!0)}),[e,u.data,m.data,d.data,p]),m.isLoading||d.isLoading?s.jsx("div",{className:"flex h-screen items-center justify-center","aria-live":"polite",role:"status",children:s.jsx(ac,{className:"text-text-primary"})}):t?(null==l?void 0:l.conversationId)===Sh.SEARCH?null:((null==l?void 0:l.conversationId)===o||l)&&o?s.jsx(kS,{conversationId:l.conversationId??"",children:s.jsx(pV,{index:0})}):null:null}const hV=S.forwardRef(((e,t)=>s.jsx("div",{className:n_("relative flex w-full grow overflow-hidden bg-white dark:bg-gray-800",e.className),children:s.jsx("div",{className:"transition-width relative h-full w-full flex-1 overflow-auto bg-white dark:bg-gray-800",children:s.jsx("div",{className:"flex h-full flex-col",role:"presentation",tabIndex:0,children:s.jsx("div",{className:"flex-1 overflow-hidden overflow-y-auto",children:s.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:s.jsx("div",{ref:t,style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e.children,s.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})})})})));function gV({message:e}){const t=Fk(),n=pr(),a=Ae(Ny.search),{navigateToConvo:r}=iE(),o=e.conversationId??"";return o?s.jsx("div",{className:"visible mt-0 flex items-center justify-center gap-1 self-end text-text-secondary lg:justify-start",children:s.jsxs("button",{type:"button",className:"ml-0 flex cursor-pointer items-center gap-1.5 rounded-md p-1 text-xs hover:text-text-primary hover:underline",onClick:async t=>{if(t.preventDefault(),!o)return;let s=e.title??"",i=n.getQueryData([xx.conversation,o]);const l=n.getQueryData([xx.allConversations,{search:a.debouncedQuery}]);!i&&l&&(i=ob(l,o)),s||(s=(null==i?void 0:i.title)??""),document.title=s,r(i??{conversationId:o,title:s},{resetLatestMessage:!0})},title:t("com_ui_go_to_conversation"),children:[s.jsx(Zt,{className:"icon-sm"}),e.title]})}):null}const xV=({iconData:e})=>s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:s.jsx("div",{className:"pt-0.5",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(LD,{iconData:e})})})}),vV=({message:e,messageLabel:t,fontSize:n})=>s.jsxs("div",{className:n_("relative flex w-11/12 flex-col",e.isCreatedByUser?"":"agent-turn"),children:[s.jsx("div",{className:n_("select-none font-semibold",n),children:t}),s.jsx(HO,{message:e}),s.jsxs(qO,{classes:"text-xs",children:[s.jsx(pO,{message:e}),s.jsx(gV,{message:e})]})]});function bV({message:e}){const t=Ae(Ny.UsernameDisplay),a=Ae(Ny.fontSize),{user:r}=Kk(),o=Fk(),i=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??"",model:(null==e?void 0:e.model)??"",iconURL:(null==e?void 0:e.iconURL)??"",isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1})),[null==e?void 0:e.endpoint,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.isCreatedByUser]),l=n.useMemo((()=>(null==e?void 0:e.isCreatedByUser)?t?((null==r?void 0:r.name)??"")||((null==r?void 0:r.username)??""):o("com_user_message"):(null==e?void 0:e.sender)??""),[null==e?void 0:e.isCreatedByUser,null==e?void 0:e.sender,t,null==r?void 0:r.name,null==r?void 0:r.username,o]);return e?s.jsx("div",{className:"text-token-text-primary w-full bg-transparent",children:s.jsx("div",{className:"m-auto p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-3xl md:px-5 lg:max-w-[40rem] lg:px-1 xl:max-w-[48rem] xl:px-5",children:[s.jsx(xV,{iconData:i}),s.jsx(vV,{message:e,messageLabel:l,fontSize:a})]})})}):null}function _V(){var e;const t=Fk(),a=nS(),{showToast:r}=Bd(),{isAuthenticated:o}=Kk(),i=Ae(Ny.search),l=i.debouncedQuery,{data:c,isLoading:d,isError:u,fetchNextPage:m,isFetchingNextPage:p,hasNextPage:f}=((e,t)=>{const{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}=e;return hr({queryKey:[xx.messages,{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}],queryFn:({pageParam:e})=>Rx.listMessages({sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})})({search:l||void 0},{enabled:o&&!!l,staleTime:3e4,cacheTime:3e5}),{containerRef:h}=fE({nextCursor:null==(e=null==c?void 0:c.pages[c.pages.length-1])?void 0:e.nextCursor,setShowLoading:()=>({}),fetchNextPage:m,isFetchingNext:p}),g=n.useMemo((()=>{const e=Zh({messages:(null==c?void 0:c.pages.flatMap((e=>e.messages)))||[],fileMap:a});return 0===(null==e?void 0:e.length)?null:e??null}),[a,null==c?void 0:c.pages]);n.useEffect((()=>{u&&l&&r({message:"An error occurred during search",status:"error"})}),[u,l,r]);return i.isTyping||d||p?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(ac,{className:"text-text-primary"})}):l?s.jsxs(hV,{ref:h,className:"relative flex h-full pt-4",children:[g&&0===g.length||null==g?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"rounded-lg bg-white p-6 text-lg text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:t("com_ui_nothing_found")})}):s.jsxs(s.Fragment,{children:[g.map((e=>s.jsx(bV,{message:e},e.messageId))),p&&s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(ac,{className:"text-text-primary"})})]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[5%] bg-gradient-to-t from-gray-50 to-transparent dark:from-gray-800"})]}):null}const yV=({open:e,onOpenChange:t,onAccept:a,onDecline:r,title:o,modalContent:i})=>{const l=Fk(),{showToast:c}=Bd(),d=(e=>{const t=pr();return fr((()=>Rx.acceptTerms()),{onSuccess:(n,s,a)=>{var r;t.setQueryData([xx.userTerms],{termsAccepted:!0}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)},onError:null==e?void 0:e.onError,onMutate:null==e?void 0:e.onMutate})})({onSuccess:()=>{a(),t(!1)},onError:()=>{c({message:"Failed to accept terms"})}}),u=n.useMemo((()=>"string"==typeof i?i:Array.isArray(i)?i.join("\n"):""),[i]);return s.jsx(ul,{open:e,onOpenChange:n=>{e&&!n||t(n)},children:s.jsx(Od,{title:o??l("com_ui_terms_and_conditions"),className:"w-11/12 max-w-3xl sm:w-3/4 md:w-1/2 lg:w-2/5",showCloseButton:!1,showCancelButton:!1,main:s.jsx("section",{tabIndex:0,className:"max-h-[60vh] overflow-y-auto p-4","aria-label":l("com_ui_terms_and_conditions"),children:s.jsx("div",{className:"prose dark:prose-invert w-full max-w-none !text-text-primary",children:""!==u?s.jsx(EA,{content:u}):s.jsx("p",{children:l("com_ui_no_terms_content")})})}),buttons:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{r(),t(!1)},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-surface-active",children:l("com_ui_decline")}),s.jsx("button",{onClick:()=>{d.mutate()},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-green-500 hover:text-white focus:bg-green-500 focus:text-white dark:hover:bg-green-600 dark:focus:bg-green-600",children:l("com_ui_accept")})]})})})};function jV(){var e,t,a,r;const[o,i]=n.useState(!1),[l,c]=n.useState(0),[d,u]=n.useState((()=>{const e=localStorage.getItem("navVisible");return null===e||JSON.parse(e)})),{isAuthenticated:m,logout:p}=Kk();((e=!1)=>{const t=pr(),s=n.useRef(!1),a=n.useRef(null),r=n.useRef(null);n.useEffect((()=>{if(!e)return;if(s.current)return;s.current=!0;const n=setTimeout((()=>{const e=async()=>{try{await t.fetchQuery([xx.health],(()=>Rx.healthCheck()),{retry:!1,cacheTime:0,staleTime:0})}catch(e){console.error("Health check failed:",e)}};e(),a.current=setInterval(e,vh.TEN_MINUTES);const n=async()=>{const n=t.getQueryState([xx.health]);if(!(null==n?void 0:n.dataUpdatedAt))return void(await e());const s=new Date(n.dataUpdatedAt),a=new Date(Date.now()-vh.TEN_MINUTES);s_.log(`Last health check: ${s.toISOString()}`),s_.log(`Ten minutes ago: ${a.toISOString()}`),s<a&&await e()};r.current=n,window.addEventListener("focus",n)}),500);return()=>{clearTimeout(n),a.current&&(clearInterval(a.current),a.current=null),r.current&&(window.removeEventListener("focus",r.current),r.current=null)}}),[e,t])})(m);const f=function({isAuthenticated:e}){const{data:t={}}=gj(Uu.assistants,void 0,{select:e=>su(e.data),enabled:e}),{data:n={}}=gj(Uu.azureAssistants,void 0,{select:e=>su(e.data),enabled:e});return{[Uu.assistants]:t,[Uu.azureAssistants]:n}}({isAuthenticated:m}),h=Lk({isAuthenticated:m}),g=function({isAuthenticated:e}){const{data:t}=qy({select:nu,enabled:e});return t}({isAuthenticated:m}),{data:x}=Ky(),{data:v}=(e=>mr([xx.userTerms],(()=>Rx.getUserTerms()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}))({enabled:m&&!0===(null==(t=null==(e=null==x?void 0:x.interface)?void 0:e.termsOfService)?void 0:t.modalAcceptance)});!function(e){const t=Pe(Ny.search),s=rj({enabled:e});n.useEffect((()=>{!0===s.data?t((e=>({...e,enabled:s.data}))):s.isError&&s_.error("Failed to get search enabled: ",s.error)}),[s.data,s.error,s.isError,t])}(m),n.useEffect((()=>{v&&i(!v.termsAccepted)}),[v]);return m?s.jsx(C_,{children:s.jsx(tS.Provider,{value:g,children:s.jsxs(gS.Provider,{value:f,children:[s.jsx(Ok.Provider,{value:h,children:s.jsxs($S,{children:[s.jsx(TL,{onHeightChange:c}),s.jsx("div",{className:"flex",style:{height:`calc(100dvh - ${l}px)`},children:s.jsxs("div",{className:"relative z-0 flex h-full w-full overflow-hidden",children:[s.jsx(WU,{navVisible:d,setNavVisible:u}),s.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col overflow-hidden",children:[s.jsx(zU,{setNavVisible:u}),s.jsx(En,{context:{navVisible:d,setNavVisible:u}})]})]})})]})}),!0===(null==(r=null==(a=null==x?void 0:x.interface)?void 0:a.termsOfService)?void 0:r.modalAcceptance)&&s.jsx(yV,{open:o,onOpenChange:i,onAccept:()=>{i(!1)},onDecline:()=>{i(!1),p("/login?redirect=false")},title:x.interface.termsOfService.modalTitle,modalContent:x.interface.termsOfService.modalContent})]})})}):null}const wV=()=>s.jsxs(Gk,{children:[s.jsx(En,{}),s.jsx(UT,{})]}),NV=document.querySelector("base"),CV=(null==NV?void 0:NV.getAttribute("href"))||"/",kV=Ms([{path:"share/:shareId",element:s.jsx(eD,{}),errorElement:s.jsx(kL,{})},{path:"oauth",errorElement:s.jsx(kL,{}),children:[{path:"success",element:s.jsx(jL,{})},{path:"error",element:s.jsx(wL,{})}]},{path:"/",element:s.jsx(AL,{}),errorElement:s.jsx(kL,{}),children:[{path:"register",element:s.jsx(DT,{})},{path:"forgot-password",element:s.jsx($T,{})},{path:"reset-password",element:s.jsx(FT,{})}]},{path:"verify",element:s.jsx(zT,{}),errorElement:s.jsx(kL,{})},{element:s.jsx(wV,{}),errorElement:s.jsx(kL,{}),children:[{path:"/",element:s.jsx(ML,{}),children:[{path:"login",element:s.jsx(OT,{})},{path:"login/2fa",element:s.jsx(HT,{})}]},mO,{path:"/",element:s.jsx(jV,{}),children:[{index:!0,element:s.jsx(Ln,{to:"/c/new",replace:!0})},{path:"c/:conversationId?",element:s.jsx(fV,{})},{path:"search",element:s.jsx(_V,{})},{path:"agents",element:s.jsx(yL,{})},{path:"agents/:category",element:s.jsx(yL,{})}]}]}],{basename:CV}),SV=()=>{const{setError:e}=bT(),t=new xr({queryCache:new vr({onError:t=>{var n;401===(null==(n=null==t?void 0:t.response)?void 0:n.status)&&e(t)}})}),n=function(){if(!Object.keys(d_).some((e=>e.startsWith("REACT_APP_THEME_"))))return;const e={},t=e=>d_[`REACT_APP_THEME_${e}`];return t("TEXT_PRIMARY")&&(e["rgb-text-primary"]=t("TEXT_PRIMARY")),t("TEXT_SECONDARY")&&(e["rgb-text-secondary"]=t("TEXT_SECONDARY")),t("TEXT_TERTIARY")&&(e["rgb-text-tertiary"]=t("TEXT_TERTIARY")),t("TEXT_WARNING")&&(e["rgb-text-warning"]=t("TEXT_WARNING")),t("SURFACE_PRIMARY")&&(e["rgb-surface-primary"]=t("SURFACE_PRIMARY")),t("SURFACE_SECONDARY")&&(e["rgb-surface-secondary"]=t("SURFACE_SECONDARY")),t("SURFACE_TERTIARY")&&(e["rgb-surface-tertiary"]=t("SURFACE_TERTIARY")),t("SURFACE_SUBMIT")&&(e["rgb-surface-submit"]=t("SURFACE_SUBMIT")),t("SURFACE_SUBMIT_HOVER")&&(e["rgb-surface-submit-hover"]=t("SURFACE_SUBMIT_HOVER")),t("SURFACE_DESTRUCTIVE")&&(e["rgb-surface-destructive"]=t("SURFACE_DESTRUCTIVE")),t("SURFACE_DESTRUCTIVE_HOVER")&&(e["rgb-surface-destructive-hover"]=t("SURFACE_DESTRUCTIVE_HOVER")),t("SURFACE_DIALOG")&&(e["rgb-surface-dialog"]=t("SURFACE_DIALOG")),t("SURFACE_CHAT")&&(e["rgb-surface-chat"]=t("SURFACE_CHAT")),t("BORDER_LIGHT")&&(e["rgb-border-light"]=t("BORDER_LIGHT")),t("BORDER_MEDIUM")&&(e["rgb-border-medium"]=t("BORDER_MEDIUM")),t("BORDER_HEAVY")&&(e["rgb-border-heavy"]=t("BORDER_HEAVY")),t("BORDER_XHEAVY")&&(e["rgb-border-xheavy"]=t("BORDER_XHEAVY")),t("BRAND_PURPLE")&&(e["rgb-brand-purple"]=t("BRAND_PURPLE")),t("HEADER_PRIMARY")&&(e["rgb-header-primary"]=t("HEADER_PRIMARY")),t("HEADER_HOVER")&&(e["rgb-header-hover"]=t("HEADER_HOVER")),t("PRESENTATION")&&(e["rgb-presentation"]=t("PRESENTATION")),Object.keys(e).length>0?e:void 0}();return s.jsx(br,{client:t,children:s.jsx(Ts,{children:s.jsx(PT,{children:s.jsx(Rd,{...n&&{initialTheme:"system",themeRGB:n},children:s.jsx(Za,{children:s.jsx($d,{children:s.jsxs(rr,{backend:or,children:[s.jsx(Ls,{router:kV}),s.jsx(_r,{initialIsOpen:!1,position:"top-right"}),s.jsx(Ll,{}),s.jsx(Ja,{className:"pointer-events-none fixed inset-0 z-[1000] mx-auto my-2 flex max-w-[560px] flex-col items-stretch justify-start md:pb-5"})]})})})})})})})},EV=()=>s.jsxs(mE,{children:[s.jsx(SV,{}),s.jsx("iframe",{src:"assets/silence.mp3",allow:"autoplay",id:"audio",title:"audio-silence",style:{display:"none"}})]}),TV=document.getElementById("root");Is.createRoot(TV).render(s.jsx(vT,{children:s.jsx(EV,{})}));export{ac as $,vU as A,dS as B,Uz as C,Cl as D,Qc as E,mR as F,Lz as G,Lv as H,gR as I,gg as J,Om as K,Tc as L,Ec as M,kc as N,tc as O,Rx as P,hg as Q,Dc as R,FU as S,ll as T,hp as U,Ti as V,Ai as W,kl as X,Sl as Y,Tl as Z,Bd as _,Fk as a,Il as a0,El as a1,Rl as a2,qy as a3,ul as a4,gl as a5,xl as a6,bl as a7,Kk as a8,aj as a9,nd as aa,wc as ab,Hk as ac,Wy as b,n_ as c,gE as d,ky as e,tj as f,Wk as g,Ki as h,Ky as i,Nc as j,Bc as k,Zz as l,qz as m,Nh as n,jU as o,Ei as p,Ri as q,Ol as r,Ny as s,xx as t,uS as u,Pi as v,Mi as w,Si as x,Mv as y,ki as z};
