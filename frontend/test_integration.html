<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #4a72ff;
            padding-bottom: 10px;
        }
        .test-button {
            background: #4a72ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #3d5fe0;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-item {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-item.success { color: #28a745; }
        .log-item.error { color: #dc3545; }
        .log-item.info { color: #333; }
        .form-group {
            margin: 10px 0;
        }
        .form-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸš€ APIé›†æˆæµ‹è¯•é¡µé¢</h1>
    
    <!-- ç”¨æˆ·è®¤è¯æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ‘¤ ç”¨æˆ·è®¤è¯æµ‹è¯•</h2>
        <div class="form-group">
            <input id="username" type="text" placeholder="ç”¨æˆ·å" value="testuser">
            <input id="password" type="password" placeholder="å¯†ç " value="testpass">
        </div>
        <button class="test-button" onclick="testRegister()">æ³¨å†Œç”¨æˆ·</button>
        <button class="test-button" onclick="testLogin()">ç™»å½•</button>
        <button class="test-button" onclick="testGetUser()">è·å–ç”¨æˆ·ä¿¡æ¯</button>
        <button class="test-button" onclick="testUpdateUser()">æ›´æ–°ç”¨æˆ·ä¿¡æ¯</button>
        <button class="test-button" onclick="testDeleteUser()">åˆ é™¤ç”¨æˆ·</button>
        <div id="authStatus" class="status info">æœªç™»å½•</div>
    </div>

    <!-- ä¼šè¯ç®¡ç†æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ’¬ ä¼šè¯ç®¡ç†æµ‹è¯•</h2>
        <div class="form-group">
            <input id="conversationTitle" type="text" placeholder="ä¼šè¯æ ‡é¢˜" value="æµ‹è¯•ä¼šè¯">
        </div>
        <button class="test-button" onclick="testCreateConversation()">åˆ›å»ºä¼šè¯</button>
        <button class="test-button" onclick="testGetConversations()">è·å–ä¼šè¯åˆ—è¡¨</button>
        <button class="test-button" onclick="testUpdateConversation()">æ›´æ–°ä¼šè¯æ ‡é¢˜</button>
        <button class="test-button" onclick="testDeleteConversation()">åˆ é™¤ä¼šè¯</button>
        <div id="conversationStatus" class="status info">æ— ä¼šè¯</div>
    </div>

    <!-- æ¶ˆæ¯ç®¡ç†æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸ“ æ¶ˆæ¯ç®¡ç†æµ‹è¯•</h2>
        <div class="form-group">
            <input id="messageContent" type="text" placeholder="æ¶ˆæ¯å†…å®¹" value="ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯">
        </div>
        <button class="test-button" onclick="testSendMessage()">å‘é€æ¶ˆæ¯</button>
        <button class="test-button" onclick="testGetMessages()">è·å–æ¶ˆæ¯åˆ—è¡¨</button>
        <button class="test-button" onclick="testUpdateMessage()">æ›´æ–°æ¶ˆæ¯å†…å®¹</button>
        <button class="test-button" onclick="testDeleteMessage()">åˆ é™¤æ¶ˆæ¯</button>
        <div id="messageStatus" class="status info">æ— æ¶ˆæ¯</div>
    </div>

    <!-- æµå¼æ¶ˆæ¯æµ‹è¯• -->
    <div class="test-section">
        <h2>ğŸŒŠ æµå¼æ¶ˆæ¯æµ‹è¯•</h2>
        <div class="form-group">
            <input id="streamMessage" type="text" placeholder="æµå¼æ¶ˆæ¯å†…å®¹" value="è¯·å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—">
            <label><input type="checkbox" id="enableSearch"> å¯ç”¨æœç´¢</label>
            <label><input type="checkbox" id="enableThinking"> å¯ç”¨æ€è€ƒ</label>
        </div>
        <button class="test-button" onclick="testStreamMessage()">å‘é€æµå¼æ¶ˆæ¯</button>
        <div id="streamStatus" class="status info">å‡†å¤‡å°±ç»ª</div>
        <div id="streamContent" class="log"></div>
    </div>

    <!-- æ“ä½œæ—¥å¿— -->
    <div class="test-section">
        <h2>ğŸ“‹ æ“ä½œæ—¥å¿—</h2>
        <button class="test-button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <div id="logs" class="log"></div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:8000/api';
        let currentToken = localStorage.getItem('token');
        let currentUserId = null;
        let currentConversationId = null;
        let currentMessageId = null;

        // æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.insertBefore(logItem, logs.firstChild);
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            while (logs.children.length > 100) {
                logs.removeChild(logs.lastChild);
            }
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // APIè¯·æ±‚å‡½æ•°
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };

            if (currentToken) {
                config.headers['Authorization'] = `Bearer ${currentToken}`;
            }

            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                addLog(`APIè¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                throw error;
            }
        }

        // ç”¨æˆ·è®¤è¯æµ‹è¯•
        async function testRegister() {
            try {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                addLog('å¼€å§‹ç”¨æˆ·æ³¨å†Œ...', 'info');
                const result = await apiRequest('/users/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
                
                addLog('ç”¨æˆ·æ³¨å†ŒæˆåŠŸ', 'success');
                document.getElementById('authStatus').textContent = 'æ³¨å†ŒæˆåŠŸ';
                document.getElementById('authStatus').className = 'status success';
            } catch (error) {
                addLog(`ç”¨æˆ·æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
                document.getElementById('authStatus').textContent = 'æ³¨å†Œå¤±è´¥';
                document.getElementById('authStatus').className = 'status error';
            }
        }

        async function testLogin() {
            try {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                addLog('å¼€å§‹ç”¨æˆ·ç™»å½•...', 'info');
                const result = await apiRequest('/users/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
                
                currentToken = result.access_token;
                localStorage.setItem('token', currentToken);
                
                addLog('ç”¨æˆ·ç™»å½•æˆåŠŸ', 'success');
                document.getElementById('authStatus').textContent = 'ç™»å½•æˆåŠŸ';
                document.getElementById('authStatus').className = 'status success';
            } catch (error) {
                addLog(`ç”¨æˆ·ç™»å½•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('authStatus').textContent = 'ç™»å½•å¤±è´¥';
                document.getElementById('authStatus').className = 'status error';
            }
        }

        async function testGetUser() {
            try {
                addLog('å¼€å§‹è·å–ç”¨æˆ·ä¿¡æ¯...', 'info');
                const result = await apiRequest('/users/me');
                
                currentUserId = result.id;
                addLog(`ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ: ${result.username} (ID: ${result.id})`, 'success');
                document.getElementById('authStatus').textContent = `å·²ç™»å½•: ${result.username}`;
                document.getElementById('authStatus').className = 'status success';
            } catch (error) {
                addLog(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('authStatus').textContent = 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥';
                document.getElementById('authStatus').className = 'status error';
            }
        }

        async function testUpdateUser() {
            try {
                const newUsername = prompt('è¯·è¾“å…¥æ–°çš„ç”¨æˆ·å:', 'updateduser');
                if (!newUsername) return;
                
                addLog('å¼€å§‹æ›´æ–°ç”¨æˆ·ä¿¡æ¯...', 'info');
                const result = await apiRequest('/users/me', {
                    method: 'PUT',
                    body: JSON.stringify({ username: newUsername })
                });
                
                addLog('ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ', 'success');
                document.getElementById('authStatus').textContent = `å·²æ›´æ–°: ${newUsername}`;
                document.getElementById('authStatus').className = 'status success';
            } catch (error) {
                addLog(`æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('authStatus').textContent = 'æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥';
                document.getElementById('authStatus').className = 'status error';
            }
        }

        async function testDeleteUser() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤ç”¨æˆ·è´¦æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            
            try {
                addLog('å¼€å§‹åˆ é™¤ç”¨æˆ·è´¦æˆ·...', 'info');
                await apiRequest('/users/me', { method: 'DELETE' });
                
                currentToken = null;
                currentUserId = null;
                localStorage.removeItem('token');
                
                addLog('ç”¨æˆ·è´¦æˆ·åˆ é™¤æˆåŠŸ', 'success');
                document.getElementById('authStatus').textContent = 'è´¦æˆ·å·²åˆ é™¤';
                document.getElementById('authStatus').className = 'status info';
            } catch (error) {
                addLog(`åˆ é™¤ç”¨æˆ·è´¦æˆ·å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('authStatus').textContent = 'åˆ é™¤ç”¨æˆ·è´¦æˆ·å¤±è´¥';
                document.getElementById('authStatus').className = 'status error';
            }
        }

        // ä¼šè¯ç®¡ç†æµ‹è¯•
        async function testCreateConversation() {
            try {
                const title = document.getElementById('conversationTitle').value;
                
                addLog('å¼€å§‹åˆ›å»ºä¼šè¯...', 'info');
                const result = await apiRequest('/conversations/', {
                    method: 'POST',
                    body: JSON.stringify({ title })
                });
                
                currentConversationId = result.id;
                addLog(`ä¼šè¯åˆ›å»ºæˆåŠŸ: ${result.title} (ID: ${result.id})`, 'success');
                document.getElementById('conversationStatus').textContent = `å½“å‰ä¼šè¯: ${result.title}`;
                document.getElementById('conversationStatus').className = 'status success';
            } catch (error) {
                addLog(`åˆ›å»ºä¼šè¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('conversationStatus').textContent = 'åˆ›å»ºä¼šè¯å¤±è´¥';
                document.getElementById('conversationStatus').className = 'status error';
            }
        }

        async function testGetConversations() {
            try {
                addLog('å¼€å§‹è·å–ä¼šè¯åˆ—è¡¨...', 'info');
                const result = await apiRequest('/conversations/');
                
                const conversations = result.conversations || result;
                addLog(`è·å–ä¼šè¯åˆ—è¡¨æˆåŠŸï¼Œå…± ${conversations.length} ä¸ªä¼šè¯`, 'success');
                document.getElementById('conversationStatus').textContent = `å…± ${conversations.length} ä¸ªä¼šè¯`;
                document.getElementById('conversationStatus').className = 'status success';
            } catch (error) {
                addLog(`è·å–ä¼šè¯åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('conversationStatus').textContent = 'è·å–ä¼šè¯åˆ—è¡¨å¤±è´¥';
                document.getElementById('conversationStatus').className = 'status error';
            }
        }

        async function testUpdateConversation() {
            if (!currentConversationId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªä¼šè¯');
                return;
            }
            
            try {
                const newTitle = prompt('è¯·è¾“å…¥æ–°çš„ä¼šè¯æ ‡é¢˜:', 'æ›´æ–°åçš„æ ‡é¢˜');
                if (!newTitle) return;
                
                addLog('å¼€å§‹æ›´æ–°ä¼šè¯æ ‡é¢˜...', 'info');
                await apiRequest(`/conversations/${currentConversationId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ title: newTitle })
                });
                
                addLog('ä¼šè¯æ ‡é¢˜æ›´æ–°æˆåŠŸ', 'success');
                document.getElementById('conversationStatus').textContent = `å½“å‰ä¼šè¯: ${newTitle}`;
                document.getElementById('conversationStatus').className = 'status success';
            } catch (error) {
                addLog(`æ›´æ–°ä¼šè¯æ ‡é¢˜å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('conversationStatus').textContent = 'æ›´æ–°ä¼šè¯æ ‡é¢˜å¤±è´¥';
                document.getElementById('conversationStatus').className = 'status error';
            }
        }

        async function testDeleteConversation() {
            if (!currentConversationId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªä¼šè¯');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¼šè¯å—ï¼Ÿ')) return;
            
            try {
                addLog('å¼€å§‹åˆ é™¤ä¼šè¯...', 'info');
                await apiRequest(`/conversations/${currentConversationId}`, { method: 'DELETE' });
                
                currentConversationId = null;
                addLog('ä¼šè¯åˆ é™¤æˆåŠŸ', 'success');
                document.getElementById('conversationStatus').textContent = 'ä¼šè¯å·²åˆ é™¤';
                document.getElementById('conversationStatus').className = 'status info';
            } catch (error) {
                addLog(`åˆ é™¤ä¼šè¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('conversationStatus').textContent = 'åˆ é™¤ä¼šè¯å¤±è´¥';
                document.getElementById('conversationStatus').className = 'status error';
            }
        }

        // æ¶ˆæ¯ç®¡ç†æµ‹è¯•
        async function testSendMessage() {
            if (!currentConversationId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªä¼šè¯');
                return;
            }
            
            try {
                const content = document.getElementById('messageContent').value;
                
                addLog('å¼€å§‹å‘é€æ¶ˆæ¯...', 'info');
                const result = await apiRequest('/messages/send', {
                    method: 'POST',
                    body: JSON.stringify({
                        content,
                        conversation_id: currentConversationId,
                        enable_search: false,
                        enable_thinking: false
                    })
                });
                
                addLog('æ¶ˆæ¯å‘é€æˆåŠŸ', 'success');
                document.getElementById('messageStatus').textContent = 'æ¶ˆæ¯å‘é€æˆåŠŸ';
                document.getElementById('messageStatus').className = 'status success';
            } catch (error) {
                addLog(`å‘é€æ¶ˆæ¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('messageStatus').textContent = 'å‘é€æ¶ˆæ¯å¤±è´¥';
                document.getElementById('messageStatus').className = 'status error';
            }
        }

        async function testGetMessages() {
            if (!currentConversationId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªä¼šè¯');
                return;
            }
            
            try {
                addLog('å¼€å§‹è·å–æ¶ˆæ¯åˆ—è¡¨...', 'info');
                const result = await apiRequest(`/messages/conversation/${currentConversationId}`);
                
                const messages = result.messages || result;
                addLog(`è·å–æ¶ˆæ¯åˆ—è¡¨æˆåŠŸï¼Œå…± ${messages.length} æ¡æ¶ˆæ¯`, 'success');
                document.getElementById('messageStatus').textContent = `å…± ${messages.length} æ¡æ¶ˆæ¯`;
                document.getElementById('messageStatus').className = 'status success';
                
                if (messages.length > 0) {
                    currentMessageId = messages[messages.length - 1].id;
                }
            } catch (error) {
                addLog(`è·å–æ¶ˆæ¯åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('messageStatus').textContent = 'è·å–æ¶ˆæ¯åˆ—è¡¨å¤±è´¥';
                document.getElementById('messageStatus').className = 'status error';
            }
        }

        async function testUpdateMessage() {
            if (!currentMessageId) {
                alert('è¯·å…ˆå‘é€ä¸€æ¡æ¶ˆæ¯');
                return;
            }
            
            try {
                const newContent = prompt('è¯·è¾“å…¥æ–°çš„æ¶ˆæ¯å†…å®¹:', 'æ›´æ–°åçš„æ¶ˆæ¯å†…å®¹');
                if (!newContent) return;
                
                addLog('å¼€å§‹æ›´æ–°æ¶ˆæ¯å†…å®¹...', 'info');
                await apiRequest(`/messages/${currentMessageId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ content: newContent })
                });
                
                addLog('æ¶ˆæ¯å†…å®¹æ›´æ–°æˆåŠŸ', 'success');
                document.getElementById('messageStatus').textContent = 'æ¶ˆæ¯å†…å®¹æ›´æ–°æˆåŠŸ';
                document.getElementById('messageStatus').className = 'status success';
            } catch (error) {
                addLog(`æ›´æ–°æ¶ˆæ¯å†…å®¹å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('messageStatus').textContent = 'æ›´æ–°æ¶ˆæ¯å†…å®¹å¤±è´¥';
                document.getElementById('messageStatus').className = 'status error';
            }
        }

        async function testDeleteMessage() {
            if (!currentMessageId) {
                alert('è¯·å…ˆå‘é€ä¸€æ¡æ¶ˆæ¯');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ')) return;
            
            try {
                addLog('å¼€å§‹åˆ é™¤æ¶ˆæ¯...', 'info');
                await apiRequest(`/messages/${currentMessageId}`, { method: 'DELETE' });
                
                currentMessageId = null;
                addLog('æ¶ˆæ¯åˆ é™¤æˆåŠŸ', 'success');
                document.getElementById('messageStatus').textContent = 'æ¶ˆæ¯å·²åˆ é™¤';
                document.getElementById('messageStatus').className = 'status info';
            } catch (error) {
                addLog(`åˆ é™¤æ¶ˆæ¯å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('messageStatus').textContent = 'åˆ é™¤æ¶ˆæ¯å¤±è´¥';
                document.getElementById('messageStatus').className = 'status error';
            }
        }

        // æµå¼æ¶ˆæ¯æµ‹è¯•
        async function testStreamMessage() {
            if (!currentConversationId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªä¼šè¯');
                return;
            }
            
            try {
                const content = document.getElementById('streamMessage').value;
                const enableSearch = document.getElementById('enableSearch').checked;
                const enableThinking = document.getElementById('enableThinking').checked;
                
                addLog('å¼€å§‹å‘é€æµå¼æ¶ˆæ¯...', 'info');
                document.getElementById('streamContent').innerHTML = '';
                document.getElementById('streamStatus').textContent = 'æ­£åœ¨å‘é€...';
                document.getElementById('streamStatus').className = 'status info';
                
                const response = await fetch(`${API_BASE_URL}/messages/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({
                        content,
                        conversation_id: currentConversationId,
                        enable_search: enableSearch,
                        enable_thinking: enableThinking
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop();

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                handleStreamChunk(data);
                            } catch (e) {
                                console.error('è§£ææµæ•°æ®å¤±è´¥:', e);
                            }
                        }
                    }
                }

                addLog('æµå¼æ¶ˆæ¯å‘é€å®Œæˆ', 'success');
                document.getElementById('streamStatus').textContent = 'å‘é€å®Œæˆ';
                document.getElementById('streamStatus').className = 'status success';
            } catch (error) {
                addLog(`æµå¼æ¶ˆæ¯å‘é€å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('streamStatus').textContent = 'å‘é€å¤±è´¥';
                document.getElementById('streamStatus').className = 'status error';
            }
        }

        function handleStreamChunk(chunk) {
            const streamContent = document.getElementById('streamContent');
            const logItem = document.createElement('div');
            logItem.className = 'log-item info';
            
            switch (chunk.type) {
                case 'conversation':
                    logItem.textContent = `[ä¼šè¯] ID: ${chunk.conversation_id}`;
                    break;
                case 'message':
                    logItem.textContent = `[æ¶ˆæ¯] ID: ${chunk.message_id}`;
                    break;
                case 'content':
                    logItem.textContent = `[å†…å®¹] ${chunk.content}`;
                    break;
                case 'tool_start':
                    logItem.textContent = `[å·¥å…·å¼€å§‹] ${chunk.content}`;
                    break;
                case 'tool_end':
                    logItem.textContent = `[å·¥å…·ç»“æŸ] ${chunk.content}`;
                    break;
                case 'thinking':
                    logItem.textContent = `[æ€è€ƒ] ${chunk.content}`;
                    break;
                case 'error':
                    logItem.textContent = `[é”™è¯¯] ${chunk.content}`;
                    logItem.className = 'log-item error';
                    break;
                case 'done':
                    logItem.textContent = `[å®Œæˆ] æ¶ˆæ¯å‘é€å®Œæˆ`;
                    logItem.className = 'log-item success';
                    break;
                default:
                    logItem.textContent = `[æœªçŸ¥] ${JSON.stringify(chunk)}`;
            }
            
            streamContent.appendChild(logItem);
            streamContent.scrollTop = streamContent.scrollHeight;
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.onload = function() {
            if (currentToken) {
                addLog('æ£€æµ‹åˆ°å·²ä¿å­˜çš„tokenï¼Œå°è¯•è·å–ç”¨æˆ·ä¿¡æ¯...', 'info');
                testGetUser();
            } else {
                addLog('æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ï¼Œè¯·å…ˆç™»å½•', 'info');
            }
        };
    </script>
</body>
</html>
